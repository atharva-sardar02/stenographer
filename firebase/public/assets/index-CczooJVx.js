function JA(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in t)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(t,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();function wS(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var xS={exports:{}},ch={},ES={exports:{}},ue={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gu=Symbol.for("react.element"),YA=Symbol.for("react.portal"),XA=Symbol.for("react.fragment"),ZA=Symbol.for("react.strict_mode"),eN=Symbol.for("react.profiler"),tN=Symbol.for("react.provider"),nN=Symbol.for("react.context"),rN=Symbol.for("react.forward_ref"),sN=Symbol.for("react.suspense"),iN=Symbol.for("react.memo"),oN=Symbol.for("react.lazy"),y_=Symbol.iterator;function aN(t){return t===null||typeof t!="object"?null:(t=y_&&t[y_]||t["@@iterator"],typeof t=="function"?t:null)}var SS={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},bS=Object.assign,TS={};function ha(t,e,n){this.props=t,this.context=e,this.refs=TS,this.updater=n||SS}ha.prototype.isReactComponent={};ha.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};ha.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function kS(){}kS.prototype=ha.prototype;function jg(t,e,n){this.props=t,this.context=e,this.refs=TS,this.updater=n||SS}var Fg=jg.prototype=new kS;Fg.constructor=jg;bS(Fg,ha.prototype);Fg.isPureReactComponent=!0;var v_=Array.isArray,IS=Object.prototype.hasOwnProperty,Ug={current:null},CS={key:!0,ref:!0,__self:!0,__source:!0};function AS(t,e,n){var r,s={},i=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)IS.call(e,r)&&!CS.hasOwnProperty(r)&&(s[r]=e[r]);var a=arguments.length-2;if(a===1)s.children=n;else if(1<a){for(var l=Array(a),u=0;u<a;u++)l[u]=arguments[u+2];s.children=l}if(t&&t.defaultProps)for(r in a=t.defaultProps,a)s[r]===void 0&&(s[r]=a[r]);return{$$typeof:gu,type:t,key:i,ref:o,props:s,_owner:Ug.current}}function lN(t,e){return{$$typeof:gu,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Bg(t){return typeof t=="object"&&t!==null&&t.$$typeof===gu}function uN(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var __=/\/+/g;function Lf(t,e){return typeof t=="object"&&t!==null&&t.key!=null?uN(""+t.key):e.toString(36)}function Uc(t,e,n,r,s){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case gu:case YA:o=!0}}if(o)return o=t,s=s(o),t=r===""?"."+Lf(o,0):r,v_(s)?(n="",t!=null&&(n=t.replace(__,"$&/")+"/"),Uc(s,e,n,"",function(u){return u})):s!=null&&(Bg(s)&&(s=lN(s,n+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(__,"$&/")+"/")+t)),e.push(s)),1;if(o=0,r=r===""?".":r+":",v_(t))for(var a=0;a<t.length;a++){i=t[a];var l=r+Lf(i,a);o+=Uc(i,e,n,l,s)}else if(l=aN(t),typeof l=="function")for(t=l.call(t),a=0;!(i=t.next()).done;)i=i.value,l=r+Lf(i,a++),o+=Uc(i,e,n,l,s);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function ic(t,e,n){if(t==null)return t;var r=[],s=0;return Uc(t,r,"","",function(i){return e.call(n,i,s++)}),r}function cN(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Ht={current:null},Bc={transition:null},dN={ReactCurrentDispatcher:Ht,ReactCurrentBatchConfig:Bc,ReactCurrentOwner:Ug};function NS(){throw Error("act(...) is not supported in production builds of React.")}ue.Children={map:ic,forEach:function(t,e,n){ic(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return ic(t,function(){e++}),e},toArray:function(t){return ic(t,function(e){return e})||[]},only:function(t){if(!Bg(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};ue.Component=ha;ue.Fragment=XA;ue.Profiler=eN;ue.PureComponent=jg;ue.StrictMode=ZA;ue.Suspense=sN;ue.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=dN;ue.act=NS;ue.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=bS({},t.props),s=t.key,i=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=Ug.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)IS.call(e,l)&&!CS.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=n;else if(1<l){a=Array(l);for(var u=0;u<l;u++)a[u]=arguments[u+2];r.children=a}return{$$typeof:gu,type:t.type,key:s,ref:i,props:r,_owner:o}};ue.createContext=function(t){return t={$$typeof:nN,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:tN,_context:t},t.Consumer=t};ue.createElement=AS;ue.createFactory=function(t){var e=AS.bind(null,t);return e.type=t,e};ue.createRef=function(){return{current:null}};ue.forwardRef=function(t){return{$$typeof:rN,render:t}};ue.isValidElement=Bg;ue.lazy=function(t){return{$$typeof:oN,_payload:{_status:-1,_result:t},_init:cN}};ue.memo=function(t,e){return{$$typeof:iN,type:t,compare:e===void 0?null:e}};ue.startTransition=function(t){var e=Bc.transition;Bc.transition={};try{t()}finally{Bc.transition=e}};ue.unstable_act=NS;ue.useCallback=function(t,e){return Ht.current.useCallback(t,e)};ue.useContext=function(t){return Ht.current.useContext(t)};ue.useDebugValue=function(){};ue.useDeferredValue=function(t){return Ht.current.useDeferredValue(t)};ue.useEffect=function(t,e){return Ht.current.useEffect(t,e)};ue.useId=function(){return Ht.current.useId()};ue.useImperativeHandle=function(t,e,n){return Ht.current.useImperativeHandle(t,e,n)};ue.useInsertionEffect=function(t,e){return Ht.current.useInsertionEffect(t,e)};ue.useLayoutEffect=function(t,e){return Ht.current.useLayoutEffect(t,e)};ue.useMemo=function(t,e){return Ht.current.useMemo(t,e)};ue.useReducer=function(t,e,n){return Ht.current.useReducer(t,e,n)};ue.useRef=function(t){return Ht.current.useRef(t)};ue.useState=function(t){return Ht.current.useState(t)};ue.useSyncExternalStore=function(t,e,n){return Ht.current.useSyncExternalStore(t,e,n)};ue.useTransition=function(){return Ht.current.useTransition()};ue.version="18.3.1";ES.exports=ue;var R=ES.exports;const dt=wS(R),hN=JA({__proto__:null,default:dt},[R]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fN=R,pN=Symbol.for("react.element"),mN=Symbol.for("react.fragment"),gN=Object.prototype.hasOwnProperty,yN=fN.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,vN={key:!0,ref:!0,__self:!0,__source:!0};function RS(t,e,n){var r,s={},i=null,o=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)gN.call(e,r)&&!vN.hasOwnProperty(r)&&(s[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:pN,type:t,key:i,ref:o,props:s,_owner:yN.current}}ch.Fragment=mN;ch.jsx=RS;ch.jsxs=RS;xS.exports=ch;var p=xS.exports,Kp={},PS={exports:{}},mn={},DS={exports:{}},OS={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e($,X){var ie=$.length;$.push(X);e:for(;0<ie;){var De=ie-1>>>1,_e=$[De];if(0<s(_e,X))$[De]=X,$[ie]=_e,ie=De;else break e}}function n($){return $.length===0?null:$[0]}function r($){if($.length===0)return null;var X=$[0],ie=$.pop();if(ie!==X){$[0]=ie;e:for(var De=0,_e=$.length,ze=_e>>>1;De<ze;){var ur=2*(De+1)-1,cr=$[ur],dr=ur+1,hr=$[dr];if(0>s(cr,ie))dr<_e&&0>s(hr,cr)?($[De]=hr,$[dr]=ie,De=dr):($[De]=cr,$[ur]=ie,De=ur);else if(dr<_e&&0>s(hr,ie))$[De]=hr,$[dr]=ie,De=dr;else break e}}return X}function s($,X){var ie=$.sortIndex-X.sortIndex;return ie!==0?ie:$.id-X.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],u=[],d=1,h=null,f=3,m=!1,y=!1,v=!1,w=typeof setTimeout=="function"?setTimeout:null,x=typeof clearTimeout=="function"?clearTimeout:null,S=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function b($){for(var X=n(u);X!==null;){if(X.callback===null)r(u);else if(X.startTime<=$)r(u),X.sortIndex=X.expirationTime,e(l,X);else break;X=n(u)}}function N($){if(v=!1,b($),!y)if(n(l)!==null)y=!0,ge(M);else{var X=n(u);X!==null&&Re(N,X.startTime-$)}}function M($,X){y=!1,v&&(v=!1,x(E),E=-1),m=!0;var ie=f;try{for(b(X),h=n(l);h!==null&&(!(h.expirationTime>X)||$&&!P());){var De=h.callback;if(typeof De=="function"){h.callback=null,f=h.priorityLevel;var _e=De(h.expirationTime<=X);X=t.unstable_now(),typeof _e=="function"?h.callback=_e:h===n(l)&&r(l),b(X)}else r(l);h=n(l)}if(h!==null)var ze=!0;else{var ur=n(u);ur!==null&&Re(N,ur.startTime-X),ze=!1}return ze}finally{h=null,f=ie,m=!1}}var V=!1,k=null,E=-1,I=5,C=-1;function P(){return!(t.unstable_now()-C<I)}function D(){if(k!==null){var $=t.unstable_now();C=$;var X=!0;try{X=k(!0,$)}finally{X?A():(V=!1,k=null)}}else V=!1}var A;if(typeof S=="function")A=function(){S(D)};else if(typeof MessageChannel<"u"){var Z=new MessageChannel,Q=Z.port2;Z.port1.onmessage=D,A=function(){Q.postMessage(null)}}else A=function(){w(D,0)};function ge($){k=$,V||(V=!0,A())}function Re($,X){E=w(function(){$(t.unstable_now())},X)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function($){$.callback=null},t.unstable_continueExecution=function(){y||m||(y=!0,ge(M))},t.unstable_forceFrameRate=function($){0>$||125<$?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<$?Math.floor(1e3/$):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function($){switch(f){case 1:case 2:case 3:var X=3;break;default:X=f}var ie=f;f=X;try{return $()}finally{f=ie}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function($,X){switch($){case 1:case 2:case 3:case 4:case 5:break;default:$=3}var ie=f;f=$;try{return X()}finally{f=ie}},t.unstable_scheduleCallback=function($,X,ie){var De=t.unstable_now();switch(typeof ie=="object"&&ie!==null?(ie=ie.delay,ie=typeof ie=="number"&&0<ie?De+ie:De):ie=De,$){case 1:var _e=-1;break;case 2:_e=250;break;case 5:_e=1073741823;break;case 4:_e=1e4;break;default:_e=5e3}return _e=ie+_e,$={id:d++,callback:X,priorityLevel:$,startTime:ie,expirationTime:_e,sortIndex:-1},ie>De?($.sortIndex=ie,e(u,$),n(l)===null&&$===n(u)&&(v?(x(E),E=-1):v=!0,Re(N,ie-De))):($.sortIndex=_e,e(l,$),y||m||(y=!0,ge(M))),$},t.unstable_shouldYield=P,t.unstable_wrapCallback=function($){var X=f;return function(){var ie=f;f=X;try{return $.apply(this,arguments)}finally{f=ie}}}})(OS);DS.exports=OS;var _N=DS.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wN=R,pn=_N;function B(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var MS=new Set,Nl={};function Hi(t,e){zo(t,e),zo(t+"Capture",e)}function zo(t,e){for(Nl[t]=e,t=0;t<e.length;t++)MS.add(e[t])}var Pr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Gp=Object.prototype.hasOwnProperty,xN=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,w_={},x_={};function EN(t){return Gp.call(x_,t)?!0:Gp.call(w_,t)?!1:xN.test(t)?x_[t]=!0:(w_[t]=!0,!1)}function SN(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function bN(t,e,n,r){if(e===null||typeof e>"u"||SN(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Wt(t,e,n,r,s,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var yt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){yt[t]=new Wt(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];yt[e]=new Wt(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){yt[t]=new Wt(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){yt[t]=new Wt(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){yt[t]=new Wt(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){yt[t]=new Wt(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){yt[t]=new Wt(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){yt[t]=new Wt(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){yt[t]=new Wt(t,5,!1,t.toLowerCase(),null,!1,!1)});var zg=/[\-:]([a-z])/g;function $g(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(zg,$g);yt[e]=new Wt(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(zg,$g);yt[e]=new Wt(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(zg,$g);yt[e]=new Wt(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){yt[t]=new Wt(t,1,!1,t.toLowerCase(),null,!1,!1)});yt.xlinkHref=new Wt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){yt[t]=new Wt(t,1,!1,t.toLowerCase(),null,!0,!0)});function qg(t,e,n,r){var s=yt.hasOwnProperty(e)?yt[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(bN(e,n,s,r)&&(n=null),r||s===null?EN(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,r=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var Br=wN.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,oc=Symbol.for("react.element"),po=Symbol.for("react.portal"),mo=Symbol.for("react.fragment"),Hg=Symbol.for("react.strict_mode"),Qp=Symbol.for("react.profiler"),LS=Symbol.for("react.provider"),VS=Symbol.for("react.context"),Wg=Symbol.for("react.forward_ref"),Jp=Symbol.for("react.suspense"),Yp=Symbol.for("react.suspense_list"),Kg=Symbol.for("react.memo"),Yr=Symbol.for("react.lazy"),jS=Symbol.for("react.offscreen"),E_=Symbol.iterator;function ja(t){return t===null||typeof t!="object"?null:(t=E_&&t[E_]||t["@@iterator"],typeof t=="function"?t:null)}var Le=Object.assign,Vf;function Ja(t){if(Vf===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Vf=e&&e[1]||""}return`
`+Vf+t}var jf=!1;function Ff(t,e){if(!t||jf)return"";jf=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var r=u}Reflect.construct(t,[],e)}else{try{e.call()}catch(u){r=u}t.call(e.prototype)}else{try{throw Error()}catch(u){r=u}t()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var s=u.stack.split(`
`),i=r.stack.split(`
`),o=s.length-1,a=i.length-1;1<=o&&0<=a&&s[o]!==i[a];)a--;for(;1<=o&&0<=a;o--,a--)if(s[o]!==i[a]){if(o!==1||a!==1)do if(o--,a--,0>a||s[o]!==i[a]){var l=`
`+s[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{jf=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Ja(t):""}function TN(t){switch(t.tag){case 5:return Ja(t.type);case 16:return Ja("Lazy");case 13:return Ja("Suspense");case 19:return Ja("SuspenseList");case 0:case 2:case 15:return t=Ff(t.type,!1),t;case 11:return t=Ff(t.type.render,!1),t;case 1:return t=Ff(t.type,!0),t;default:return""}}function Xp(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case mo:return"Fragment";case po:return"Portal";case Qp:return"Profiler";case Hg:return"StrictMode";case Jp:return"Suspense";case Yp:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case VS:return(t.displayName||"Context")+".Consumer";case LS:return(t._context.displayName||"Context")+".Provider";case Wg:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Kg:return e=t.displayName||null,e!==null?e:Xp(t.type)||"Memo";case Yr:e=t._payload,t=t._init;try{return Xp(t(e))}catch{}}return null}function kN(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Xp(e);case 8:return e===Hg?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Ds(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function FS(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function IN(t){var e=FS(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){r=""+o,i.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function ac(t){t._valueTracker||(t._valueTracker=IN(t))}function US(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=FS(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function dd(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Zp(t,e){var n=e.checked;return Le({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function S_(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=Ds(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function BS(t,e){e=e.checked,e!=null&&qg(t,"checked",e,!1)}function em(t,e){BS(t,e);var n=Ds(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?tm(t,e.type,n):e.hasOwnProperty("defaultValue")&&tm(t,e.type,Ds(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function b_(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function tm(t,e,n){(e!=="number"||dd(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Ya=Array.isArray;function Co(t,e,n,r){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&r&&(t[n].defaultSelected=!0)}else{for(n=""+Ds(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,r&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function nm(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(B(91));return Le({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function T_(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(B(92));if(Ya(n)){if(1<n.length)throw Error(B(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Ds(n)}}function zS(t,e){var n=Ds(e.value),r=Ds(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function k_(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function $S(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function rm(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?$S(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var lc,qS=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(lc=lc||document.createElement("div"),lc.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=lc.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Rl(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var cl={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},CN=["Webkit","ms","Moz","O"];Object.keys(cl).forEach(function(t){CN.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),cl[e]=cl[t]})});function HS(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||cl.hasOwnProperty(t)&&cl[t]?(""+e).trim():e+"px"}function WS(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=HS(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,s):t[n]=s}}var AN=Le({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function sm(t,e){if(e){if(AN[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(B(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(B(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(B(61))}if(e.style!=null&&typeof e.style!="object")throw Error(B(62))}}function im(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var om=null;function Gg(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var am=null,Ao=null,No=null;function I_(t){if(t=_u(t)){if(typeof am!="function")throw Error(B(280));var e=t.stateNode;e&&(e=mh(e),am(t.stateNode,t.type,e))}}function KS(t){Ao?No?No.push(t):No=[t]:Ao=t}function GS(){if(Ao){var t=Ao,e=No;if(No=Ao=null,I_(t),e)for(t=0;t<e.length;t++)I_(e[t])}}function QS(t,e){return t(e)}function JS(){}var Uf=!1;function YS(t,e,n){if(Uf)return t(e,n);Uf=!0;try{return QS(t,e,n)}finally{Uf=!1,(Ao!==null||No!==null)&&(JS(),GS())}}function Pl(t,e){var n=t.stateNode;if(n===null)return null;var r=mh(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(B(231,e,typeof n));return n}var lm=!1;if(Pr)try{var Fa={};Object.defineProperty(Fa,"passive",{get:function(){lm=!0}}),window.addEventListener("test",Fa,Fa),window.removeEventListener("test",Fa,Fa)}catch{lm=!1}function NN(t,e,n,r,s,i,o,a,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(n,u)}catch(d){this.onError(d)}}var dl=!1,hd=null,fd=!1,um=null,RN={onError:function(t){dl=!0,hd=t}};function PN(t,e,n,r,s,i,o,a,l){dl=!1,hd=null,NN.apply(RN,arguments)}function DN(t,e,n,r,s,i,o,a,l){if(PN.apply(this,arguments),dl){if(dl){var u=hd;dl=!1,hd=null}else throw Error(B(198));fd||(fd=!0,um=u)}}function Wi(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function XS(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function C_(t){if(Wi(t)!==t)throw Error(B(188))}function ON(t){var e=t.alternate;if(!e){if(e=Wi(t),e===null)throw Error(B(188));return e!==t?null:t}for(var n=t,r=e;;){var s=n.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===n)return C_(s),t;if(i===r)return C_(s),e;i=i.sibling}throw Error(B(188))}if(n.return!==r.return)n=s,r=i;else{for(var o=!1,a=s.child;a;){if(a===n){o=!0,n=s,r=i;break}if(a===r){o=!0,r=s,n=i;break}a=a.sibling}if(!o){for(a=i.child;a;){if(a===n){o=!0,n=i,r=s;break}if(a===r){o=!0,r=i,n=s;break}a=a.sibling}if(!o)throw Error(B(189))}}if(n.alternate!==r)throw Error(B(190))}if(n.tag!==3)throw Error(B(188));return n.stateNode.current===n?t:e}function ZS(t){return t=ON(t),t!==null?eb(t):null}function eb(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=eb(t);if(e!==null)return e;t=t.sibling}return null}var tb=pn.unstable_scheduleCallback,A_=pn.unstable_cancelCallback,MN=pn.unstable_shouldYield,LN=pn.unstable_requestPaint,qe=pn.unstable_now,VN=pn.unstable_getCurrentPriorityLevel,Qg=pn.unstable_ImmediatePriority,nb=pn.unstable_UserBlockingPriority,pd=pn.unstable_NormalPriority,jN=pn.unstable_LowPriority,rb=pn.unstable_IdlePriority,dh=null,Xn=null;function FN(t){if(Xn&&typeof Xn.onCommitFiberRoot=="function")try{Xn.onCommitFiberRoot(dh,t,void 0,(t.current.flags&128)===128)}catch{}}var Fn=Math.clz32?Math.clz32:zN,UN=Math.log,BN=Math.LN2;function zN(t){return t>>>=0,t===0?32:31-(UN(t)/BN|0)|0}var uc=64,cc=4194304;function Xa(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function md(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,s=t.suspendedLanes,i=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~s;a!==0?r=Xa(a):(i&=o,i!==0&&(r=Xa(i)))}else o=n&~s,o!==0?r=Xa(o):i!==0&&(r=Xa(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-Fn(e),s=1<<n,r|=t[n],e&=~s;return r}function $N(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function qN(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,s=t.expirationTimes,i=t.pendingLanes;0<i;){var o=31-Fn(i),a=1<<o,l=s[o];l===-1?(!(a&n)||a&r)&&(s[o]=$N(a,e)):l<=e&&(t.expiredLanes|=a),i&=~a}}function cm(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function sb(){var t=uc;return uc<<=1,!(uc&4194240)&&(uc=64),t}function Bf(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function yu(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Fn(e),t[e]=n}function HN(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var s=31-Fn(n),i=1<<s;e[s]=0,r[s]=-1,t[s]=-1,n&=~i}}function Jg(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-Fn(n),s=1<<r;s&e|t[r]&e&&(t[r]|=e),n&=~s}}var ye=0;function ib(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var ob,Yg,ab,lb,ub,dm=!1,dc=[],gs=null,ys=null,vs=null,Dl=new Map,Ol=new Map,ts=[],WN="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function N_(t,e){switch(t){case"focusin":case"focusout":gs=null;break;case"dragenter":case"dragleave":ys=null;break;case"mouseover":case"mouseout":vs=null;break;case"pointerover":case"pointerout":Dl.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ol.delete(e.pointerId)}}function Ua(t,e,n,r,s,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=_u(e),e!==null&&Yg(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function KN(t,e,n,r,s){switch(e){case"focusin":return gs=Ua(gs,t,e,n,r,s),!0;case"dragenter":return ys=Ua(ys,t,e,n,r,s),!0;case"mouseover":return vs=Ua(vs,t,e,n,r,s),!0;case"pointerover":var i=s.pointerId;return Dl.set(i,Ua(Dl.get(i)||null,t,e,n,r,s)),!0;case"gotpointercapture":return i=s.pointerId,Ol.set(i,Ua(Ol.get(i)||null,t,e,n,r,s)),!0}return!1}function cb(t){var e=di(t.target);if(e!==null){var n=Wi(e);if(n!==null){if(e=n.tag,e===13){if(e=XS(n),e!==null){t.blockedOn=e,ub(t.priority,function(){ab(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function zc(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=hm(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);om=r,n.target.dispatchEvent(r),om=null}else return e=_u(n),e!==null&&Yg(e),t.blockedOn=n,!1;e.shift()}return!0}function R_(t,e,n){zc(t)&&n.delete(e)}function GN(){dm=!1,gs!==null&&zc(gs)&&(gs=null),ys!==null&&zc(ys)&&(ys=null),vs!==null&&zc(vs)&&(vs=null),Dl.forEach(R_),Ol.forEach(R_)}function Ba(t,e){t.blockedOn===e&&(t.blockedOn=null,dm||(dm=!0,pn.unstable_scheduleCallback(pn.unstable_NormalPriority,GN)))}function Ml(t){function e(s){return Ba(s,t)}if(0<dc.length){Ba(dc[0],t);for(var n=1;n<dc.length;n++){var r=dc[n];r.blockedOn===t&&(r.blockedOn=null)}}for(gs!==null&&Ba(gs,t),ys!==null&&Ba(ys,t),vs!==null&&Ba(vs,t),Dl.forEach(e),Ol.forEach(e),n=0;n<ts.length;n++)r=ts[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<ts.length&&(n=ts[0],n.blockedOn===null);)cb(n),n.blockedOn===null&&ts.shift()}var Ro=Br.ReactCurrentBatchConfig,gd=!0;function QN(t,e,n,r){var s=ye,i=Ro.transition;Ro.transition=null;try{ye=1,Xg(t,e,n,r)}finally{ye=s,Ro.transition=i}}function JN(t,e,n,r){var s=ye,i=Ro.transition;Ro.transition=null;try{ye=4,Xg(t,e,n,r)}finally{ye=s,Ro.transition=i}}function Xg(t,e,n,r){if(gd){var s=hm(t,e,n,r);if(s===null)Yf(t,e,r,yd,n),N_(t,r);else if(KN(s,t,e,n,r))r.stopPropagation();else if(N_(t,r),e&4&&-1<WN.indexOf(t)){for(;s!==null;){var i=_u(s);if(i!==null&&ob(i),i=hm(t,e,n,r),i===null&&Yf(t,e,r,yd,n),i===s)break;s=i}s!==null&&r.stopPropagation()}else Yf(t,e,r,null,n)}}var yd=null;function hm(t,e,n,r){if(yd=null,t=Gg(r),t=di(t),t!==null)if(e=Wi(t),e===null)t=null;else if(n=e.tag,n===13){if(t=XS(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return yd=t,null}function db(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(VN()){case Qg:return 1;case nb:return 4;case pd:case jN:return 16;case rb:return 536870912;default:return 16}default:return 16}}var us=null,Zg=null,$c=null;function hb(){if($c)return $c;var t,e=Zg,n=e.length,r,s="value"in us?us.value:us.textContent,i=s.length;for(t=0;t<n&&e[t]===s[t];t++);var o=n-t;for(r=1;r<=o&&e[n-r]===s[i-r];r++);return $c=s.slice(t,1<r?1-r:void 0)}function qc(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function hc(){return!0}function P_(){return!1}function gn(t){function e(n,r,s,i,o){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(i):i[a]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?hc:P_,this.isPropagationStopped=P_,this}return Le(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=hc)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=hc)},persist:function(){},isPersistent:hc}),e}var fa={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ey=gn(fa),vu=Le({},fa,{view:0,detail:0}),YN=gn(vu),zf,$f,za,hh=Le({},vu,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ty,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==za&&(za&&t.type==="mousemove"?(zf=t.screenX-za.screenX,$f=t.screenY-za.screenY):$f=zf=0,za=t),zf)},movementY:function(t){return"movementY"in t?t.movementY:$f}}),D_=gn(hh),XN=Le({},hh,{dataTransfer:0}),ZN=gn(XN),eR=Le({},vu,{relatedTarget:0}),qf=gn(eR),tR=Le({},fa,{animationName:0,elapsedTime:0,pseudoElement:0}),nR=gn(tR),rR=Le({},fa,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),sR=gn(rR),iR=Le({},fa,{data:0}),O_=gn(iR),oR={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},aR={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},lR={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function uR(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=lR[t])?!!e[t]:!1}function ty(){return uR}var cR=Le({},vu,{key:function(t){if(t.key){var e=oR[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=qc(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?aR[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ty,charCode:function(t){return t.type==="keypress"?qc(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?qc(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),dR=gn(cR),hR=Le({},hh,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),M_=gn(hR),fR=Le({},vu,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ty}),pR=gn(fR),mR=Le({},fa,{propertyName:0,elapsedTime:0,pseudoElement:0}),gR=gn(mR),yR=Le({},hh,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),vR=gn(yR),_R=[9,13,27,32],ny=Pr&&"CompositionEvent"in window,hl=null;Pr&&"documentMode"in document&&(hl=document.documentMode);var wR=Pr&&"TextEvent"in window&&!hl,fb=Pr&&(!ny||hl&&8<hl&&11>=hl),L_=" ",V_=!1;function pb(t,e){switch(t){case"keyup":return _R.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function mb(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var go=!1;function xR(t,e){switch(t){case"compositionend":return mb(e);case"keypress":return e.which!==32?null:(V_=!0,L_);case"textInput":return t=e.data,t===L_&&V_?null:t;default:return null}}function ER(t,e){if(go)return t==="compositionend"||!ny&&pb(t,e)?(t=hb(),$c=Zg=us=null,go=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return fb&&e.locale!=="ko"?null:e.data;default:return null}}var SR={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function j_(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!SR[t.type]:e==="textarea"}function gb(t,e,n,r){KS(r),e=vd(e,"onChange"),0<e.length&&(n=new ey("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var fl=null,Ll=null;function bR(t){Ib(t,0)}function fh(t){var e=_o(t);if(US(e))return t}function TR(t,e){if(t==="change")return e}var yb=!1;if(Pr){var Hf;if(Pr){var Wf="oninput"in document;if(!Wf){var F_=document.createElement("div");F_.setAttribute("oninput","return;"),Wf=typeof F_.oninput=="function"}Hf=Wf}else Hf=!1;yb=Hf&&(!document.documentMode||9<document.documentMode)}function U_(){fl&&(fl.detachEvent("onpropertychange",vb),Ll=fl=null)}function vb(t){if(t.propertyName==="value"&&fh(Ll)){var e=[];gb(e,Ll,t,Gg(t)),YS(bR,e)}}function kR(t,e,n){t==="focusin"?(U_(),fl=e,Ll=n,fl.attachEvent("onpropertychange",vb)):t==="focusout"&&U_()}function IR(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return fh(Ll)}function CR(t,e){if(t==="click")return fh(e)}function AR(t,e){if(t==="input"||t==="change")return fh(e)}function NR(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var $n=typeof Object.is=="function"?Object.is:NR;function Vl(t,e){if($n(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!Gp.call(e,s)||!$n(t[s],e[s]))return!1}return!0}function B_(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function z_(t,e){var n=B_(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=B_(n)}}function _b(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?_b(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function wb(){for(var t=window,e=dd();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=dd(t.document)}return e}function ry(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function RR(t){var e=wb(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&_b(n.ownerDocument.documentElement,n)){if(r!==null&&ry(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=n.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!t.extend&&i>r&&(s=r,r=i,i=s),s=z_(n,i);var o=z_(n,r);s&&o&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),i>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var PR=Pr&&"documentMode"in document&&11>=document.documentMode,yo=null,fm=null,pl=null,pm=!1;function $_(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;pm||yo==null||yo!==dd(r)||(r=yo,"selectionStart"in r&&ry(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),pl&&Vl(pl,r)||(pl=r,r=vd(fm,"onSelect"),0<r.length&&(e=new ey("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=yo)))}function fc(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var vo={animationend:fc("Animation","AnimationEnd"),animationiteration:fc("Animation","AnimationIteration"),animationstart:fc("Animation","AnimationStart"),transitionend:fc("Transition","TransitionEnd")},Kf={},xb={};Pr&&(xb=document.createElement("div").style,"AnimationEvent"in window||(delete vo.animationend.animation,delete vo.animationiteration.animation,delete vo.animationstart.animation),"TransitionEvent"in window||delete vo.transitionend.transition);function ph(t){if(Kf[t])return Kf[t];if(!vo[t])return t;var e=vo[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in xb)return Kf[t]=e[n];return t}var Eb=ph("animationend"),Sb=ph("animationiteration"),bb=ph("animationstart"),Tb=ph("transitionend"),kb=new Map,q_="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function qs(t,e){kb.set(t,e),Hi(e,[t])}for(var Gf=0;Gf<q_.length;Gf++){var Qf=q_[Gf],DR=Qf.toLowerCase(),OR=Qf[0].toUpperCase()+Qf.slice(1);qs(DR,"on"+OR)}qs(Eb,"onAnimationEnd");qs(Sb,"onAnimationIteration");qs(bb,"onAnimationStart");qs("dblclick","onDoubleClick");qs("focusin","onFocus");qs("focusout","onBlur");qs(Tb,"onTransitionEnd");zo("onMouseEnter",["mouseout","mouseover"]);zo("onMouseLeave",["mouseout","mouseover"]);zo("onPointerEnter",["pointerout","pointerover"]);zo("onPointerLeave",["pointerout","pointerover"]);Hi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Hi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Hi("onBeforeInput",["compositionend","keypress","textInput","paste"]);Hi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Hi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Hi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Za="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),MR=new Set("cancel close invalid load scroll toggle".split(" ").concat(Za));function H_(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,DN(r,e,void 0,t),t.currentTarget=null}function Ib(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,u=a.currentTarget;if(a=a.listener,l!==i&&s.isPropagationStopped())break e;H_(s,a,u),i=l}else for(o=0;o<r.length;o++){if(a=r[o],l=a.instance,u=a.currentTarget,a=a.listener,l!==i&&s.isPropagationStopped())break e;H_(s,a,u),i=l}}}if(fd)throw t=um,fd=!1,um=null,t}function Te(t,e){var n=e[_m];n===void 0&&(n=e[_m]=new Set);var r=t+"__bubble";n.has(r)||(Cb(e,t,2,!1),n.add(r))}function Jf(t,e,n){var r=0;e&&(r|=4),Cb(n,t,r,e)}var pc="_reactListening"+Math.random().toString(36).slice(2);function jl(t){if(!t[pc]){t[pc]=!0,MS.forEach(function(n){n!=="selectionchange"&&(MR.has(n)||Jf(n,!1,t),Jf(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[pc]||(e[pc]=!0,Jf("selectionchange",!1,e))}}function Cb(t,e,n,r){switch(db(e)){case 1:var s=QN;break;case 4:s=JN;break;default:s=Xg}n=s.bind(null,e,n,t),s=void 0,!lm||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function Yf(t,e,n,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===s||a.nodeType===8&&a.parentNode===s)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===s||l.nodeType===8&&l.parentNode===s))return;o=o.return}for(;a!==null;){if(o=di(a),o===null)return;if(l=o.tag,l===5||l===6){r=i=o;continue e}a=a.parentNode}}r=r.return}YS(function(){var u=i,d=Gg(n),h=[];e:{var f=kb.get(t);if(f!==void 0){var m=ey,y=t;switch(t){case"keypress":if(qc(n)===0)break e;case"keydown":case"keyup":m=dR;break;case"focusin":y="focus",m=qf;break;case"focusout":y="blur",m=qf;break;case"beforeblur":case"afterblur":m=qf;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":m=D_;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":m=ZN;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":m=pR;break;case Eb:case Sb:case bb:m=nR;break;case Tb:m=gR;break;case"scroll":m=YN;break;case"wheel":m=vR;break;case"copy":case"cut":case"paste":m=sR;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":m=M_}var v=(e&4)!==0,w=!v&&t==="scroll",x=v?f!==null?f+"Capture":null:f;v=[];for(var S=u,b;S!==null;){b=S;var N=b.stateNode;if(b.tag===5&&N!==null&&(b=N,x!==null&&(N=Pl(S,x),N!=null&&v.push(Fl(S,N,b)))),w)break;S=S.return}0<v.length&&(f=new m(f,y,null,n,d),h.push({event:f,listeners:v}))}}if(!(e&7)){e:{if(f=t==="mouseover"||t==="pointerover",m=t==="mouseout"||t==="pointerout",f&&n!==om&&(y=n.relatedTarget||n.fromElement)&&(di(y)||y[Dr]))break e;if((m||f)&&(f=d.window===d?d:(f=d.ownerDocument)?f.defaultView||f.parentWindow:window,m?(y=n.relatedTarget||n.toElement,m=u,y=y?di(y):null,y!==null&&(w=Wi(y),y!==w||y.tag!==5&&y.tag!==6)&&(y=null)):(m=null,y=u),m!==y)){if(v=D_,N="onMouseLeave",x="onMouseEnter",S="mouse",(t==="pointerout"||t==="pointerover")&&(v=M_,N="onPointerLeave",x="onPointerEnter",S="pointer"),w=m==null?f:_o(m),b=y==null?f:_o(y),f=new v(N,S+"leave",m,n,d),f.target=w,f.relatedTarget=b,N=null,di(d)===u&&(v=new v(x,S+"enter",y,n,d),v.target=b,v.relatedTarget=w,N=v),w=N,m&&y)t:{for(v=m,x=y,S=0,b=v;b;b=ro(b))S++;for(b=0,N=x;N;N=ro(N))b++;for(;0<S-b;)v=ro(v),S--;for(;0<b-S;)x=ro(x),b--;for(;S--;){if(v===x||x!==null&&v===x.alternate)break t;v=ro(v),x=ro(x)}v=null}else v=null;m!==null&&W_(h,f,m,v,!1),y!==null&&w!==null&&W_(h,w,y,v,!0)}}e:{if(f=u?_o(u):window,m=f.nodeName&&f.nodeName.toLowerCase(),m==="select"||m==="input"&&f.type==="file")var M=TR;else if(j_(f))if(yb)M=AR;else{M=IR;var V=kR}else(m=f.nodeName)&&m.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(M=CR);if(M&&(M=M(t,u))){gb(h,M,n,d);break e}V&&V(t,f,u),t==="focusout"&&(V=f._wrapperState)&&V.controlled&&f.type==="number"&&tm(f,"number",f.value)}switch(V=u?_o(u):window,t){case"focusin":(j_(V)||V.contentEditable==="true")&&(yo=V,fm=u,pl=null);break;case"focusout":pl=fm=yo=null;break;case"mousedown":pm=!0;break;case"contextmenu":case"mouseup":case"dragend":pm=!1,$_(h,n,d);break;case"selectionchange":if(PR)break;case"keydown":case"keyup":$_(h,n,d)}var k;if(ny)e:{switch(t){case"compositionstart":var E="onCompositionStart";break e;case"compositionend":E="onCompositionEnd";break e;case"compositionupdate":E="onCompositionUpdate";break e}E=void 0}else go?pb(t,n)&&(E="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(E="onCompositionStart");E&&(fb&&n.locale!=="ko"&&(go||E!=="onCompositionStart"?E==="onCompositionEnd"&&go&&(k=hb()):(us=d,Zg="value"in us?us.value:us.textContent,go=!0)),V=vd(u,E),0<V.length&&(E=new O_(E,t,null,n,d),h.push({event:E,listeners:V}),k?E.data=k:(k=mb(n),k!==null&&(E.data=k)))),(k=wR?xR(t,n):ER(t,n))&&(u=vd(u,"onBeforeInput"),0<u.length&&(d=new O_("onBeforeInput","beforeinput",null,n,d),h.push({event:d,listeners:u}),d.data=k))}Ib(h,e)})}function Fl(t,e,n){return{instance:t,listener:e,currentTarget:n}}function vd(t,e){for(var n=e+"Capture",r=[];t!==null;){var s=t,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=Pl(t,n),i!=null&&r.unshift(Fl(t,i,s)),i=Pl(t,e),i!=null&&r.push(Fl(t,i,s))),t=t.return}return r}function ro(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function W_(t,e,n,r,s){for(var i=e._reactName,o=[];n!==null&&n!==r;){var a=n,l=a.alternate,u=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&u!==null&&(a=u,s?(l=Pl(n,i),l!=null&&o.unshift(Fl(n,l,a))):s||(l=Pl(n,i),l!=null&&o.push(Fl(n,l,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var LR=/\r\n?/g,VR=/\u0000|\uFFFD/g;function K_(t){return(typeof t=="string"?t:""+t).replace(LR,`
`).replace(VR,"")}function mc(t,e,n){if(e=K_(e),K_(t)!==e&&n)throw Error(B(425))}function _d(){}var mm=null,gm=null;function ym(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var vm=typeof setTimeout=="function"?setTimeout:void 0,jR=typeof clearTimeout=="function"?clearTimeout:void 0,G_=typeof Promise=="function"?Promise:void 0,FR=typeof queueMicrotask=="function"?queueMicrotask:typeof G_<"u"?function(t){return G_.resolve(null).then(t).catch(UR)}:vm;function UR(t){setTimeout(function(){throw t})}function Xf(t,e){var n=e,r=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){t.removeChild(s),Ml(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);Ml(e)}function _s(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Q_(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var pa=Math.random().toString(36).slice(2),Qn="__reactFiber$"+pa,Ul="__reactProps$"+pa,Dr="__reactContainer$"+pa,_m="__reactEvents$"+pa,BR="__reactListeners$"+pa,zR="__reactHandles$"+pa;function di(t){var e=t[Qn];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Dr]||n[Qn]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Q_(t);t!==null;){if(n=t[Qn])return n;t=Q_(t)}return e}t=n,n=t.parentNode}return null}function _u(t){return t=t[Qn]||t[Dr],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function _o(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(B(33))}function mh(t){return t[Ul]||null}var wm=[],wo=-1;function Hs(t){return{current:t}}function Ce(t){0>wo||(t.current=wm[wo],wm[wo]=null,wo--)}function Se(t,e){wo++,wm[wo]=t.current,t.current=e}var Os={},Pt=Hs(Os),Yt=Hs(!1),Ai=Os;function $o(t,e){var n=t.type.contextTypes;if(!n)return Os;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in n)s[i]=e[i];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function Xt(t){return t=t.childContextTypes,t!=null}function wd(){Ce(Yt),Ce(Pt)}function J_(t,e,n){if(Pt.current!==Os)throw Error(B(168));Se(Pt,e),Se(Yt,n)}function Ab(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(B(108,kN(t)||"Unknown",s));return Le({},n,r)}function xd(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Os,Ai=Pt.current,Se(Pt,t),Se(Yt,Yt.current),!0}function Y_(t,e,n){var r=t.stateNode;if(!r)throw Error(B(169));n?(t=Ab(t,e,Ai),r.__reactInternalMemoizedMergedChildContext=t,Ce(Yt),Ce(Pt),Se(Pt,t)):Ce(Yt),Se(Yt,n)}var vr=null,gh=!1,Zf=!1;function Nb(t){vr===null?vr=[t]:vr.push(t)}function $R(t){gh=!0,Nb(t)}function Ws(){if(!Zf&&vr!==null){Zf=!0;var t=0,e=ye;try{var n=vr;for(ye=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}vr=null,gh=!1}catch(s){throw vr!==null&&(vr=vr.slice(t+1)),tb(Qg,Ws),s}finally{ye=e,Zf=!1}}return null}var xo=[],Eo=0,Ed=null,Sd=0,vn=[],_n=0,Ni=null,wr=1,xr="";function ii(t,e){xo[Eo++]=Sd,xo[Eo++]=Ed,Ed=t,Sd=e}function Rb(t,e,n){vn[_n++]=wr,vn[_n++]=xr,vn[_n++]=Ni,Ni=t;var r=wr;t=xr;var s=32-Fn(r)-1;r&=~(1<<s),n+=1;var i=32-Fn(e)+s;if(30<i){var o=s-s%5;i=(r&(1<<o)-1).toString(32),r>>=o,s-=o,wr=1<<32-Fn(e)+s|n<<s|r,xr=i+t}else wr=1<<i|n<<s|r,xr=t}function sy(t){t.return!==null&&(ii(t,1),Rb(t,1,0))}function iy(t){for(;t===Ed;)Ed=xo[--Eo],xo[Eo]=null,Sd=xo[--Eo],xo[Eo]=null;for(;t===Ni;)Ni=vn[--_n],vn[_n]=null,xr=vn[--_n],vn[_n]=null,wr=vn[--_n],vn[_n]=null}var hn=null,un=null,Pe=!1,Ln=null;function Pb(t,e){var n=xn(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function X_(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,hn=t,un=_s(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,hn=t,un=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Ni!==null?{id:wr,overflow:xr}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=xn(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,hn=t,un=null,!0):!1;default:return!1}}function xm(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Em(t){if(Pe){var e=un;if(e){var n=e;if(!X_(t,e)){if(xm(t))throw Error(B(418));e=_s(n.nextSibling);var r=hn;e&&X_(t,e)?Pb(r,n):(t.flags=t.flags&-4097|2,Pe=!1,hn=t)}}else{if(xm(t))throw Error(B(418));t.flags=t.flags&-4097|2,Pe=!1,hn=t}}}function Z_(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;hn=t}function gc(t){if(t!==hn)return!1;if(!Pe)return Z_(t),Pe=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!ym(t.type,t.memoizedProps)),e&&(e=un)){if(xm(t))throw Db(),Error(B(418));for(;e;)Pb(t,e),e=_s(e.nextSibling)}if(Z_(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(B(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){un=_s(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}un=null}}else un=hn?_s(t.stateNode.nextSibling):null;return!0}function Db(){for(var t=un;t;)t=_s(t.nextSibling)}function qo(){un=hn=null,Pe=!1}function oy(t){Ln===null?Ln=[t]:Ln.push(t)}var qR=Br.ReactCurrentBatchConfig;function $a(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(B(309));var r=n.stateNode}if(!r)throw Error(B(147,t));var s=r,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var a=s.refs;o===null?delete a[i]:a[i]=o},e._stringRef=i,e)}if(typeof t!="string")throw Error(B(284));if(!n._owner)throw Error(B(290,t))}return t}function yc(t,e){throw t=Object.prototype.toString.call(e),Error(B(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function ew(t){var e=t._init;return e(t._payload)}function Ob(t){function e(x,S){if(t){var b=x.deletions;b===null?(x.deletions=[S],x.flags|=16):b.push(S)}}function n(x,S){if(!t)return null;for(;S!==null;)e(x,S),S=S.sibling;return null}function r(x,S){for(x=new Map;S!==null;)S.key!==null?x.set(S.key,S):x.set(S.index,S),S=S.sibling;return x}function s(x,S){return x=Ss(x,S),x.index=0,x.sibling=null,x}function i(x,S,b){return x.index=b,t?(b=x.alternate,b!==null?(b=b.index,b<S?(x.flags|=2,S):b):(x.flags|=2,S)):(x.flags|=1048576,S)}function o(x){return t&&x.alternate===null&&(x.flags|=2),x}function a(x,S,b,N){return S===null||S.tag!==6?(S=op(b,x.mode,N),S.return=x,S):(S=s(S,b),S.return=x,S)}function l(x,S,b,N){var M=b.type;return M===mo?d(x,S,b.props.children,N,b.key):S!==null&&(S.elementType===M||typeof M=="object"&&M!==null&&M.$$typeof===Yr&&ew(M)===S.type)?(N=s(S,b.props),N.ref=$a(x,S,b),N.return=x,N):(N=Yc(b.type,b.key,b.props,null,x.mode,N),N.ref=$a(x,S,b),N.return=x,N)}function u(x,S,b,N){return S===null||S.tag!==4||S.stateNode.containerInfo!==b.containerInfo||S.stateNode.implementation!==b.implementation?(S=ap(b,x.mode,N),S.return=x,S):(S=s(S,b.children||[]),S.return=x,S)}function d(x,S,b,N,M){return S===null||S.tag!==7?(S=wi(b,x.mode,N,M),S.return=x,S):(S=s(S,b),S.return=x,S)}function h(x,S,b){if(typeof S=="string"&&S!==""||typeof S=="number")return S=op(""+S,x.mode,b),S.return=x,S;if(typeof S=="object"&&S!==null){switch(S.$$typeof){case oc:return b=Yc(S.type,S.key,S.props,null,x.mode,b),b.ref=$a(x,null,S),b.return=x,b;case po:return S=ap(S,x.mode,b),S.return=x,S;case Yr:var N=S._init;return h(x,N(S._payload),b)}if(Ya(S)||ja(S))return S=wi(S,x.mode,b,null),S.return=x,S;yc(x,S)}return null}function f(x,S,b,N){var M=S!==null?S.key:null;if(typeof b=="string"&&b!==""||typeof b=="number")return M!==null?null:a(x,S,""+b,N);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case oc:return b.key===M?l(x,S,b,N):null;case po:return b.key===M?u(x,S,b,N):null;case Yr:return M=b._init,f(x,S,M(b._payload),N)}if(Ya(b)||ja(b))return M!==null?null:d(x,S,b,N,null);yc(x,b)}return null}function m(x,S,b,N,M){if(typeof N=="string"&&N!==""||typeof N=="number")return x=x.get(b)||null,a(S,x,""+N,M);if(typeof N=="object"&&N!==null){switch(N.$$typeof){case oc:return x=x.get(N.key===null?b:N.key)||null,l(S,x,N,M);case po:return x=x.get(N.key===null?b:N.key)||null,u(S,x,N,M);case Yr:var V=N._init;return m(x,S,b,V(N._payload),M)}if(Ya(N)||ja(N))return x=x.get(b)||null,d(S,x,N,M,null);yc(S,N)}return null}function y(x,S,b,N){for(var M=null,V=null,k=S,E=S=0,I=null;k!==null&&E<b.length;E++){k.index>E?(I=k,k=null):I=k.sibling;var C=f(x,k,b[E],N);if(C===null){k===null&&(k=I);break}t&&k&&C.alternate===null&&e(x,k),S=i(C,S,E),V===null?M=C:V.sibling=C,V=C,k=I}if(E===b.length)return n(x,k),Pe&&ii(x,E),M;if(k===null){for(;E<b.length;E++)k=h(x,b[E],N),k!==null&&(S=i(k,S,E),V===null?M=k:V.sibling=k,V=k);return Pe&&ii(x,E),M}for(k=r(x,k);E<b.length;E++)I=m(k,x,E,b[E],N),I!==null&&(t&&I.alternate!==null&&k.delete(I.key===null?E:I.key),S=i(I,S,E),V===null?M=I:V.sibling=I,V=I);return t&&k.forEach(function(P){return e(x,P)}),Pe&&ii(x,E),M}function v(x,S,b,N){var M=ja(b);if(typeof M!="function")throw Error(B(150));if(b=M.call(b),b==null)throw Error(B(151));for(var V=M=null,k=S,E=S=0,I=null,C=b.next();k!==null&&!C.done;E++,C=b.next()){k.index>E?(I=k,k=null):I=k.sibling;var P=f(x,k,C.value,N);if(P===null){k===null&&(k=I);break}t&&k&&P.alternate===null&&e(x,k),S=i(P,S,E),V===null?M=P:V.sibling=P,V=P,k=I}if(C.done)return n(x,k),Pe&&ii(x,E),M;if(k===null){for(;!C.done;E++,C=b.next())C=h(x,C.value,N),C!==null&&(S=i(C,S,E),V===null?M=C:V.sibling=C,V=C);return Pe&&ii(x,E),M}for(k=r(x,k);!C.done;E++,C=b.next())C=m(k,x,E,C.value,N),C!==null&&(t&&C.alternate!==null&&k.delete(C.key===null?E:C.key),S=i(C,S,E),V===null?M=C:V.sibling=C,V=C);return t&&k.forEach(function(D){return e(x,D)}),Pe&&ii(x,E),M}function w(x,S,b,N){if(typeof b=="object"&&b!==null&&b.type===mo&&b.key===null&&(b=b.props.children),typeof b=="object"&&b!==null){switch(b.$$typeof){case oc:e:{for(var M=b.key,V=S;V!==null;){if(V.key===M){if(M=b.type,M===mo){if(V.tag===7){n(x,V.sibling),S=s(V,b.props.children),S.return=x,x=S;break e}}else if(V.elementType===M||typeof M=="object"&&M!==null&&M.$$typeof===Yr&&ew(M)===V.type){n(x,V.sibling),S=s(V,b.props),S.ref=$a(x,V,b),S.return=x,x=S;break e}n(x,V);break}else e(x,V);V=V.sibling}b.type===mo?(S=wi(b.props.children,x.mode,N,b.key),S.return=x,x=S):(N=Yc(b.type,b.key,b.props,null,x.mode,N),N.ref=$a(x,S,b),N.return=x,x=N)}return o(x);case po:e:{for(V=b.key;S!==null;){if(S.key===V)if(S.tag===4&&S.stateNode.containerInfo===b.containerInfo&&S.stateNode.implementation===b.implementation){n(x,S.sibling),S=s(S,b.children||[]),S.return=x,x=S;break e}else{n(x,S);break}else e(x,S);S=S.sibling}S=ap(b,x.mode,N),S.return=x,x=S}return o(x);case Yr:return V=b._init,w(x,S,V(b._payload),N)}if(Ya(b))return y(x,S,b,N);if(ja(b))return v(x,S,b,N);yc(x,b)}return typeof b=="string"&&b!==""||typeof b=="number"?(b=""+b,S!==null&&S.tag===6?(n(x,S.sibling),S=s(S,b),S.return=x,x=S):(n(x,S),S=op(b,x.mode,N),S.return=x,x=S),o(x)):n(x,S)}return w}var Ho=Ob(!0),Mb=Ob(!1),bd=Hs(null),Td=null,So=null,ay=null;function ly(){ay=So=Td=null}function uy(t){var e=bd.current;Ce(bd),t._currentValue=e}function Sm(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function Po(t,e){Td=t,ay=So=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Jt=!0),t.firstContext=null)}function Cn(t){var e=t._currentValue;if(ay!==t)if(t={context:t,memoizedValue:e,next:null},So===null){if(Td===null)throw Error(B(308));So=t,Td.dependencies={lanes:0,firstContext:t}}else So=So.next=t;return e}var hi=null;function cy(t){hi===null?hi=[t]:hi.push(t)}function Lb(t,e,n,r){var s=e.interleaved;return s===null?(n.next=n,cy(e)):(n.next=s.next,s.next=n),e.interleaved=n,Or(t,r)}function Or(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Xr=!1;function dy(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Vb(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function kr(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function ws(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,fe&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,Or(t,n)}return s=r.interleaved,s===null?(e.next=e,cy(r)):(e.next=s.next,s.next=e),r.interleaved=e,Or(t,n)}function Hc(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Jg(t,n)}}function tw(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?s=i=o:i=i.next=o,n=n.next}while(n!==null);i===null?s=i=e:i=i.next=e}else s=i=e;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function kd(t,e,n,r){var s=t.updateQueue;Xr=!1;var i=s.firstBaseUpdate,o=s.lastBaseUpdate,a=s.shared.pending;if(a!==null){s.shared.pending=null;var l=a,u=l.next;l.next=null,o===null?i=u:o.next=u,o=l;var d=t.alternate;d!==null&&(d=d.updateQueue,a=d.lastBaseUpdate,a!==o&&(a===null?d.firstBaseUpdate=u:a.next=u,d.lastBaseUpdate=l))}if(i!==null){var h=s.baseState;o=0,d=u=l=null,a=i;do{var f=a.lane,m=a.eventTime;if((r&f)===f){d!==null&&(d=d.next={eventTime:m,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var y=t,v=a;switch(f=e,m=n,v.tag){case 1:if(y=v.payload,typeof y=="function"){h=y.call(m,h,f);break e}h=y;break e;case 3:y.flags=y.flags&-65537|128;case 0:if(y=v.payload,f=typeof y=="function"?y.call(m,h,f):y,f==null)break e;h=Le({},h,f);break e;case 2:Xr=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,f=s.effects,f===null?s.effects=[a]:f.push(a))}else m={eventTime:m,lane:f,tag:a.tag,payload:a.payload,callback:a.callback,next:null},d===null?(u=d=m,l=h):d=d.next=m,o|=f;if(a=a.next,a===null){if(a=s.shared.pending,a===null)break;f=a,a=f.next,f.next=null,s.lastBaseUpdate=f,s.shared.pending=null}}while(!0);if(d===null&&(l=h),s.baseState=l,s.firstBaseUpdate=u,s.lastBaseUpdate=d,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);Pi|=o,t.lanes=o,t.memoizedState=h}}function nw(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(B(191,s));s.call(r)}}}var wu={},Zn=Hs(wu),Bl=Hs(wu),zl=Hs(wu);function fi(t){if(t===wu)throw Error(B(174));return t}function hy(t,e){switch(Se(zl,e),Se(Bl,t),Se(Zn,wu),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:rm(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=rm(e,t)}Ce(Zn),Se(Zn,e)}function Wo(){Ce(Zn),Ce(Bl),Ce(zl)}function jb(t){fi(zl.current);var e=fi(Zn.current),n=rm(e,t.type);e!==n&&(Se(Bl,t),Se(Zn,n))}function fy(t){Bl.current===t&&(Ce(Zn),Ce(Bl))}var Oe=Hs(0);function Id(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var ep=[];function py(){for(var t=0;t<ep.length;t++)ep[t]._workInProgressVersionPrimary=null;ep.length=0}var Wc=Br.ReactCurrentDispatcher,tp=Br.ReactCurrentBatchConfig,Ri=0,Me=null,Ye=null,tt=null,Cd=!1,ml=!1,$l=0,HR=0;function St(){throw Error(B(321))}function my(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!$n(t[n],e[n]))return!1;return!0}function gy(t,e,n,r,s,i){if(Ri=i,Me=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Wc.current=t===null||t.memoizedState===null?QR:JR,t=n(r,s),ml){i=0;do{if(ml=!1,$l=0,25<=i)throw Error(B(301));i+=1,tt=Ye=null,e.updateQueue=null,Wc.current=YR,t=n(r,s)}while(ml)}if(Wc.current=Ad,e=Ye!==null&&Ye.next!==null,Ri=0,tt=Ye=Me=null,Cd=!1,e)throw Error(B(300));return t}function yy(){var t=$l!==0;return $l=0,t}function Wn(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return tt===null?Me.memoizedState=tt=t:tt=tt.next=t,tt}function An(){if(Ye===null){var t=Me.alternate;t=t!==null?t.memoizedState:null}else t=Ye.next;var e=tt===null?Me.memoizedState:tt.next;if(e!==null)tt=e,Ye=t;else{if(t===null)throw Error(B(310));Ye=t,t={memoizedState:Ye.memoizedState,baseState:Ye.baseState,baseQueue:Ye.baseQueue,queue:Ye.queue,next:null},tt===null?Me.memoizedState=tt=t:tt=tt.next=t}return tt}function ql(t,e){return typeof e=="function"?e(t):e}function np(t){var e=An(),n=e.queue;if(n===null)throw Error(B(311));n.lastRenderedReducer=t;var r=Ye,s=r.baseQueue,i=n.pending;if(i!==null){if(s!==null){var o=s.next;s.next=i.next,i.next=o}r.baseQueue=s=i,n.pending=null}if(s!==null){i=s.next,r=r.baseState;var a=o=null,l=null,u=i;do{var d=u.lane;if((Ri&d)===d)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:t(r,u.action);else{var h={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(a=l=h,o=r):l=l.next=h,Me.lanes|=d,Pi|=d}u=u.next}while(u!==null&&u!==i);l===null?o=r:l.next=a,$n(r,e.memoizedState)||(Jt=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=l,n.lastRenderedState=r}if(t=n.interleaved,t!==null){s=t;do i=s.lane,Me.lanes|=i,Pi|=i,s=s.next;while(s!==t)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function rp(t){var e=An(),n=e.queue;if(n===null)throw Error(B(311));n.lastRenderedReducer=t;var r=n.dispatch,s=n.pending,i=e.memoizedState;if(s!==null){n.pending=null;var o=s=s.next;do i=t(i,o.action),o=o.next;while(o!==s);$n(i,e.memoizedState)||(Jt=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,r]}function Fb(){}function Ub(t,e){var n=Me,r=An(),s=e(),i=!$n(r.memoizedState,s);if(i&&(r.memoizedState=s,Jt=!0),r=r.queue,vy($b.bind(null,n,r,t),[t]),r.getSnapshot!==e||i||tt!==null&&tt.memoizedState.tag&1){if(n.flags|=2048,Hl(9,zb.bind(null,n,r,s,e),void 0,null),rt===null)throw Error(B(349));Ri&30||Bb(n,e,s)}return s}function Bb(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Me.updateQueue,e===null?(e={lastEffect:null,stores:null},Me.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function zb(t,e,n,r){e.value=n,e.getSnapshot=r,qb(e)&&Hb(t)}function $b(t,e,n){return n(function(){qb(e)&&Hb(t)})}function qb(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!$n(t,n)}catch{return!0}}function Hb(t){var e=Or(t,1);e!==null&&Un(e,t,1,-1)}function rw(t){var e=Wn();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ql,lastRenderedState:t},e.queue=t,t=t.dispatch=GR.bind(null,Me,t),[e.memoizedState,t]}function Hl(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=Me.updateQueue,e===null?(e={lastEffect:null,stores:null},Me.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function Wb(){return An().memoizedState}function Kc(t,e,n,r){var s=Wn();Me.flags|=t,s.memoizedState=Hl(1|e,n,void 0,r===void 0?null:r)}function yh(t,e,n,r){var s=An();r=r===void 0?null:r;var i=void 0;if(Ye!==null){var o=Ye.memoizedState;if(i=o.destroy,r!==null&&my(r,o.deps)){s.memoizedState=Hl(e,n,i,r);return}}Me.flags|=t,s.memoizedState=Hl(1|e,n,i,r)}function sw(t,e){return Kc(8390656,8,t,e)}function vy(t,e){return yh(2048,8,t,e)}function Kb(t,e){return yh(4,2,t,e)}function Gb(t,e){return yh(4,4,t,e)}function Qb(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function Jb(t,e,n){return n=n!=null?n.concat([t]):null,yh(4,4,Qb.bind(null,e,t),n)}function _y(){}function Yb(t,e){var n=An();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&my(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function Xb(t,e){var n=An();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&my(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function Zb(t,e,n){return Ri&21?($n(n,e)||(n=sb(),Me.lanes|=n,Pi|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Jt=!0),t.memoizedState=n)}function WR(t,e){var n=ye;ye=n!==0&&4>n?n:4,t(!0);var r=tp.transition;tp.transition={};try{t(!1),e()}finally{ye=n,tp.transition=r}}function eT(){return An().memoizedState}function KR(t,e,n){var r=Es(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},tT(t))nT(e,n);else if(n=Lb(t,e,n,r),n!==null){var s=Ft();Un(n,t,r,s),rT(n,e,r)}}function GR(t,e,n){var r=Es(t),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(tT(t))nT(e,s);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,a=i(o,n);if(s.hasEagerState=!0,s.eagerState=a,$n(a,o)){var l=e.interleaved;l===null?(s.next=s,cy(e)):(s.next=l.next,l.next=s),e.interleaved=s;return}}catch{}finally{}n=Lb(t,e,s,r),n!==null&&(s=Ft(),Un(n,t,r,s),rT(n,e,r))}}function tT(t){var e=t.alternate;return t===Me||e!==null&&e===Me}function nT(t,e){ml=Cd=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function rT(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Jg(t,n)}}var Ad={readContext:Cn,useCallback:St,useContext:St,useEffect:St,useImperativeHandle:St,useInsertionEffect:St,useLayoutEffect:St,useMemo:St,useReducer:St,useRef:St,useState:St,useDebugValue:St,useDeferredValue:St,useTransition:St,useMutableSource:St,useSyncExternalStore:St,useId:St,unstable_isNewReconciler:!1},QR={readContext:Cn,useCallback:function(t,e){return Wn().memoizedState=[t,e===void 0?null:e],t},useContext:Cn,useEffect:sw,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Kc(4194308,4,Qb.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Kc(4194308,4,t,e)},useInsertionEffect:function(t,e){return Kc(4,2,t,e)},useMemo:function(t,e){var n=Wn();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=Wn();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=KR.bind(null,Me,t),[r.memoizedState,t]},useRef:function(t){var e=Wn();return t={current:t},e.memoizedState=t},useState:rw,useDebugValue:_y,useDeferredValue:function(t){return Wn().memoizedState=t},useTransition:function(){var t=rw(!1),e=t[0];return t=WR.bind(null,t[1]),Wn().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=Me,s=Wn();if(Pe){if(n===void 0)throw Error(B(407));n=n()}else{if(n=e(),rt===null)throw Error(B(349));Ri&30||Bb(r,e,n)}s.memoizedState=n;var i={value:n,getSnapshot:e};return s.queue=i,sw($b.bind(null,r,i,t),[t]),r.flags|=2048,Hl(9,zb.bind(null,r,i,n,e),void 0,null),n},useId:function(){var t=Wn(),e=rt.identifierPrefix;if(Pe){var n=xr,r=wr;n=(r&~(1<<32-Fn(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=$l++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=HR++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},JR={readContext:Cn,useCallback:Yb,useContext:Cn,useEffect:vy,useImperativeHandle:Jb,useInsertionEffect:Kb,useLayoutEffect:Gb,useMemo:Xb,useReducer:np,useRef:Wb,useState:function(){return np(ql)},useDebugValue:_y,useDeferredValue:function(t){var e=An();return Zb(e,Ye.memoizedState,t)},useTransition:function(){var t=np(ql)[0],e=An().memoizedState;return[t,e]},useMutableSource:Fb,useSyncExternalStore:Ub,useId:eT,unstable_isNewReconciler:!1},YR={readContext:Cn,useCallback:Yb,useContext:Cn,useEffect:vy,useImperativeHandle:Jb,useInsertionEffect:Kb,useLayoutEffect:Gb,useMemo:Xb,useReducer:rp,useRef:Wb,useState:function(){return rp(ql)},useDebugValue:_y,useDeferredValue:function(t){var e=An();return Ye===null?e.memoizedState=t:Zb(e,Ye.memoizedState,t)},useTransition:function(){var t=rp(ql)[0],e=An().memoizedState;return[t,e]},useMutableSource:Fb,useSyncExternalStore:Ub,useId:eT,unstable_isNewReconciler:!1};function On(t,e){if(t&&t.defaultProps){e=Le({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function bm(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:Le({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var vh={isMounted:function(t){return(t=t._reactInternals)?Wi(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=Ft(),s=Es(t),i=kr(r,s);i.payload=e,n!=null&&(i.callback=n),e=ws(t,i,s),e!==null&&(Un(e,t,s,r),Hc(e,t,s))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=Ft(),s=Es(t),i=kr(r,s);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=ws(t,i,s),e!==null&&(Un(e,t,s,r),Hc(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Ft(),r=Es(t),s=kr(n,r);s.tag=2,e!=null&&(s.callback=e),e=ws(t,s,r),e!==null&&(Un(e,t,r,n),Hc(e,t,r))}};function iw(t,e,n,r,s,i,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,i,o):e.prototype&&e.prototype.isPureReactComponent?!Vl(n,r)||!Vl(s,i):!0}function sT(t,e,n){var r=!1,s=Os,i=e.contextType;return typeof i=="object"&&i!==null?i=Cn(i):(s=Xt(e)?Ai:Pt.current,r=e.contextTypes,i=(r=r!=null)?$o(t,s):Os),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=vh,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=i),e}function ow(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&vh.enqueueReplaceState(e,e.state,null)}function Tm(t,e,n,r){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs={},dy(t);var i=e.contextType;typeof i=="object"&&i!==null?s.context=Cn(i):(i=Xt(e)?Ai:Pt.current,s.context=$o(t,i)),s.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(bm(t,e,i,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&vh.enqueueReplaceState(s,s.state,null),kd(t,n,s,r),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function Ko(t,e){try{var n="",r=e;do n+=TN(r),r=r.return;while(r);var s=n}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:s,digest:null}}function sp(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function km(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var XR=typeof WeakMap=="function"?WeakMap:Map;function iT(t,e,n){n=kr(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){Rd||(Rd=!0,Lm=r),km(t,e)},n}function oT(t,e,n){n=kr(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;n.payload=function(){return r(s)},n.callback=function(){km(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){km(t,e),typeof r!="function"&&(xs===null?xs=new Set([this]):xs.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function aw(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new XR;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(n)||(s.add(n),t=hP.bind(null,t,e,n),e.then(t,t))}function lw(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function uw(t,e,n,r,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=kr(-1,1),e.tag=2,ws(n,e,1))),n.lanes|=1),t)}var ZR=Br.ReactCurrentOwner,Jt=!1;function jt(t,e,n,r){e.child=t===null?Mb(e,null,n,r):Ho(e,t.child,n,r)}function cw(t,e,n,r,s){n=n.render;var i=e.ref;return Po(e,s),r=gy(t,e,n,r,i,s),n=yy(),t!==null&&!Jt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Mr(t,e,s)):(Pe&&n&&sy(e),e.flags|=1,jt(t,e,r,s),e.child)}function dw(t,e,n,r,s){if(t===null){var i=n.type;return typeof i=="function"&&!Iy(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,aT(t,e,i,r,s)):(t=Yc(n.type,null,r,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&s)){var o=i.memoizedProps;if(n=n.compare,n=n!==null?n:Vl,n(o,r)&&t.ref===e.ref)return Mr(t,e,s)}return e.flags|=1,t=Ss(i,r),t.ref=e.ref,t.return=e,e.child=t}function aT(t,e,n,r,s){if(t!==null){var i=t.memoizedProps;if(Vl(i,r)&&t.ref===e.ref)if(Jt=!1,e.pendingProps=r=i,(t.lanes&s)!==0)t.flags&131072&&(Jt=!0);else return e.lanes=t.lanes,Mr(t,e,s)}return Im(t,e,n,r,s)}function lT(t,e,n){var r=e.pendingProps,s=r.children,i=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Se(To,an),an|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Se(To,an),an|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,Se(To,an),an|=r}else i!==null?(r=i.baseLanes|n,e.memoizedState=null):r=n,Se(To,an),an|=r;return jt(t,e,s,n),e.child}function uT(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Im(t,e,n,r,s){var i=Xt(n)?Ai:Pt.current;return i=$o(e,i),Po(e,s),n=gy(t,e,n,r,i,s),r=yy(),t!==null&&!Jt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Mr(t,e,s)):(Pe&&r&&sy(e),e.flags|=1,jt(t,e,n,s),e.child)}function hw(t,e,n,r,s){if(Xt(n)){var i=!0;xd(e)}else i=!1;if(Po(e,s),e.stateNode===null)Gc(t,e),sT(e,n,r),Tm(e,n,r,s),r=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,u=n.contextType;typeof u=="object"&&u!==null?u=Cn(u):(u=Xt(n)?Ai:Pt.current,u=$o(e,u));var d=n.getDerivedStateFromProps,h=typeof d=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||l!==u)&&ow(e,o,r,u),Xr=!1;var f=e.memoizedState;o.state=f,kd(e,r,o,s),l=e.memoizedState,a!==r||f!==l||Yt.current||Xr?(typeof d=="function"&&(bm(e,n,d,r),l=e.memoizedState),(a=Xr||iw(e,n,a,r,f,l,u))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),o.props=r,o.state=l,o.context=u,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,Vb(t,e),a=e.memoizedProps,u=e.type===e.elementType?a:On(e.type,a),o.props=u,h=e.pendingProps,f=o.context,l=n.contextType,typeof l=="object"&&l!==null?l=Cn(l):(l=Xt(n)?Ai:Pt.current,l=$o(e,l));var m=n.getDerivedStateFromProps;(d=typeof m=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==h||f!==l)&&ow(e,o,r,l),Xr=!1,f=e.memoizedState,o.state=f,kd(e,r,o,s);var y=e.memoizedState;a!==h||f!==y||Yt.current||Xr?(typeof m=="function"&&(bm(e,n,m,r),y=e.memoizedState),(u=Xr||iw(e,n,u,r,f,y,l)||!1)?(d||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,y,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,y,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=y),o.props=r,o.state=y,o.context=l,r=u):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),r=!1)}return Cm(t,e,n,r,i,s)}function Cm(t,e,n,r,s,i){uT(t,e);var o=(e.flags&128)!==0;if(!r&&!o)return s&&Y_(e,n,!1),Mr(t,e,i);r=e.stateNode,ZR.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=Ho(e,t.child,null,i),e.child=Ho(e,null,a,i)):jt(t,e,a,i),e.memoizedState=r.state,s&&Y_(e,n,!0),e.child}function cT(t){var e=t.stateNode;e.pendingContext?J_(t,e.pendingContext,e.pendingContext!==e.context):e.context&&J_(t,e.context,!1),hy(t,e.containerInfo)}function fw(t,e,n,r,s){return qo(),oy(s),e.flags|=256,jt(t,e,n,r),e.child}var Am={dehydrated:null,treeContext:null,retryLane:0};function Nm(t){return{baseLanes:t,cachePool:null,transitions:null}}function dT(t,e,n){var r=e.pendingProps,s=Oe.current,i=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(s&2)!==0),a?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),Se(Oe,s&1),t===null)return Em(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,t=r.fallback,i?(r=e.mode,i=e.child,o={mode:"hidden",children:o},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=xh(o,r,0,null),t=wi(t,r,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=Nm(n),e.memoizedState=Am,t):wy(e,o));if(s=t.memoizedState,s!==null&&(a=s.dehydrated,a!==null))return eP(t,e,o,r,a,s,n);if(i){i=r.fallback,o=e.mode,s=t.child,a=s.sibling;var l={mode:"hidden",children:r.children};return!(o&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=Ss(s,l),r.subtreeFlags=s.subtreeFlags&14680064),a!==null?i=Ss(a,i):(i=wi(i,o,n,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,o=t.child.memoizedState,o=o===null?Nm(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=t.childLanes&~n,e.memoizedState=Am,r}return i=t.child,t=i.sibling,r=Ss(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function wy(t,e){return e=xh({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function vc(t,e,n,r){return r!==null&&oy(r),Ho(e,t.child,null,n),t=wy(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function eP(t,e,n,r,s,i,o){if(n)return e.flags&256?(e.flags&=-257,r=sp(Error(B(422))),vc(t,e,o,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=xh({mode:"visible",children:r.children},s,0,null),i=wi(i,s,o,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&Ho(e,t.child,null,o),e.child.memoizedState=Nm(o),e.memoizedState=Am,i);if(!(e.mode&1))return vc(t,e,o,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var a=r.dgst;return r=a,i=Error(B(419)),r=sp(i,r,void 0),vc(t,e,o,r)}if(a=(o&t.childLanes)!==0,Jt||a){if(r=rt,r!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|o)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,Or(t,s),Un(r,t,s,-1))}return ky(),r=sp(Error(B(421))),vc(t,e,o,r)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=fP.bind(null,t),s._reactRetry=e,null):(t=i.treeContext,un=_s(s.nextSibling),hn=e,Pe=!0,Ln=null,t!==null&&(vn[_n++]=wr,vn[_n++]=xr,vn[_n++]=Ni,wr=t.id,xr=t.overflow,Ni=e),e=wy(e,r.children),e.flags|=4096,e)}function pw(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),Sm(t.return,e,n)}function ip(t,e,n,r,s){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=s)}function hT(t,e,n){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(jt(t,e,r.children,n),r=Oe.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&pw(t,n,e);else if(t.tag===19)pw(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(Se(Oe,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&Id(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),ip(e,!1,s,n,i);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&Id(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}ip(e,!0,n,null,i);break;case"together":ip(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Gc(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Mr(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Pi|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(B(153));if(e.child!==null){for(t=e.child,n=Ss(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Ss(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function tP(t,e,n){switch(e.tag){case 3:cT(e),qo();break;case 5:jb(e);break;case 1:Xt(e.type)&&xd(e);break;case 4:hy(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;Se(bd,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Se(Oe,Oe.current&1),e.flags|=128,null):n&e.child.childLanes?dT(t,e,n):(Se(Oe,Oe.current&1),t=Mr(t,e,n),t!==null?t.sibling:null);Se(Oe,Oe.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return hT(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),Se(Oe,Oe.current),r)break;return null;case 22:case 23:return e.lanes=0,lT(t,e,n)}return Mr(t,e,n)}var fT,Rm,pT,mT;fT=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Rm=function(){};pT=function(t,e,n,r){var s=t.memoizedProps;if(s!==r){t=e.stateNode,fi(Zn.current);var i=null;switch(n){case"input":s=Zp(t,s),r=Zp(t,r),i=[];break;case"select":s=Le({},s,{value:void 0}),r=Le({},r,{value:void 0}),i=[];break;case"textarea":s=nm(t,s),r=nm(t,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=_d)}sm(n,r);var o;n=null;for(u in s)if(!r.hasOwnProperty(u)&&s.hasOwnProperty(u)&&s[u]!=null)if(u==="style"){var a=s[u];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Nl.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in r){var l=r[u];if(a=s!=null?s[u]:void 0,r.hasOwnProperty(u)&&l!==a&&(l!=null||a!=null))if(u==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(n||(n={}),n[o]=l[o])}else n||(i||(i=[]),i.push(u,n)),n=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(i=i||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(i=i||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Nl.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&Te("scroll",t),i||a===l||(i=[])):(i=i||[]).push(u,l))}n&&(i=i||[]).push("style",n);var u=i;(e.updateQueue=u)&&(e.flags|=4)}};mT=function(t,e,n,r){n!==r&&(e.flags|=4)};function qa(t,e){if(!Pe)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function bt(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function nP(t,e,n){var r=e.pendingProps;switch(iy(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return bt(e),null;case 1:return Xt(e.type)&&wd(),bt(e),null;case 3:return r=e.stateNode,Wo(),Ce(Yt),Ce(Pt),py(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(gc(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Ln!==null&&(Fm(Ln),Ln=null))),Rm(t,e),bt(e),null;case 5:fy(e);var s=fi(zl.current);if(n=e.type,t!==null&&e.stateNode!=null)pT(t,e,n,r,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(B(166));return bt(e),null}if(t=fi(Zn.current),gc(e)){r=e.stateNode,n=e.type;var i=e.memoizedProps;switch(r[Qn]=e,r[Ul]=i,t=(e.mode&1)!==0,n){case"dialog":Te("cancel",r),Te("close",r);break;case"iframe":case"object":case"embed":Te("load",r);break;case"video":case"audio":for(s=0;s<Za.length;s++)Te(Za[s],r);break;case"source":Te("error",r);break;case"img":case"image":case"link":Te("error",r),Te("load",r);break;case"details":Te("toggle",r);break;case"input":S_(r,i),Te("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},Te("invalid",r);break;case"textarea":T_(r,i),Te("invalid",r)}sm(n,i),s=null;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];o==="children"?typeof a=="string"?r.textContent!==a&&(i.suppressHydrationWarning!==!0&&mc(r.textContent,a,t),s=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(i.suppressHydrationWarning!==!0&&mc(r.textContent,a,t),s=["children",""+a]):Nl.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&Te("scroll",r)}switch(n){case"input":ac(r),b_(r,i,!0);break;case"textarea":ac(r),k_(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=_d)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=$S(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(n,{is:r.is}):(t=o.createElement(n),n==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,n),t[Qn]=e,t[Ul]=r,fT(t,e,!1,!1),e.stateNode=t;e:{switch(o=im(n,r),n){case"dialog":Te("cancel",t),Te("close",t),s=r;break;case"iframe":case"object":case"embed":Te("load",t),s=r;break;case"video":case"audio":for(s=0;s<Za.length;s++)Te(Za[s],t);s=r;break;case"source":Te("error",t),s=r;break;case"img":case"image":case"link":Te("error",t),Te("load",t),s=r;break;case"details":Te("toggle",t),s=r;break;case"input":S_(t,r),s=Zp(t,r),Te("invalid",t);break;case"option":s=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},s=Le({},r,{value:void 0}),Te("invalid",t);break;case"textarea":T_(t,r),s=nm(t,r),Te("invalid",t);break;default:s=r}sm(n,s),a=s;for(i in a)if(a.hasOwnProperty(i)){var l=a[i];i==="style"?WS(t,l):i==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&qS(t,l)):i==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&Rl(t,l):typeof l=="number"&&Rl(t,""+l):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Nl.hasOwnProperty(i)?l!=null&&i==="onScroll"&&Te("scroll",t):l!=null&&qg(t,i,l,o))}switch(n){case"input":ac(t),b_(t,r,!1);break;case"textarea":ac(t),k_(t);break;case"option":r.value!=null&&t.setAttribute("value",""+Ds(r.value));break;case"select":t.multiple=!!r.multiple,i=r.value,i!=null?Co(t,!!r.multiple,i,!1):r.defaultValue!=null&&Co(t,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=_d)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return bt(e),null;case 6:if(t&&e.stateNode!=null)mT(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(B(166));if(n=fi(zl.current),fi(Zn.current),gc(e)){if(r=e.stateNode,n=e.memoizedProps,r[Qn]=e,(i=r.nodeValue!==n)&&(t=hn,t!==null))switch(t.tag){case 3:mc(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&mc(r.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Qn]=e,e.stateNode=r}return bt(e),null;case 13:if(Ce(Oe),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Pe&&un!==null&&e.mode&1&&!(e.flags&128))Db(),qo(),e.flags|=98560,i=!1;else if(i=gc(e),r!==null&&r.dehydrated!==null){if(t===null){if(!i)throw Error(B(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(B(317));i[Qn]=e}else qo(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;bt(e),i=!1}else Ln!==null&&(Fm(Ln),Ln=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||Oe.current&1?Ze===0&&(Ze=3):ky())),e.updateQueue!==null&&(e.flags|=4),bt(e),null);case 4:return Wo(),Rm(t,e),t===null&&jl(e.stateNode.containerInfo),bt(e),null;case 10:return uy(e.type._context),bt(e),null;case 17:return Xt(e.type)&&wd(),bt(e),null;case 19:if(Ce(Oe),i=e.memoizedState,i===null)return bt(e),null;if(r=(e.flags&128)!==0,o=i.rendering,o===null)if(r)qa(i,!1);else{if(Ze!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=Id(t),o!==null){for(e.flags|=128,qa(i,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)i=n,t=r,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,t=o.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return Se(Oe,Oe.current&1|2),e.child}t=t.sibling}i.tail!==null&&qe()>Go&&(e.flags|=128,r=!0,qa(i,!1),e.lanes=4194304)}else{if(!r)if(t=Id(o),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),qa(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!Pe)return bt(e),null}else 2*qe()-i.renderingStartTime>Go&&n!==1073741824&&(e.flags|=128,r=!0,qa(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(n=i.last,n!==null?n.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=qe(),e.sibling=null,n=Oe.current,Se(Oe,r?n&1|2:n&1),e):(bt(e),null);case 22:case 23:return Ty(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?an&1073741824&&(bt(e),e.subtreeFlags&6&&(e.flags|=8192)):bt(e),null;case 24:return null;case 25:return null}throw Error(B(156,e.tag))}function rP(t,e){switch(iy(e),e.tag){case 1:return Xt(e.type)&&wd(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Wo(),Ce(Yt),Ce(Pt),py(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return fy(e),null;case 13:if(Ce(Oe),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(B(340));qo()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Ce(Oe),null;case 4:return Wo(),null;case 10:return uy(e.type._context),null;case 22:case 23:return Ty(),null;case 24:return null;default:return null}}var _c=!1,Ct=!1,sP=typeof WeakSet=="function"?WeakSet:Set,W=null;function bo(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){Ue(t,e,r)}else n.current=null}function Pm(t,e,n){try{n()}catch(r){Ue(t,e,r)}}var mw=!1;function iP(t,e){if(mm=gd,t=wb(),ry(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var o=0,a=-1,l=-1,u=0,d=0,h=t,f=null;t:for(;;){for(var m;h!==n||s!==0&&h.nodeType!==3||(a=o+s),h!==i||r!==0&&h.nodeType!==3||(l=o+r),h.nodeType===3&&(o+=h.nodeValue.length),(m=h.firstChild)!==null;)f=h,h=m;for(;;){if(h===t)break t;if(f===n&&++u===s&&(a=o),f===i&&++d===r&&(l=o),(m=h.nextSibling)!==null)break;h=f,f=h.parentNode}h=m}n=a===-1||l===-1?null:{start:a,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(gm={focusedElem:t,selectionRange:n},gd=!1,W=e;W!==null;)if(e=W,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,W=t;else for(;W!==null;){e=W;try{var y=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(y!==null){var v=y.memoizedProps,w=y.memoizedState,x=e.stateNode,S=x.getSnapshotBeforeUpdate(e.elementType===e.type?v:On(e.type,v),w);x.__reactInternalSnapshotBeforeUpdate=S}break;case 3:var b=e.stateNode.containerInfo;b.nodeType===1?b.textContent="":b.nodeType===9&&b.documentElement&&b.removeChild(b.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(B(163))}}catch(N){Ue(e,e.return,N)}if(t=e.sibling,t!==null){t.return=e.return,W=t;break}W=e.return}return y=mw,mw=!1,y}function gl(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&t)===t){var i=s.destroy;s.destroy=void 0,i!==void 0&&Pm(e,n,i)}s=s.next}while(s!==r)}}function _h(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function Dm(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function gT(t){var e=t.alternate;e!==null&&(t.alternate=null,gT(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Qn],delete e[Ul],delete e[_m],delete e[BR],delete e[zR])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function yT(t){return t.tag===5||t.tag===3||t.tag===4}function gw(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||yT(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Om(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=_d));else if(r!==4&&(t=t.child,t!==null))for(Om(t,e,n),t=t.sibling;t!==null;)Om(t,e,n),t=t.sibling}function Mm(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(Mm(t,e,n),t=t.sibling;t!==null;)Mm(t,e,n),t=t.sibling}var lt=null,Mn=!1;function Gr(t,e,n){for(n=n.child;n!==null;)vT(t,e,n),n=n.sibling}function vT(t,e,n){if(Xn&&typeof Xn.onCommitFiberUnmount=="function")try{Xn.onCommitFiberUnmount(dh,n)}catch{}switch(n.tag){case 5:Ct||bo(n,e);case 6:var r=lt,s=Mn;lt=null,Gr(t,e,n),lt=r,Mn=s,lt!==null&&(Mn?(t=lt,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):lt.removeChild(n.stateNode));break;case 18:lt!==null&&(Mn?(t=lt,n=n.stateNode,t.nodeType===8?Xf(t.parentNode,n):t.nodeType===1&&Xf(t,n),Ml(t)):Xf(lt,n.stateNode));break;case 4:r=lt,s=Mn,lt=n.stateNode.containerInfo,Mn=!0,Gr(t,e,n),lt=r,Mn=s;break;case 0:case 11:case 14:case 15:if(!Ct&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&Pm(n,e,o),s=s.next}while(s!==r)}Gr(t,e,n);break;case 1:if(!Ct&&(bo(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(a){Ue(n,e,a)}Gr(t,e,n);break;case 21:Gr(t,e,n);break;case 22:n.mode&1?(Ct=(r=Ct)||n.memoizedState!==null,Gr(t,e,n),Ct=r):Gr(t,e,n);break;default:Gr(t,e,n)}}function yw(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new sP),e.forEach(function(r){var s=pP.bind(null,t,r);n.has(r)||(n.add(r),r.then(s,s))})}}function Pn(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var i=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:lt=a.stateNode,Mn=!1;break e;case 3:lt=a.stateNode.containerInfo,Mn=!0;break e;case 4:lt=a.stateNode.containerInfo,Mn=!0;break e}a=a.return}if(lt===null)throw Error(B(160));vT(i,o,s),lt=null,Mn=!1;var l=s.alternate;l!==null&&(l.return=null),s.return=null}catch(u){Ue(s,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)_T(e,t),e=e.sibling}function _T(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Pn(e,t),Hn(t),r&4){try{gl(3,t,t.return),_h(3,t)}catch(v){Ue(t,t.return,v)}try{gl(5,t,t.return)}catch(v){Ue(t,t.return,v)}}break;case 1:Pn(e,t),Hn(t),r&512&&n!==null&&bo(n,n.return);break;case 5:if(Pn(e,t),Hn(t),r&512&&n!==null&&bo(n,n.return),t.flags&32){var s=t.stateNode;try{Rl(s,"")}catch(v){Ue(t,t.return,v)}}if(r&4&&(s=t.stateNode,s!=null)){var i=t.memoizedProps,o=n!==null?n.memoizedProps:i,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&i.type==="radio"&&i.name!=null&&BS(s,i),im(a,o);var u=im(a,i);for(o=0;o<l.length;o+=2){var d=l[o],h=l[o+1];d==="style"?WS(s,h):d==="dangerouslySetInnerHTML"?qS(s,h):d==="children"?Rl(s,h):qg(s,d,h,u)}switch(a){case"input":em(s,i);break;case"textarea":zS(s,i);break;case"select":var f=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var m=i.value;m!=null?Co(s,!!i.multiple,m,!1):f!==!!i.multiple&&(i.defaultValue!=null?Co(s,!!i.multiple,i.defaultValue,!0):Co(s,!!i.multiple,i.multiple?[]:"",!1))}s[Ul]=i}catch(v){Ue(t,t.return,v)}}break;case 6:if(Pn(e,t),Hn(t),r&4){if(t.stateNode===null)throw Error(B(162));s=t.stateNode,i=t.memoizedProps;try{s.nodeValue=i}catch(v){Ue(t,t.return,v)}}break;case 3:if(Pn(e,t),Hn(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Ml(e.containerInfo)}catch(v){Ue(t,t.return,v)}break;case 4:Pn(e,t),Hn(t);break;case 13:Pn(e,t),Hn(t),s=t.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(Sy=qe())),r&4&&yw(t);break;case 22:if(d=n!==null&&n.memoizedState!==null,t.mode&1?(Ct=(u=Ct)||d,Pn(e,t),Ct=u):Pn(e,t),Hn(t),r&8192){if(u=t.memoizedState!==null,(t.stateNode.isHidden=u)&&!d&&t.mode&1)for(W=t,d=t.child;d!==null;){for(h=W=d;W!==null;){switch(f=W,m=f.child,f.tag){case 0:case 11:case 14:case 15:gl(4,f,f.return);break;case 1:bo(f,f.return);var y=f.stateNode;if(typeof y.componentWillUnmount=="function"){r=f,n=f.return;try{e=r,y.props=e.memoizedProps,y.state=e.memoizedState,y.componentWillUnmount()}catch(v){Ue(r,n,v)}}break;case 5:bo(f,f.return);break;case 22:if(f.memoizedState!==null){_w(h);continue}}m!==null?(m.return=f,W=m):_w(h)}d=d.sibling}e:for(d=null,h=t;;){if(h.tag===5){if(d===null){d=h;try{s=h.stateNode,u?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(a=h.stateNode,l=h.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=HS("display",o))}catch(v){Ue(t,t.return,v)}}}else if(h.tag===6){if(d===null)try{h.stateNode.nodeValue=u?"":h.memoizedProps}catch(v){Ue(t,t.return,v)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===t)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===t)break e;for(;h.sibling===null;){if(h.return===null||h.return===t)break e;d===h&&(d=null),h=h.return}d===h&&(d=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:Pn(e,t),Hn(t),r&4&&yw(t);break;case 21:break;default:Pn(e,t),Hn(t)}}function Hn(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(yT(n)){var r=n;break e}n=n.return}throw Error(B(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(Rl(s,""),r.flags&=-33);var i=gw(t);Mm(t,i,s);break;case 3:case 4:var o=r.stateNode.containerInfo,a=gw(t);Om(t,a,o);break;default:throw Error(B(161))}}catch(l){Ue(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function oP(t,e,n){W=t,wT(t)}function wT(t,e,n){for(var r=(t.mode&1)!==0;W!==null;){var s=W,i=s.child;if(s.tag===22&&r){var o=s.memoizedState!==null||_c;if(!o){var a=s.alternate,l=a!==null&&a.memoizedState!==null||Ct;a=_c;var u=Ct;if(_c=o,(Ct=l)&&!u)for(W=s;W!==null;)o=W,l=o.child,o.tag===22&&o.memoizedState!==null?ww(s):l!==null?(l.return=o,W=l):ww(s);for(;i!==null;)W=i,wT(i),i=i.sibling;W=s,_c=a,Ct=u}vw(t)}else s.subtreeFlags&8772&&i!==null?(i.return=s,W=i):vw(t)}}function vw(t){for(;W!==null;){var e=W;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Ct||_h(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Ct)if(n===null)r.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:On(e.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&nw(e,i,r);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}nw(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var d=u.memoizedState;if(d!==null){var h=d.dehydrated;h!==null&&Ml(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(B(163))}Ct||e.flags&512&&Dm(e)}catch(f){Ue(e,e.return,f)}}if(e===t){W=null;break}if(n=e.sibling,n!==null){n.return=e.return,W=n;break}W=e.return}}function _w(t){for(;W!==null;){var e=W;if(e===t){W=null;break}var n=e.sibling;if(n!==null){n.return=e.return,W=n;break}W=e.return}}function ww(t){for(;W!==null;){var e=W;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{_h(4,e)}catch(l){Ue(e,n,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(l){Ue(e,s,l)}}var i=e.return;try{Dm(e)}catch(l){Ue(e,i,l)}break;case 5:var o=e.return;try{Dm(e)}catch(l){Ue(e,o,l)}}}catch(l){Ue(e,e.return,l)}if(e===t){W=null;break}var a=e.sibling;if(a!==null){a.return=e.return,W=a;break}W=e.return}}var aP=Math.ceil,Nd=Br.ReactCurrentDispatcher,xy=Br.ReactCurrentOwner,bn=Br.ReactCurrentBatchConfig,fe=0,rt=null,Ge=null,mt=0,an=0,To=Hs(0),Ze=0,Wl=null,Pi=0,wh=0,Ey=0,yl=null,Gt=null,Sy=0,Go=1/0,gr=null,Rd=!1,Lm=null,xs=null,wc=!1,cs=null,Pd=0,vl=0,Vm=null,Qc=-1,Jc=0;function Ft(){return fe&6?qe():Qc!==-1?Qc:Qc=qe()}function Es(t){return t.mode&1?fe&2&&mt!==0?mt&-mt:qR.transition!==null?(Jc===0&&(Jc=sb()),Jc):(t=ye,t!==0||(t=window.event,t=t===void 0?16:db(t.type)),t):1}function Un(t,e,n,r){if(50<vl)throw vl=0,Vm=null,Error(B(185));yu(t,n,r),(!(fe&2)||t!==rt)&&(t===rt&&(!(fe&2)&&(wh|=n),Ze===4&&ns(t,mt)),Zt(t,r),n===1&&fe===0&&!(e.mode&1)&&(Go=qe()+500,gh&&Ws()))}function Zt(t,e){var n=t.callbackNode;qN(t,e);var r=md(t,t===rt?mt:0);if(r===0)n!==null&&A_(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&A_(n),e===1)t.tag===0?$R(xw.bind(null,t)):Nb(xw.bind(null,t)),FR(function(){!(fe&6)&&Ws()}),n=null;else{switch(ib(r)){case 1:n=Qg;break;case 4:n=nb;break;case 16:n=pd;break;case 536870912:n=rb;break;default:n=pd}n=CT(n,xT.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function xT(t,e){if(Qc=-1,Jc=0,fe&6)throw Error(B(327));var n=t.callbackNode;if(Do()&&t.callbackNode!==n)return null;var r=md(t,t===rt?mt:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=Dd(t,r);else{e=r;var s=fe;fe|=2;var i=ST();(rt!==t||mt!==e)&&(gr=null,Go=qe()+500,_i(t,e));do try{cP();break}catch(a){ET(t,a)}while(!0);ly(),Nd.current=i,fe=s,Ge!==null?e=0:(rt=null,mt=0,e=Ze)}if(e!==0){if(e===2&&(s=cm(t),s!==0&&(r=s,e=jm(t,s))),e===1)throw n=Wl,_i(t,0),ns(t,r),Zt(t,qe()),n;if(e===6)ns(t,r);else{if(s=t.current.alternate,!(r&30)&&!lP(s)&&(e=Dd(t,r),e===2&&(i=cm(t),i!==0&&(r=i,e=jm(t,i))),e===1))throw n=Wl,_i(t,0),ns(t,r),Zt(t,qe()),n;switch(t.finishedWork=s,t.finishedLanes=r,e){case 0:case 1:throw Error(B(345));case 2:oi(t,Gt,gr);break;case 3:if(ns(t,r),(r&130023424)===r&&(e=Sy+500-qe(),10<e)){if(md(t,0)!==0)break;if(s=t.suspendedLanes,(s&r)!==r){Ft(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=vm(oi.bind(null,t,Gt,gr),e);break}oi(t,Gt,gr);break;case 4:if(ns(t,r),(r&4194240)===r)break;for(e=t.eventTimes,s=-1;0<r;){var o=31-Fn(r);i=1<<o,o=e[o],o>s&&(s=o),r&=~i}if(r=s,r=qe()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*aP(r/1960))-r,10<r){t.timeoutHandle=vm(oi.bind(null,t,Gt,gr),r);break}oi(t,Gt,gr);break;case 5:oi(t,Gt,gr);break;default:throw Error(B(329))}}}return Zt(t,qe()),t.callbackNode===n?xT.bind(null,t):null}function jm(t,e){var n=yl;return t.current.memoizedState.isDehydrated&&(_i(t,e).flags|=256),t=Dd(t,e),t!==2&&(e=Gt,Gt=n,e!==null&&Fm(e)),t}function Fm(t){Gt===null?Gt=t:Gt.push.apply(Gt,t)}function lP(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],i=s.getSnapshot;s=s.value;try{if(!$n(i(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function ns(t,e){for(e&=~Ey,e&=~wh,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Fn(e),r=1<<n;t[n]=-1,e&=~r}}function xw(t){if(fe&6)throw Error(B(327));Do();var e=md(t,0);if(!(e&1))return Zt(t,qe()),null;var n=Dd(t,e);if(t.tag!==0&&n===2){var r=cm(t);r!==0&&(e=r,n=jm(t,r))}if(n===1)throw n=Wl,_i(t,0),ns(t,e),Zt(t,qe()),n;if(n===6)throw Error(B(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,oi(t,Gt,gr),Zt(t,qe()),null}function by(t,e){var n=fe;fe|=1;try{return t(e)}finally{fe=n,fe===0&&(Go=qe()+500,gh&&Ws())}}function Di(t){cs!==null&&cs.tag===0&&!(fe&6)&&Do();var e=fe;fe|=1;var n=bn.transition,r=ye;try{if(bn.transition=null,ye=1,t)return t()}finally{ye=r,bn.transition=n,fe=e,!(fe&6)&&Ws()}}function Ty(){an=To.current,Ce(To)}function _i(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,jR(n)),Ge!==null)for(n=Ge.return;n!==null;){var r=n;switch(iy(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&wd();break;case 3:Wo(),Ce(Yt),Ce(Pt),py();break;case 5:fy(r);break;case 4:Wo();break;case 13:Ce(Oe);break;case 19:Ce(Oe);break;case 10:uy(r.type._context);break;case 22:case 23:Ty()}n=n.return}if(rt=t,Ge=t=Ss(t.current,null),mt=an=e,Ze=0,Wl=null,Ey=wh=Pi=0,Gt=yl=null,hi!==null){for(e=0;e<hi.length;e++)if(n=hi[e],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,i=n.pending;if(i!==null){var o=i.next;i.next=s,r.next=o}n.pending=r}hi=null}return t}function ET(t,e){do{var n=Ge;try{if(ly(),Wc.current=Ad,Cd){for(var r=Me.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}Cd=!1}if(Ri=0,tt=Ye=Me=null,ml=!1,$l=0,xy.current=null,n===null||n.return===null){Ze=1,Wl=e,Ge=null;break}e:{var i=t,o=n.return,a=n,l=e;if(e=mt,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,d=a,h=d.tag;if(!(d.mode&1)&&(h===0||h===11||h===15)){var f=d.alternate;f?(d.updateQueue=f.updateQueue,d.memoizedState=f.memoizedState,d.lanes=f.lanes):(d.updateQueue=null,d.memoizedState=null)}var m=lw(o);if(m!==null){m.flags&=-257,uw(m,o,a,i,e),m.mode&1&&aw(i,u,e),e=m,l=u;var y=e.updateQueue;if(y===null){var v=new Set;v.add(l),e.updateQueue=v}else y.add(l);break e}else{if(!(e&1)){aw(i,u,e),ky();break e}l=Error(B(426))}}else if(Pe&&a.mode&1){var w=lw(o);if(w!==null){!(w.flags&65536)&&(w.flags|=256),uw(w,o,a,i,e),oy(Ko(l,a));break e}}i=l=Ko(l,a),Ze!==4&&(Ze=2),yl===null?yl=[i]:yl.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var x=iT(i,l,e);tw(i,x);break e;case 1:a=l;var S=i.type,b=i.stateNode;if(!(i.flags&128)&&(typeof S.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(xs===null||!xs.has(b)))){i.flags|=65536,e&=-e,i.lanes|=e;var N=oT(i,a,e);tw(i,N);break e}}i=i.return}while(i!==null)}TT(n)}catch(M){e=M,Ge===n&&n!==null&&(Ge=n=n.return);continue}break}while(!0)}function ST(){var t=Nd.current;return Nd.current=Ad,t===null?Ad:t}function ky(){(Ze===0||Ze===3||Ze===2)&&(Ze=4),rt===null||!(Pi&268435455)&&!(wh&268435455)||ns(rt,mt)}function Dd(t,e){var n=fe;fe|=2;var r=ST();(rt!==t||mt!==e)&&(gr=null,_i(t,e));do try{uP();break}catch(s){ET(t,s)}while(!0);if(ly(),fe=n,Nd.current=r,Ge!==null)throw Error(B(261));return rt=null,mt=0,Ze}function uP(){for(;Ge!==null;)bT(Ge)}function cP(){for(;Ge!==null&&!MN();)bT(Ge)}function bT(t){var e=IT(t.alternate,t,an);t.memoizedProps=t.pendingProps,e===null?TT(t):Ge=e,xy.current=null}function TT(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=rP(n,e),n!==null){n.flags&=32767,Ge=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Ze=6,Ge=null;return}}else if(n=nP(n,e,an),n!==null){Ge=n;return}if(e=e.sibling,e!==null){Ge=e;return}Ge=e=t}while(e!==null);Ze===0&&(Ze=5)}function oi(t,e,n){var r=ye,s=bn.transition;try{bn.transition=null,ye=1,dP(t,e,n,r)}finally{bn.transition=s,ye=r}return null}function dP(t,e,n,r){do Do();while(cs!==null);if(fe&6)throw Error(B(327));n=t.finishedWork;var s=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(B(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(HN(t,i),t===rt&&(Ge=rt=null,mt=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||wc||(wc=!0,CT(pd,function(){return Do(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=bn.transition,bn.transition=null;var o=ye;ye=1;var a=fe;fe|=4,xy.current=null,iP(t,n),_T(n,t),RR(gm),gd=!!mm,gm=mm=null,t.current=n,oP(n),LN(),fe=a,ye=o,bn.transition=i}else t.current=n;if(wc&&(wc=!1,cs=t,Pd=s),i=t.pendingLanes,i===0&&(xs=null),FN(n.stateNode),Zt(t,qe()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)s=e[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(Rd)throw Rd=!1,t=Lm,Lm=null,t;return Pd&1&&t.tag!==0&&Do(),i=t.pendingLanes,i&1?t===Vm?vl++:(vl=0,Vm=t):vl=0,Ws(),null}function Do(){if(cs!==null){var t=ib(Pd),e=bn.transition,n=ye;try{if(bn.transition=null,ye=16>t?16:t,cs===null)var r=!1;else{if(t=cs,cs=null,Pd=0,fe&6)throw Error(B(331));var s=fe;for(fe|=4,W=t.current;W!==null;){var i=W,o=i.child;if(W.flags&16){var a=i.deletions;if(a!==null){for(var l=0;l<a.length;l++){var u=a[l];for(W=u;W!==null;){var d=W;switch(d.tag){case 0:case 11:case 15:gl(8,d,i)}var h=d.child;if(h!==null)h.return=d,W=h;else for(;W!==null;){d=W;var f=d.sibling,m=d.return;if(gT(d),d===u){W=null;break}if(f!==null){f.return=m,W=f;break}W=m}}}var y=i.alternate;if(y!==null){var v=y.child;if(v!==null){y.child=null;do{var w=v.sibling;v.sibling=null,v=w}while(v!==null)}}W=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,W=o;else e:for(;W!==null;){if(i=W,i.flags&2048)switch(i.tag){case 0:case 11:case 15:gl(9,i,i.return)}var x=i.sibling;if(x!==null){x.return=i.return,W=x;break e}W=i.return}}var S=t.current;for(W=S;W!==null;){o=W;var b=o.child;if(o.subtreeFlags&2064&&b!==null)b.return=o,W=b;else e:for(o=S;W!==null;){if(a=W,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:_h(9,a)}}catch(M){Ue(a,a.return,M)}if(a===o){W=null;break e}var N=a.sibling;if(N!==null){N.return=a.return,W=N;break e}W=a.return}}if(fe=s,Ws(),Xn&&typeof Xn.onPostCommitFiberRoot=="function")try{Xn.onPostCommitFiberRoot(dh,t)}catch{}r=!0}return r}finally{ye=n,bn.transition=e}}return!1}function Ew(t,e,n){e=Ko(n,e),e=iT(t,e,1),t=ws(t,e,1),e=Ft(),t!==null&&(yu(t,1,e),Zt(t,e))}function Ue(t,e,n){if(t.tag===3)Ew(t,t,n);else for(;e!==null;){if(e.tag===3){Ew(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(xs===null||!xs.has(r))){t=Ko(n,t),t=oT(e,t,1),e=ws(e,t,1),t=Ft(),e!==null&&(yu(e,1,t),Zt(e,t));break}}e=e.return}}function hP(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=Ft(),t.pingedLanes|=t.suspendedLanes&n,rt===t&&(mt&n)===n&&(Ze===4||Ze===3&&(mt&130023424)===mt&&500>qe()-Sy?_i(t,0):Ey|=n),Zt(t,e)}function kT(t,e){e===0&&(t.mode&1?(e=cc,cc<<=1,!(cc&130023424)&&(cc=4194304)):e=1);var n=Ft();t=Or(t,e),t!==null&&(yu(t,e,n),Zt(t,n))}function fP(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),kT(t,n)}function pP(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(B(314))}r!==null&&r.delete(e),kT(t,n)}var IT;IT=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Yt.current)Jt=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Jt=!1,tP(t,e,n);Jt=!!(t.flags&131072)}else Jt=!1,Pe&&e.flags&1048576&&Rb(e,Sd,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Gc(t,e),t=e.pendingProps;var s=$o(e,Pt.current);Po(e,n),s=gy(null,e,r,t,s,n);var i=yy();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Xt(r)?(i=!0,xd(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,dy(e),s.updater=vh,e.stateNode=s,s._reactInternals=e,Tm(e,r,t,n),e=Cm(null,e,r,!0,i,n)):(e.tag=0,Pe&&i&&sy(e),jt(null,e,s,n),e=e.child),e;case 16:r=e.elementType;e:{switch(Gc(t,e),t=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=gP(r),t=On(r,t),s){case 0:e=Im(null,e,r,t,n);break e;case 1:e=hw(null,e,r,t,n);break e;case 11:e=cw(null,e,r,t,n);break e;case 14:e=dw(null,e,r,On(r.type,t),n);break e}throw Error(B(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:On(r,s),Im(t,e,r,s,n);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:On(r,s),hw(t,e,r,s,n);case 3:e:{if(cT(e),t===null)throw Error(B(387));r=e.pendingProps,i=e.memoizedState,s=i.element,Vb(t,e),kd(e,r,null,n);var o=e.memoizedState;if(r=o.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=Ko(Error(B(423)),e),e=fw(t,e,r,n,s);break e}else if(r!==s){s=Ko(Error(B(424)),e),e=fw(t,e,r,n,s);break e}else for(un=_s(e.stateNode.containerInfo.firstChild),hn=e,Pe=!0,Ln=null,n=Mb(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(qo(),r===s){e=Mr(t,e,n);break e}jt(t,e,r,n)}e=e.child}return e;case 5:return jb(e),t===null&&Em(e),r=e.type,s=e.pendingProps,i=t!==null?t.memoizedProps:null,o=s.children,ym(r,s)?o=null:i!==null&&ym(r,i)&&(e.flags|=32),uT(t,e),jt(t,e,o,n),e.child;case 6:return t===null&&Em(e),null;case 13:return dT(t,e,n);case 4:return hy(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=Ho(e,null,r,n):jt(t,e,r,n),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:On(r,s),cw(t,e,r,s,n);case 7:return jt(t,e,e.pendingProps,n),e.child;case 8:return jt(t,e,e.pendingProps.children,n),e.child;case 12:return jt(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,o=s.value,Se(bd,r._currentValue),r._currentValue=o,i!==null)if($n(i.value,o)){if(i.children===s.children&&!Yt.current){e=Mr(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var a=i.dependencies;if(a!==null){o=i.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(i.tag===1){l=kr(-1,n&-n),l.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var d=u.pending;d===null?l.next=l:(l.next=d.next,d.next=l),u.pending=l}}i.lanes|=n,l=i.alternate,l!==null&&(l.lanes|=n),Sm(i.return,n,e),a.lanes|=n;break}l=l.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(B(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),Sm(o,n,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}jt(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,Po(e,n),s=Cn(s),r=r(s),e.flags|=1,jt(t,e,r,n),e.child;case 14:return r=e.type,s=On(r,e.pendingProps),s=On(r.type,s),dw(t,e,r,s,n);case 15:return aT(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:On(r,s),Gc(t,e),e.tag=1,Xt(r)?(t=!0,xd(e)):t=!1,Po(e,n),sT(e,r,s),Tm(e,r,s,n),Cm(null,e,r,!0,t,n);case 19:return hT(t,e,n);case 22:return lT(t,e,n)}throw Error(B(156,e.tag))};function CT(t,e){return tb(t,e)}function mP(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function xn(t,e,n,r){return new mP(t,e,n,r)}function Iy(t){return t=t.prototype,!(!t||!t.isReactComponent)}function gP(t){if(typeof t=="function")return Iy(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Wg)return 11;if(t===Kg)return 14}return 2}function Ss(t,e){var n=t.alternate;return n===null?(n=xn(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Yc(t,e,n,r,s,i){var o=2;if(r=t,typeof t=="function")Iy(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case mo:return wi(n.children,s,i,e);case Hg:o=8,s|=8;break;case Qp:return t=xn(12,n,e,s|2),t.elementType=Qp,t.lanes=i,t;case Jp:return t=xn(13,n,e,s),t.elementType=Jp,t.lanes=i,t;case Yp:return t=xn(19,n,e,s),t.elementType=Yp,t.lanes=i,t;case jS:return xh(n,s,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case LS:o=10;break e;case VS:o=9;break e;case Wg:o=11;break e;case Kg:o=14;break e;case Yr:o=16,r=null;break e}throw Error(B(130,t==null?t:typeof t,""))}return e=xn(o,n,e,s),e.elementType=t,e.type=r,e.lanes=i,e}function wi(t,e,n,r){return t=xn(7,t,r,e),t.lanes=n,t}function xh(t,e,n,r){return t=xn(22,t,r,e),t.elementType=jS,t.lanes=n,t.stateNode={isHidden:!1},t}function op(t,e,n){return t=xn(6,t,null,e),t.lanes=n,t}function ap(t,e,n){return e=xn(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function yP(t,e,n,r,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Bf(0),this.expirationTimes=Bf(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Bf(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function Cy(t,e,n,r,s,i,o,a,l){return t=new yP(t,e,n,a,l),e===1?(e=1,i===!0&&(e|=8)):e=0,i=xn(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},dy(i),t}function vP(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:po,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function AT(t){if(!t)return Os;t=t._reactInternals;e:{if(Wi(t)!==t||t.tag!==1)throw Error(B(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Xt(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(B(171))}if(t.tag===1){var n=t.type;if(Xt(n))return Ab(t,n,e)}return e}function NT(t,e,n,r,s,i,o,a,l){return t=Cy(n,r,!0,t,s,i,o,a,l),t.context=AT(null),n=t.current,r=Ft(),s=Es(n),i=kr(r,s),i.callback=e??null,ws(n,i,s),t.current.lanes=s,yu(t,s,r),Zt(t,r),t}function Eh(t,e,n,r){var s=e.current,i=Ft(),o=Es(s);return n=AT(n),e.context===null?e.context=n:e.pendingContext=n,e=kr(i,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=ws(s,e,o),t!==null&&(Un(t,s,o,i),Hc(t,s,o)),o}function Od(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Sw(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Ay(t,e){Sw(t,e),(t=t.alternate)&&Sw(t,e)}function _P(){return null}var RT=typeof reportError=="function"?reportError:function(t){console.error(t)};function Ny(t){this._internalRoot=t}Sh.prototype.render=Ny.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(B(409));Eh(t,e,null,null)};Sh.prototype.unmount=Ny.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Di(function(){Eh(null,t,null,null)}),e[Dr]=null}};function Sh(t){this._internalRoot=t}Sh.prototype.unstable_scheduleHydration=function(t){if(t){var e=lb();t={blockedOn:null,target:t,priority:e};for(var n=0;n<ts.length&&e!==0&&e<ts[n].priority;n++);ts.splice(n,0,t),n===0&&cb(t)}};function Ry(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function bh(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function bw(){}function wP(t,e,n,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var u=Od(o);i.call(u)}}var o=NT(e,r,t,0,null,!1,!1,"",bw);return t._reactRootContainer=o,t[Dr]=o.current,jl(t.nodeType===8?t.parentNode:t),Di(),o}for(;s=t.lastChild;)t.removeChild(s);if(typeof r=="function"){var a=r;r=function(){var u=Od(l);a.call(u)}}var l=Cy(t,0,!1,null,null,!1,!1,"",bw);return t._reactRootContainer=l,t[Dr]=l.current,jl(t.nodeType===8?t.parentNode:t),Di(function(){Eh(e,l,n,r)}),l}function Th(t,e,n,r,s){var i=n._reactRootContainer;if(i){var o=i;if(typeof s=="function"){var a=s;s=function(){var l=Od(o);a.call(l)}}Eh(e,o,t,s)}else o=wP(n,e,t,s,r);return Od(o)}ob=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Xa(e.pendingLanes);n!==0&&(Jg(e,n|1),Zt(e,qe()),!(fe&6)&&(Go=qe()+500,Ws()))}break;case 13:Di(function(){var r=Or(t,1);if(r!==null){var s=Ft();Un(r,t,1,s)}}),Ay(t,1)}};Yg=function(t){if(t.tag===13){var e=Or(t,134217728);if(e!==null){var n=Ft();Un(e,t,134217728,n)}Ay(t,134217728)}};ab=function(t){if(t.tag===13){var e=Es(t),n=Or(t,e);if(n!==null){var r=Ft();Un(n,t,e,r)}Ay(t,e)}};lb=function(){return ye};ub=function(t,e){var n=ye;try{return ye=t,e()}finally{ye=n}};am=function(t,e,n){switch(e){case"input":if(em(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var s=mh(r);if(!s)throw Error(B(90));US(r),em(r,s)}}}break;case"textarea":zS(t,n);break;case"select":e=n.value,e!=null&&Co(t,!!n.multiple,e,!1)}};QS=by;JS=Di;var xP={usingClientEntryPoint:!1,Events:[_u,_o,mh,KS,GS,by]},Ha={findFiberByHostInstance:di,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},EP={bundleType:Ha.bundleType,version:Ha.version,rendererPackageName:Ha.rendererPackageName,rendererConfig:Ha.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Br.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=ZS(t),t===null?null:t.stateNode},findFiberByHostInstance:Ha.findFiberByHostInstance||_P,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var xc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!xc.isDisabled&&xc.supportsFiber)try{dh=xc.inject(EP),Xn=xc}catch{}}mn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=xP;mn.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Ry(e))throw Error(B(200));return vP(t,e,null,n)};mn.createRoot=function(t,e){if(!Ry(t))throw Error(B(299));var n=!1,r="",s=RT;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=Cy(t,1,!1,null,null,n,!1,r,s),t[Dr]=e.current,jl(t.nodeType===8?t.parentNode:t),new Ny(e)};mn.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(B(188)):(t=Object.keys(t).join(","),Error(B(268,t)));return t=ZS(e),t=t===null?null:t.stateNode,t};mn.flushSync=function(t){return Di(t)};mn.hydrate=function(t,e,n){if(!bh(e))throw Error(B(200));return Th(null,t,e,!0,n)};mn.hydrateRoot=function(t,e,n){if(!Ry(t))throw Error(B(405));var r=n!=null&&n.hydratedSources||null,s=!1,i="",o=RT;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=NT(e,null,t,1,n??null,s,!1,i,o),t[Dr]=e.current,jl(t),r)for(t=0;t<r.length;t++)n=r[t],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new Sh(e)};mn.render=function(t,e,n){if(!bh(e))throw Error(B(200));return Th(null,t,e,!1,n)};mn.unmountComponentAtNode=function(t){if(!bh(t))throw Error(B(40));return t._reactRootContainer?(Di(function(){Th(null,null,t,!1,function(){t._reactRootContainer=null,t[Dr]=null})}),!0):!1};mn.unstable_batchedUpdates=by;mn.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!bh(n))throw Error(B(200));if(t==null||t._reactInternals===void 0)throw Error(B(38));return Th(t,e,n,!1,r)};mn.version="18.3.1-next-f1338f8080-20240426";function PT(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(PT)}catch(t){console.error(t)}}PT(),PS.exports=mn;var DT=PS.exports;const SP=wS(DT);var Tw=DT;Kp.createRoot=Tw.createRoot,Kp.hydrateRoot=Tw.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Kl(){return Kl=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Kl.apply(this,arguments)}var ds;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(ds||(ds={}));const kw="popstate";function bP(t){t===void 0&&(t={});function e(r,s){let{pathname:i,search:o,hash:a}=r.location;return Um("",{pathname:i,search:o,hash:a},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function n(r,s){return typeof s=="string"?s:Md(s)}return kP(e,n,null,t)}function He(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function OT(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function TP(){return Math.random().toString(36).substr(2,8)}function Iw(t,e){return{usr:t.state,key:t.key,idx:e}}function Um(t,e,n,r){return n===void 0&&(n=null),Kl({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?ma(e):e,{state:n,key:e&&e.key||r||TP()})}function Md(t){let{pathname:e="/",search:n="",hash:r=""}=t;return n&&n!=="?"&&(e+=n.charAt(0)==="?"?n:"?"+n),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function ma(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substr(r),t=t.substr(0,r)),t&&(e.pathname=t)}return e}function kP(t,e,n,r){r===void 0&&(r={});let{window:s=document.defaultView,v5Compat:i=!1}=r,o=s.history,a=ds.Pop,l=null,u=d();u==null&&(u=0,o.replaceState(Kl({},o.state,{idx:u}),""));function d(){return(o.state||{idx:null}).idx}function h(){a=ds.Pop;let w=d(),x=w==null?null:w-u;u=w,l&&l({action:a,location:v.location,delta:x})}function f(w,x){a=ds.Push;let S=Um(v.location,w,x);u=d()+1;let b=Iw(S,u),N=v.createHref(S);try{o.pushState(b,"",N)}catch(M){if(M instanceof DOMException&&M.name==="DataCloneError")throw M;s.location.assign(N)}i&&l&&l({action:a,location:v.location,delta:1})}function m(w,x){a=ds.Replace;let S=Um(v.location,w,x);u=d();let b=Iw(S,u),N=v.createHref(S);o.replaceState(b,"",N),i&&l&&l({action:a,location:v.location,delta:0})}function y(w){let x=s.location.origin!=="null"?s.location.origin:s.location.href,S=typeof w=="string"?w:Md(w);return S=S.replace(/ $/,"%20"),He(x,"No window.location.(origin|href) available to create URL for href: "+S),new URL(S,x)}let v={get action(){return a},get location(){return t(s,o)},listen(w){if(l)throw new Error("A history only accepts one active listener");return s.addEventListener(kw,h),l=w,()=>{s.removeEventListener(kw,h),l=null}},createHref(w){return e(s,w)},createURL:y,encodeLocation(w){let x=y(w);return{pathname:x.pathname,search:x.search,hash:x.hash}},push:f,replace:m,go(w){return o.go(w)}};return v}var Cw;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(Cw||(Cw={}));function IP(t,e,n){return n===void 0&&(n="/"),CP(t,e,n)}function CP(t,e,n,r){let s=typeof e=="string"?ma(e):e,i=Py(s.pathname||"/",n);if(i==null)return null;let o=MT(t);AP(o);let a=null;for(let l=0;a==null&&l<o.length;++l){let u=BP(i);a=jP(o[l],u)}return a}function MT(t,e,n,r){e===void 0&&(e=[]),n===void 0&&(n=[]),r===void 0&&(r="");let s=(i,o,a)=>{let l={relativePath:a===void 0?i.path||"":a,caseSensitive:i.caseSensitive===!0,childrenIndex:o,route:i};l.relativePath.startsWith("/")&&(He(l.relativePath.startsWith(r),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(r.length));let u=bs([r,l.relativePath]),d=n.concat(l);i.children&&i.children.length>0&&(He(i.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+u+'".')),MT(i.children,e,d,u)),!(i.path==null&&!i.index)&&e.push({path:u,score:LP(u,i.index),routesMeta:d})};return t.forEach((i,o)=>{var a;if(i.path===""||!((a=i.path)!=null&&a.includes("?")))s(i,o);else for(let l of LT(i.path))s(i,o,l)}),e}function LT(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,s=n.endsWith("?"),i=n.replace(/\?$/,"");if(r.length===0)return s?[i,""]:[i];let o=LT(r.join("/")),a=[];return a.push(...o.map(l=>l===""?i:[i,l].join("/"))),s&&a.push(...o),a.map(l=>t.startsWith("/")&&l===""?"/":l)}function AP(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:VP(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}const NP=/^:[\w-]+$/,RP=3,PP=2,DP=1,OP=10,MP=-2,Aw=t=>t==="*";function LP(t,e){let n=t.split("/"),r=n.length;return n.some(Aw)&&(r+=MP),e&&(r+=PP),n.filter(s=>!Aw(s)).reduce((s,i)=>s+(NP.test(i)?RP:i===""?DP:OP),r)}function VP(t,e){return t.length===e.length&&t.slice(0,-1).every((r,s)=>r===e[s])?t[t.length-1]-e[e.length-1]:0}function jP(t,e,n){let{routesMeta:r}=t,s={},i="/",o=[];for(let a=0;a<r.length;++a){let l=r[a],u=a===r.length-1,d=i==="/"?e:e.slice(i.length)||"/",h=FP({path:l.relativePath,caseSensitive:l.caseSensitive,end:u},d),f=l.route;if(!h)return null;Object.assign(s,h.params),o.push({params:s,pathname:bs([i,h.pathname]),pathnameBase:HP(bs([i,h.pathnameBase])),route:f}),h.pathnameBase!=="/"&&(i=bs([i,h.pathnameBase]))}return o}function FP(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=UP(t.path,t.caseSensitive,t.end),s=e.match(n);if(!s)return null;let i=s[0],o=i.replace(/(.)\/+$/,"$1"),a=s.slice(1);return{params:r.reduce((u,d,h)=>{let{paramName:f,isOptional:m}=d;if(f==="*"){let v=a[h]||"";o=i.slice(0,i.length-v.length).replace(/(.)\/+$/,"$1")}const y=a[h];return m&&!y?u[f]=void 0:u[f]=(y||"").replace(/%2F/g,"/"),u},{}),pathname:i,pathnameBase:o,pattern:t}}function UP(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!0),OT(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let r=[],s="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,l)=>(r.push({paramName:a,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(r.push({paramName:"*"}),s+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?s+="\\/*$":t!==""&&t!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function BP(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return OT(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function Py(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}function zP(t,e){e===void 0&&(e="/");let{pathname:n,search:r="",hash:s=""}=typeof t=="string"?ma(t):t;return{pathname:n?n.startsWith("/")?n:$P(n,e):e,search:WP(r),hash:KP(s)}}function $P(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(s=>{s===".."?n.length>1&&n.pop():s!=="."&&n.push(s)}),n.length>1?n.join("/"):"/"}function lp(t,e,n,r){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function qP(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function Dy(t,e){let n=qP(t);return e?n.map((r,s)=>s===n.length-1?r.pathname:r.pathnameBase):n.map(r=>r.pathnameBase)}function Oy(t,e,n,r){r===void 0&&(r=!1);let s;typeof t=="string"?s=ma(t):(s=Kl({},t),He(!s.pathname||!s.pathname.includes("?"),lp("?","pathname","search",s)),He(!s.pathname||!s.pathname.includes("#"),lp("#","pathname","hash",s)),He(!s.search||!s.search.includes("#"),lp("#","search","hash",s)));let i=t===""||s.pathname==="",o=i?"/":s.pathname,a;if(o==null)a=n;else{let h=e.length-1;if(!r&&o.startsWith("..")){let f=o.split("/");for(;f[0]==="..";)f.shift(),h-=1;s.pathname=f.join("/")}a=h>=0?e[h]:"/"}let l=zP(s,a),u=o&&o!=="/"&&o.endsWith("/"),d=(i||o===".")&&n.endsWith("/");return!l.pathname.endsWith("/")&&(u||d)&&(l.pathname+="/"),l}const bs=t=>t.join("/").replace(/\/\/+/g,"/"),HP=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),WP=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,KP=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function GP(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const VT=["post","put","patch","delete"];new Set(VT);const QP=["get",...VT];new Set(QP);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Gl(){return Gl=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Gl.apply(this,arguments)}const My=R.createContext(null),JP=R.createContext(null),Ks=R.createContext(null),kh=R.createContext(null),zr=R.createContext({outlet:null,matches:[],isDataRoute:!1}),jT=R.createContext(null);function YP(t,e){let{relative:n}=e===void 0?{}:e;ga()||He(!1);let{basename:r,navigator:s}=R.useContext(Ks),{hash:i,pathname:o,search:a}=UT(t,{relative:n}),l=o;return r!=="/"&&(l=o==="/"?r:bs([r,o])),s.createHref({pathname:l,search:a,hash:i})}function ga(){return R.useContext(kh)!=null}function xu(){return ga()||He(!1),R.useContext(kh).location}function FT(t){R.useContext(Ks).static||R.useLayoutEffect(t)}function $r(){let{isDataRoute:t}=R.useContext(zr);return t?cD():XP()}function XP(){ga()||He(!1);let t=R.useContext(My),{basename:e,future:n,navigator:r}=R.useContext(Ks),{matches:s}=R.useContext(zr),{pathname:i}=xu(),o=JSON.stringify(Dy(s,n.v7_relativeSplatPath)),a=R.useRef(!1);return FT(()=>{a.current=!0}),R.useCallback(function(u,d){if(d===void 0&&(d={}),!a.current)return;if(typeof u=="number"){r.go(u);return}let h=Oy(u,JSON.parse(o),i,d.relative==="path");t==null&&e!=="/"&&(h.pathname=h.pathname==="/"?e:bs([e,h.pathname])),(d.replace?r.replace:r.push)(h,d.state,d)},[e,r,o,i,t])}function Ly(){let{matches:t}=R.useContext(zr),e=t[t.length-1];return e?e.params:{}}function UT(t,e){let{relative:n}=e===void 0?{}:e,{future:r}=R.useContext(Ks),{matches:s}=R.useContext(zr),{pathname:i}=xu(),o=JSON.stringify(Dy(s,r.v7_relativeSplatPath));return R.useMemo(()=>Oy(t,JSON.parse(o),i,n==="path"),[t,o,i,n])}function ZP(t,e){return eD(t,e)}function eD(t,e,n,r){ga()||He(!1);let{navigator:s}=R.useContext(Ks),{matches:i}=R.useContext(zr),o=i[i.length-1],a=o?o.params:{};o&&o.pathname;let l=o?o.pathnameBase:"/";o&&o.route;let u=xu(),d;if(e){var h;let w=typeof e=="string"?ma(e):e;l==="/"||(h=w.pathname)!=null&&h.startsWith(l)||He(!1),d=w}else d=u;let f=d.pathname||"/",m=f;if(l!=="/"){let w=l.replace(/^\//,"").split("/");m="/"+f.replace(/^\//,"").split("/").slice(w.length).join("/")}let y=IP(t,{pathname:m}),v=iD(y&&y.map(w=>Object.assign({},w,{params:Object.assign({},a,w.params),pathname:bs([l,s.encodeLocation?s.encodeLocation(w.pathname).pathname:w.pathname]),pathnameBase:w.pathnameBase==="/"?l:bs([l,s.encodeLocation?s.encodeLocation(w.pathnameBase).pathname:w.pathnameBase])})),i,n,r);return e&&v?R.createElement(kh.Provider,{value:{location:Gl({pathname:"/",search:"",hash:"",state:null,key:"default"},d),navigationType:ds.Pop}},v):v}function tD(){let t=uD(),e=GP(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return R.createElement(R.Fragment,null,R.createElement("h2",null,"Unexpected Application Error!"),R.createElement("h3",{style:{fontStyle:"italic"}},e),n?R.createElement("pre",{style:s},n):null,null)}const nD=R.createElement(tD,null);class rD extends R.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,n){return n.location!==e.location||n.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:n.error,location:n.location,revalidation:e.revalidation||n.revalidation}}componentDidCatch(e,n){console.error("React Router caught the following error during render",e,n)}render(){return this.state.error!==void 0?R.createElement(zr.Provider,{value:this.props.routeContext},R.createElement(jT.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function sD(t){let{routeContext:e,match:n,children:r}=t,s=R.useContext(My);return s&&s.static&&s.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=n.route.id),R.createElement(zr.Provider,{value:e},r)}function iD(t,e,n,r){var s;if(e===void 0&&(e=[]),n===void 0&&(n=null),r===void 0&&(r=null),t==null){var i;if(!n)return null;if(n.errors)t=n.matches;else if((i=r)!=null&&i.v7_partialHydration&&e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let o=t,a=(s=n)==null?void 0:s.errors;if(a!=null){let d=o.findIndex(h=>h.route.id&&(a==null?void 0:a[h.route.id])!==void 0);d>=0||He(!1),o=o.slice(0,Math.min(o.length,d+1))}let l=!1,u=-1;if(n&&r&&r.v7_partialHydration)for(let d=0;d<o.length;d++){let h=o[d];if((h.route.HydrateFallback||h.route.hydrateFallbackElement)&&(u=d),h.route.id){let{loaderData:f,errors:m}=n,y=h.route.loader&&f[h.route.id]===void 0&&(!m||m[h.route.id]===void 0);if(h.route.lazy||y){l=!0,u>=0?o=o.slice(0,u+1):o=[o[0]];break}}}return o.reduceRight((d,h,f)=>{let m,y=!1,v=null,w=null;n&&(m=a&&h.route.id?a[h.route.id]:void 0,v=h.route.errorElement||nD,l&&(u<0&&f===0?(dD("route-fallback"),y=!0,w=null):u===f&&(y=!0,w=h.route.hydrateFallbackElement||null)));let x=e.concat(o.slice(0,f+1)),S=()=>{let b;return m?b=v:y?b=w:h.route.Component?b=R.createElement(h.route.Component,null):h.route.element?b=h.route.element:b=d,R.createElement(sD,{match:h,routeContext:{outlet:d,matches:x,isDataRoute:n!=null},children:b})};return n&&(h.route.ErrorBoundary||h.route.errorElement||f===0)?R.createElement(rD,{location:n.location,revalidation:n.revalidation,component:v,error:m,children:S(),routeContext:{outlet:null,matches:x,isDataRoute:!0}}):S()},null)}var BT=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(BT||{}),zT=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(zT||{});function oD(t){let e=R.useContext(My);return e||He(!1),e}function aD(t){let e=R.useContext(JP);return e||He(!1),e}function lD(t){let e=R.useContext(zr);return e||He(!1),e}function $T(t){let e=lD(),n=e.matches[e.matches.length-1];return n.route.id||He(!1),n.route.id}function uD(){var t;let e=R.useContext(jT),n=aD(),r=$T();return e!==void 0?e:(t=n.errors)==null?void 0:t[r]}function cD(){let{router:t}=oD(BT.UseNavigateStable),e=$T(zT.UseNavigateStable),n=R.useRef(!1);return FT(()=>{n.current=!0}),R.useCallback(function(s,i){i===void 0&&(i={}),n.current&&(typeof s=="number"?t.navigate(s):t.navigate(s,Gl({fromRouteId:e},i)))},[t,e])}const Nw={};function dD(t,e,n){Nw[t]||(Nw[t]=!0)}function hD(t,e){t==null||t.v7_startTransition,t==null||t.v7_relativeSplatPath}function Bm(t){let{to:e,replace:n,state:r,relative:s}=t;ga()||He(!1);let{future:i,static:o}=R.useContext(Ks),{matches:a}=R.useContext(zr),{pathname:l}=xu(),u=$r(),d=Oy(e,Dy(a,i.v7_relativeSplatPath),l,s==="path"),h=JSON.stringify(d);return R.useEffect(()=>u(JSON.parse(h),{replace:n,state:r,relative:s}),[u,h,s,n,r]),null}function Dn(t){He(!1)}function fD(t){let{basename:e="/",children:n=null,location:r,navigationType:s=ds.Pop,navigator:i,static:o=!1,future:a}=t;ga()&&He(!1);let l=e.replace(/^\/*/,"/"),u=R.useMemo(()=>({basename:l,navigator:i,static:o,future:Gl({v7_relativeSplatPath:!1},a)}),[l,a,i,o]);typeof r=="string"&&(r=ma(r));let{pathname:d="/",search:h="",hash:f="",state:m=null,key:y="default"}=r,v=R.useMemo(()=>{let w=Py(d,l);return w==null?null:{location:{pathname:w,search:h,hash:f,state:m,key:y},navigationType:s}},[l,d,h,f,m,y,s]);return v==null?null:R.createElement(Ks.Provider,{value:u},R.createElement(kh.Provider,{children:n,value:v}))}function pD(t){let{children:e,location:n}=t;return ZP(zm(e),n)}new Promise(()=>{});function zm(t,e){e===void 0&&(e=[]);let n=[];return R.Children.forEach(t,(r,s)=>{if(!R.isValidElement(r))return;let i=[...e,s];if(r.type===R.Fragment){n.push.apply(n,zm(r.props.children,i));return}r.type!==Dn&&He(!1),!r.props.index||!r.props.children||He(!1);let o={id:r.props.id||i.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=zm(r.props.children,i)),n.push(o)}),n}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function $m(){return $m=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},$m.apply(this,arguments)}function mD(t,e){if(t==null)return{};var n={},r=Object.keys(t),s,i;for(i=0;i<r.length;i++)s=r[i],!(e.indexOf(s)>=0)&&(n[s]=t[s]);return n}function gD(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function yD(t,e){return t.button===0&&(!e||e==="_self")&&!gD(t)}const vD=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],_D="6";try{window.__reactRouterVersion=_D}catch{}const wD="startTransition",Rw=hN[wD];function xD(t){let{basename:e,children:n,future:r,window:s}=t,i=R.useRef();i.current==null&&(i.current=bP({window:s,v5Compat:!0}));let o=i.current,[a,l]=R.useState({action:o.action,location:o.location}),{v7_startTransition:u}=r||{},d=R.useCallback(h=>{u&&Rw?Rw(()=>l(h)):l(h)},[l,u]);return R.useLayoutEffect(()=>o.listen(d),[o,d]),R.useEffect(()=>hD(r),[r]),R.createElement(fD,{basename:e,children:n,location:a.location,navigationType:a.action,navigator:o,future:r})}const ED=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",SD=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Bn=R.forwardRef(function(e,n){let{onClick:r,relative:s,reloadDocument:i,replace:o,state:a,target:l,to:u,preventScrollReset:d,viewTransition:h}=e,f=mD(e,vD),{basename:m}=R.useContext(Ks),y,v=!1;if(typeof u=="string"&&SD.test(u)&&(y=u,ED))try{let b=new URL(window.location.href),N=u.startsWith("//")?new URL(b.protocol+u):new URL(u),M=Py(N.pathname,m);N.origin===b.origin&&M!=null?u=M+N.search+N.hash:v=!0}catch{}let w=YP(u,{relative:s}),x=bD(u,{replace:o,state:a,target:l,preventScrollReset:d,relative:s,viewTransition:h});function S(b){r&&r(b),b.defaultPrevented||x(b)}return R.createElement("a",$m({},f,{href:y||w,onClick:v||i?r:S,ref:n,target:l}))});var Pw;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(Pw||(Pw={}));var Dw;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(Dw||(Dw={}));function bD(t,e){let{target:n,replace:r,state:s,preventScrollReset:i,relative:o,viewTransition:a}=e===void 0?{}:e,l=$r(),u=xu(),d=UT(t,{relative:o});return R.useCallback(h=>{if(yD(h,n)){h.preventDefault();let f=r!==void 0?r:Md(u)===Md(d);l(t,{replace:f,state:s,preventScrollReset:i,relative:o,viewTransition:a})}},[u,l,d,r,s,n,t,i,o,a])}var Ow={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qT=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):(s&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},TD=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const s=t[n++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=t[n++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=t[n++],o=t[n++],a=t[n++],l=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const i=t[n++],o=t[n++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},HT={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<t.length;s+=3){const i=t[s],o=s+1<t.length,a=o?t[s+1]:0,l=s+2<t.length,u=l?t[s+2]:0,d=i>>2,h=(i&3)<<4|a>>4;let f=(a&15)<<2|u>>6,m=u&63;l||(m=64,o||(f=64)),r.push(n[d],n[h],n[f],n[m])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(qT(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):TD(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<t.length;){const i=n[t.charAt(s++)],a=s<t.length?n[t.charAt(s)]:0;++s;const u=s<t.length?n[t.charAt(s)]:64;++s;const h=s<t.length?n[t.charAt(s)]:64;if(++s,i==null||a==null||u==null||h==null)throw new kD;const f=i<<2|a>>4;if(r.push(f),u!==64){const m=a<<4&240|u>>2;if(r.push(m),h!==64){const y=u<<6&192|h;r.push(y)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class kD extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const ID=function(t){const e=qT(t);return HT.encodeByteArray(e,!0)},Ld=function(t){return ID(t).replace(/\./g,"")},WT=function(t){try{return HT.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CD(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AD=()=>CD().__FIREBASE_DEFAULTS__,ND=()=>{if(typeof process>"u"||typeof Ow>"u")return;const t=Ow.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},RD=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&WT(t[1]);return e&&JSON.parse(e)},Ih=()=>{try{return AD()||ND()||RD()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},KT=t=>{var e,n;return(n=(e=Ih())===null||e===void 0?void 0:e.emulatorHosts)===null||n===void 0?void 0:n[t]},GT=t=>{const e=KT(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},QT=()=>{var t;return(t=Ih())===null||t===void 0?void 0:t.config},JT=t=>{var e;return(e=Ih())===null||e===void 0?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PD{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YT(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",s=t.iat||0,i=t.sub||t.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},t);return[Ld(JSON.stringify(n)),Ld(JSON.stringify(o)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dt(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function DD(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Dt())}function OD(){var t;const e=(t=Ih())===null||t===void 0?void 0:t.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function MD(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function LD(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function VD(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function jD(){const t=Dt();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function FD(){return!OD()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function UD(){try{return typeof indexedDB=="object"}catch{return!1}}function BD(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var i;e(((i=s.error)===null||i===void 0?void 0:i.message)||"")}}catch(n){e(n)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zD="FirebaseError";class ar extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=zD,Object.setPrototypeOf(this,ar.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Eu.prototype.create)}}class Eu{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?$D(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new ar(s,a,r)}}function $D(t,e){return t.replace(qD,(n,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const qD=/\{\$([^}]+)}/g;function HD(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Qo(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const s of n){if(!r.includes(s))return!1;const i=t[s],o=e[s];if(Mw(i)&&Mw(o)){if(!Qo(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!n.includes(s))return!1;return!0}function Mw(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Su(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function el(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function tl(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function WD(t,e){const n=new KD(t,e);return n.subscribe.bind(n)}class KD{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let s;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");GD(e,["next","error","complete"])?s=e:s={next:e,error:n,complete:r},s.next===void 0&&(s.next=up),s.error===void 0&&(s.error=up),s.complete===void 0&&(s.complete=up);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function GD(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function up(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ae(t){return t&&t._delegate?t._delegate:t}class Ms{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ai="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QD{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new PD;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:n});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){var n;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(n=e==null?void 0:e.optional)!==null&&n!==void 0?n:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(YD(e))try{this.getOrInitializeService({instanceIdentifier:ai})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(n);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=ai){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=ai){return this.instances.has(e)}getOptions(e=ai){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,n){var r;const s=this.normalizeInstanceIdentifier(n),i=(r=this.onInitCallbacks.get(s))!==null&&r!==void 0?r:new Set;i.add(e),this.onInitCallbacks.set(s,i);const o=this.instances.get(s);return o&&e(o,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const s of r)try{s(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:JD(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=ai){return this.component?this.component.multipleInstances?e:ai:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function JD(t){return t===ai?void 0:t}function YD(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XD{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new QD(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var de;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(de||(de={}));const ZD={debug:de.DEBUG,verbose:de.VERBOSE,info:de.INFO,warn:de.WARN,error:de.ERROR,silent:de.SILENT},eO=de.INFO,tO={[de.DEBUG]:"log",[de.VERBOSE]:"log",[de.INFO]:"info",[de.WARN]:"warn",[de.ERROR]:"error"},nO=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),s=tO[e];if(s)console[s](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Vy{constructor(e){this.name=e,this._logLevel=eO,this._logHandler=nO,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in de))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?ZD[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,de.DEBUG,...e),this._logHandler(this,de.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,de.VERBOSE,...e),this._logHandler(this,de.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,de.INFO,...e),this._logHandler(this,de.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,de.WARN,...e),this._logHandler(this,de.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,de.ERROR,...e),this._logHandler(this,de.ERROR,...e)}}const rO=(t,e)=>e.some(n=>t instanceof n);let Lw,Vw;function sO(){return Lw||(Lw=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function iO(){return Vw||(Vw=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const XT=new WeakMap,qm=new WeakMap,ZT=new WeakMap,cp=new WeakMap,jy=new WeakMap;function oO(t){const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("success",i),t.removeEventListener("error",o)},i=()=>{n(Ts(t.result)),s()},o=()=>{r(t.error),s()};t.addEventListener("success",i),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&XT.set(n,t)}).catch(()=>{}),jy.set(e,t),e}function aO(t){if(qm.has(t))return;const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",o),t.removeEventListener("abort",o)},i=()=>{n(),s()},o=()=>{r(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",i),t.addEventListener("error",o),t.addEventListener("abort",o)});qm.set(t,e)}let Hm={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return qm.get(t);if(e==="objectStoreNames")return t.objectStoreNames||ZT.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Ts(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function lO(t){Hm=t(Hm)}function uO(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(dp(this),e,...n);return ZT.set(r,e.sort?e.sort():[e]),Ts(r)}:iO().includes(t)?function(...e){return t.apply(dp(this),e),Ts(XT.get(this))}:function(...e){return Ts(t.apply(dp(this),e))}}function cO(t){return typeof t=="function"?uO(t):(t instanceof IDBTransaction&&aO(t),rO(t,sO())?new Proxy(t,Hm):t)}function Ts(t){if(t instanceof IDBRequest)return oO(t);if(cp.has(t))return cp.get(t);const e=cO(t);return e!==t&&(cp.set(t,e),jy.set(e,t)),e}const dp=t=>jy.get(t);function dO(t,e,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(t,e),a=Ts(o);return r&&o.addEventListener("upgradeneeded",l=>{r(Ts(o.result),l.oldVersion,l.newVersion,Ts(o.transaction),l)}),n&&o.addEventListener("blocked",l=>n(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",u=>s(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}const hO=["get","getKey","getAll","getAllKeys","count"],fO=["put","add","delete","clear"],hp=new Map;function jw(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(hp.get(e))return hp.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=fO.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(s||hO.includes(n)))return;const i=async function(o,...a){const l=this.transaction(o,s?"readwrite":"readonly");let u=l.store;return r&&(u=u.index(a.shift())),(await Promise.all([u[n](...a),s&&l.done]))[0]};return hp.set(e,i),i}lO(t=>({...t,get:(e,n,r)=>jw(e,n)||t.get(e,n,r),has:(e,n)=>!!jw(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pO{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(mO(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function mO(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Wm="@firebase/app",Fw="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lr=new Vy("@firebase/app"),gO="@firebase/app-compat",yO="@firebase/analytics-compat",vO="@firebase/analytics",_O="@firebase/app-check-compat",wO="@firebase/app-check",xO="@firebase/auth",EO="@firebase/auth-compat",SO="@firebase/database",bO="@firebase/data-connect",TO="@firebase/database-compat",kO="@firebase/functions",IO="@firebase/functions-compat",CO="@firebase/installations",AO="@firebase/installations-compat",NO="@firebase/messaging",RO="@firebase/messaging-compat",PO="@firebase/performance",DO="@firebase/performance-compat",OO="@firebase/remote-config",MO="@firebase/remote-config-compat",LO="@firebase/storage",VO="@firebase/storage-compat",jO="@firebase/firestore",FO="@firebase/vertexai-preview",UO="@firebase/firestore-compat",BO="firebase",zO="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Km="[DEFAULT]",$O={[Wm]:"fire-core",[gO]:"fire-core-compat",[vO]:"fire-analytics",[yO]:"fire-analytics-compat",[wO]:"fire-app-check",[_O]:"fire-app-check-compat",[xO]:"fire-auth",[EO]:"fire-auth-compat",[SO]:"fire-rtdb",[bO]:"fire-data-connect",[TO]:"fire-rtdb-compat",[kO]:"fire-fn",[IO]:"fire-fn-compat",[CO]:"fire-iid",[AO]:"fire-iid-compat",[NO]:"fire-fcm",[RO]:"fire-fcm-compat",[PO]:"fire-perf",[DO]:"fire-perf-compat",[OO]:"fire-rc",[MO]:"fire-rc-compat",[LO]:"fire-gcs",[VO]:"fire-gcs-compat",[jO]:"fire-fst",[UO]:"fire-fst-compat",[FO]:"fire-vertex","fire-js":"fire-js",[BO]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ql=new Map,qO=new Map,Gm=new Map;function Uw(t,e){try{t.container.addComponent(e)}catch(n){Lr.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Oi(t){const e=t.name;if(Gm.has(e))return Lr.debug(`There were multiple attempts to register component ${e}.`),!1;Gm.set(e,t);for(const n of Ql.values())Uw(n,t);for(const n of qO.values())Uw(n,t);return!0}function Ch(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function jn(t){return t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HO={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ks=new Eu("app","Firebase",HO);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WO{constructor(e,n,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Ms("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ks.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ki=zO;function ek(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r=Object.assign({name:Km,automaticDataCollectionEnabled:!1},e),s=r.name;if(typeof s!="string"||!s)throw ks.create("bad-app-name",{appName:String(s)});if(n||(n=QT()),!n)throw ks.create("no-options");const i=Ql.get(s);if(i){if(Qo(n,i.options)&&Qo(r,i.config))return i;throw ks.create("duplicate-app",{appName:s})}const o=new XD(s);for(const l of Gm.values())o.addComponent(l);const a=new WO(n,r,o);return Ql.set(s,a),a}function Fy(t=Km){const e=Ql.get(t);if(!e&&t===Km&&QT())return ek();if(!e)throw ks.create("no-app",{appName:t});return e}function Bw(){return Array.from(Ql.values())}function er(t,e,n){var r;let s=(r=$O[t])!==null&&r!==void 0?r:t;n&&(s+=`-${n}`);const i=s.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const a=[`Unable to register library "${s}" with version "${e}":`];i&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Lr.warn(a.join(" "));return}Oi(new Ms(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KO="firebase-heartbeat-database",GO=1,Jl="firebase-heartbeat-store";let fp=null;function tk(){return fp||(fp=dO(KO,GO,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Jl)}catch(n){console.warn(n)}}}}).catch(t=>{throw ks.create("idb-open",{originalErrorMessage:t.message})})),fp}async function QO(t){try{const n=(await tk()).transaction(Jl),r=await n.objectStore(Jl).get(nk(t));return await n.done,r}catch(e){if(e instanceof ar)Lr.warn(e.message);else{const n=ks.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Lr.warn(n.message)}}}async function zw(t,e){try{const r=(await tk()).transaction(Jl,"readwrite");await r.objectStore(Jl).put(e,nk(t)),await r.done}catch(n){if(n instanceof ar)Lr.warn(n.message);else{const r=ks.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});Lr.warn(r.message)}}}function nk(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JO=1024,YO=30*24*60*60*1e3;class XO{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new eM(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,n;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=$w();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)===null||n===void 0?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const a=new Date(o.date).valueOf();return Date.now()-a<=YO}),this._storage.overwrite(this._heartbeatsCache))}catch(r){Lr.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=$w(),{heartbeatsToSend:r,unsentEntries:s}=ZO(this._heartbeatsCache.heartbeats),i=Ld(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=n,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(n){return Lr.warn(n),""}}}function $w(){return new Date().toISOString().substring(0,10)}function ZO(t,e=JO){const n=[];let r=t.slice();for(const s of t){const i=n.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),qw(n)>e){i.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),qw(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class eM{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return UD()?BD().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await QO(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var n;if(await this._canUseIndexedDBPromise){const s=await this.read();return zw(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var n;if(await this._canUseIndexedDBPromise){const s=await this.read();return zw(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function qw(t){return Ld(JSON.stringify({version:2,heartbeats:t})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tM(t){Oi(new Ms("platform-logger",e=>new pO(e),"PRIVATE")),Oi(new Ms("heartbeat",e=>new XO(e),"PRIVATE")),er(Wm,Fw,t),er(Wm,Fw,"esm2017"),er("fire-js","")}tM("");function Uy(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(t);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(t,r[s])&&(n[r[s]]=t[r[s]]);return n}function rk(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const nM=rk,sk=new Eu("auth","Firebase",rk());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vd=new Vy("@firebase/auth");function rM(t,...e){Vd.logLevel<=de.WARN&&Vd.warn(`Auth (${Ki}): ${t}`,...e)}function Xc(t,...e){Vd.logLevel<=de.ERROR&&Vd.error(`Auth (${Ki}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nn(t,...e){throw zy(t,...e)}function zn(t,...e){return zy(t,...e)}function By(t,e,n){const r=Object.assign(Object.assign({},nM()),{[e]:n});return new Eu("auth","Firebase",r).create(e,{appName:t.name})}function Ir(t){return By(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function sM(t,e,n){const r=n;if(!(e instanceof r))throw r.name!==e.constructor.name&&Nn(t,"argument-error"),By(t,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function zy(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return sk.create(t,...e)}function ee(t,e,...n){if(!t)throw zy(e,...n)}function Er(t){const e="INTERNAL ASSERTION FAILED: "+t;throw Xc(e),new Error(e)}function Vr(t,e){t||Er(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qm(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.href)||""}function iM(){return Hw()==="http:"||Hw()==="https:"}function Hw(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oM(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(iM()||LD()||"connection"in navigator)?navigator.onLine:!0}function aM(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bu{constructor(e,n){this.shortDelay=e,this.longDelay=n,Vr(n>e,"Short delay should be less than long delay!"),this.isMobile=DD()||VD()}get(){return oM()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $y(t,e){Vr(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ik{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Er("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Er("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Er("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lM={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uM=new bu(3e4,6e4);function Gs(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function qr(t,e,n,r,s={}){return ok(t,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const a=Su(Object.assign({key:t.config.apiKey},o)).slice(1),l=await t._getAdditionalHeaders();l["Content-Type"]="application/json",t.languageCode&&(l["X-Firebase-Locale"]=t.languageCode);const u=Object.assign({method:e,headers:l},i);return MD()||(u.referrerPolicy="no-referrer"),ik.fetch()(ak(t,t.config.apiHost,n,a),u)})}async function ok(t,e,n){t._canInitEmulator=!1;const r=Object.assign(Object.assign({},lM),e);try{const s=new dM(t),i=await Promise.race([n(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw Ec(t,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,u]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw Ec(t,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw Ec(t,"email-already-in-use",o);if(l==="USER_DISABLED")throw Ec(t,"user-disabled",o);const d=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw By(t,d,u);Nn(t,d)}}catch(s){if(s instanceof ar)throw s;Nn(t,"network-request-failed",{message:String(s)})}}async function Tu(t,e,n,r,s={}){const i=await qr(t,e,n,r,s);return"mfaPendingCredential"in i&&Nn(t,"multi-factor-auth-required",{_serverResponse:i}),i}function ak(t,e,n,r){const s=`${e}${n}?${r}`;return t.config.emulator?$y(t.config,s):`${t.config.apiScheme}://${s}`}function cM(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class dM{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(zn(this.auth,"network-request-failed")),uM.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Ec(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const s=zn(t,e,r);return s.customData._tokenResponse=n,s}function Ww(t){return t!==void 0&&t.enterprise!==void 0}class hM{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return cM(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}async function fM(t,e){return qr(t,"GET","/v2/recaptchaConfig",Gs(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pM(t,e){return qr(t,"POST","/v1/accounts:delete",e)}async function lk(t,e){return qr(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _l(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function mM(t,e=!1){const n=Ae(t),r=await n.getIdToken(e),s=qy(r);ee(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:_l(pp(s.auth_time)),issuedAtTime:_l(pp(s.iat)),expirationTime:_l(pp(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function pp(t){return Number(t)*1e3}function qy(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return Xc("JWT malformed, contained fewer than 3 sections"),null;try{const s=WT(n);return s?JSON.parse(s):(Xc("Failed to decode base64 JWT payload"),null)}catch(s){return Xc("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function Kw(t){const e=qy(t);return ee(e,"internal-error"),ee(typeof e.exp<"u","internal-error"),ee(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Jo(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof ar&&gM(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function gM({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yM{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var n;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const s=((n=this.user.stsTokenManager.expirationTime)!==null&&n!==void 0?n:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jm{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=_l(this.lastLoginAt),this.creationTime=_l(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jd(t){var e;const n=t.auth,r=await t.getIdToken(),s=await Jo(t,lk(n,{idToken:r}));ee(s==null?void 0:s.users.length,n,"internal-error");const i=s.users[0];t._notifyReloadListener(i);const o=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?uk(i.providerUserInfo):[],a=_M(t.providerData,o),l=t.isAnonymous,u=!(t.email&&i.passwordHash)&&!(a!=null&&a.length),d=l?u:!1,h={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new Jm(i.createdAt,i.lastLoginAt),isAnonymous:d};Object.assign(t,h)}async function vM(t){const e=Ae(t);await jd(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function _M(t,e){return[...t.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function uk(t){return t.map(e=>{var{providerId:n}=e,r=Uy(e,["providerId"]);return{providerId:n,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wM(t,e){const n=await ok(t,{},async()=>{const r=Su({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=t.config,o=ak(t,s,"/v1/token",`key=${i}`),a=await t._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",ik.fetch()(o,{method:"POST",headers:a,body:r})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function xM(t,e){return qr(t,"POST","/v2/accounts:revokeToken",Gs(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oo{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){ee(e.idToken,"internal-error"),ee(typeof e.idToken<"u","internal-error"),ee(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Kw(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){ee(e.length!==0,"internal-error");const n=Kw(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(ee(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:s,expiresIn:i}=await wM(e,n);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:s,expirationTime:i}=n,o=new Oo;return r&&(ee(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(ee(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(ee(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Oo,this.toJSON())}_performRefresh(){return Er("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qr(t,e){ee(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class Sr{constructor(e){var{uid:n,auth:r,stsTokenManager:s}=e,i=Uy(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new yM(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=n,this.auth=r,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Jm(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const n=await Jo(this,this.stsTokenManager.getToken(this.auth,e));return ee(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return mM(this,e)}reload(){return vM(this)}_assign(e){this!==e&&(ee(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>Object.assign({},n)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new Sr(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return n.metadata._copy(this.metadata),n}_onReload(e){ee(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await jd(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(jn(this.auth.app))return Promise.reject(Ir(this.auth));const e=await this.getIdToken();return await Jo(this,pM(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){var r,s,i,o,a,l,u,d;const h=(r=n.displayName)!==null&&r!==void 0?r:void 0,f=(s=n.email)!==null&&s!==void 0?s:void 0,m=(i=n.phoneNumber)!==null&&i!==void 0?i:void 0,y=(o=n.photoURL)!==null&&o!==void 0?o:void 0,v=(a=n.tenantId)!==null&&a!==void 0?a:void 0,w=(l=n._redirectEventId)!==null&&l!==void 0?l:void 0,x=(u=n.createdAt)!==null&&u!==void 0?u:void 0,S=(d=n.lastLoginAt)!==null&&d!==void 0?d:void 0,{uid:b,emailVerified:N,isAnonymous:M,providerData:V,stsTokenManager:k}=n;ee(b&&k,e,"internal-error");const E=Oo.fromJSON(this.name,k);ee(typeof b=="string",e,"internal-error"),Qr(h,e.name),Qr(f,e.name),ee(typeof N=="boolean",e,"internal-error"),ee(typeof M=="boolean",e,"internal-error"),Qr(m,e.name),Qr(y,e.name),Qr(v,e.name),Qr(w,e.name),Qr(x,e.name),Qr(S,e.name);const I=new Sr({uid:b,auth:e,email:f,emailVerified:N,displayName:h,isAnonymous:M,photoURL:y,phoneNumber:m,tenantId:v,stsTokenManager:E,createdAt:x,lastLoginAt:S});return V&&Array.isArray(V)&&(I.providerData=V.map(C=>Object.assign({},C))),w&&(I._redirectEventId=w),I}static async _fromIdTokenResponse(e,n,r=!1){const s=new Oo;s.updateFromServerResponse(n);const i=new Sr({uid:n.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await jd(i),i}static async _fromGetAccountInfoResponse(e,n,r){const s=n.users[0];ee(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?uk(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),a=new Oo;a.updateFromIdToken(r);const l=new Sr({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:o}),u={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new Jm(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(l,u),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gw=new Map;function br(t){Vr(t instanceof Function,"Expected a class definition");let e=Gw.get(t);return e?(Vr(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,Gw.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ck{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}ck.type="NONE";const Qw=ck;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zc(t,e,n){return`firebase:${t}:${e}:${n}`}class Mo{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=Zc(this.userKey,s.apiKey,i),this.fullPersistenceKey=Zc("persistence",s.apiKey,i),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Sr._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new Mo(br(Qw),e,r);const s=(await Promise.all(n.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let i=s[0]||br(Qw);const o=Zc(r,e.config.apiKey,e.name);let a=null;for(const u of n)try{const d=await u._get(o);if(d){const h=Sr._fromJSON(e,d);u!==i&&(a=h),i=u;break}}catch{}const l=s.filter(u=>u._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new Mo(i,e,r):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(n.map(async u=>{if(u!==i)try{await u._remove(o)}catch{}})),new Mo(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jw(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(pk(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(dk(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(gk(e))return"Blackberry";if(yk(e))return"Webos";if(hk(e))return"Safari";if((e.includes("chrome/")||fk(e))&&!e.includes("edge/"))return"Chrome";if(mk(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function dk(t=Dt()){return/firefox\//i.test(t)}function hk(t=Dt()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function fk(t=Dt()){return/crios\//i.test(t)}function pk(t=Dt()){return/iemobile/i.test(t)}function mk(t=Dt()){return/android/i.test(t)}function gk(t=Dt()){return/blackberry/i.test(t)}function yk(t=Dt()){return/webos/i.test(t)}function Hy(t=Dt()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function EM(t=Dt()){var e;return Hy(t)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function SM(){return jD()&&document.documentMode===10}function vk(t=Dt()){return Hy(t)||mk(t)||yk(t)||gk(t)||/windows phone/i.test(t)||pk(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _k(t,e=[]){let n;switch(t){case"Browser":n=Jw(Dt());break;case"Worker":n=`${Jw(Dt())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${Ki}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bM{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});r.onAbort=n,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const s of n)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function TM(t,e={}){return qr(t,"GET","/v2/passwordPolicy",Gs(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kM=6;class IM{constructor(e){var n,r,s,i;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(n=o.minPasswordLength)!==null&&n!==void 0?n:kM,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var n,r,s,i,o,a;const l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,l),this.validatePasswordCharacterOptions(e,l),l.isValid&&(l.isValid=(n=l.meetsMinPasswordLength)!==null&&n!==void 0?n:!0),l.isValid&&(l.isValid=(r=l.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(s=l.containsLowercaseLetter)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(i=l.containsUppercaseLetter)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(o=l.containsNumericCharacter)!==null&&o!==void 0?o:!0),l.isValid&&(l.isValid=(a=l.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),l}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),s&&(n.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CM{constructor(e,n,r,s){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Yw(this),this.idTokenSubscription=new Yw(this),this.beforeStateQueue=new bM(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=sk,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=br(n)),this._initializationPromise=this.queue(async()=>{var r,s;if(!this._deleted&&(this.persistenceManager=await Mo.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await lk(this,{idToken:e}),r=await Sr._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var n;if(jn(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let s=r,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId,a=s==null?void 0:s._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(s=l.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(o){s=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return ee(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await jd(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=aM()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(jn(this.app))return Promise.reject(Ir(this));const n=e?Ae(e):null;return n&&ee(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&ee(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return jn(this.app)?Promise.reject(Ir(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return jn(this.app)?Promise.reject(Ir(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(br(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await TM(this),n=new IM(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Eu("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await xM(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&br(e)||this._popupRedirectResolver;ee(n,this,"argument-error"),this.redirectPersistenceManager=await Mo.create(this,[br(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,r;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)===null||n===void 0?void 0:n._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(n=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&n!==void 0?n:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,s){if(this._deleted)return()=>{};const i=typeof n=="function"?n:n.next.bind(n);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(ee(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof n=="function"){const l=e.addObserver(n,r,s);return()=>{o=!0,l()}}else{const l=e.addObserver(n);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return ee(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=_k(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const n={"X-Client-Version":this.clientVersion};this.app.options.appId&&(n["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(n["X-Firebase-Client"]=r);const s=await this._getAppCheckToken();return s&&(n["X-Firebase-AppCheck"]=s),n}async _getAppCheckToken(){var e;const n=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return n!=null&&n.error&&rM(`Error while retrieving App Check token: ${n.error}`),n==null?void 0:n.token}}function Qs(t){return Ae(t)}class Yw{constructor(e){this.auth=e,this.observer=null,this.addObserver=WD(n=>this.observer=n)}get next(){return ee(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ah={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function AM(t){Ah=t}function wk(t){return Ah.loadJS(t)}function NM(){return Ah.recaptchaEnterpriseScript}function RM(){return Ah.gapiScript}function PM(t){return`__${t}${Math.floor(Math.random()*1e6)}`}const DM="recaptcha-enterprise",OM="NO_RECAPTCHA";class MM{constructor(e){this.type=DM,this.auth=Qs(e)}async verify(e="verify",n=!1){async function r(i){if(!n){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{fM(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const u=new hM(l);return i.tenantId==null?i._agentRecaptchaConfig=u:i._tenantRecaptchaConfigs[i.tenantId]=u,o(u.siteKey)}}).catch(l=>{a(l)})})}function s(i,o,a){const l=window.grecaptcha;Ww(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(u=>{o(u)}).catch(()=>{o(OM)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((i,o)=>{r(this.auth).then(a=>{if(!n&&Ww(window.grecaptcha))s(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let l=NM();l.length!==0&&(l+=a),wk(l).then(()=>{s(a,i,o)}).catch(u=>{o(u)})}}).catch(a=>{o(a)})})}}async function Xw(t,e,n,r=!1){const s=new MM(t);let i;try{i=await s.verify(n)}catch{i=await s.verify(n,!0)}const o=Object.assign({},e);return r?Object.assign(o,{captchaResp:i}):Object.assign(o,{captchaResponse:i}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function Ym(t,e,n,r){var s;if(!((s=t._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await Xw(t,e,n,n==="getOobCode");return r(t,i)}else return r(t,e).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await Xw(t,e,n,n==="getOobCode");return r(t,o)}else return Promise.reject(i)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LM(t,e){const n=Ch(t,"auth");if(n.isInitialized()){const s=n.getImmediate(),i=n.getOptions();if(Qo(i,e??{}))return s;Nn(s,"already-initialized")}return n.initialize({options:e})}function VM(t,e){const n=(e==null?void 0:e.persistence)||[],r=(Array.isArray(n)?n:[n]).map(br);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function jM(t,e,n){const r=Qs(t);ee(r._canInitEmulator,r,"emulator-config-failed"),ee(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,i=xk(e),{host:o,port:a}=FM(e),l=a===null?"":`:${a}`;r.config.emulator={url:`${i}//${o}${l}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})}),UM()}function xk(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function FM(t){const e=xk(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:Zw(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:Zw(o)}}}function Zw(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function UM(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wy{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return Er("not implemented")}_getIdTokenResponse(e){return Er("not implemented")}_linkToIdToken(e,n){return Er("not implemented")}_getReauthenticationResolver(e){return Er("not implemented")}}async function BM(t,e){return qr(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zM(t,e){return Tu(t,"POST","/v1/accounts:signInWithPassword",Gs(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $M(t,e){return Tu(t,"POST","/v1/accounts:signInWithEmailLink",Gs(t,e))}async function qM(t,e){return Tu(t,"POST","/v1/accounts:signInWithEmailLink",Gs(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yl extends Wy{constructor(e,n,r,s=null){super("password",r),this._email=e,this._password=n,this._tenantId=s}static _fromEmailAndPassword(e,n){return new Yl(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new Yl(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n!=null&&n.email&&(n!=null&&n.password)){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Ym(e,n,"signInWithPassword",zM);case"emailLink":return $M(e,{email:this._email,oobCode:this._password});default:Nn(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Ym(e,r,"signUpPassword",BM);case"emailLink":return qM(e,{idToken:n,email:this._email,oobCode:this._password});default:Nn(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Lo(t,e){return Tu(t,"POST","/v1/accounts:signInWithIdp",Gs(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HM="http://localhost";class Mi extends Wy{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new Mi(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):Nn("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s}=n,i=Uy(n,["providerId","signInMethod"]);if(!r||!s)return null;const o=new Mi(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const n=this.buildRequest();return Lo(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,Lo(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,Lo(e,n)}buildRequest(){const e={requestUri:HM,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=Su(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WM(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function KM(t){const e=el(tl(t)).link,n=e?el(tl(e)).deep_link_id:null,r=el(tl(t)).deep_link_id;return(r?el(tl(r)).link:null)||r||n||e||t}class Ky{constructor(e){var n,r,s,i,o,a;const l=el(tl(e)),u=(n=l.apiKey)!==null&&n!==void 0?n:null,d=(r=l.oobCode)!==null&&r!==void 0?r:null,h=WM((s=l.mode)!==null&&s!==void 0?s:null);ee(u&&d&&h,"argument-error"),this.apiKey=u,this.operation=h,this.code=d,this.continueUrl=(i=l.continueUrl)!==null&&i!==void 0?i:null,this.languageCode=(o=l.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(a=l.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){const n=KM(e);try{return new Ky(n)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ya{constructor(){this.providerId=ya.PROVIDER_ID}static credential(e,n){return Yl._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const r=Ky.parseLink(n);return ee(r,"argument-error"),Yl._fromEmailAndCode(e,r.code,r.tenantId)}}ya.PROVIDER_ID="password";ya.EMAIL_PASSWORD_SIGN_IN_METHOD="password";ya.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gy{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ku extends Gy{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rs extends ku{constructor(){super("facebook.com")}static credential(e){return Mi._fromParams({providerId:rs.PROVIDER_ID,signInMethod:rs.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return rs.credentialFromTaggedObject(e)}static credentialFromError(e){return rs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return rs.credential(e.oauthAccessToken)}catch{return null}}}rs.FACEBOOK_SIGN_IN_METHOD="facebook.com";rs.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _r extends ku{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return Mi._fromParams({providerId:_r.PROVIDER_ID,signInMethod:_r.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return _r.credentialFromTaggedObject(e)}static credentialFromError(e){return _r.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return _r.credential(n,r)}catch{return null}}}_r.GOOGLE_SIGN_IN_METHOD="google.com";_r.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ss extends ku{constructor(){super("github.com")}static credential(e){return Mi._fromParams({providerId:ss.PROVIDER_ID,signInMethod:ss.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ss.credentialFromTaggedObject(e)}static credentialFromError(e){return ss.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ss.credential(e.oauthAccessToken)}catch{return null}}}ss.GITHUB_SIGN_IN_METHOD="github.com";ss.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class is extends ku{constructor(){super("twitter.com")}static credential(e,n){return Mi._fromParams({providerId:is.PROVIDER_ID,signInMethod:is.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return is.credentialFromTaggedObject(e)}static credentialFromError(e){return is.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return is.credential(n,r)}catch{return null}}}is.TWITTER_SIGN_IN_METHOD="twitter.com";is.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function GM(t,e){return Tu(t,"POST","/v1/accounts:signUp",Gs(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Li{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,s=!1){const i=await Sr._fromIdTokenResponse(e,r,s),o=ex(r);return new Li({user:i,providerId:o,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const s=ex(r);return new Li({user:e,providerId:s,_tokenResponse:r,operationType:n})}}function ex(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fd extends ar{constructor(e,n,r,s){var i;super(n.code,n.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,Fd.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,s){return new Fd(e,n,r,s)}}function Ek(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?Fd._fromErrorAndOperation(t,i,e,r):i})}async function QM(t,e,n=!1){const r=await Jo(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return Li._forOperation(t,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function JM(t,e,n=!1){const{auth:r}=t;if(jn(r.app))return Promise.reject(Ir(r));const s="reauthenticate";try{const i=await Jo(t,Ek(r,s,e,t),n);ee(i.idToken,r,"internal-error");const o=qy(i.idToken);ee(o,r,"internal-error");const{sub:a}=o;return ee(t.uid===a,r,"user-mismatch"),Li._forOperation(t,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Nn(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Sk(t,e,n=!1){if(jn(t.app))return Promise.reject(Ir(t));const r="signIn",s=await Ek(t,r,e),i=await Li._fromIdTokenResponse(t,r,s);return n||await t._updateCurrentUser(i.user),i}async function YM(t,e){return Sk(Qs(t),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bk(t){const e=Qs(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function XM(t,e,n){if(jn(t.app))return Promise.reject(Ir(t));const r=Qs(t),o=await Ym(r,{returnSecureToken:!0,email:e,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",GM).catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&bk(t),l}),a=await Li._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(a.user),a}function ZM(t,e,n){return jn(t.app)?Promise.reject(Ir(t)):YM(Ae(t),ya.credential(e,n)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&bk(t),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function e2(t,e){return qr(t,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function t2(t,{displayName:e,photoURL:n}){if(e===void 0&&n===void 0)return;const r=Ae(t),i={idToken:await r.getIdToken(),displayName:e,photoUrl:n,returnSecureToken:!0},o=await Jo(r,e2(r.auth,i));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find(({providerId:l})=>l==="password");a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}function n2(t,e,n,r){return Ae(t).onIdTokenChanged(e,n,r)}function r2(t,e,n){return Ae(t).beforeAuthStateChanged(e,n)}function s2(t,e,n,r){return Ae(t).onAuthStateChanged(e,n,r)}function i2(t){return Ae(t).signOut()}const Ud="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tk{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(Ud,"1"),this.storage.removeItem(Ud),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o2=1e3,a2=10;class kk extends Tk{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=vk(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),s=this.localCache[n];r!==s&&e(n,s,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const r=e.key;n?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!n&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);SM()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,a2):s()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},o2)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}kk.type="LOCAL";const l2=kk;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ik extends Tk{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}Ik.type="SESSION";const Ck=Ik;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function u2(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nh{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(s=>s.isListeningto(e));if(n)return n;const r=new Nh(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:s,data:i}=n.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const a=Array.from(o).map(async u=>u(n.origin,i)),l=await u2(a);n.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:l})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Nh.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qy(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c2{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const u=Qy("",20);s.port1.start();const d=setTimeout(()=>{l(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(h){const f=h;if(f.data.eventId===u)switch(f.data.status){case"ack":clearTimeout(d),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(f.data.response);break;default:clearTimeout(d),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:u,data:n},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tr(){return window}function d2(t){tr().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ak(){return typeof tr().WorkerGlobalScope<"u"&&typeof tr().importScripts=="function"}async function h2(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function f2(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)===null||t===void 0?void 0:t.controller)||null}function p2(){return Ak()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nk="firebaseLocalStorageDb",m2=1,Bd="firebaseLocalStorage",Rk="fbase_key";class Iu{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function Rh(t,e){return t.transaction([Bd],e?"readwrite":"readonly").objectStore(Bd)}function g2(){const t=indexedDB.deleteDatabase(Nk);return new Iu(t).toPromise()}function Xm(){const t=indexedDB.open(Nk,m2);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(Bd,{keyPath:Rk})}catch(s){n(s)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(Bd)?e(r):(r.close(),await g2(),e(await Xm()))})})}async function tx(t,e,n){const r=Rh(t,!0).put({[Rk]:e,value:n});return new Iu(r).toPromise()}async function y2(t,e){const n=Rh(t,!1).get(e),r=await new Iu(n).toPromise();return r===void 0?null:r.value}function nx(t,e){const n=Rh(t,!0).delete(e);return new Iu(n).toPromise()}const v2=800,_2=3;class Pk{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Xm(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>_2)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Ak()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Nh._getInstance(p2()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var e,n;if(this.activeServiceWorker=await h2(),!this.activeServiceWorker)return;this.sender=new c2(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((n=r[0])===null||n===void 0)&&n.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||f2()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Xm();return await tx(e,Ud,"1"),await nx(e,Ud),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>tx(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>y2(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>nx(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=Rh(s,!1).getAll();return new Iu(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),n.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),n.push(s));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),v2)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Pk.type="LOCAL";const w2=Pk;new bu(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dk(t,e){return e?br(e):(ee(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jy extends Wy{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Lo(e,this._buildIdpRequest())}_linkToIdToken(e,n){return Lo(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return Lo(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function x2(t){return Sk(t.auth,new Jy(t),t.bypassAuthState)}function E2(t){const{auth:e,user:n}=t;return ee(n,e,"internal-error"),JM(n,new Jy(t),t.bypassAuthState)}async function S2(t){const{auth:e,user:n}=t;return ee(n,e,"internal-error"),QM(n,new Jy(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ok{constructor(e,n,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:s,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:n,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return x2;case"linkViaPopup":case"linkViaRedirect":return S2;case"reauthViaPopup":case"reauthViaRedirect":return E2;default:Nn(this.auth,"internal-error")}}resolve(e){Vr(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Vr(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b2=new bu(2e3,1e4);async function T2(t,e,n){if(jn(t.app))return Promise.reject(zn(t,"operation-not-supported-in-this-environment"));const r=Qs(t);sM(t,e,Gy);const s=Dk(r,n);return new pi(r,"signInViaPopup",e,s).executeNotNull()}class pi extends Ok{constructor(e,n,r,s,i){super(e,n,s,i),this.provider=r,this.authWindow=null,this.pollId=null,pi.currentPopupAction&&pi.currentPopupAction.cancel(),pi.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return ee(e,this.auth,"internal-error"),e}async onExecution(){Vr(this.filter.length===1,"Popup operations only handle one event");const e=Qy();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(zn(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(zn(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,pi.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,r;if(!((r=(n=this.authWindow)===null||n===void 0?void 0:n.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(zn(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,b2.get())};e()}}pi.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k2="pendingRedirect",ed=new Map;class I2 extends Ok{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=ed.get(this.auth._key());if(!e){try{const r=await C2(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}ed.set(this.auth._key(),e)}return this.bypassAuthState||ed.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function C2(t,e){const n=R2(e),r=N2(t);if(!await r._isAvailable())return!1;const s=await r._get(n)==="true";return await r._remove(n),s}function A2(t,e){ed.set(t._key(),e)}function N2(t){return br(t._redirectPersistence)}function R2(t){return Zc(k2,t.config.apiKey,t.name)}async function P2(t,e,n=!1){if(jn(t.app))return Promise.reject(Ir(t));const r=Qs(t),s=Dk(r,e),o=await new I2(r,s,n).execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D2=10*60*1e3;class O2{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!M2(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var r;if(e.error&&!Mk(e)){const s=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";n.onError(zn(this.auth,s))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=D2&&this.cachedEventUids.clear(),this.cachedEventUids.has(rx(e))}saveEventToCache(e){this.cachedEventUids.add(rx(e)),this.lastProcessedEventTime=Date.now()}}function rx(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function Mk({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function M2(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Mk(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function L2(t,e={}){return qr(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V2=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,j2=/^https?/;async function F2(t){if(t.config.emulator)return;const{authorizedDomains:e}=await L2(t);for(const n of e)try{if(U2(n))return}catch{}Nn(t,"unauthorized-domain")}function U2(t){const e=Qm(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const o=new URL(t);return o.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&o.hostname===r}if(!j2.test(n))return!1;if(V2.test(t))return r===t;const s=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B2=new bu(3e4,6e4);function sx(){const t=tr().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function z2(t){return new Promise((e,n)=>{var r,s,i;function o(){sx(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{sx(),n(zn(t,"network-request-failed"))},timeout:B2.get()})}if(!((s=(r=tr().gapi)===null||r===void 0?void 0:r.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((i=tr().gapi)===null||i===void 0)&&i.load)o();else{const a=PM("iframefcb");return tr()[a]=()=>{gapi.load?o():n(zn(t,"network-request-failed"))},wk(`${RM()}?onload=${a}`).catch(l=>n(l))}}).catch(e=>{throw td=null,e})}let td=null;function $2(t){return td=td||z2(t),td}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q2=new bu(5e3,15e3),H2="__/auth/iframe",W2="emulator/auth/iframe",K2={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},G2=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Q2(t){const e=t.config;ee(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?$y(e,W2):`https://${t.config.authDomain}/${H2}`,r={apiKey:e.apiKey,appName:t.name,v:Ki},s=G2.get(t.config.apiHost);s&&(r.eid=s);const i=t._getFrameworks();return i.length&&(r.fw=i.join(",")),`${n}?${Su(r).slice(1)}`}async function J2(t){const e=await $2(t),n=tr().gapi;return ee(n,t,"internal-error"),e.open({where:document.body,url:Q2(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:K2,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=zn(t,"network-request-failed"),a=tr().setTimeout(()=>{i(o)},q2.get());function l(){tr().clearTimeout(a),s(r)}r.ping(l).then(l,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y2={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},X2=500,Z2=600,eL="_blank",tL="http://localhost";class ix{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function nL(t,e,n,r=X2,s=Z2){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const l=Object.assign(Object.assign({},Y2),{width:r.toString(),height:s.toString(),top:i,left:o}),u=Dt().toLowerCase();n&&(a=fk(u)?eL:n),dk(u)&&(e=e||tL,l.scrollbars="yes");const d=Object.entries(l).reduce((f,[m,y])=>`${f}${m}=${y},`,"");if(EM(u)&&a!=="_self")return rL(e||"",a),new ix(null);const h=window.open(e||"",a,d);ee(h,t,"popup-blocked");try{h.focus()}catch{}return new ix(h)}function rL(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sL="__/auth/handler",iL="emulator/auth/handler",oL=encodeURIComponent("fac");async function ox(t,e,n,r,s,i){ee(t.config.authDomain,t,"auth-domain-config-required"),ee(t.config.apiKey,t,"invalid-api-key");const o={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:Ki,eventId:s};if(e instanceof Gy){e.setDefaultLanguage(t.languageCode),o.providerId=e.providerId||"",HD(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[d,h]of Object.entries({}))o[d]=h}if(e instanceof ku){const d=e.getScopes().filter(h=>h!=="");d.length>0&&(o.scopes=d.join(","))}t.tenantId&&(o.tid=t.tenantId);const a=o;for(const d of Object.keys(a))a[d]===void 0&&delete a[d];const l=await t._getAppCheckToken(),u=l?`#${oL}=${encodeURIComponent(l)}`:"";return`${aL(t)}?${Su(a).slice(1)}${u}`}function aL({config:t}){return t.emulator?$y(t,iL):`https://${t.authDomain}/${sL}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mp="webStorageSupport";class lL{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Ck,this._completeRedirectFn=P2,this._overrideRedirectResult=A2}async _openPopup(e,n,r,s){var i;Vr((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const o=await ox(e,n,r,Qm(),s);return nL(e,o,Qy())}async _openRedirect(e,n,r,s){await this._originValidation(e);const i=await ox(e,n,r,Qm(),s);return d2(i),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:s,promise:i}=this.eventManagers[n];return s?Promise.resolve(s):(Vr(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await J2(e),r=new O2(e);return n.register("authEvent",s=>(ee(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(mp,{type:mp},s=>{var i;const o=(i=s==null?void 0:s[0])===null||i===void 0?void 0:i[mp];o!==void 0&&n(!!o),Nn(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=F2(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return vk()||hk()||Hy()}}const uL=lL;var ax="@firebase/auth",lx="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cL{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){ee(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dL(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function hL(t){Oi(new Ms("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;ee(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:o,authDomain:a,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:_k(t)},u=new CM(r,s,i,l);return VM(u,n),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),Oi(new Ms("auth-internal",e=>{const n=Qs(e.getProvider("auth").getImmediate());return(r=>new cL(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),er(ax,lx,dL(t)),er(ax,lx,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fL=5*60,pL=JT("authIdTokenMaxAge")||fL;let ux=null;const mL=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>pL)return;const s=n==null?void 0:n.token;ux!==s&&(ux=s,await fetch(t,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function gL(t=Fy()){const e=Ch(t,"auth");if(e.isInitialized())return e.getImmediate();const n=LM(t,{popupRedirectResolver:uL,persistence:[w2,l2,Ck]}),r=JT("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=mL(i.toString());r2(n,o,()=>o(n.currentUser)),n2(n,a=>o(a))}}const s=KT("auth");return s&&jM(n,`http://${s}`),n}function yL(){var t,e;return(e=(t=document.getElementsByTagName("head"))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:document}AM({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=s=>{const i=zn("internal-error");i.customData=s,n(i)},r.type="text/javascript",r.charset="UTF-8",yL().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});hL("Browser");var cx=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var xi,Lk;(function(){var t;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(k,E){function I(){}I.prototype=E.prototype,k.D=E.prototype,k.prototype=new I,k.prototype.constructor=k,k.C=function(C,P,D){for(var A=Array(arguments.length-2),Z=2;Z<arguments.length;Z++)A[Z-2]=arguments[Z];return E.prototype[P].apply(C,A)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,n),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(k,E,I){I||(I=0);var C=Array(16);if(typeof E=="string")for(var P=0;16>P;++P)C[P]=E.charCodeAt(I++)|E.charCodeAt(I++)<<8|E.charCodeAt(I++)<<16|E.charCodeAt(I++)<<24;else for(P=0;16>P;++P)C[P]=E[I++]|E[I++]<<8|E[I++]<<16|E[I++]<<24;E=k.g[0],I=k.g[1],P=k.g[2];var D=k.g[3],A=E+(D^I&(P^D))+C[0]+3614090360&4294967295;E=I+(A<<7&4294967295|A>>>25),A=D+(P^E&(I^P))+C[1]+3905402710&4294967295,D=E+(A<<12&4294967295|A>>>20),A=P+(I^D&(E^I))+C[2]+606105819&4294967295,P=D+(A<<17&4294967295|A>>>15),A=I+(E^P&(D^E))+C[3]+3250441966&4294967295,I=P+(A<<22&4294967295|A>>>10),A=E+(D^I&(P^D))+C[4]+4118548399&4294967295,E=I+(A<<7&4294967295|A>>>25),A=D+(P^E&(I^P))+C[5]+1200080426&4294967295,D=E+(A<<12&4294967295|A>>>20),A=P+(I^D&(E^I))+C[6]+2821735955&4294967295,P=D+(A<<17&4294967295|A>>>15),A=I+(E^P&(D^E))+C[7]+4249261313&4294967295,I=P+(A<<22&4294967295|A>>>10),A=E+(D^I&(P^D))+C[8]+1770035416&4294967295,E=I+(A<<7&4294967295|A>>>25),A=D+(P^E&(I^P))+C[9]+2336552879&4294967295,D=E+(A<<12&4294967295|A>>>20),A=P+(I^D&(E^I))+C[10]+4294925233&4294967295,P=D+(A<<17&4294967295|A>>>15),A=I+(E^P&(D^E))+C[11]+2304563134&4294967295,I=P+(A<<22&4294967295|A>>>10),A=E+(D^I&(P^D))+C[12]+1804603682&4294967295,E=I+(A<<7&4294967295|A>>>25),A=D+(P^E&(I^P))+C[13]+4254626195&4294967295,D=E+(A<<12&4294967295|A>>>20),A=P+(I^D&(E^I))+C[14]+2792965006&4294967295,P=D+(A<<17&4294967295|A>>>15),A=I+(E^P&(D^E))+C[15]+1236535329&4294967295,I=P+(A<<22&4294967295|A>>>10),A=E+(P^D&(I^P))+C[1]+4129170786&4294967295,E=I+(A<<5&4294967295|A>>>27),A=D+(I^P&(E^I))+C[6]+3225465664&4294967295,D=E+(A<<9&4294967295|A>>>23),A=P+(E^I&(D^E))+C[11]+643717713&4294967295,P=D+(A<<14&4294967295|A>>>18),A=I+(D^E&(P^D))+C[0]+3921069994&4294967295,I=P+(A<<20&4294967295|A>>>12),A=E+(P^D&(I^P))+C[5]+3593408605&4294967295,E=I+(A<<5&4294967295|A>>>27),A=D+(I^P&(E^I))+C[10]+38016083&4294967295,D=E+(A<<9&4294967295|A>>>23),A=P+(E^I&(D^E))+C[15]+3634488961&4294967295,P=D+(A<<14&4294967295|A>>>18),A=I+(D^E&(P^D))+C[4]+3889429448&4294967295,I=P+(A<<20&4294967295|A>>>12),A=E+(P^D&(I^P))+C[9]+568446438&4294967295,E=I+(A<<5&4294967295|A>>>27),A=D+(I^P&(E^I))+C[14]+3275163606&4294967295,D=E+(A<<9&4294967295|A>>>23),A=P+(E^I&(D^E))+C[3]+4107603335&4294967295,P=D+(A<<14&4294967295|A>>>18),A=I+(D^E&(P^D))+C[8]+1163531501&4294967295,I=P+(A<<20&4294967295|A>>>12),A=E+(P^D&(I^P))+C[13]+2850285829&4294967295,E=I+(A<<5&4294967295|A>>>27),A=D+(I^P&(E^I))+C[2]+4243563512&4294967295,D=E+(A<<9&4294967295|A>>>23),A=P+(E^I&(D^E))+C[7]+1735328473&4294967295,P=D+(A<<14&4294967295|A>>>18),A=I+(D^E&(P^D))+C[12]+2368359562&4294967295,I=P+(A<<20&4294967295|A>>>12),A=E+(I^P^D)+C[5]+4294588738&4294967295,E=I+(A<<4&4294967295|A>>>28),A=D+(E^I^P)+C[8]+2272392833&4294967295,D=E+(A<<11&4294967295|A>>>21),A=P+(D^E^I)+C[11]+1839030562&4294967295,P=D+(A<<16&4294967295|A>>>16),A=I+(P^D^E)+C[14]+4259657740&4294967295,I=P+(A<<23&4294967295|A>>>9),A=E+(I^P^D)+C[1]+2763975236&4294967295,E=I+(A<<4&4294967295|A>>>28),A=D+(E^I^P)+C[4]+1272893353&4294967295,D=E+(A<<11&4294967295|A>>>21),A=P+(D^E^I)+C[7]+4139469664&4294967295,P=D+(A<<16&4294967295|A>>>16),A=I+(P^D^E)+C[10]+3200236656&4294967295,I=P+(A<<23&4294967295|A>>>9),A=E+(I^P^D)+C[13]+681279174&4294967295,E=I+(A<<4&4294967295|A>>>28),A=D+(E^I^P)+C[0]+3936430074&4294967295,D=E+(A<<11&4294967295|A>>>21),A=P+(D^E^I)+C[3]+3572445317&4294967295,P=D+(A<<16&4294967295|A>>>16),A=I+(P^D^E)+C[6]+76029189&4294967295,I=P+(A<<23&4294967295|A>>>9),A=E+(I^P^D)+C[9]+3654602809&4294967295,E=I+(A<<4&4294967295|A>>>28),A=D+(E^I^P)+C[12]+3873151461&4294967295,D=E+(A<<11&4294967295|A>>>21),A=P+(D^E^I)+C[15]+530742520&4294967295,P=D+(A<<16&4294967295|A>>>16),A=I+(P^D^E)+C[2]+3299628645&4294967295,I=P+(A<<23&4294967295|A>>>9),A=E+(P^(I|~D))+C[0]+4096336452&4294967295,E=I+(A<<6&4294967295|A>>>26),A=D+(I^(E|~P))+C[7]+1126891415&4294967295,D=E+(A<<10&4294967295|A>>>22),A=P+(E^(D|~I))+C[14]+2878612391&4294967295,P=D+(A<<15&4294967295|A>>>17),A=I+(D^(P|~E))+C[5]+4237533241&4294967295,I=P+(A<<21&4294967295|A>>>11),A=E+(P^(I|~D))+C[12]+1700485571&4294967295,E=I+(A<<6&4294967295|A>>>26),A=D+(I^(E|~P))+C[3]+2399980690&4294967295,D=E+(A<<10&4294967295|A>>>22),A=P+(E^(D|~I))+C[10]+4293915773&4294967295,P=D+(A<<15&4294967295|A>>>17),A=I+(D^(P|~E))+C[1]+2240044497&4294967295,I=P+(A<<21&4294967295|A>>>11),A=E+(P^(I|~D))+C[8]+1873313359&4294967295,E=I+(A<<6&4294967295|A>>>26),A=D+(I^(E|~P))+C[15]+4264355552&4294967295,D=E+(A<<10&4294967295|A>>>22),A=P+(E^(D|~I))+C[6]+2734768916&4294967295,P=D+(A<<15&4294967295|A>>>17),A=I+(D^(P|~E))+C[13]+1309151649&4294967295,I=P+(A<<21&4294967295|A>>>11),A=E+(P^(I|~D))+C[4]+4149444226&4294967295,E=I+(A<<6&4294967295|A>>>26),A=D+(I^(E|~P))+C[11]+3174756917&4294967295,D=E+(A<<10&4294967295|A>>>22),A=P+(E^(D|~I))+C[2]+718787259&4294967295,P=D+(A<<15&4294967295|A>>>17),A=I+(D^(P|~E))+C[9]+3951481745&4294967295,k.g[0]=k.g[0]+E&4294967295,k.g[1]=k.g[1]+(P+(A<<21&4294967295|A>>>11))&4294967295,k.g[2]=k.g[2]+P&4294967295,k.g[3]=k.g[3]+D&4294967295}r.prototype.u=function(k,E){E===void 0&&(E=k.length);for(var I=E-this.blockSize,C=this.B,P=this.h,D=0;D<E;){if(P==0)for(;D<=I;)s(this,k,D),D+=this.blockSize;if(typeof k=="string"){for(;D<E;)if(C[P++]=k.charCodeAt(D++),P==this.blockSize){s(this,C),P=0;break}}else for(;D<E;)if(C[P++]=k[D++],P==this.blockSize){s(this,C),P=0;break}}this.h=P,this.o+=E},r.prototype.v=function(){var k=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);k[0]=128;for(var E=1;E<k.length-8;++E)k[E]=0;var I=8*this.o;for(E=k.length-8;E<k.length;++E)k[E]=I&255,I/=256;for(this.u(k),k=Array(16),E=I=0;4>E;++E)for(var C=0;32>C;C+=8)k[I++]=this.g[E]>>>C&255;return k};function i(k,E){var I=a;return Object.prototype.hasOwnProperty.call(I,k)?I[k]:I[k]=E(k)}function o(k,E){this.h=E;for(var I=[],C=!0,P=k.length-1;0<=P;P--){var D=k[P]|0;C&&D==E||(I[P]=D,C=!1)}this.g=I}var a={};function l(k){return-128<=k&&128>k?i(k,function(E){return new o([E|0],0>E?-1:0)}):new o([k|0],0>k?-1:0)}function u(k){if(isNaN(k)||!isFinite(k))return h;if(0>k)return w(u(-k));for(var E=[],I=1,C=0;k>=I;C++)E[C]=k/I|0,I*=4294967296;return new o(E,0)}function d(k,E){if(k.length==0)throw Error("number format error: empty string");if(E=E||10,2>E||36<E)throw Error("radix out of range: "+E);if(k.charAt(0)=="-")return w(d(k.substring(1),E));if(0<=k.indexOf("-"))throw Error('number format error: interior "-" character');for(var I=u(Math.pow(E,8)),C=h,P=0;P<k.length;P+=8){var D=Math.min(8,k.length-P),A=parseInt(k.substring(P,P+D),E);8>D?(D=u(Math.pow(E,D)),C=C.j(D).add(u(A))):(C=C.j(I),C=C.add(u(A)))}return C}var h=l(0),f=l(1),m=l(16777216);t=o.prototype,t.m=function(){if(v(this))return-w(this).m();for(var k=0,E=1,I=0;I<this.g.length;I++){var C=this.i(I);k+=(0<=C?C:4294967296+C)*E,E*=4294967296}return k},t.toString=function(k){if(k=k||10,2>k||36<k)throw Error("radix out of range: "+k);if(y(this))return"0";if(v(this))return"-"+w(this).toString(k);for(var E=u(Math.pow(k,6)),I=this,C="";;){var P=N(I,E).g;I=x(I,P.j(E));var D=((0<I.g.length?I.g[0]:I.h)>>>0).toString(k);if(I=P,y(I))return D+C;for(;6>D.length;)D="0"+D;C=D+C}},t.i=function(k){return 0>k?0:k<this.g.length?this.g[k]:this.h};function y(k){if(k.h!=0)return!1;for(var E=0;E<k.g.length;E++)if(k.g[E]!=0)return!1;return!0}function v(k){return k.h==-1}t.l=function(k){return k=x(this,k),v(k)?-1:y(k)?0:1};function w(k){for(var E=k.g.length,I=[],C=0;C<E;C++)I[C]=~k.g[C];return new o(I,~k.h).add(f)}t.abs=function(){return v(this)?w(this):this},t.add=function(k){for(var E=Math.max(this.g.length,k.g.length),I=[],C=0,P=0;P<=E;P++){var D=C+(this.i(P)&65535)+(k.i(P)&65535),A=(D>>>16)+(this.i(P)>>>16)+(k.i(P)>>>16);C=A>>>16,D&=65535,A&=65535,I[P]=A<<16|D}return new o(I,I[I.length-1]&-2147483648?-1:0)};function x(k,E){return k.add(w(E))}t.j=function(k){if(y(this)||y(k))return h;if(v(this))return v(k)?w(this).j(w(k)):w(w(this).j(k));if(v(k))return w(this.j(w(k)));if(0>this.l(m)&&0>k.l(m))return u(this.m()*k.m());for(var E=this.g.length+k.g.length,I=[],C=0;C<2*E;C++)I[C]=0;for(C=0;C<this.g.length;C++)for(var P=0;P<k.g.length;P++){var D=this.i(C)>>>16,A=this.i(C)&65535,Z=k.i(P)>>>16,Q=k.i(P)&65535;I[2*C+2*P]+=A*Q,S(I,2*C+2*P),I[2*C+2*P+1]+=D*Q,S(I,2*C+2*P+1),I[2*C+2*P+1]+=A*Z,S(I,2*C+2*P+1),I[2*C+2*P+2]+=D*Z,S(I,2*C+2*P+2)}for(C=0;C<E;C++)I[C]=I[2*C+1]<<16|I[2*C];for(C=E;C<2*E;C++)I[C]=0;return new o(I,0)};function S(k,E){for(;(k[E]&65535)!=k[E];)k[E+1]+=k[E]>>>16,k[E]&=65535,E++}function b(k,E){this.g=k,this.h=E}function N(k,E){if(y(E))throw Error("division by zero");if(y(k))return new b(h,h);if(v(k))return E=N(w(k),E),new b(w(E.g),w(E.h));if(v(E))return E=N(k,w(E)),new b(w(E.g),E.h);if(30<k.g.length){if(v(k)||v(E))throw Error("slowDivide_ only works with positive integers.");for(var I=f,C=E;0>=C.l(k);)I=M(I),C=M(C);var P=V(I,1),D=V(C,1);for(C=V(C,2),I=V(I,2);!y(C);){var A=D.add(C);0>=A.l(k)&&(P=P.add(I),D=A),C=V(C,1),I=V(I,1)}return E=x(k,P.j(E)),new b(P,E)}for(P=h;0<=k.l(E);){for(I=Math.max(1,Math.floor(k.m()/E.m())),C=Math.ceil(Math.log(I)/Math.LN2),C=48>=C?1:Math.pow(2,C-48),D=u(I),A=D.j(E);v(A)||0<A.l(k);)I-=C,D=u(I),A=D.j(E);y(D)&&(D=f),P=P.add(D),k=x(k,A)}return new b(P,k)}t.A=function(k){return N(this,k).h},t.and=function(k){for(var E=Math.max(this.g.length,k.g.length),I=[],C=0;C<E;C++)I[C]=this.i(C)&k.i(C);return new o(I,this.h&k.h)},t.or=function(k){for(var E=Math.max(this.g.length,k.g.length),I=[],C=0;C<E;C++)I[C]=this.i(C)|k.i(C);return new o(I,this.h|k.h)},t.xor=function(k){for(var E=Math.max(this.g.length,k.g.length),I=[],C=0;C<E;C++)I[C]=this.i(C)^k.i(C);return new o(I,this.h^k.h)};function M(k){for(var E=k.g.length+1,I=[],C=0;C<E;C++)I[C]=k.i(C)<<1|k.i(C-1)>>>31;return new o(I,k.h)}function V(k,E){var I=E>>5;E%=32;for(var C=k.g.length-I,P=[],D=0;D<C;D++)P[D]=0<E?k.i(D+I)>>>E|k.i(D+I+1)<<32-E:k.i(D+I);return new o(P,k.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,Lk=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=u,o.fromString=d,xi=o}).apply(typeof cx<"u"?cx:typeof self<"u"?self:typeof window<"u"?window:{});var Sc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Vk,nl,jk,nd,Zm,Fk,Uk,Bk;(function(){var t,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(c,g,_){return c==Array.prototype||c==Object.prototype||(c[g]=_.value),c};function n(c){c=[typeof globalThis=="object"&&globalThis,c,typeof window=="object"&&window,typeof self=="object"&&self,typeof Sc=="object"&&Sc];for(var g=0;g<c.length;++g){var _=c[g];if(_&&_.Math==Math)return _}throw Error("Cannot find global object")}var r=n(this);function s(c,g){if(g)e:{var _=r;c=c.split(".");for(var T=0;T<c.length-1;T++){var O=c[T];if(!(O in _))break e;_=_[O]}c=c[c.length-1],T=_[c],g=g(T),g!=T&&g!=null&&e(_,c,{configurable:!0,writable:!0,value:g})}}function i(c,g){c instanceof String&&(c+="");var _=0,T=!1,O={next:function(){if(!T&&_<c.length){var L=_++;return{value:g(L,c[L]),done:!1}}return T=!0,{done:!0,value:void 0}}};return O[Symbol.iterator]=function(){return O},O}s("Array.prototype.values",function(c){return c||function(){return i(this,function(g,_){return _})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function l(c){var g=typeof c;return g=g!="object"?g:c?Array.isArray(c)?"array":g:"null",g=="array"||g=="object"&&typeof c.length=="number"}function u(c){var g=typeof c;return g=="object"&&c!=null||g=="function"}function d(c,g,_){return c.call.apply(c.bind,arguments)}function h(c,g,_){if(!c)throw Error();if(2<arguments.length){var T=Array.prototype.slice.call(arguments,2);return function(){var O=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(O,T),c.apply(g,O)}}return function(){return c.apply(g,arguments)}}function f(c,g,_){return f=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?d:h,f.apply(null,arguments)}function m(c,g){var _=Array.prototype.slice.call(arguments,1);return function(){var T=_.slice();return T.push.apply(T,arguments),c.apply(this,T)}}function y(c,g){function _(){}_.prototype=g.prototype,c.aa=g.prototype,c.prototype=new _,c.prototype.constructor=c,c.Qb=function(T,O,L){for(var z=Array(arguments.length-2),we=2;we<arguments.length;we++)z[we-2]=arguments[we];return g.prototype[O].apply(T,z)}}function v(c){const g=c.length;if(0<g){const _=Array(g);for(let T=0;T<g;T++)_[T]=c[T];return _}return[]}function w(c,g){for(let _=1;_<arguments.length;_++){const T=arguments[_];if(l(T)){const O=c.length||0,L=T.length||0;c.length=O+L;for(let z=0;z<L;z++)c[O+z]=T[z]}else c.push(T)}}class x{constructor(g,_){this.i=g,this.j=_,this.h=0,this.g=null}get(){let g;return 0<this.h?(this.h--,g=this.g,this.g=g.next,g.next=null):g=this.i(),g}}function S(c){return/^[\s\xa0]*$/.test(c)}function b(){var c=a.navigator;return c&&(c=c.userAgent)?c:""}function N(c){return N[" "](c),c}N[" "]=function(){};var M=b().indexOf("Gecko")!=-1&&!(b().toLowerCase().indexOf("webkit")!=-1&&b().indexOf("Edge")==-1)&&!(b().indexOf("Trident")!=-1||b().indexOf("MSIE")!=-1)&&b().indexOf("Edge")==-1;function V(c,g,_){for(const T in c)g.call(_,c[T],T,c)}function k(c,g){for(const _ in c)g.call(void 0,c[_],_,c)}function E(c){const g={};for(const _ in c)g[_]=c[_];return g}const I="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function C(c,g){let _,T;for(let O=1;O<arguments.length;O++){T=arguments[O];for(_ in T)c[_]=T[_];for(let L=0;L<I.length;L++)_=I[L],Object.prototype.hasOwnProperty.call(T,_)&&(c[_]=T[_])}}function P(c){var g=1;c=c.split(":");const _=[];for(;0<g&&c.length;)_.push(c.shift()),g--;return c.length&&_.push(c.join(":")),_}function D(c){a.setTimeout(()=>{throw c},0)}function A(){var c=X;let g=null;return c.g&&(g=c.g,c.g=c.g.next,c.g||(c.h=null),g.next=null),g}class Z{constructor(){this.h=this.g=null}add(g,_){const T=Q.get();T.set(g,_),this.h?this.h.next=T:this.g=T,this.h=T}}var Q=new x(()=>new ge,c=>c.reset());class ge{constructor(){this.next=this.g=this.h=null}set(g,_){this.h=g,this.g=_,this.next=null}reset(){this.next=this.g=this.h=null}}let Re,$=!1,X=new Z,ie=()=>{const c=a.Promise.resolve(void 0);Re=()=>{c.then(De)}};var De=()=>{for(var c;c=A();){try{c.h.call(c.g)}catch(_){D(_)}var g=Q;g.j(c),100>g.h&&(g.h++,c.next=g.g,g.g=c)}$=!1};function _e(){this.s=this.s,this.C=this.C}_e.prototype.s=!1,_e.prototype.ma=function(){this.s||(this.s=!0,this.N())},_e.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function ze(c,g){this.type=c,this.g=this.target=g,this.defaultPrevented=!1}ze.prototype.h=function(){this.defaultPrevented=!0};var ur=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var c=!1,g=Object.defineProperty({},"passive",{get:function(){c=!0}});try{const _=()=>{};a.addEventListener("test",_,g),a.removeEventListener("test",_,g)}catch{}return c}();function cr(c,g){if(ze.call(this,c?c.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,c){var _=this.type=c.type,T=c.changedTouches&&c.changedTouches.length?c.changedTouches[0]:null;if(this.target=c.target||c.srcElement,this.g=g,g=c.relatedTarget){if(M){e:{try{N(g.nodeName);var O=!0;break e}catch{}O=!1}O||(g=null)}}else _=="mouseover"?g=c.fromElement:_=="mouseout"&&(g=c.toElement);this.relatedTarget=g,T?(this.clientX=T.clientX!==void 0?T.clientX:T.pageX,this.clientY=T.clientY!==void 0?T.clientY:T.pageY,this.screenX=T.screenX||0,this.screenY=T.screenY||0):(this.clientX=c.clientX!==void 0?c.clientX:c.pageX,this.clientY=c.clientY!==void 0?c.clientY:c.pageY,this.screenX=c.screenX||0,this.screenY=c.screenY||0),this.button=c.button,this.key=c.key||"",this.ctrlKey=c.ctrlKey,this.altKey=c.altKey,this.shiftKey=c.shiftKey,this.metaKey=c.metaKey,this.pointerId=c.pointerId||0,this.pointerType=typeof c.pointerType=="string"?c.pointerType:dr[c.pointerType]||"",this.state=c.state,this.i=c,c.defaultPrevented&&cr.aa.h.call(this)}}y(cr,ze);var dr={2:"touch",3:"pen",4:"mouse"};cr.prototype.h=function(){cr.aa.h.call(this);var c=this.i;c.preventDefault?c.preventDefault():c.returnValue=!1};var hr="closure_listenable_"+(1e6*Math.random()|0),_A=0;function wA(c,g,_,T,O){this.listener=c,this.proxy=null,this.src=g,this.type=_,this.capture=!!T,this.ha=O,this.key=++_A,this.da=this.fa=!1}function Bu(c){c.da=!0,c.listener=null,c.proxy=null,c.src=null,c.ha=null}function zu(c){this.src=c,this.g={},this.h=0}zu.prototype.add=function(c,g,_,T,O){var L=c.toString();c=this.g[L],c||(c=this.g[L]=[],this.h++);var z=pf(c,g,T,O);return-1<z?(g=c[z],_||(g.fa=!1)):(g=new wA(g,this.src,L,!!T,O),g.fa=_,c.push(g)),g};function ff(c,g){var _=g.type;if(_ in c.g){var T=c.g[_],O=Array.prototype.indexOf.call(T,g,void 0),L;(L=0<=O)&&Array.prototype.splice.call(T,O,1),L&&(Bu(g),c.g[_].length==0&&(delete c.g[_],c.h--))}}function pf(c,g,_,T){for(var O=0;O<c.length;++O){var L=c[O];if(!L.da&&L.listener==g&&L.capture==!!_&&L.ha==T)return O}return-1}var mf="closure_lm_"+(1e6*Math.random()|0),gf={};function vv(c,g,_,T,O){if(Array.isArray(g)){for(var L=0;L<g.length;L++)vv(c,g[L],_,T,O);return null}return _=xv(_),c&&c[hr]?c.K(g,_,u(T)?!!T.capture:!1,O):xA(c,g,_,!1,T,O)}function xA(c,g,_,T,O,L){if(!g)throw Error("Invalid event type");var z=u(O)?!!O.capture:!!O,we=vf(c);if(we||(c[mf]=we=new zu(c)),_=we.add(g,_,T,z,L),_.proxy)return _;if(T=EA(),_.proxy=T,T.src=c,T.listener=_,c.addEventListener)ur||(O=z),O===void 0&&(O=!1),c.addEventListener(g.toString(),T,O);else if(c.attachEvent)c.attachEvent(wv(g.toString()),T);else if(c.addListener&&c.removeListener)c.addListener(T);else throw Error("addEventListener and attachEvent are unavailable.");return _}function EA(){function c(_){return g.call(c.src,c.listener,_)}const g=SA;return c}function _v(c,g,_,T,O){if(Array.isArray(g))for(var L=0;L<g.length;L++)_v(c,g[L],_,T,O);else T=u(T)?!!T.capture:!!T,_=xv(_),c&&c[hr]?(c=c.i,g=String(g).toString(),g in c.g&&(L=c.g[g],_=pf(L,_,T,O),-1<_&&(Bu(L[_]),Array.prototype.splice.call(L,_,1),L.length==0&&(delete c.g[g],c.h--)))):c&&(c=vf(c))&&(g=c.g[g.toString()],c=-1,g&&(c=pf(g,_,T,O)),(_=-1<c?g[c]:null)&&yf(_))}function yf(c){if(typeof c!="number"&&c&&!c.da){var g=c.src;if(g&&g[hr])ff(g.i,c);else{var _=c.type,T=c.proxy;g.removeEventListener?g.removeEventListener(_,T,c.capture):g.detachEvent?g.detachEvent(wv(_),T):g.addListener&&g.removeListener&&g.removeListener(T),(_=vf(g))?(ff(_,c),_.h==0&&(_.src=null,g[mf]=null)):Bu(c)}}}function wv(c){return c in gf?gf[c]:gf[c]="on"+c}function SA(c,g){if(c.da)c=!0;else{g=new cr(g,this);var _=c.listener,T=c.ha||c.src;c.fa&&yf(c),c=_.call(T,g)}return c}function vf(c){return c=c[mf],c instanceof zu?c:null}var _f="__closure_events_fn_"+(1e9*Math.random()>>>0);function xv(c){return typeof c=="function"?c:(c[_f]||(c[_f]=function(g){return c.handleEvent(g)}),c[_f])}function wt(){_e.call(this),this.i=new zu(this),this.M=this,this.F=null}y(wt,_e),wt.prototype[hr]=!0,wt.prototype.removeEventListener=function(c,g,_,T){_v(this,c,g,_,T)};function Mt(c,g){var _,T=c.F;if(T)for(_=[];T;T=T.F)_.push(T);if(c=c.M,T=g.type||g,typeof g=="string")g=new ze(g,c);else if(g instanceof ze)g.target=g.target||c;else{var O=g;g=new ze(T,c),C(g,O)}if(O=!0,_)for(var L=_.length-1;0<=L;L--){var z=g.g=_[L];O=$u(z,T,!0,g)&&O}if(z=g.g=c,O=$u(z,T,!0,g)&&O,O=$u(z,T,!1,g)&&O,_)for(L=0;L<_.length;L++)z=g.g=_[L],O=$u(z,T,!1,g)&&O}wt.prototype.N=function(){if(wt.aa.N.call(this),this.i){var c=this.i,g;for(g in c.g){for(var _=c.g[g],T=0;T<_.length;T++)Bu(_[T]);delete c.g[g],c.h--}}this.F=null},wt.prototype.K=function(c,g,_,T){return this.i.add(String(c),g,!1,_,T)},wt.prototype.L=function(c,g,_,T){return this.i.add(String(c),g,!0,_,T)};function $u(c,g,_,T){if(g=c.i.g[String(g)],!g)return!0;g=g.concat();for(var O=!0,L=0;L<g.length;++L){var z=g[L];if(z&&!z.da&&z.capture==_){var we=z.listener,at=z.ha||z.src;z.fa&&ff(c.i,z),O=we.call(at,T)!==!1&&O}}return O&&!T.defaultPrevented}function Ev(c,g,_){if(typeof c=="function")_&&(c=f(c,_));else if(c&&typeof c.handleEvent=="function")c=f(c.handleEvent,c);else throw Error("Invalid listener argument");return 2147483647<Number(g)?-1:a.setTimeout(c,g||0)}function Sv(c){c.g=Ev(()=>{c.g=null,c.i&&(c.i=!1,Sv(c))},c.l);const g=c.h;c.h=null,c.m.apply(null,g)}class bA extends _e{constructor(g,_){super(),this.m=g,this.l=_,this.h=null,this.i=!1,this.g=null}j(g){this.h=arguments,this.g?this.i=!0:Sv(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ta(c){_e.call(this),this.h=c,this.g={}}y(Ta,_e);var bv=[];function Tv(c){V(c.g,function(g,_){this.g.hasOwnProperty(_)&&yf(g)},c),c.g={}}Ta.prototype.N=function(){Ta.aa.N.call(this),Tv(this)},Ta.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var wf=a.JSON.stringify,TA=a.JSON.parse,kA=class{stringify(c){return a.JSON.stringify(c,void 0)}parse(c){return a.JSON.parse(c,void 0)}};function xf(){}xf.prototype.h=null;function kv(c){return c.h||(c.h=c.i())}function Iv(){}var ka={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Ef(){ze.call(this,"d")}y(Ef,ze);function Sf(){ze.call(this,"c")}y(Sf,ze);var ti={},Cv=null;function qu(){return Cv=Cv||new wt}ti.La="serverreachability";function Av(c){ze.call(this,ti.La,c)}y(Av,ze);function Ia(c){const g=qu();Mt(g,new Av(g))}ti.STAT_EVENT="statevent";function Nv(c,g){ze.call(this,ti.STAT_EVENT,c),this.stat=g}y(Nv,ze);function Lt(c){const g=qu();Mt(g,new Nv(g,c))}ti.Ma="timingevent";function Rv(c,g){ze.call(this,ti.Ma,c),this.size=g}y(Rv,ze);function Ca(c,g){if(typeof c!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){c()},g)}function Aa(){this.g=!0}Aa.prototype.xa=function(){this.g=!1};function IA(c,g,_,T,O,L){c.info(function(){if(c.g)if(L)for(var z="",we=L.split("&"),at=0;at<we.length;at++){var pe=we[at].split("=");if(1<pe.length){var xt=pe[0];pe=pe[1];var Et=xt.split("_");z=2<=Et.length&&Et[1]=="type"?z+(xt+"="+pe+"&"):z+(xt+"=redacted&")}}else z=null;else z=L;return"XMLHTTP REQ ("+T+") [attempt "+O+"]: "+g+`
`+_+`
`+z})}function CA(c,g,_,T,O,L,z){c.info(function(){return"XMLHTTP RESP ("+T+") [ attempt "+O+"]: "+g+`
`+_+`
`+L+" "+z})}function Zi(c,g,_,T){c.info(function(){return"XMLHTTP TEXT ("+g+"): "+NA(c,_)+(T?" "+T:"")})}function AA(c,g){c.info(function(){return"TIMEOUT: "+g})}Aa.prototype.info=function(){};function NA(c,g){if(!c.g)return g;if(!g)return null;try{var _=JSON.parse(g);if(_){for(c=0;c<_.length;c++)if(Array.isArray(_[c])){var T=_[c];if(!(2>T.length)){var O=T[1];if(Array.isArray(O)&&!(1>O.length)){var L=O[0];if(L!="noop"&&L!="stop"&&L!="close")for(var z=1;z<O.length;z++)O[z]=""}}}}return wf(_)}catch{return g}}var Hu={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Pv={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},bf;function Wu(){}y(Wu,xf),Wu.prototype.g=function(){return new XMLHttpRequest},Wu.prototype.i=function(){return{}},bf=new Wu;function Hr(c,g,_,T){this.j=c,this.i=g,this.l=_,this.R=T||1,this.U=new Ta(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Dv}function Dv(){this.i=null,this.g="",this.h=!1}var Ov={},Tf={};function kf(c,g,_){c.L=1,c.v=Ju(fr(g)),c.m=_,c.P=!0,Mv(c,null)}function Mv(c,g){c.F=Date.now(),Ku(c),c.A=fr(c.v);var _=c.A,T=c.R;Array.isArray(T)||(T=[String(T)]),Qv(_.i,"t",T),c.C=0,_=c.j.J,c.h=new Dv,c.g=f_(c.j,_?g:null,!c.m),0<c.O&&(c.M=new bA(f(c.Y,c,c.g),c.O)),g=c.U,_=c.g,T=c.ca;var O="readystatechange";Array.isArray(O)||(O&&(bv[0]=O.toString()),O=bv);for(var L=0;L<O.length;L++){var z=vv(_,O[L],T||g.handleEvent,!1,g.h||g);if(!z)break;g.g[z.key]=z}g=c.H?E(c.H):{},c.m?(c.u||(c.u="POST"),g["Content-Type"]="application/x-www-form-urlencoded",c.g.ea(c.A,c.u,c.m,g)):(c.u="GET",c.g.ea(c.A,c.u,null,g)),Ia(),IA(c.i,c.u,c.A,c.l,c.R,c.m)}Hr.prototype.ca=function(c){c=c.target;const g=this.M;g&&pr(c)==3?g.j():this.Y(c)},Hr.prototype.Y=function(c){try{if(c==this.g)e:{const Et=pr(this.g);var g=this.g.Ba();const no=this.g.Z();if(!(3>Et)&&(Et!=3||this.g&&(this.h.h||this.g.oa()||n_(this.g)))){this.J||Et!=4||g==7||(g==8||0>=no?Ia(3):Ia(2)),If(this);var _=this.g.Z();this.X=_;t:if(Lv(this)){var T=n_(this.g);c="";var O=T.length,L=pr(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){ni(this),Na(this);var z="";break t}this.h.i=new a.TextDecoder}for(g=0;g<O;g++)this.h.h=!0,c+=this.h.i.decode(T[g],{stream:!(L&&g==O-1)});T.length=0,this.h.g+=c,this.C=0,z=this.h.g}else z=this.g.oa();if(this.o=_==200,CA(this.i,this.u,this.A,this.l,this.R,Et,_),this.o){if(this.T&&!this.K){t:{if(this.g){var we,at=this.g;if((we=at.g?at.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!S(we)){var pe=we;break t}}pe=null}if(_=pe)Zi(this.i,this.l,_,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Cf(this,_);else{this.o=!1,this.s=3,Lt(12),ni(this),Na(this);break e}}if(this.P){_=!0;let Rn;for(;!this.J&&this.C<z.length;)if(Rn=RA(this,z),Rn==Tf){Et==4&&(this.s=4,Lt(14),_=!1),Zi(this.i,this.l,null,"[Incomplete Response]");break}else if(Rn==Ov){this.s=4,Lt(15),Zi(this.i,this.l,z,"[Invalid Chunk]"),_=!1;break}else Zi(this.i,this.l,Rn,null),Cf(this,Rn);if(Lv(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Et!=4||z.length!=0||this.h.h||(this.s=1,Lt(16),_=!1),this.o=this.o&&_,!_)Zi(this.i,this.l,z,"[Invalid Chunked Response]"),ni(this),Na(this);else if(0<z.length&&!this.W){this.W=!0;var xt=this.j;xt.g==this&&xt.ba&&!xt.M&&(xt.j.info("Great, no buffering proxy detected. Bytes received: "+z.length),Of(xt),xt.M=!0,Lt(11))}}else Zi(this.i,this.l,z,null),Cf(this,z);Et==4&&ni(this),this.o&&!this.J&&(Et==4?u_(this.j,this):(this.o=!1,Ku(this)))}else GA(this.g),_==400&&0<z.indexOf("Unknown SID")?(this.s=3,Lt(12)):(this.s=0,Lt(13)),ni(this),Na(this)}}}catch{}finally{}};function Lv(c){return c.g?c.u=="GET"&&c.L!=2&&c.j.Ca:!1}function RA(c,g){var _=c.C,T=g.indexOf(`
`,_);return T==-1?Tf:(_=Number(g.substring(_,T)),isNaN(_)?Ov:(T+=1,T+_>g.length?Tf:(g=g.slice(T,T+_),c.C=T+_,g)))}Hr.prototype.cancel=function(){this.J=!0,ni(this)};function Ku(c){c.S=Date.now()+c.I,Vv(c,c.I)}function Vv(c,g){if(c.B!=null)throw Error("WatchDog timer not null");c.B=Ca(f(c.ba,c),g)}function If(c){c.B&&(a.clearTimeout(c.B),c.B=null)}Hr.prototype.ba=function(){this.B=null;const c=Date.now();0<=c-this.S?(AA(this.i,this.A),this.L!=2&&(Ia(),Lt(17)),ni(this),this.s=2,Na(this)):Vv(this,this.S-c)};function Na(c){c.j.G==0||c.J||u_(c.j,c)}function ni(c){If(c);var g=c.M;g&&typeof g.ma=="function"&&g.ma(),c.M=null,Tv(c.U),c.g&&(g=c.g,c.g=null,g.abort(),g.ma())}function Cf(c,g){try{var _=c.j;if(_.G!=0&&(_.g==c||Af(_.h,c))){if(!c.K&&Af(_.h,c)&&_.G==3){try{var T=_.Da.g.parse(g)}catch{T=null}if(Array.isArray(T)&&T.length==3){var O=T;if(O[0]==0){e:if(!_.u){if(_.g)if(_.g.F+3e3<c.F)nc(_),ec(_);else break e;Df(_),Lt(18)}}else _.za=O[1],0<_.za-_.T&&37500>O[2]&&_.F&&_.v==0&&!_.C&&(_.C=Ca(f(_.Za,_),6e3));if(1>=Uv(_.h)&&_.ca){try{_.ca()}catch{}_.ca=void 0}}else si(_,11)}else if((c.K||_.g==c)&&nc(_),!S(g))for(O=_.Da.g.parse(g),g=0;g<O.length;g++){let pe=O[g];if(_.T=pe[0],pe=pe[1],_.G==2)if(pe[0]=="c"){_.K=pe[1],_.ia=pe[2];const xt=pe[3];xt!=null&&(_.la=xt,_.j.info("VER="+_.la));const Et=pe[4];Et!=null&&(_.Aa=Et,_.j.info("SVER="+_.Aa));const no=pe[5];no!=null&&typeof no=="number"&&0<no&&(T=1.5*no,_.L=T,_.j.info("backChannelRequestTimeoutMs_="+T)),T=_;const Rn=c.g;if(Rn){const sc=Rn.g?Rn.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(sc){var L=T.h;L.g||sc.indexOf("spdy")==-1&&sc.indexOf("quic")==-1&&sc.indexOf("h2")==-1||(L.j=L.l,L.g=new Set,L.h&&(Nf(L,L.h),L.h=null))}if(T.D){const Mf=Rn.g?Rn.g.getResponseHeader("X-HTTP-Session-Id"):null;Mf&&(T.ya=Mf,be(T.I,T.D,Mf))}}_.G=3,_.l&&_.l.ua(),_.ba&&(_.R=Date.now()-c.F,_.j.info("Handshake RTT: "+_.R+"ms")),T=_;var z=c;if(T.qa=h_(T,T.J?T.ia:null,T.W),z.K){Bv(T.h,z);var we=z,at=T.L;at&&(we.I=at),we.B&&(If(we),Ku(we)),T.g=z}else a_(T);0<_.i.length&&tc(_)}else pe[0]!="stop"&&pe[0]!="close"||si(_,7);else _.G==3&&(pe[0]=="stop"||pe[0]=="close"?pe[0]=="stop"?si(_,7):Pf(_):pe[0]!="noop"&&_.l&&_.l.ta(pe),_.v=0)}}Ia(4)}catch{}}var PA=class{constructor(c,g){this.g=c,this.map=g}};function jv(c){this.l=c||10,a.PerformanceNavigationTiming?(c=a.performance.getEntriesByType("navigation"),c=0<c.length&&(c[0].nextHopProtocol=="hq"||c[0].nextHopProtocol=="h2")):c=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=c?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Fv(c){return c.h?!0:c.g?c.g.size>=c.j:!1}function Uv(c){return c.h?1:c.g?c.g.size:0}function Af(c,g){return c.h?c.h==g:c.g?c.g.has(g):!1}function Nf(c,g){c.g?c.g.add(g):c.h=g}function Bv(c,g){c.h&&c.h==g?c.h=null:c.g&&c.g.has(g)&&c.g.delete(g)}jv.prototype.cancel=function(){if(this.i=zv(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const c of this.g.values())c.cancel();this.g.clear()}};function zv(c){if(c.h!=null)return c.i.concat(c.h.D);if(c.g!=null&&c.g.size!==0){let g=c.i;for(const _ of c.g.values())g=g.concat(_.D);return g}return v(c.i)}function DA(c){if(c.V&&typeof c.V=="function")return c.V();if(typeof Map<"u"&&c instanceof Map||typeof Set<"u"&&c instanceof Set)return Array.from(c.values());if(typeof c=="string")return c.split("");if(l(c)){for(var g=[],_=c.length,T=0;T<_;T++)g.push(c[T]);return g}g=[],_=0;for(T in c)g[_++]=c[T];return g}function OA(c){if(c.na&&typeof c.na=="function")return c.na();if(!c.V||typeof c.V!="function"){if(typeof Map<"u"&&c instanceof Map)return Array.from(c.keys());if(!(typeof Set<"u"&&c instanceof Set)){if(l(c)||typeof c=="string"){var g=[];c=c.length;for(var _=0;_<c;_++)g.push(_);return g}g=[],_=0;for(const T in c)g[_++]=T;return g}}}function $v(c,g){if(c.forEach&&typeof c.forEach=="function")c.forEach(g,void 0);else if(l(c)||typeof c=="string")Array.prototype.forEach.call(c,g,void 0);else for(var _=OA(c),T=DA(c),O=T.length,L=0;L<O;L++)g.call(void 0,T[L],_&&_[L],c)}var qv=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function MA(c,g){if(c){c=c.split("&");for(var _=0;_<c.length;_++){var T=c[_].indexOf("="),O=null;if(0<=T){var L=c[_].substring(0,T);O=c[_].substring(T+1)}else L=c[_];g(L,O?decodeURIComponent(O.replace(/\+/g," ")):"")}}}function ri(c){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,c instanceof ri){this.h=c.h,Gu(this,c.j),this.o=c.o,this.g=c.g,Qu(this,c.s),this.l=c.l;var g=c.i,_=new Da;_.i=g.i,g.g&&(_.g=new Map(g.g),_.h=g.h),Hv(this,_),this.m=c.m}else c&&(g=String(c).match(qv))?(this.h=!1,Gu(this,g[1]||"",!0),this.o=Ra(g[2]||""),this.g=Ra(g[3]||"",!0),Qu(this,g[4]),this.l=Ra(g[5]||"",!0),Hv(this,g[6]||"",!0),this.m=Ra(g[7]||"")):(this.h=!1,this.i=new Da(null,this.h))}ri.prototype.toString=function(){var c=[],g=this.j;g&&c.push(Pa(g,Wv,!0),":");var _=this.g;return(_||g=="file")&&(c.push("//"),(g=this.o)&&c.push(Pa(g,Wv,!0),"@"),c.push(encodeURIComponent(String(_)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),_=this.s,_!=null&&c.push(":",String(_))),(_=this.l)&&(this.g&&_.charAt(0)!="/"&&c.push("/"),c.push(Pa(_,_.charAt(0)=="/"?jA:VA,!0))),(_=this.i.toString())&&c.push("?",_),(_=this.m)&&c.push("#",Pa(_,UA)),c.join("")};function fr(c){return new ri(c)}function Gu(c,g,_){c.j=_?Ra(g,!0):g,c.j&&(c.j=c.j.replace(/:$/,""))}function Qu(c,g){if(g){if(g=Number(g),isNaN(g)||0>g)throw Error("Bad port number "+g);c.s=g}else c.s=null}function Hv(c,g,_){g instanceof Da?(c.i=g,BA(c.i,c.h)):(_||(g=Pa(g,FA)),c.i=new Da(g,c.h))}function be(c,g,_){c.i.set(g,_)}function Ju(c){return be(c,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),c}function Ra(c,g){return c?g?decodeURI(c.replace(/%25/g,"%2525")):decodeURIComponent(c):""}function Pa(c,g,_){return typeof c=="string"?(c=encodeURI(c).replace(g,LA),_&&(c=c.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),c):null}function LA(c){return c=c.charCodeAt(0),"%"+(c>>4&15).toString(16)+(c&15).toString(16)}var Wv=/[#\/\?@]/g,VA=/[#\?:]/g,jA=/[#\?]/g,FA=/[#\?@]/g,UA=/#/g;function Da(c,g){this.h=this.g=null,this.i=c||null,this.j=!!g}function Wr(c){c.g||(c.g=new Map,c.h=0,c.i&&MA(c.i,function(g,_){c.add(decodeURIComponent(g.replace(/\+/g," ")),_)}))}t=Da.prototype,t.add=function(c,g){Wr(this),this.i=null,c=eo(this,c);var _=this.g.get(c);return _||this.g.set(c,_=[]),_.push(g),this.h+=1,this};function Kv(c,g){Wr(c),g=eo(c,g),c.g.has(g)&&(c.i=null,c.h-=c.g.get(g).length,c.g.delete(g))}function Gv(c,g){return Wr(c),g=eo(c,g),c.g.has(g)}t.forEach=function(c,g){Wr(this),this.g.forEach(function(_,T){_.forEach(function(O){c.call(g,O,T,this)},this)},this)},t.na=function(){Wr(this);const c=Array.from(this.g.values()),g=Array.from(this.g.keys()),_=[];for(let T=0;T<g.length;T++){const O=c[T];for(let L=0;L<O.length;L++)_.push(g[T])}return _},t.V=function(c){Wr(this);let g=[];if(typeof c=="string")Gv(this,c)&&(g=g.concat(this.g.get(eo(this,c))));else{c=Array.from(this.g.values());for(let _=0;_<c.length;_++)g=g.concat(c[_])}return g},t.set=function(c,g){return Wr(this),this.i=null,c=eo(this,c),Gv(this,c)&&(this.h-=this.g.get(c).length),this.g.set(c,[g]),this.h+=1,this},t.get=function(c,g){return c?(c=this.V(c),0<c.length?String(c[0]):g):g};function Qv(c,g,_){Kv(c,g),0<_.length&&(c.i=null,c.g.set(eo(c,g),v(_)),c.h+=_.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const c=[],g=Array.from(this.g.keys());for(var _=0;_<g.length;_++){var T=g[_];const L=encodeURIComponent(String(T)),z=this.V(T);for(T=0;T<z.length;T++){var O=L;z[T]!==""&&(O+="="+encodeURIComponent(String(z[T]))),c.push(O)}}return this.i=c.join("&")};function eo(c,g){return g=String(g),c.j&&(g=g.toLowerCase()),g}function BA(c,g){g&&!c.j&&(Wr(c),c.i=null,c.g.forEach(function(_,T){var O=T.toLowerCase();T!=O&&(Kv(this,T),Qv(this,O,_))},c)),c.j=g}function zA(c,g){const _=new Aa;if(a.Image){const T=new Image;T.onload=m(Kr,_,"TestLoadImage: loaded",!0,g,T),T.onerror=m(Kr,_,"TestLoadImage: error",!1,g,T),T.onabort=m(Kr,_,"TestLoadImage: abort",!1,g,T),T.ontimeout=m(Kr,_,"TestLoadImage: timeout",!1,g,T),a.setTimeout(function(){T.ontimeout&&T.ontimeout()},1e4),T.src=c}else g(!1)}function $A(c,g){const _=new Aa,T=new AbortController,O=setTimeout(()=>{T.abort(),Kr(_,"TestPingServer: timeout",!1,g)},1e4);fetch(c,{signal:T.signal}).then(L=>{clearTimeout(O),L.ok?Kr(_,"TestPingServer: ok",!0,g):Kr(_,"TestPingServer: server error",!1,g)}).catch(()=>{clearTimeout(O),Kr(_,"TestPingServer: error",!1,g)})}function Kr(c,g,_,T,O){try{O&&(O.onload=null,O.onerror=null,O.onabort=null,O.ontimeout=null),T(_)}catch{}}function qA(){this.g=new kA}function HA(c,g,_){const T=_||"";try{$v(c,function(O,L){let z=O;u(O)&&(z=wf(O)),g.push(T+L+"="+encodeURIComponent(z))})}catch(O){throw g.push(T+"type="+encodeURIComponent("_badmap")),O}}function Yu(c){this.l=c.Ub||null,this.j=c.eb||!1}y(Yu,xf),Yu.prototype.g=function(){return new Xu(this.l,this.j)},Yu.prototype.i=function(c){return function(){return c}}({});function Xu(c,g){wt.call(this),this.D=c,this.o=g,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}y(Xu,wt),t=Xu.prototype,t.open=function(c,g){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=c,this.A=g,this.readyState=1,Ma(this)},t.send=function(c){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const g={headers:this.u,method:this.B,credentials:this.m,cache:void 0};c&&(g.body=c),(this.D||a).fetch(new Request(this.A,g)).then(this.Sa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Oa(this)),this.readyState=0},t.Sa=function(c){if(this.g&&(this.l=c,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=c.headers,this.readyState=2,Ma(this)),this.g&&(this.readyState=3,Ma(this),this.g)))if(this.responseType==="arraybuffer")c.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in c){if(this.j=c.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Jv(this)}else c.text().then(this.Ra.bind(this),this.ga.bind(this))};function Jv(c){c.j.read().then(c.Pa.bind(c)).catch(c.ga.bind(c))}t.Pa=function(c){if(this.g){if(this.o&&c.value)this.response.push(c.value);else if(!this.o){var g=c.value?c.value:new Uint8Array(0);(g=this.v.decode(g,{stream:!c.done}))&&(this.response=this.responseText+=g)}c.done?Oa(this):Ma(this),this.readyState==3&&Jv(this)}},t.Ra=function(c){this.g&&(this.response=this.responseText=c,Oa(this))},t.Qa=function(c){this.g&&(this.response=c,Oa(this))},t.ga=function(){this.g&&Oa(this)};function Oa(c){c.readyState=4,c.l=null,c.j=null,c.v=null,Ma(c)}t.setRequestHeader=function(c,g){this.u.append(c,g)},t.getResponseHeader=function(c){return this.h&&this.h.get(c.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const c=[],g=this.h.entries();for(var _=g.next();!_.done;)_=_.value,c.push(_[0]+": "+_[1]),_=g.next();return c.join(`\r
`)};function Ma(c){c.onreadystatechange&&c.onreadystatechange.call(c)}Object.defineProperty(Xu.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(c){this.m=c?"include":"same-origin"}});function Yv(c){let g="";return V(c,function(_,T){g+=T,g+=":",g+=_,g+=`\r
`}),g}function Rf(c,g,_){e:{for(T in _){var T=!1;break e}T=!0}T||(_=Yv(_),typeof c=="string"?_!=null&&encodeURIComponent(String(_)):be(c,g,_))}function Fe(c){wt.call(this),this.headers=new Map,this.o=c||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}y(Fe,wt);var WA=/^https?$/i,KA=["POST","PUT"];t=Fe.prototype,t.Ha=function(c){this.J=c},t.ea=function(c,g,_,T){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+c);g=g?g.toUpperCase():"GET",this.D=c,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():bf.g(),this.v=this.o?kv(this.o):kv(bf),this.g.onreadystatechange=f(this.Ea,this);try{this.B=!0,this.g.open(g,String(c),!0),this.B=!1}catch(L){Xv(this,L);return}if(c=_||"",_=new Map(this.headers),T)if(Object.getPrototypeOf(T)===Object.prototype)for(var O in T)_.set(O,T[O]);else if(typeof T.keys=="function"&&typeof T.get=="function")for(const L of T.keys())_.set(L,T.get(L));else throw Error("Unknown input type for opt_headers: "+String(T));T=Array.from(_.keys()).find(L=>L.toLowerCase()=="content-type"),O=a.FormData&&c instanceof a.FormData,!(0<=Array.prototype.indexOf.call(KA,g,void 0))||T||O||_.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[L,z]of _)this.g.setRequestHeader(L,z);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{t_(this),this.u=!0,this.g.send(c),this.u=!1}catch(L){Xv(this,L)}};function Xv(c,g){c.h=!1,c.g&&(c.j=!0,c.g.abort(),c.j=!1),c.l=g,c.m=5,Zv(c),Zu(c)}function Zv(c){c.A||(c.A=!0,Mt(c,"complete"),Mt(c,"error"))}t.abort=function(c){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=c||7,Mt(this,"complete"),Mt(this,"abort"),Zu(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Zu(this,!0)),Fe.aa.N.call(this)},t.Ea=function(){this.s||(this.B||this.u||this.j?e_(this):this.bb())},t.bb=function(){e_(this)};function e_(c){if(c.h&&typeof o<"u"&&(!c.v[1]||pr(c)!=4||c.Z()!=2)){if(c.u&&pr(c)==4)Ev(c.Ea,0,c);else if(Mt(c,"readystatechange"),pr(c)==4){c.h=!1;try{const z=c.Z();e:switch(z){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var g=!0;break e;default:g=!1}var _;if(!(_=g)){var T;if(T=z===0){var O=String(c.D).match(qv)[1]||null;!O&&a.self&&a.self.location&&(O=a.self.location.protocol.slice(0,-1)),T=!WA.test(O?O.toLowerCase():"")}_=T}if(_)Mt(c,"complete"),Mt(c,"success");else{c.m=6;try{var L=2<pr(c)?c.g.statusText:""}catch{L=""}c.l=L+" ["+c.Z()+"]",Zv(c)}}finally{Zu(c)}}}}function Zu(c,g){if(c.g){t_(c);const _=c.g,T=c.v[0]?()=>{}:null;c.g=null,c.v=null,g||Mt(c,"ready");try{_.onreadystatechange=T}catch{}}}function t_(c){c.I&&(a.clearTimeout(c.I),c.I=null)}t.isActive=function(){return!!this.g};function pr(c){return c.g?c.g.readyState:0}t.Z=function(){try{return 2<pr(this)?this.g.status:-1}catch{return-1}},t.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.Oa=function(c){if(this.g){var g=this.g.responseText;return c&&g.indexOf(c)==0&&(g=g.substring(c.length)),TA(g)}};function n_(c){try{if(!c.g)return null;if("response"in c.g)return c.g.response;switch(c.H){case"":case"text":return c.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in c.g)return c.g.mozResponseArrayBuffer}return null}catch{return null}}function GA(c){const g={};c=(c.g&&2<=pr(c)&&c.g.getAllResponseHeaders()||"").split(`\r
`);for(let T=0;T<c.length;T++){if(S(c[T]))continue;var _=P(c[T]);const O=_[0];if(_=_[1],typeof _!="string")continue;_=_.trim();const L=g[O]||[];g[O]=L,L.push(_)}k(g,function(T){return T.join(", ")})}t.Ba=function(){return this.m},t.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function La(c,g,_){return _&&_.internalChannelParams&&_.internalChannelParams[c]||g}function r_(c){this.Aa=0,this.i=[],this.j=new Aa,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=La("failFast",!1,c),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=La("baseRetryDelayMs",5e3,c),this.cb=La("retryDelaySeedMs",1e4,c),this.Wa=La("forwardChannelMaxRetries",2,c),this.wa=La("forwardChannelRequestTimeoutMs",2e4,c),this.pa=c&&c.xmlHttpFactory||void 0,this.Xa=c&&c.Tb||void 0,this.Ca=c&&c.useFetchStreams||!1,this.L=void 0,this.J=c&&c.supportsCrossDomainXhr||!1,this.K="",this.h=new jv(c&&c.concurrentRequestLimit),this.Da=new qA,this.P=c&&c.fastHandshake||!1,this.O=c&&c.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=c&&c.Rb||!1,c&&c.xa&&this.j.xa(),c&&c.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&c&&c.detectBufferingProxy||!1,this.ja=void 0,c&&c.longPollingTimeout&&0<c.longPollingTimeout&&(this.ja=c.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}t=r_.prototype,t.la=8,t.G=1,t.connect=function(c,g,_,T){Lt(0),this.W=c,this.H=g||{},_&&T!==void 0&&(this.H.OSID=_,this.H.OAID=T),this.F=this.X,this.I=h_(this,null,this.W),tc(this)};function Pf(c){if(s_(c),c.G==3){var g=c.U++,_=fr(c.I);if(be(_,"SID",c.K),be(_,"RID",g),be(_,"TYPE","terminate"),Va(c,_),g=new Hr(c,c.j,g),g.L=2,g.v=Ju(fr(_)),_=!1,a.navigator&&a.navigator.sendBeacon)try{_=a.navigator.sendBeacon(g.v.toString(),"")}catch{}!_&&a.Image&&(new Image().src=g.v,_=!0),_||(g.g=f_(g.j,null),g.g.ea(g.v)),g.F=Date.now(),Ku(g)}d_(c)}function ec(c){c.g&&(Of(c),c.g.cancel(),c.g=null)}function s_(c){ec(c),c.u&&(a.clearTimeout(c.u),c.u=null),nc(c),c.h.cancel(),c.s&&(typeof c.s=="number"&&a.clearTimeout(c.s),c.s=null)}function tc(c){if(!Fv(c.h)&&!c.s){c.s=!0;var g=c.Ga;Re||ie(),$||(Re(),$=!0),X.add(g,c),c.B=0}}function QA(c,g){return Uv(c.h)>=c.h.j-(c.s?1:0)?!1:c.s?(c.i=g.D.concat(c.i),!0):c.G==1||c.G==2||c.B>=(c.Va?0:c.Wa)?!1:(c.s=Ca(f(c.Ga,c,g),c_(c,c.B)),c.B++,!0)}t.Ga=function(c){if(this.s)if(this.s=null,this.G==1){if(!c){this.U=Math.floor(1e5*Math.random()),c=this.U++;const O=new Hr(this,this.j,c);let L=this.o;if(this.S&&(L?(L=E(L),C(L,this.S)):L=this.S),this.m!==null||this.O||(O.H=L,L=null),this.P)e:{for(var g=0,_=0;_<this.i.length;_++){t:{var T=this.i[_];if("__data__"in T.map&&(T=T.map.__data__,typeof T=="string")){T=T.length;break t}T=void 0}if(T===void 0)break;if(g+=T,4096<g){g=_;break e}if(g===4096||_===this.i.length-1){g=_+1;break e}}g=1e3}else g=1e3;g=o_(this,O,g),_=fr(this.I),be(_,"RID",c),be(_,"CVER",22),this.D&&be(_,"X-HTTP-Session-Id",this.D),Va(this,_),L&&(this.O?g="headers="+encodeURIComponent(String(Yv(L)))+"&"+g:this.m&&Rf(_,this.m,L)),Nf(this.h,O),this.Ua&&be(_,"TYPE","init"),this.P?(be(_,"$req",g),be(_,"SID","null"),O.T=!0,kf(O,_,null)):kf(O,_,g),this.G=2}}else this.G==3&&(c?i_(this,c):this.i.length==0||Fv(this.h)||i_(this))};function i_(c,g){var _;g?_=g.l:_=c.U++;const T=fr(c.I);be(T,"SID",c.K),be(T,"RID",_),be(T,"AID",c.T),Va(c,T),c.m&&c.o&&Rf(T,c.m,c.o),_=new Hr(c,c.j,_,c.B+1),c.m===null&&(_.H=c.o),g&&(c.i=g.D.concat(c.i)),g=o_(c,_,1e3),_.I=Math.round(.5*c.wa)+Math.round(.5*c.wa*Math.random()),Nf(c.h,_),kf(_,T,g)}function Va(c,g){c.H&&V(c.H,function(_,T){be(g,T,_)}),c.l&&$v({},function(_,T){be(g,T,_)})}function o_(c,g,_){_=Math.min(c.i.length,_);var T=c.l?f(c.l.Na,c.l,c):null;e:{var O=c.i;let L=-1;for(;;){const z=["count="+_];L==-1?0<_?(L=O[0].g,z.push("ofs="+L)):L=0:z.push("ofs="+L);let we=!0;for(let at=0;at<_;at++){let pe=O[at].g;const xt=O[at].map;if(pe-=L,0>pe)L=Math.max(0,O[at].g-100),we=!1;else try{HA(xt,z,"req"+pe+"_")}catch{T&&T(xt)}}if(we){T=z.join("&");break e}}}return c=c.i.splice(0,_),g.D=c,T}function a_(c){if(!c.g&&!c.u){c.Y=1;var g=c.Fa;Re||ie(),$||(Re(),$=!0),X.add(g,c),c.v=0}}function Df(c){return c.g||c.u||3<=c.v?!1:(c.Y++,c.u=Ca(f(c.Fa,c),c_(c,c.v)),c.v++,!0)}t.Fa=function(){if(this.u=null,l_(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var c=2*this.R;this.j.info("BP detection timer enabled: "+c),this.A=Ca(f(this.ab,this),c)}},t.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Lt(10),ec(this),l_(this))};function Of(c){c.A!=null&&(a.clearTimeout(c.A),c.A=null)}function l_(c){c.g=new Hr(c,c.j,"rpc",c.Y),c.m===null&&(c.g.H=c.o),c.g.O=0;var g=fr(c.qa);be(g,"RID","rpc"),be(g,"SID",c.K),be(g,"AID",c.T),be(g,"CI",c.F?"0":"1"),!c.F&&c.ja&&be(g,"TO",c.ja),be(g,"TYPE","xmlhttp"),Va(c,g),c.m&&c.o&&Rf(g,c.m,c.o),c.L&&(c.g.I=c.L);var _=c.g;c=c.ia,_.L=1,_.v=Ju(fr(g)),_.m=null,_.P=!0,Mv(_,c)}t.Za=function(){this.C!=null&&(this.C=null,ec(this),Df(this),Lt(19))};function nc(c){c.C!=null&&(a.clearTimeout(c.C),c.C=null)}function u_(c,g){var _=null;if(c.g==g){nc(c),Of(c),c.g=null;var T=2}else if(Af(c.h,g))_=g.D,Bv(c.h,g),T=1;else return;if(c.G!=0){if(g.o)if(T==1){_=g.m?g.m.length:0,g=Date.now()-g.F;var O=c.B;T=qu(),Mt(T,new Rv(T,_)),tc(c)}else a_(c);else if(O=g.s,O==3||O==0&&0<g.X||!(T==1&&QA(c,g)||T==2&&Df(c)))switch(_&&0<_.length&&(g=c.h,g.i=g.i.concat(_)),O){case 1:si(c,5);break;case 4:si(c,10);break;case 3:si(c,6);break;default:si(c,2)}}}function c_(c,g){let _=c.Ta+Math.floor(Math.random()*c.cb);return c.isActive()||(_*=2),_*g}function si(c,g){if(c.j.info("Error code "+g),g==2){var _=f(c.fb,c),T=c.Xa;const O=!T;T=new ri(T||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Gu(T,"https"),Ju(T),O?zA(T.toString(),_):$A(T.toString(),_)}else Lt(2);c.G=0,c.l&&c.l.sa(g),d_(c),s_(c)}t.fb=function(c){c?(this.j.info("Successfully pinged google.com"),Lt(2)):(this.j.info("Failed to ping google.com"),Lt(1))};function d_(c){if(c.G=0,c.ka=[],c.l){const g=zv(c.h);(g.length!=0||c.i.length!=0)&&(w(c.ka,g),w(c.ka,c.i),c.h.i.length=0,v(c.i),c.i.length=0),c.l.ra()}}function h_(c,g,_){var T=_ instanceof ri?fr(_):new ri(_);if(T.g!="")g&&(T.g=g+"."+T.g),Qu(T,T.s);else{var O=a.location;T=O.protocol,g=g?g+"."+O.hostname:O.hostname,O=+O.port;var L=new ri(null);T&&Gu(L,T),g&&(L.g=g),O&&Qu(L,O),_&&(L.l=_),T=L}return _=c.D,g=c.ya,_&&g&&be(T,_,g),be(T,"VER",c.la),Va(c,T),T}function f_(c,g,_){if(g&&!c.J)throw Error("Can't create secondary domain capable XhrIo object.");return g=c.Ca&&!c.pa?new Fe(new Yu({eb:_})):new Fe(c.pa),g.Ha(c.J),g}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function p_(){}t=p_.prototype,t.ua=function(){},t.ta=function(){},t.sa=function(){},t.ra=function(){},t.isActive=function(){return!0},t.Na=function(){};function rc(){}rc.prototype.g=function(c,g){return new on(c,g)};function on(c,g){wt.call(this),this.g=new r_(g),this.l=c,this.h=g&&g.messageUrlParams||null,c=g&&g.messageHeaders||null,g&&g.clientProtocolHeaderRequired&&(c?c["X-Client-Protocol"]="webchannel":c={"X-Client-Protocol":"webchannel"}),this.g.o=c,c=g&&g.initMessageHeaders||null,g&&g.messageContentType&&(c?c["X-WebChannel-Content-Type"]=g.messageContentType:c={"X-WebChannel-Content-Type":g.messageContentType}),g&&g.va&&(c?c["X-WebChannel-Client-Profile"]=g.va:c={"X-WebChannel-Client-Profile":g.va}),this.g.S=c,(c=g&&g.Sb)&&!S(c)&&(this.g.m=c),this.v=g&&g.supportsCrossDomainXhr||!1,this.u=g&&g.sendRawJson||!1,(g=g&&g.httpSessionIdParam)&&!S(g)&&(this.g.D=g,c=this.h,c!==null&&g in c&&(c=this.h,g in c&&delete c[g])),this.j=new to(this)}y(on,wt),on.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},on.prototype.close=function(){Pf(this.g)},on.prototype.o=function(c){var g=this.g;if(typeof c=="string"){var _={};_.__data__=c,c=_}else this.u&&(_={},_.__data__=wf(c),c=_);g.i.push(new PA(g.Ya++,c)),g.G==3&&tc(g)},on.prototype.N=function(){this.g.l=null,delete this.j,Pf(this.g),delete this.g,on.aa.N.call(this)};function m_(c){Ef.call(this),c.__headers__&&(this.headers=c.__headers__,this.statusCode=c.__status__,delete c.__headers__,delete c.__status__);var g=c.__sm__;if(g){e:{for(const _ in g){c=_;break e}c=void 0}(this.i=c)&&(c=this.i,g=g!==null&&c in g?g[c]:void 0),this.data=g}else this.data=c}y(m_,Ef);function g_(){Sf.call(this),this.status=1}y(g_,Sf);function to(c){this.g=c}y(to,p_),to.prototype.ua=function(){Mt(this.g,"a")},to.prototype.ta=function(c){Mt(this.g,new m_(c))},to.prototype.sa=function(c){Mt(this.g,new g_)},to.prototype.ra=function(){Mt(this.g,"b")},rc.prototype.createWebChannel=rc.prototype.g,on.prototype.send=on.prototype.o,on.prototype.open=on.prototype.m,on.prototype.close=on.prototype.close,Bk=function(){return new rc},Uk=function(){return qu()},Fk=ti,Zm={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Hu.NO_ERROR=0,Hu.TIMEOUT=8,Hu.HTTP_ERROR=6,nd=Hu,Pv.COMPLETE="complete",jk=Pv,Iv.EventType=ka,ka.OPEN="a",ka.CLOSE="b",ka.ERROR="c",ka.MESSAGE="d",wt.prototype.listen=wt.prototype.K,nl=Iv,Fe.prototype.listenOnce=Fe.prototype.L,Fe.prototype.getLastError=Fe.prototype.Ka,Fe.prototype.getLastErrorCode=Fe.prototype.Ba,Fe.prototype.getStatus=Fe.prototype.Z,Fe.prototype.getResponseJson=Fe.prototype.Oa,Fe.prototype.getResponseText=Fe.prototype.oa,Fe.prototype.send=Fe.prototype.ea,Fe.prototype.setWithCredentials=Fe.prototype.Ha,Vk=Fe}).apply(typeof Sc<"u"?Sc:typeof self<"u"?self:typeof window<"u"?window:{});const dx="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class It{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}It.UNAUTHENTICATED=new It(null),It.GOOGLE_CREDENTIALS=new It("google-credentials-uid"),It.FIRST_PARTY=new It("first-party-uid"),It.MOCK_USER=new It("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let va="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vi=new Vy("@firebase/firestore");function Wa(){return Vi.logLevel}function G(t,...e){if(Vi.logLevel<=de.DEBUG){const n=e.map(Yy);Vi.debug(`Firestore (${va}): ${t}`,...n)}}function jr(t,...e){if(Vi.logLevel<=de.ERROR){const n=e.map(Yy);Vi.error(`Firestore (${va}): ${t}`,...n)}}function Yo(t,...e){if(Vi.logLevel<=de.WARN){const n=e.map(Yy);Vi.warn(`Firestore (${va}): ${t}`,...n)}}function Yy(t){if(typeof t=="string")return t;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(n){return JSON.stringify(n)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function te(t="Unexpected state"){const e=`FIRESTORE (${va}) INTERNAL ASSERTION FAILED: `+t;throw jr(e),new Error(e)}function ve(t,e){t||te()}function se(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const j={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class H extends ar{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cr{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zk{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class vL{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(It.UNAUTHENTICATED))}shutdown(){}}class _L{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}}class wL{constructor(e){this.t=e,this.currentUser=It.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){ve(this.o===void 0);let r=this.i;const s=l=>this.i!==r?(r=this.i,n(l)):Promise.resolve();let i=new Cr;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Cr,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const l=i;e.enqueueRetryable(async()=>{await l.promise,await s(this.currentUser)})},a=l=>{G("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(G("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Cr)}},0),o()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(r=>this.i!==e?(G("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(ve(typeof r.accessToken=="string"),new zk(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return ve(e===null||typeof e=="string"),new It(e)}}class xL{constructor(e,n,r){this.l=e,this.h=n,this.P=r,this.type="FirstParty",this.user=It.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class EL{constructor(e,n,r){this.l=e,this.h=n,this.P=r}getToken(){return Promise.resolve(new xL(this.l,this.h,this.P))}start(e,n){e.enqueueRetryable(()=>n(It.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class SL{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class bL{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,n){ve(this.o===void 0);const r=i=>{i.error!=null&&G("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.R;return this.R=i.token,G("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?n(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{G("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):G("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?(ve(typeof n.token=="string"),this.R=n.token,new SL(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TL(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $k{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=TL(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<n&&(r+=e.charAt(s[i]%e.length))}return r}}function me(t,e){return t<e?-1:t>e?1:0}function Xo(t,e,n){return t.length===e.length&&t.every((r,s)=>n(r,e[s]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class We{constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new H(j.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new H(j.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<-62135596800)throw new H(j.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new H(j.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return We.fromMillis(Date.now())}static fromDate(e){return We.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*n));return new We(n,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?me(this.nanoseconds,e.nanoseconds):me(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class re{constructor(e){this.timestamp=e}static fromTimestamp(e){return new re(e)}static min(){return new re(new We(0,0))}static max(){return new re(new We(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xl{constructor(e,n,r){n===void 0?n=0:n>e.length&&te(),r===void 0?r=e.length-n:r>e.length-n&&te(),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return Xl.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof Xl?e.forEach(r=>{n.push(r)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let s=0;s<r;s++){const i=e.get(s),o=n.get(s);if(i<o)return-1;if(i>o)return 1}return e.length<n.length?-1:e.length>n.length?1:0}}class ke extends Xl{construct(e,n,r){return new ke(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new H(j.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter(s=>s.length>0))}return new ke(n)}static emptyPath(){return new ke([])}}const kL=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class pt extends Xl{construct(e,n,r){return new pt(e,n,r)}static isValidIdentifier(e){return kL.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),pt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new pt(["__name__"])}static fromServerFormat(e){const n=[];let r="",s=0;const i=()=>{if(r.length===0)throw new H(j.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new H(j.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new H(j.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new H(j.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new pt(n)}static emptyPath(){return new pt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J{constructor(e){this.path=e}static fromPath(e){return new J(ke.fromString(e))}static fromName(e){return new J(ke.fromString(e).popFirst(5))}static empty(){return new J(ke.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ke.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return ke.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new J(new ke(e.slice()))}}function IL(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,s=re.fromTimestamp(r===1e9?new We(n+1,0):new We(n,r));return new Ls(s,J.empty(),e)}function CL(t){return new Ls(t.readTime,t.key,-1)}class Ls{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new Ls(re.min(),J.empty(),-1)}static max(){return new Ls(re.max(),J.empty(),-1)}}function AL(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=J.comparator(t.documentKey,e.documentKey),n!==0?n:me(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NL="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class RL{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Cu(t){if(t.code!==j.FAILED_PRECONDITION||t.message!==NL)throw t;G("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&te(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new U((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(n,i).next(r,s)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{const n=e();return n instanceof U?n:U.resolve(n)}catch(n){return U.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):U.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):U.reject(n)}static resolve(e){return new U((n,r)=>{n(e)})}static reject(e){return new U((n,r)=>{r(e)})}static waitFor(e){return new U((n,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&n()},l=>r(l))}),o=!0,i===s&&n()})}static or(e){let n=U.resolve(!1);for(const r of e)n=n.next(s=>s?U.resolve(s):r());return n}static forEach(e,n){const r=[];return e.forEach((s,i)=>{r.push(n.call(this,s,i))}),this.waitFor(r)}static mapArray(e,n){return new U((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const u=l;n(e[u]).next(d=>{o[u]=d,++a,a===i&&r(o)},d=>s(d))}})}static doWhile(e,n){return new U((r,s)=>{const i=()=>{e()===!0?n().next(()=>{i()},s):r()};i()})}}function PL(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function Au(t){return t.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xy{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.ie(r),this.se=r=>n.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}Xy.oe=-1;function Ph(t){return t==null}function zd(t){return t===0&&1/t==-1/0}function DL(t){return typeof t=="number"&&Number.isInteger(t)&&!zd(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hx(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Gi(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function qk(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ve{constructor(e,n){this.comparator=e,this.root=n||ct.EMPTY}insert(e,n){return new Ve(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,ct.BLACK,null,null))}remove(e){return new Ve(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ct.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return n+r.left.size;s<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,r)=>(e(n,r),!1))}toString(){const e=[];return this.inorderTraversal((n,r)=>(e.push(`${n}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new bc(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new bc(this.root,e,this.comparator,!1)}getReverseIterator(){return new bc(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new bc(this.root,e,this.comparator,!0)}}class bc{constructor(e,n,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=n?r(e.key,n):1,n&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ct{constructor(e,n,r,s,i){this.key=e,this.value=n,this.color=r??ct.RED,this.left=s??ct.EMPTY,this.right=i??ct.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,s,i){return new ct(e??this.key,n??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,n,r),null):i===0?s.copy(null,n,null,null,null):s.copy(null,null,null,null,s.right.insert(e,n,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return ct.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,s=this;if(n(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,n),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),n(e,s.key)===0){if(s.right.isEmpty())return ct.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,n))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,ct.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,ct.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw te();const e=this.left.check();if(e!==this.right.check())throw te();return e+(this.isRed()?0:1)}}ct.EMPTY=null,ct.RED=!0,ct.BLACK=!1;ct.EMPTY=new class{constructor(){this.size=0}get key(){throw te()}get value(){throw te()}get color(){throw te()}get left(){throw te()}get right(){throw te()}copy(e,n,r,s,i){return this}insert(e,n,r){return new ct(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gt{constructor(e){this.comparator=e,this.data=new Ve(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,r)=>(e(n),!1))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;n(s.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new fx(this.data.getIterator())}getIteratorFrom(e){return new fx(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(r=>{n=n.add(r)}),n}isEqual(e){if(!(e instanceof gt)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const s=n.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(n=>{e.push(n)}),e}toString(){const e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){const n=new gt(this.comparator);return n.data=e,n}}class fx{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cn{constructor(e){this.fields=e,e.sort(pt.comparator)}static empty(){return new cn([])}unionWith(e){let n=new gt(pt.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new cn(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return Xo(this.fields,e.fields,(n,r)=>n.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hk extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vt{constructor(e){this.binaryString=e}static fromBase64String(e){const n=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new Hk("Invalid base64 string: "+i):i}}(e);return new vt(n)}static fromUint8Array(e){const n=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new vt(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(n){return btoa(n)}(this.binaryString)}toUint8Array(){return function(n){const r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return me(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}vt.EMPTY_BYTE_STRING=new vt("");const OL=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Vs(t){if(ve(!!t),typeof t=="string"){let e=0;const n=OL.exec(t);if(ve(!!n),n[1]){let s=n[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:$e(t.seconds),nanos:$e(t.nanos)}}function $e(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function ji(t){return typeof t=="string"?vt.fromBase64String(t):vt.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zy(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="server_timestamp"}function e0(t){const e=t.mapValue.fields.__previous_value__;return Zy(e)?e0(e):e}function Zl(t){const e=Vs(t.mapValue.fields.__local_write_time__.timestampValue);return new We(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ML{constructor(e,n,r,s,i,o,a,l,u){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=u}}class eu{constructor(e,n){this.projectId=e,this.database=n||"(default)"}static empty(){return new eu("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof eu&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tc={mapValue:{}};function Fi(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Zy(t)?4:VL(t)?9007199254740991:LL(t)?10:11:te()}function sr(t,e){if(t===e)return!0;const n=Fi(t);if(n!==Fi(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Zl(t).isEqual(Zl(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=Vs(s.timestampValue),a=Vs(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(s,i){return ji(s.bytesValue).isEqual(ji(i.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(s,i){return $e(s.geoPointValue.latitude)===$e(i.geoPointValue.latitude)&&$e(s.geoPointValue.longitude)===$e(i.geoPointValue.longitude)}(t,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return $e(s.integerValue)===$e(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=$e(s.doubleValue),a=$e(i.doubleValue);return o===a?zd(o)===zd(a):isNaN(o)&&isNaN(a)}return!1}(t,e);case 9:return Xo(t.arrayValue.values||[],e.arrayValue.values||[],sr);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},a=i.mapValue.fields||{};if(hx(o)!==hx(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!sr(o[l],a[l])))return!1;return!0}(t,e);default:return te()}}function tu(t,e){return(t.values||[]).find(n=>sr(n,e))!==void 0}function Zo(t,e){if(t===e)return 0;const n=Fi(t),r=Fi(e);if(n!==r)return me(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return me(t.booleanValue,e.booleanValue);case 2:return function(i,o){const a=$e(i.integerValue||i.doubleValue),l=$e(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(t,e);case 3:return px(t.timestampValue,e.timestampValue);case 4:return px(Zl(t),Zl(e));case 5:return me(t.stringValue,e.stringValue);case 6:return function(i,o){const a=ji(i),l=ji(o);return a.compareTo(l)}(t.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),l=o.split("/");for(let u=0;u<a.length&&u<l.length;u++){const d=me(a[u],l[u]);if(d!==0)return d}return me(a.length,l.length)}(t.referenceValue,e.referenceValue);case 8:return function(i,o){const a=me($e(i.latitude),$e(o.latitude));return a!==0?a:me($e(i.longitude),$e(o.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return mx(t.arrayValue,e.arrayValue);case 10:return function(i,o){var a,l,u,d;const h=i.fields||{},f=o.fields||{},m=(a=h.value)===null||a===void 0?void 0:a.arrayValue,y=(l=f.value)===null||l===void 0?void 0:l.arrayValue,v=me(((u=m==null?void 0:m.values)===null||u===void 0?void 0:u.length)||0,((d=y==null?void 0:y.values)===null||d===void 0?void 0:d.length)||0);return v!==0?v:mx(m,y)}(t.mapValue,e.mapValue);case 11:return function(i,o){if(i===Tc.mapValue&&o===Tc.mapValue)return 0;if(i===Tc.mapValue)return 1;if(o===Tc.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),u=o.fields||{},d=Object.keys(u);l.sort(),d.sort();for(let h=0;h<l.length&&h<d.length;++h){const f=me(l[h],d[h]);if(f!==0)return f;const m=Zo(a[l[h]],u[d[h]]);if(m!==0)return m}return me(l.length,d.length)}(t.mapValue,e.mapValue);default:throw te()}}function px(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return me(t,e);const n=Vs(t),r=Vs(e),s=me(n.seconds,r.seconds);return s!==0?s:me(n.nanos,r.nanos)}function mx(t,e){const n=t.values||[],r=e.values||[];for(let s=0;s<n.length&&s<r.length;++s){const i=Zo(n[s],r[s]);if(i)return i}return me(n.length,r.length)}function ea(t){return eg(t)}function eg(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(n){const r=Vs(n);return`time(${r.seconds},${r.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(n){return ji(n).toBase64()}(t.bytesValue):"referenceValue"in t?function(n){return J.fromName(n).toString()}(t.referenceValue):"geoPointValue"in t?function(n){return`geo(${n.latitude},${n.longitude})`}(t.geoPointValue):"arrayValue"in t?function(n){let r="[",s=!0;for(const i of n.values||[])s?s=!1:r+=",",r+=eg(i);return r+"]"}(t.arrayValue):"mapValue"in t?function(n){const r=Object.keys(n.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${eg(n.fields[o])}`;return s+"}"}(t.mapValue):te()}function gx(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function tg(t){return!!t&&"integerValue"in t}function t0(t){return!!t&&"arrayValue"in t}function yx(t){return!!t&&"nullValue"in t}function vx(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function rd(t){return!!t&&"mapValue"in t}function LL(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="__vector__"}function wl(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Gi(t.mapValue.fields,(n,r)=>e.mapValue.fields[n]=wl(r)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=wl(t.arrayValue.values[n]);return e}return Object.assign({},t)}function VL(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qt{constructor(e){this.value=e}static empty(){return new Qt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!rd(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=wl(n)}setAll(e){let n=pt.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!n.isImmediateParentOf(a)){const l=this.getFieldsMap(n);this.applyChanges(l,r,s),r={},s=[],n=a.popLast()}o?r[a.lastSegment()]=wl(o):s.push(a.lastSegment())});const i=this.getFieldsMap(n);this.applyChanges(i,r,s)}delete(e){const n=this.field(e.popLast());rd(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return sr(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=n.mapValue.fields[e.get(r)];rd(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=s),n=s}return n.mapValue.fields}applyChanges(e,n,r){Gi(n,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new Qt(wl(this.value))}}function Wk(t){const e=[];return Gi(t.fields,(n,r)=>{const s=new pt([n]);if(rd(r)){const i=Wk(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new cn(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class At{constructor(e,n,r,s,i,o,a){this.key=e,this.documentType=n,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new At(e,0,re.min(),re.min(),re.min(),Qt.empty(),0)}static newFoundDocument(e,n,r,s){return new At(e,1,n,re.min(),r,s,0)}static newNoDocument(e,n){return new At(e,2,n,re.min(),re.min(),Qt.empty(),0)}static newUnknownDocument(e,n){return new At(e,3,n,re.min(),re.min(),Qt.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(re.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Qt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Qt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=re.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof At&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new At(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $d{constructor(e,n){this.position=e,this.inclusive=n}}function _x(t,e,n){let r=0;for(let s=0;s<t.position.length;s++){const i=e[s],o=t.position[s];if(i.field.isKeyField()?r=J.comparator(J.fromName(o.referenceValue),n.key):r=Zo(o,n.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function wx(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!sr(t.position[n],e.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nu{constructor(e,n="asc"){this.field=e,this.dir=n}}function jL(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kk{}class Qe extends Kk{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new UL(e,n,r):n==="array-contains"?new $L(e,r):n==="in"?new qL(e,r):n==="not-in"?new HL(e,r):n==="array-contains-any"?new WL(e,r):new Qe(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new BL(e,r):new zL(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&this.matchesComparison(Zo(n,this.value)):n!==null&&Fi(this.value)===Fi(n)&&this.matchesComparison(Zo(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return te()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class qn extends Kk{constructor(e,n){super(),this.filters=e,this.op=n,this.ae=null}static create(e,n){return new qn(e,n)}matches(e){return Gk(this)?this.filters.find(n=>!n.matches(e))===void 0:this.filters.find(n=>n.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,n)=>e.concat(n.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Gk(t){return t.op==="and"}function Qk(t){return FL(t)&&Gk(t)}function FL(t){for(const e of t.filters)if(e instanceof qn)return!1;return!0}function ng(t){if(t instanceof Qe)return t.field.canonicalString()+t.op.toString()+ea(t.value);if(Qk(t))return t.filters.map(e=>ng(e)).join(",");{const e=t.filters.map(n=>ng(n)).join(",");return`${t.op}(${e})`}}function Jk(t,e){return t instanceof Qe?function(r,s){return s instanceof Qe&&r.op===s.op&&r.field.isEqual(s.field)&&sr(r.value,s.value)}(t,e):t instanceof qn?function(r,s){return s instanceof qn&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,a)=>i&&Jk(o,s.filters[a]),!0):!1}(t,e):void te()}function Yk(t){return t instanceof Qe?function(n){return`${n.field.canonicalString()} ${n.op} ${ea(n.value)}`}(t):t instanceof qn?function(n){return n.op.toString()+" {"+n.getFilters().map(Yk).join(" ,")+"}"}(t):"Filter"}class UL extends Qe{constructor(e,n,r){super(e,n,r),this.key=J.fromName(r.referenceValue)}matches(e){const n=J.comparator(e.key,this.key);return this.matchesComparison(n)}}class BL extends Qe{constructor(e,n){super(e,"in",n),this.keys=Xk("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}}class zL extends Qe{constructor(e,n){super(e,"not-in",n),this.keys=Xk("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}}function Xk(t,e){var n;return(((n=e.arrayValue)===null||n===void 0?void 0:n.values)||[]).map(r=>J.fromName(r.referenceValue))}class $L extends Qe{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return t0(n)&&tu(n.arrayValue,this.value)}}class qL extends Qe{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&tu(this.value.arrayValue,n)}}class HL extends Qe{constructor(e,n){super(e,"not-in",n)}matches(e){if(tu(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&!tu(this.value.arrayValue,n)}}class WL extends Qe{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!t0(n)||!n.arrayValue.values)&&n.arrayValue.values.some(r=>tu(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KL{constructor(e,n=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.ue=null}}function xx(t,e=null,n=[],r=[],s=null,i=null,o=null){return new KL(t,e,n,r,s,i,o)}function n0(t){const e=se(t);if(e.ue===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(r=>ng(r)).join(","),n+="|ob:",n+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),Ph(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(r=>ea(r)).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(r=>ea(r)).join(",")),e.ue=n}return e.ue}function r0(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!jL(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!Jk(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!wx(t.startAt,e.startAt)&&wx(t.endAt,e.endAt)}function rg(t){return J.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _a{constructor(e,n=null,r=[],s=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function GL(t,e,n,r,s,i,o,a){return new _a(t,e,n,r,s,i,o,a)}function Dh(t){return new _a(t)}function Ex(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function Zk(t){return t.collectionGroup!==null}function xl(t){const e=se(t);if(e.ce===null){e.ce=[];const n=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),n.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new gt(pt.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(u=>{u.isInequality()&&(a=a.add(u.field))})}),a})(e).forEach(i=>{n.has(i.canonicalString())||i.isKeyField()||e.ce.push(new nu(i,r))}),n.has(pt.keyField().canonicalString())||e.ce.push(new nu(pt.keyField(),r))}return e.ce}function nr(t){const e=se(t);return e.le||(e.le=QL(e,xl(t))),e.le}function QL(t,e){if(t.limitType==="F")return xx(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new nu(s.field,i)});const n=t.endAt?new $d(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new $d(t.startAt.position,t.startAt.inclusive):null;return xx(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function sg(t,e){const n=t.filters.concat([e]);return new _a(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function ig(t,e,n){return new _a(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Oh(t,e){return r0(nr(t),nr(e))&&t.limitType===e.limitType}function eI(t){return`${n0(nr(t))}|lt:${t.limitType}`}function lo(t){return`Query(target=${function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map(s=>Yk(s)).join(", ")}]`),Ph(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map(s=>ea(s)).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map(s=>ea(s)).join(",")),`Target(${r})`}(nr(t))}; limitType=${t.limitType})`}function Mh(t,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):J.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(t,e)&&function(r,s){for(const i of xl(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(t,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(t,e)&&function(r,s){return!(r.startAt&&!function(o,a,l){const u=_x(o,a,l);return o.inclusive?u<=0:u<0}(r.startAt,xl(r),s)||r.endAt&&!function(o,a,l){const u=_x(o,a,l);return o.inclusive?u>=0:u>0}(r.endAt,xl(r),s))}(t,e)}function JL(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function tI(t){return(e,n)=>{let r=!1;for(const s of xl(t)){const i=YL(s,e,n);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function YL(t,e,n){const r=t.field.isKeyField()?J.comparator(e.key,n.key):function(i,o,a){const l=o.data.field(i),u=a.data.field(i);return l!==null&&u!==null?Zo(l,u):te()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return te()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wa{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,n]);s.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[n]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Gi(this.inner,(n,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return qk(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XL=new Ve(J.comparator);function Fr(){return XL}const nI=new Ve(J.comparator);function rl(...t){let e=nI;for(const n of t)e=e.insert(n.key,n);return e}function rI(t){let e=nI;return t.forEach((n,r)=>e=e.insert(n,r.overlayedDocument)),e}function mi(){return El()}function sI(){return El()}function El(){return new wa(t=>t.toString(),(t,e)=>t.isEqual(e))}const ZL=new Ve(J.comparator),eV=new gt(J.comparator);function ce(...t){let e=eV;for(const n of t)e=e.add(n);return e}const tV=new gt(me);function nV(){return tV}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s0(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:zd(e)?"-0":e}}function iI(t){return{integerValue:""+t}}function rV(t,e){return DL(e)?iI(e):s0(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lh{constructor(){this._=void 0}}function sV(t,e,n){return t instanceof ru?function(s,i){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&Zy(i)&&(i=e0(i)),i&&(o.fields.__previous_value__=i),{mapValue:o}}(n,e):t instanceof ta?aI(t,e):t instanceof na?lI(t,e):function(s,i){const o=oI(s,i),a=Sx(o)+Sx(s.Pe);return tg(o)&&tg(s.Pe)?iI(a):s0(s.serializer,a)}(t,e)}function iV(t,e,n){return t instanceof ta?aI(t,e):t instanceof na?lI(t,e):n}function oI(t,e){return t instanceof qd?function(r){return tg(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class ru extends Lh{}class ta extends Lh{constructor(e){super(),this.elements=e}}function aI(t,e){const n=uI(e);for(const r of t.elements)n.some(s=>sr(s,r))||n.push(r);return{arrayValue:{values:n}}}class na extends Lh{constructor(e){super(),this.elements=e}}function lI(t,e){let n=uI(e);for(const r of t.elements)n=n.filter(s=>!sr(s,r));return{arrayValue:{values:n}}}class qd extends Lh{constructor(e,n){super(),this.serializer=e,this.Pe=n}}function Sx(t){return $e(t.integerValue||t.doubleValue)}function uI(t){return t0(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i0{constructor(e,n){this.field=e,this.transform=n}}function oV(t,e){return t.field.isEqual(e.field)&&function(r,s){return r instanceof ta&&s instanceof ta||r instanceof na&&s instanceof na?Xo(r.elements,s.elements,sr):r instanceof qd&&s instanceof qd?sr(r.Pe,s.Pe):r instanceof ru&&s instanceof ru}(t.transform,e.transform)}class aV{constructor(e,n){this.version=e,this.transformResults=n}}class Tn{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new Tn}static exists(e){return new Tn(void 0,e)}static updateTime(e){return new Tn(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function sd(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class Vh{}function cI(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new o0(t.key,Tn.none()):new Nu(t.key,t.data,Tn.none());{const n=t.data,r=Qt.empty();let s=new gt(pt.comparator);for(let i of e.fields)if(!s.has(i)){let o=n.field(i);o===null&&i.length>1&&(i=i.popLast(),o=n.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new Js(t.key,r,new cn(s.toArray()),Tn.none())}}function lV(t,e,n){t instanceof Nu?function(s,i,o){const a=s.value.clone(),l=Tx(s.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(t,e,n):t instanceof Js?function(s,i,o){if(!sd(s.precondition,i))return void i.convertToUnknownDocument(o.version);const a=Tx(s.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(dI(s)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(t,e,n):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,n)}function Sl(t,e,n,r){return t instanceof Nu?function(i,o,a,l){if(!sd(i.precondition,o))return a;const u=i.value.clone(),d=kx(i.fieldTransforms,l,o);return u.setAll(d),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null}(t,e,n,r):t instanceof Js?function(i,o,a,l){if(!sd(i.precondition,o))return a;const u=kx(i.fieldTransforms,l,o),d=o.data;return d.setAll(dI(i)),d.setAll(u),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(h=>h.field))}(t,e,n,r):function(i,o,a){return sd(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(t,e,n)}function uV(t,e){let n=null;for(const r of t.fieldTransforms){const s=e.data.field(r.field),i=oI(r.transform,s||null);i!=null&&(n===null&&(n=Qt.empty()),n.set(r.field,i))}return n||null}function bx(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Xo(r,s,(i,o)=>oV(i,o))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Nu extends Vh{constructor(e,n,r,s=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Js extends Vh{constructor(e,n,r,s,i=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function dI(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}}),e}function Tx(t,e,n){const r=new Map;ve(t.length===n.length);for(let s=0;s<n.length;s++){const i=t[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,iV(o,a,n[s]))}return r}function kx(t,e,n){const r=new Map;for(const s of t){const i=s.transform,o=n.data.field(s.field);r.set(s.field,sV(i,o,e))}return r}class o0 extends Vh{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class cV extends Vh{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dV{constructor(e,n,r,s){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&lV(i,e,r[s])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=Sl(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=Sl(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=sI();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=n.has(s.key)?null:a;const l=cI(o,a);l!==null&&r.set(s.key,l),o.isValidDocument()||o.convertToNoDocument(re.min())}),r}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),ce())}isEqual(e){return this.batchId===e.batchId&&Xo(this.mutations,e.mutations,(n,r)=>bx(n,r))&&Xo(this.baseMutations,e.baseMutations,(n,r)=>bx(n,r))}}class a0{constructor(e,n,r,s){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=s}static from(e,n,r){ve(e.mutations.length===r.length);let s=function(){return ZL}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new a0(e,n,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hV{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fV{constructor(e,n){this.count=e,this.unchangedNames=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ke,he;function pV(t){switch(t){default:return te();case j.CANCELLED:case j.UNKNOWN:case j.DEADLINE_EXCEEDED:case j.RESOURCE_EXHAUSTED:case j.INTERNAL:case j.UNAVAILABLE:case j.UNAUTHENTICATED:return!1;case j.INVALID_ARGUMENT:case j.NOT_FOUND:case j.ALREADY_EXISTS:case j.PERMISSION_DENIED:case j.FAILED_PRECONDITION:case j.ABORTED:case j.OUT_OF_RANGE:case j.UNIMPLEMENTED:case j.DATA_LOSS:return!0}}function hI(t){if(t===void 0)return jr("GRPC error has no .code"),j.UNKNOWN;switch(t){case Ke.OK:return j.OK;case Ke.CANCELLED:return j.CANCELLED;case Ke.UNKNOWN:return j.UNKNOWN;case Ke.DEADLINE_EXCEEDED:return j.DEADLINE_EXCEEDED;case Ke.RESOURCE_EXHAUSTED:return j.RESOURCE_EXHAUSTED;case Ke.INTERNAL:return j.INTERNAL;case Ke.UNAVAILABLE:return j.UNAVAILABLE;case Ke.UNAUTHENTICATED:return j.UNAUTHENTICATED;case Ke.INVALID_ARGUMENT:return j.INVALID_ARGUMENT;case Ke.NOT_FOUND:return j.NOT_FOUND;case Ke.ALREADY_EXISTS:return j.ALREADY_EXISTS;case Ke.PERMISSION_DENIED:return j.PERMISSION_DENIED;case Ke.FAILED_PRECONDITION:return j.FAILED_PRECONDITION;case Ke.ABORTED:return j.ABORTED;case Ke.OUT_OF_RANGE:return j.OUT_OF_RANGE;case Ke.UNIMPLEMENTED:return j.UNIMPLEMENTED;case Ke.DATA_LOSS:return j.DATA_LOSS;default:return te()}}(he=Ke||(Ke={}))[he.OK=0]="OK",he[he.CANCELLED=1]="CANCELLED",he[he.UNKNOWN=2]="UNKNOWN",he[he.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",he[he.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",he[he.NOT_FOUND=5]="NOT_FOUND",he[he.ALREADY_EXISTS=6]="ALREADY_EXISTS",he[he.PERMISSION_DENIED=7]="PERMISSION_DENIED",he[he.UNAUTHENTICATED=16]="UNAUTHENTICATED",he[he.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",he[he.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",he[he.ABORTED=10]="ABORTED",he[he.OUT_OF_RANGE=11]="OUT_OF_RANGE",he[he.UNIMPLEMENTED=12]="UNIMPLEMENTED",he[he.INTERNAL=13]="INTERNAL",he[he.UNAVAILABLE=14]="UNAVAILABLE",he[he.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mV(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gV=new xi([4294967295,4294967295],0);function Ix(t){const e=mV().encode(t),n=new Lk;return n.update(e),new Uint8Array(n.digest())}function Cx(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new xi([n,r],0),new xi([s,i],0)]}class l0{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new sl(`Invalid padding: ${n}`);if(r<0)throw new sl(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new sl(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new sl(`Invalid padding when bitmap length is 0: ${n}`);this.Ie=8*e.length-n,this.Te=xi.fromNumber(this.Ie)}Ee(e,n,r){let s=e.add(n.multiply(xi.fromNumber(r)));return s.compare(gV)===1&&(s=new xi([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const n=Ix(e),[r,s]=Cx(n);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);if(!this.de(o))return!1}return!0}static create(e,n,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new l0(i,s,n);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Ie===0)return;const n=Ix(e),[r,s]=Cx(n);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);this.Ae(o)}}Ae(e){const n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}}class sl extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jh{constructor(e,n,r,s,i){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,n,r){const s=new Map;return s.set(e,Ru.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new jh(re.min(),s,new Ve(me),Fr(),ce())}}class Ru{constructor(e,n,r,s,i){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new Ru(r,n,ce(),ce(),ce())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class id{constructor(e,n,r,s){this.Re=e,this.removedTargetIds=n,this.key=r,this.Ve=s}}class fI{constructor(e,n){this.targetId=e,this.me=n}}class pI{constructor(e,n,r=vt.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=s}}class Ax{constructor(){this.fe=0,this.ge=Rx(),this.pe=vt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=ce(),n=ce(),r=ce();return this.ge.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:n=n.add(s);break;case 1:r=r.add(s);break;default:te()}}),new Ru(this.pe,this.ye,e,n,r)}Ce(){this.we=!1,this.ge=Rx()}Fe(e,n){this.we=!0,this.ge=this.ge.insert(e,n)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,ve(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class yV{constructor(e){this.Le=e,this.Be=new Map,this.ke=Fr(),this.qe=Nx(),this.Qe=new Ve(me)}Ke(e){for(const n of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(n,e.Ve):this.Ue(n,e.key,e.Ve);for(const n of e.removedTargetIds)this.Ue(n,e.key,e.Ve)}We(e){this.forEachTarget(e,n=>{const r=this.Ge(n);switch(e.state){case 0:this.ze(n)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(n);break;case 3:this.ze(n)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(n)&&(this.je(n),r.De(e.resumeToken));break;default:te()}})}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.Be.forEach((r,s)=>{this.ze(s)&&n(s)})}He(e){const n=e.targetId,r=e.me.count,s=this.Je(n);if(s){const i=s.target;if(rg(i))if(r===0){const o=new J(i.path);this.Ue(n,o,At.newNoDocument(o,re.min()))}else ve(r===1);else{const o=this.Ye(n);if(o!==r){const a=this.Ze(e),l=a?this.Xe(a,e,o):1;if(l!==0){this.je(n);const u=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(n,u)}}}}}Ze(e){const n=e.me.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=n;let o,a;try{o=ji(r).toUint8Array()}catch(l){if(l instanceof Hk)return Yo("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new l0(o,s,i)}catch(l){return Yo(l instanceof sl?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.Ie===0?null:a}Xe(e,n,r){return n.me.count===r-this.nt(e,n.targetId)?0:2}nt(e,n){const r=this.Le.getRemoteKeysForTarget(n);let s=0;return r.forEach(i=>{const o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.Ue(n,i,null),s++)}),s}rt(e){const n=new Map;this.Be.forEach((i,o)=>{const a=this.Je(o);if(a){if(i.current&&rg(a.target)){const l=new J(a.target.path);this.ke.get(l)!==null||this.it(o,l)||this.Ue(o,l,At.newNoDocument(l,e))}i.be&&(n.set(o,i.ve()),i.Ce())}});let r=ce();this.qe.forEach((i,o)=>{let a=!0;o.forEachWhile(l=>{const u=this.Je(l);return!u||u.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(i))}),this.ke.forEach((i,o)=>o.setReadTime(e));const s=new jh(e,n,this.Qe,this.ke,r);return this.ke=Fr(),this.qe=Nx(),this.Qe=new Ve(me),s}$e(e,n){if(!this.ze(e))return;const r=this.it(e,n.key)?2:0;this.Ge(e).Fe(n.key,r),this.ke=this.ke.insert(n.key,n),this.qe=this.qe.insert(n.key,this.st(n.key).add(e))}Ue(e,n,r){if(!this.ze(e))return;const s=this.Ge(e);this.it(e,n)?s.Fe(n,1):s.Me(n),this.qe=this.qe.insert(n,this.st(n).delete(e)),r&&(this.ke=this.ke.insert(n,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const n=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let n=this.Be.get(e);return n||(n=new Ax,this.Be.set(e,n)),n}st(e){let n=this.qe.get(e);return n||(n=new gt(me),this.qe=this.qe.insert(e,n)),n}ze(e){const n=this.Je(e)!==null;return n||G("WatchChangeAggregator","Detected inactive target",e),n}Je(e){const n=this.Be.get(e);return n&&n.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Ax),this.Le.getRemoteKeysForTarget(e).forEach(n=>{this.Ue(e,n,null)})}it(e,n){return this.Le.getRemoteKeysForTarget(e).has(n)}}function Nx(){return new Ve(J.comparator)}function Rx(){return new Ve(J.comparator)}const vV={asc:"ASCENDING",desc:"DESCENDING"},_V={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},wV={and:"AND",or:"OR"};class xV{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function og(t,e){return t.useProto3Json||Ph(e)?e:{value:e}}function Hd(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function mI(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function EV(t,e){return Hd(t,e.toTimestamp())}function rr(t){return ve(!!t),re.fromTimestamp(function(n){const r=Vs(n);return new We(r.seconds,r.nanos)}(t))}function u0(t,e){return ag(t,e).canonicalString()}function ag(t,e){const n=function(s){return new ke(["projects",s.projectId,"databases",s.database])}(t).child("documents");return e===void 0?n:n.child(e)}function gI(t){const e=ke.fromString(t);return ve(xI(e)),e}function lg(t,e){return u0(t.databaseId,e.path)}function gp(t,e){const n=gI(e);if(n.get(1)!==t.databaseId.projectId)throw new H(j.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new H(j.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new J(vI(n))}function yI(t,e){return u0(t.databaseId,e)}function SV(t){const e=gI(t);return e.length===4?ke.emptyPath():vI(e)}function ug(t){return new ke(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function vI(t){return ve(t.length>4&&t.get(4)==="documents"),t.popFirst(5)}function Px(t,e,n){return{name:lg(t,e),fields:n.value.mapValue.fields}}function bV(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:te()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(u,d){return u.useProto3Json?(ve(d===void 0||typeof d=="string"),vt.fromBase64String(d||"")):(ve(d===void 0||d instanceof Buffer||d instanceof Uint8Array),vt.fromUint8Array(d||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(u){const d=u.code===void 0?j.UNKNOWN:hI(u.code);return new H(d,u.message||"")}(o);n=new pI(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=gp(t,r.document.name),i=rr(r.document.updateTime),o=r.document.createTime?rr(r.document.createTime):re.min(),a=new Qt({mapValue:{fields:r.document.fields}}),l=At.newFoundDocument(s,i,o,a),u=r.targetIds||[],d=r.removedTargetIds||[];n=new id(u,d,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=gp(t,r.document),i=r.readTime?rr(r.readTime):re.min(),o=At.newNoDocument(s,i),a=r.removedTargetIds||[];n=new id([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=gp(t,r.document),i=r.removedTargetIds||[];n=new id([],i,s,null)}else{if(!("filter"in e))return te();{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new fV(s,i),a=r.targetId;n=new fI(a,o)}}return n}function TV(t,e){let n;if(e instanceof Nu)n={update:Px(t,e.key,e.value)};else if(e instanceof o0)n={delete:lg(t,e.key)};else if(e instanceof Js)n={update:Px(t,e.key,e.data),updateMask:OV(e.fieldMask)};else{if(!(e instanceof cV))return te();n={verify:lg(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const a=o.transform;if(a instanceof ru)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof ta)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof na)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof qd)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw te()}(0,r))),e.precondition.isNone||(n.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:EV(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:te()}(t,e.precondition)),n}function kV(t,e){return t&&t.length>0?(ve(e!==void 0),t.map(n=>function(s,i){let o=s.updateTime?rr(s.updateTime):rr(i);return o.isEqual(re.min())&&(o=rr(i)),new aV(o,s.transformResults||[])}(n,e))):[]}function IV(t,e){return{documents:[yI(t,e.path)]}}function CV(t,e){const n={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=yI(t,s);const i=function(u){if(u.length!==0)return wI(qn.create(u,"and"))}(e.filters);i&&(n.structuredQuery.where=i);const o=function(u){if(u.length!==0)return u.map(d=>function(f){return{field:uo(f.field),direction:RV(f.dir)}}(d))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);const a=og(t,e.limit);return a!==null&&(n.structuredQuery.limit=a),e.startAt&&(n.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),{_t:n,parent:s}}function AV(t){let e=SV(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){ve(r===1);const d=n.from[0];d.allDescendants?s=d.collectionId:e=e.child(d.collectionId)}let i=[];n.where&&(i=function(h){const f=_I(h);return f instanceof qn&&Qk(f)?f.getFilters():[f]}(n.where));let o=[];n.orderBy&&(o=function(h){return h.map(f=>function(y){return new nu(co(y.field),function(w){switch(w){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(y.direction))}(f))}(n.orderBy));let a=null;n.limit&&(a=function(h){let f;return f=typeof h=="object"?h.value:h,Ph(f)?null:f}(n.limit));let l=null;n.startAt&&(l=function(h){const f=!!h.before,m=h.values||[];return new $d(m,f)}(n.startAt));let u=null;return n.endAt&&(u=function(h){const f=!h.before,m=h.values||[];return new $d(m,f)}(n.endAt)),GL(e,s,o,i,a,"F",l,u)}function NV(t,e){const n=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return te()}}(e.purpose);return n==null?null:{"goog-listen-tags":n}}function _I(t){return t.unaryFilter!==void 0?function(n){switch(n.unaryFilter.op){case"IS_NAN":const r=co(n.unaryFilter.field);return Qe.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=co(n.unaryFilter.field);return Qe.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=co(n.unaryFilter.field);return Qe.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=co(n.unaryFilter.field);return Qe.create(o,"!=",{nullValue:"NULL_VALUE"});default:return te()}}(t):t.fieldFilter!==void 0?function(n){return Qe.create(co(n.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return te()}}(n.fieldFilter.op),n.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(n){return qn.create(n.compositeFilter.filters.map(r=>_I(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return te()}}(n.compositeFilter.op))}(t):te()}function RV(t){return vV[t]}function PV(t){return _V[t]}function DV(t){return wV[t]}function uo(t){return{fieldPath:t.canonicalString()}}function co(t){return pt.fromServerFormat(t.fieldPath)}function wI(t){return t instanceof Qe?function(n){if(n.op==="=="){if(vx(n.value))return{unaryFilter:{field:uo(n.field),op:"IS_NAN"}};if(yx(n.value))return{unaryFilter:{field:uo(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(vx(n.value))return{unaryFilter:{field:uo(n.field),op:"IS_NOT_NAN"}};if(yx(n.value))return{unaryFilter:{field:uo(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:uo(n.field),op:PV(n.op),value:n.value}}}(t):t instanceof qn?function(n){const r=n.getFilters().map(s=>wI(s));return r.length===1?r[0]:{compositeFilter:{op:DV(n.op),filters:r}}}(t):te()}function OV(t){const e=[];return t.fields.forEach(n=>e.push(n.canonicalString())),{fieldPaths:e}}function xI(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hs{constructor(e,n,r,s,i=re.min(),o=re.min(),a=vt.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new hs(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new hs(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new hs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new hs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MV{constructor(e){this.ct=e}}function LV(t){const e=AV({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?ig(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VV{constructor(){this.un=new jV}addToCollectionParentIndex(e,n){return this.un.add(n),U.resolve()}getCollectionParents(e,n){return U.resolve(this.un.getEntries(n))}addFieldIndex(e,n){return U.resolve()}deleteFieldIndex(e,n){return U.resolve()}deleteAllFieldIndexes(e){return U.resolve()}createTargetIndexes(e,n){return U.resolve()}getDocumentsMatchingTarget(e,n){return U.resolve(null)}getIndexType(e,n){return U.resolve(0)}getFieldIndexes(e,n){return U.resolve([])}getNextCollectionGroupToUpdate(e){return U.resolve(null)}getMinOffset(e,n){return U.resolve(Ls.min())}getMinOffsetFromCollectionGroup(e,n){return U.resolve(Ls.min())}updateCollectionGroup(e,n,r){return U.resolve()}updateIndexEntries(e,n){return U.resolve()}}class jV{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),s=this.index[n]||new gt(ke.comparator),i=!s.has(r);return this.index[n]=s.add(r),i}has(e){const n=e.lastSegment(),r=e.popLast(),s=this.index[n];return s&&s.has(r)}getEntries(e){return(this.index[e]||new gt(ke.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ra{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new ra(0)}static kn(){return new ra(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FV{constructor(){this.changes=new wa(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,At.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?U.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UV{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BV{constructor(e,n,r,s){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,n))).next(s=>(r!==null&&Sl(r.mutation,s,cn.empty(),We.now()),s))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.getLocalViewOfDocuments(e,r,ce()).next(()=>r))}getLocalViewOfDocuments(e,n,r=ce()){const s=mi();return this.populateOverlays(e,s,n).next(()=>this.computeViews(e,n,s,r).next(i=>{let o=rl();return i.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,n){const r=mi();return this.populateOverlays(e,r,n).next(()=>this.computeViews(e,n,r,ce()))}populateOverlays(e,n,r){const s=[];return r.forEach(i=>{n.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{n.set(o,a)})})}computeViews(e,n,r,s){let i=Fr();const o=El(),a=function(){return El()}();return n.forEach((l,u)=>{const d=r.get(u.key);s.has(u.key)&&(d===void 0||d.mutation instanceof Js)?i=i.insert(u.key,u):d!==void 0?(o.set(u.key,d.mutation.getFieldMask()),Sl(d.mutation,u,d.mutation.getFieldMask(),We.now())):o.set(u.key,cn.empty())}),this.recalculateAndSaveOverlays(e,i).next(l=>(l.forEach((u,d)=>o.set(u,d)),n.forEach((u,d)=>{var h;return a.set(u,new UV(d,(h=o.get(u))!==null&&h!==void 0?h:null))}),a))}recalculateAndSaveOverlays(e,n){const r=El();let s=new Ve((o,a)=>o-a),i=ce();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next(o=>{for(const a of o)a.keys().forEach(l=>{const u=n.get(l);if(u===null)return;let d=r.get(l)||cn.empty();d=a.applyToLocalView(u,d),r.set(l,d);const h=(s.get(a.batchId)||ce()).add(l);s=s.insert(a.batchId,h)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),u=l.key,d=l.value,h=sI();d.forEach(f=>{if(!i.has(f)){const m=cI(n.get(f),r.get(f));m!==null&&h.set(f,m),i=i.add(f)}}),o.push(this.documentOverlayCache.saveOverlays(e,u,h))}return U.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,n,r,s){return function(o){return J.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):Zk(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,s):this.getDocumentsMatchingCollectionQuery(e,n,r,s)}getNextDocuments(e,n,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,s-i.size):U.resolve(mi());let a=-1,l=i;return o.next(u=>U.forEach(u,(d,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),i.get(d)?U.resolve():this.remoteDocumentCache.getEntry(e,d).next(f=>{l=l.insert(d,f)}))).next(()=>this.populateOverlays(e,u,i)).next(()=>this.computeViews(e,l,u,ce())).next(d=>({batchId:a,changes:rI(d)})))})}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new J(n)).next(r=>{let s=rl();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,n,r,s){const i=n.collectionGroup;let o=rl();return this.indexManager.getCollectionParents(e,i).next(a=>U.forEach(a,l=>{const u=function(h,f){return new _a(f,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(n,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,u,r,s).next(d=>{d.forEach((h,f)=>{o=o.insert(h,f)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,n,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,i,s))).next(o=>{i.forEach((l,u)=>{const d=u.getKey();o.get(d)===null&&(o=o.insert(d,At.newInvalidDocument(d)))});let a=rl();return o.forEach((l,u)=>{const d=i.get(l);d!==void 0&&Sl(d.mutation,u,cn.empty(),We.now()),Mh(n,u)&&(a=a.insert(l,u))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zV{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,n){return U.resolve(this.hr.get(n))}saveBundleMetadata(e,n){return this.hr.set(n.id,function(s){return{id:s.id,version:s.version,createTime:rr(s.createTime)}}(n)),U.resolve()}getNamedQuery(e,n){return U.resolve(this.Pr.get(n))}saveNamedQuery(e,n){return this.Pr.set(n.name,function(s){return{name:s.name,query:LV(s.bundledQuery),readTime:rr(s.readTime)}}(n)),U.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $V{constructor(){this.overlays=new Ve(J.comparator),this.Ir=new Map}getOverlay(e,n){return U.resolve(this.overlays.get(n))}getOverlays(e,n){const r=mi();return U.forEach(n,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,n,r){return r.forEach((s,i)=>{this.ht(e,n,i)}),U.resolve()}removeOverlaysForBatchId(e,n,r){const s=this.Ir.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(r)),U.resolve()}getOverlaysForCollection(e,n,r){const s=mi(),i=n.length+1,o=new J(n.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,u=l.getKey();if(!n.isPrefixOf(u.path))break;u.path.length===i&&l.largestBatchId>r&&s.set(l.getKey(),l)}return U.resolve(s)}getOverlaysForCollectionGroup(e,n,r,s){let i=new Ve((u,d)=>u-d);const o=this.overlays.getIterator();for(;o.hasNext();){const u=o.getNext().value;if(u.getKey().getCollectionGroup()===n&&u.largestBatchId>r){let d=i.get(u.largestBatchId);d===null&&(d=mi(),i=i.insert(u.largestBatchId,d)),d.set(u.getKey(),u)}}const a=mi(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((u,d)=>a.set(u,d)),!(a.size()>=s)););return U.resolve(a)}ht(e,n,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.Ir.get(s.largestBatchId).delete(r.key);this.Ir.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new hV(n,r));let i=this.Ir.get(n);i===void 0&&(i=ce(),this.Ir.set(n,i)),this.Ir.set(n,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qV{constructor(){this.sessionToken=vt.EMPTY_BYTE_STRING}getSessionToken(e){return U.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,U.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c0{constructor(){this.Tr=new gt(et.Er),this.dr=new gt(et.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,n){const r=new et(e,n);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,n){e.forEach(r=>this.addReference(r,n))}removeReference(e,n){this.Vr(new et(e,n))}mr(e,n){e.forEach(r=>this.removeReference(r,n))}gr(e){const n=new J(new ke([])),r=new et(n,e),s=new et(n,e+1),i=[];return this.dr.forEachInRange([r,s],o=>{this.Vr(o),i.push(o.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const n=new J(new ke([])),r=new et(n,e),s=new et(n,e+1);let i=ce();return this.dr.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const n=new et(e,0),r=this.Tr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class et{constructor(e,n){this.key=e,this.wr=n}static Er(e,n){return J.comparator(e.key,n.key)||me(e.wr,n.wr)}static Ar(e,n){return me(e.wr,n.wr)||J.comparator(e.key,n.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HV{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.Sr=1,this.br=new gt(et.Er)}checkEmpty(e){return U.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,s){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new dV(i,n,r,s);this.mutationQueue.push(o);for(const a of s)this.br=this.br.add(new et(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return U.resolve(o)}lookupMutationBatch(e,n){return U.resolve(this.Dr(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,s=this.vr(r),i=s<0?0:s;return U.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return U.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return U.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new et(n,0),s=new et(n,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([r,s],o=>{const a=this.Dr(o.wr);i.push(a)}),U.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new gt(me);return n.forEach(s=>{const i=new et(s,0),o=new et(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,o],a=>{r=r.add(a.wr)})}),U.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,s=r.length+1;let i=r;J.isDocumentKey(i)||(i=i.child(""));const o=new et(new J(i),0);let a=new gt(me);return this.br.forEachWhile(l=>{const u=l.key.path;return!!r.isPrefixOf(u)&&(u.length===s&&(a=a.add(l.wr)),!0)},o),U.resolve(this.Cr(a))}Cr(e){const n=[];return e.forEach(r=>{const s=this.Dr(r);s!==null&&n.push(s)}),n}removeMutationBatch(e,n){ve(this.Fr(n.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return U.forEach(n.mutations,s=>{const i=new et(s.key,n.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,n){const r=new et(n,0),s=this.br.firstAfterOrEqual(r);return U.resolve(n.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,U.resolve()}Fr(e,n){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const n=this.vr(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WV{constructor(e){this.Mr=e,this.docs=function(){return new Ve(J.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,s=this.docs.get(r),i=s?s.size:0,o=this.Mr(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return U.resolve(r?r.document.mutableCopy():At.newInvalidDocument(n))}getEntries(e,n){let r=Fr();return n.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():At.newInvalidDocument(s))}),U.resolve(r)}getDocumentsMatchingQuery(e,n,r,s){let i=Fr();const o=n.path,a=new J(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:u,value:{document:d}}=l.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||AL(CL(d),r)<=0||(s.has(d.key)||Mh(n,d))&&(i=i.insert(d.key,d.mutableCopy()))}return U.resolve(i)}getAllFromCollectionGroup(e,n,r,s){te()}Or(e,n){return U.forEach(this.docs,r=>n(r))}newChangeBuffer(e){return new KV(this)}getSize(e){return U.resolve(this.size)}}class KV extends FV{constructor(e){super(),this.cr=e}applyChanges(e){const n=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?n.push(this.cr.addEntry(e,s)):this.cr.removeEntry(r)}),U.waitFor(n)}getFromCache(e,n){return this.cr.getEntry(e,n)}getAllFromCache(e,n){return this.cr.getEntries(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GV{constructor(e){this.persistence=e,this.Nr=new wa(n=>n0(n),r0),this.lastRemoteSnapshotVersion=re.min(),this.highestTargetId=0,this.Lr=0,this.Br=new c0,this.targetCount=0,this.kr=ra.Bn()}forEachTarget(e,n){return this.Nr.forEach((r,s)=>n(s)),U.resolve()}getLastRemoteSnapshotVersion(e){return U.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return U.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),U.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.Lr&&(this.Lr=n),U.resolve()}Kn(e){this.Nr.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.kr=new ra(n),this.highestTargetId=n),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,n){return this.Kn(n),this.targetCount+=1,U.resolve()}updateTargetData(e,n){return this.Kn(n),U.resolve()}removeTargetData(e,n){return this.Nr.delete(n.target),this.Br.gr(n.targetId),this.targetCount-=1,U.resolve()}removeTargets(e,n,r){let s=0;const i=[];return this.Nr.forEach((o,a)=>{a.sequenceNumber<=n&&r.get(a.targetId)===null&&(this.Nr.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),U.waitFor(i).next(()=>s)}getTargetCount(e){return U.resolve(this.targetCount)}getTargetData(e,n){const r=this.Nr.get(n)||null;return U.resolve(r)}addMatchingKeys(e,n,r){return this.Br.Rr(n,r),U.resolve()}removeMatchingKeys(e,n,r){this.Br.mr(n,r);const s=this.persistence.referenceDelegate,i=[];return s&&n.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),U.waitFor(i)}removeMatchingKeysForTargetId(e,n){return this.Br.gr(n),U.resolve()}getMatchingKeysForTargetId(e,n){const r=this.Br.yr(n);return U.resolve(r)}containsKey(e,n){return U.resolve(this.Br.containsKey(n))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QV{constructor(e,n){this.qr={},this.overlays={},this.Qr=new Xy(0),this.Kr=!1,this.Kr=!0,this.$r=new qV,this.referenceDelegate=e(this),this.Ur=new GV(this),this.indexManager=new VV,this.remoteDocumentCache=function(s){return new WV(s)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new MV(n),this.Gr=new zV(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new $V,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.qr[e.toKey()];return r||(r=new HV(n,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,n,r){G("MemoryPersistence","Starting transaction:",e);const s=new JV(this.Qr.next());return this.referenceDelegate.zr(),r(s).next(i=>this.referenceDelegate.jr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Hr(e,n){return U.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,n)))}}class JV extends RL{constructor(e){super(),this.currentSequenceNumber=e}}class d0{constructor(e){this.persistence=e,this.Jr=new c0,this.Yr=null}static Zr(e){return new d0(e)}get Xr(){if(this.Yr)return this.Yr;throw te()}addReference(e,n,r){return this.Jr.addReference(r,n),this.Xr.delete(r.toString()),U.resolve()}removeReference(e,n,r){return this.Jr.removeReference(r,n),this.Xr.add(r.toString()),U.resolve()}markPotentiallyOrphaned(e,n){return this.Xr.add(n.toString()),U.resolve()}removeTarget(e,n){this.Jr.gr(n.targetId).forEach(s=>this.Xr.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next(s=>{s.forEach(i=>this.Xr.add(i.toString()))}).next(()=>r.removeTargetData(e,n))}zr(){this.Yr=new Set}jr(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return U.forEach(this.Xr,r=>{const s=J.fromPath(r);return this.ei(e,s).next(i=>{i||n.removeEntry(s,re.min())})}).next(()=>(this.Yr=null,n.apply(e)))}updateLimboDocument(e,n){return this.ei(e,n).next(r=>{r?this.Xr.delete(n.toString()):this.Xr.add(n.toString())})}Wr(e){return 0}ei(e,n){return U.or([()=>U.resolve(this.Jr.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Hr(e,n)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h0{constructor(e,n,r,s){this.targetId=e,this.fromCache=n,this.$i=r,this.Ui=s}static Wi(e,n){let r=ce(),s=ce();for(const i of n.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new h0(e,n.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YV{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XV{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return FD()?8:PL(Dt())>0?6:4}()}initialize(e,n){this.Ji=e,this.indexManager=n,this.Gi=!0}getDocumentsMatchingQuery(e,n,r,s){const i={result:null};return this.Yi(e,n).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.Zi(e,n,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new YV;return this.Xi(e,n,o).next(a=>{if(i.result=a,this.zi)return this.es(e,n,o,a.size)})}).next(()=>i.result)}es(e,n,r,s){return r.documentReadCount<this.ji?(Wa()<=de.DEBUG&&G("QueryEngine","SDK will not create cache indexes for query:",lo(n),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),U.resolve()):(Wa()<=de.DEBUG&&G("QueryEngine","Query:",lo(n),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.Hi*s?(Wa()<=de.DEBUG&&G("QueryEngine","The SDK decides to create cache indexes for query:",lo(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,nr(n))):U.resolve())}Yi(e,n){if(Ex(n))return U.resolve(null);let r=nr(n);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(n.limit!==null&&s===1&&(n=ig(n,null,"F"),r=nr(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=ce(...i);return this.Ji.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{const u=this.ts(n,a);return this.ns(n,u,o,l.readTime)?this.Yi(e,ig(n,null,"F")):this.rs(e,u,n,l)}))})))}Zi(e,n,r,s){return Ex(n)||s.isEqual(re.min())?U.resolve(null):this.Ji.getDocuments(e,r).next(i=>{const o=this.ts(n,i);return this.ns(n,o,r,s)?U.resolve(null):(Wa()<=de.DEBUG&&G("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),lo(n)),this.rs(e,o,n,IL(s,-1)).next(a=>a))})}ts(e,n){let r=new gt(tI(e));return n.forEach((s,i)=>{Mh(e,i)&&(r=r.add(i))}),r}ns(e,n,r,s){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const i=e.limitType==="F"?n.last():n.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Xi(e,n,r){return Wa()<=de.DEBUG&&G("QueryEngine","Using full collection scan to execute query:",lo(n)),this.Ji.getDocumentsMatchingQuery(e,n,Ls.min(),r)}rs(e,n,r,s){return this.Ji.getDocumentsMatchingQuery(e,r,s).next(i=>(n.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZV{constructor(e,n,r,s){this.persistence=e,this.ss=n,this.serializer=s,this.os=new Ve(me),this._s=new wa(i=>n0(i),r0),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new BV(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.os))}}function ej(t,e,n,r){return new ZV(t,e,n,r)}async function EI(t,e){const n=se(t);return await n.persistence.runTransaction("Handle user change","readonly",r=>{let s;return n.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,n.ls(e),n.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let l=ce();for(const u of s){o.push(u.batchId);for(const d of u.mutations)l=l.add(d.key)}for(const u of i){a.push(u.batchId);for(const d of u.mutations)l=l.add(d.key)}return n.localDocuments.getDocuments(r,l).next(u=>({hs:u,removedBatchIds:o,addedBatchIds:a}))})})}function tj(t,e){const n=se(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=n.cs.newChangeBuffer({trackRemovals:!0});return function(a,l,u,d){const h=u.batch,f=h.keys();let m=U.resolve();return f.forEach(y=>{m=m.next(()=>d.getEntry(l,y)).next(v=>{const w=u.docVersions.get(y);ve(w!==null),v.version.compareTo(w)<0&&(h.applyToRemoteDocument(v,u),v.isValidDocument()&&(v.setReadTime(u.commitVersion),d.addEntry(v)))})}),m.next(()=>a.mutationQueue.removeMutationBatch(l,h))}(n,r,e,i).next(()=>i.apply(r)).next(()=>n.mutationQueue.performConsistencyCheck(r)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let l=ce();for(let u=0;u<a.mutationResults.length;++u)a.mutationResults[u].transformResults.length>0&&(l=l.add(a.batch.mutations[u].key));return l}(e))).next(()=>n.localDocuments.getDocuments(r,s))})}function SI(t){const e=se(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.Ur.getLastRemoteSnapshotVersion(n))}function nj(t,e){const n=se(t),r=e.snapshotVersion;let s=n.os;return n.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=n.cs.newChangeBuffer({trackRemovals:!0});s=n.os;const a=[];e.targetChanges.forEach((d,h)=>{const f=s.get(h);if(!f)return;a.push(n.Ur.removeMatchingKeys(i,d.removedDocuments,h).next(()=>n.Ur.addMatchingKeys(i,d.addedDocuments,h)));let m=f.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(h)!==null?m=m.withResumeToken(vt.EMPTY_BYTE_STRING,re.min()).withLastLimboFreeSnapshotVersion(re.min()):d.resumeToken.approximateByteSize()>0&&(m=m.withResumeToken(d.resumeToken,r)),s=s.insert(h,m),function(v,w,x){return v.resumeToken.approximateByteSize()===0||w.snapshotVersion.toMicroseconds()-v.snapshotVersion.toMicroseconds()>=3e8?!0:x.addedDocuments.size+x.modifiedDocuments.size+x.removedDocuments.size>0}(f,m,d)&&a.push(n.Ur.updateTargetData(i,m))});let l=Fr(),u=ce();if(e.documentUpdates.forEach(d=>{e.resolvedLimboDocuments.has(d)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(i,d))}),a.push(rj(i,o,e.documentUpdates).next(d=>{l=d.Ps,u=d.Is})),!r.isEqual(re.min())){const d=n.Ur.getLastRemoteSnapshotVersion(i).next(h=>n.Ur.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(d)}return U.waitFor(a).next(()=>o.apply(i)).next(()=>n.localDocuments.getLocalViewOfDocuments(i,l,u)).next(()=>l)}).then(i=>(n.os=s,i))}function rj(t,e,n){let r=ce(),s=ce();return n.forEach(i=>r=r.add(i)),e.getEntries(t,r).next(i=>{let o=Fr();return n.forEach((a,l)=>{const u=i.get(a);l.isFoundDocument()!==u.isFoundDocument()&&(s=s.add(a)),l.isNoDocument()&&l.version.isEqual(re.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!u.isValidDocument()||l.version.compareTo(u.version)>0||l.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):G("LocalStore","Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",l.version)}),{Ps:o,Is:s}})}function sj(t,e){const n=se(t);return n.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function ij(t,e){const n=se(t);return n.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return n.Ur.getTargetData(r,e).next(i=>i?(s=i,U.resolve(s)):n.Ur.allocateTargetId(r).next(o=>(s=new hs(e,o,"TargetPurposeListen",r.currentSequenceNumber),n.Ur.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=n.os.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.os=n.os.insert(r.targetId,r),n._s.set(e,r.targetId)),r})}async function cg(t,e,n){const r=se(t),s=r.os.get(e),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!Au(o))throw o;G("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.os=r.os.remove(e),r._s.delete(s.target)}function Dx(t,e,n){const r=se(t);let s=re.min(),i=ce();return r.persistence.runTransaction("Execute query","readwrite",o=>function(l,u,d){const h=se(l),f=h._s.get(d);return f!==void 0?U.resolve(h.os.get(f)):h.Ur.getTargetData(u,d)}(r,o,nr(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(o,a.targetId).next(l=>{i=l})}).next(()=>r.ss.getDocumentsMatchingQuery(o,e,n?s:re.min(),n?i:ce())).next(a=>(oj(r,JL(e),a),{documents:a,Ts:i})))}function oj(t,e,n){let r=t.us.get(e)||re.min();n.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),t.us.set(e,r)}class Ox{constructor(){this.activeTargetIds=nV()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class aj{constructor(){this.so=new Ox,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e,n=!0){return n&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,n,r){this.oo[e]=n}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new Ox,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lj{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mx{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){G("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){G("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let kc=null;function yp(){return kc===null?kc=function(){return 268435456+Math.round(2147483648*Math.random())}():kc++,"0x"+kc.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uj={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cj{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tt="WebChannelConnection";class dj extends class{constructor(n){this.databaseInfo=n,this.databaseId=n.databaseId;const r=n.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+n.host,this.vo=`projects/${s}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${i}`}get Fo(){return!1}Mo(n,r,s,i,o){const a=yp(),l=this.xo(n,r.toUriEncodedString());G("RestConnection",`Sending RPC '${n}' ${a}:`,l,s);const u={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(u,i,o),this.No(n,l,u,s).then(d=>(G("RestConnection",`Received RPC '${n}' ${a}: `,d),d),d=>{throw Yo("RestConnection",`RPC '${n}' ${a} failed with error: `,d,"url: ",l,"request:",s),d})}Lo(n,r,s,i,o,a){return this.Mo(n,r,s,i,o)}Oo(n,r,s){n["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+va}(),n["Content-Type"]="text/plain",this.databaseInfo.appId&&(n["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((i,o)=>n[o]=i),s&&s.headers.forEach((i,o)=>n[o]=i)}xo(n,r){const s=uj[n];return`${this.Do}/v1/${r}:${s}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,n,r,s){const i=yp();return new Promise((o,a)=>{const l=new Vk;l.setWithCredentials(!0),l.listenOnce(jk.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case nd.NO_ERROR:const d=l.getResponseJson();G(Tt,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(d)),o(d);break;case nd.TIMEOUT:G(Tt,`RPC '${e}' ${i} timed out`),a(new H(j.DEADLINE_EXCEEDED,"Request time out"));break;case nd.HTTP_ERROR:const h=l.getStatus();if(G(Tt,`RPC '${e}' ${i} failed with status:`,h,"response text:",l.getResponseText()),h>0){let f=l.getResponseJson();Array.isArray(f)&&(f=f[0]);const m=f==null?void 0:f.error;if(m&&m.status&&m.message){const y=function(w){const x=w.toLowerCase().replace(/_/g,"-");return Object.values(j).indexOf(x)>=0?x:j.UNKNOWN}(m.status);a(new H(y,m.message))}else a(new H(j.UNKNOWN,"Server responded with status "+l.getStatus()))}else a(new H(j.UNAVAILABLE,"Connection failed."));break;default:te()}}finally{G(Tt,`RPC '${e}' ${i} completed.`)}});const u=JSON.stringify(s);G(Tt,`RPC '${e}' ${i} sending request:`,s),l.send(n,"POST",u,r,15)})}Bo(e,n,r){const s=yp(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=Bk(),a=Uk(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(l.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Oo(l.initMessageHeaders,n,r),l.encodeInitMessageHeaders=!0;const d=i.join("");G(Tt,`Creating RPC '${e}' stream ${s}: ${d}`,l);const h=o.createWebChannel(d,l);let f=!1,m=!1;const y=new cj({Io:w=>{m?G(Tt,`Not sending because RPC '${e}' stream ${s} is closed:`,w):(f||(G(Tt,`Opening RPC '${e}' stream ${s} transport.`),h.open(),f=!0),G(Tt,`RPC '${e}' stream ${s} sending:`,w),h.send(w))},To:()=>h.close()}),v=(w,x,S)=>{w.listen(x,b=>{try{S(b)}catch(N){setTimeout(()=>{throw N},0)}})};return v(h,nl.EventType.OPEN,()=>{m||(G(Tt,`RPC '${e}' stream ${s} transport opened.`),y.yo())}),v(h,nl.EventType.CLOSE,()=>{m||(m=!0,G(Tt,`RPC '${e}' stream ${s} transport closed`),y.So())}),v(h,nl.EventType.ERROR,w=>{m||(m=!0,Yo(Tt,`RPC '${e}' stream ${s} transport errored:`,w),y.So(new H(j.UNAVAILABLE,"The operation could not be completed")))}),v(h,nl.EventType.MESSAGE,w=>{var x;if(!m){const S=w.data[0];ve(!!S);const b=S,N=b.error||((x=b[0])===null||x===void 0?void 0:x.error);if(N){G(Tt,`RPC '${e}' stream ${s} received error:`,N);const M=N.status;let V=function(I){const C=Ke[I];if(C!==void 0)return hI(C)}(M),k=N.message;V===void 0&&(V=j.INTERNAL,k="Unknown error status: "+M+" with message "+N.message),m=!0,y.So(new H(V,k)),h.close()}else G(Tt,`RPC '${e}' stream ${s} received:`,S),y.bo(S)}}),v(a,Fk.STAT_EVENT,w=>{w.stat===Zm.PROXY?G(Tt,`RPC '${e}' stream ${s} detected buffering proxy`):w.stat===Zm.NOPROXY&&G(Tt,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{y.wo()},0),y}}function vp(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fh(t){return new xV(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bI{constructor(e,n,r=1e3,s=1.5,i=6e4){this.ui=e,this.timerId=n,this.ko=r,this.qo=s,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const n=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),s=Math.max(0,n-r);s>0&&G("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TI{constructor(e,n,r,s,i,o,a,l){this.ui=e,this.Ho=r,this.Jo=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new bI(e,n)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,n){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():n&&n.code===j.RESOURCE_EXHAUSTED?(jr(n.toString()),jr("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):n&&n.code===j.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(n)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),n=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Yo===n&&this.P_(r,s)},r=>{e(()=>{const s=new H(j.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(s)})})}P_(e,n){const r=this.h_(this.Yo);this.stream=this.T_(e,n),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{r(()=>this.I_(s))}),this.stream.onMessage(s=>{r(()=>++this.e_==1?this.E_(s):this.onNext(s))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return G("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return n=>{this.ui.enqueueAndForget(()=>this.Yo===e?n():(G("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class hj extends TI{constructor(e,n,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,s,o),this.serializer=i}T_(e,n){return this.connection.Bo("Listen",e,n)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const n=bV(this.serializer,e),r=function(i){if(!("targetChange"in i))return re.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?re.min():o.readTime?rr(o.readTime):re.min()}(e);return this.listener.d_(n,r)}A_(e){const n={};n.database=ug(this.serializer),n.addTarget=function(i,o){let a;const l=o.target;if(a=rg(l)?{documents:IV(i,l)}:{query:CV(i,l)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=mI(i,o.resumeToken);const u=og(i,o.expectedCount);u!==null&&(a.expectedCount=u)}else if(o.snapshotVersion.compareTo(re.min())>0){a.readTime=Hd(i,o.snapshotVersion.toTimestamp());const u=og(i,o.expectedCount);u!==null&&(a.expectedCount=u)}return a}(this.serializer,e);const r=NV(this.serializer,e);r&&(n.labels=r),this.a_(n)}R_(e){const n={};n.database=ug(this.serializer),n.removeTarget=e,this.a_(n)}}class fj extends TI{constructor(e,n,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,s,o),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,n){return this.connection.Bo("Write",e,n)}E_(e){return ve(!!e.streamToken),this.lastStreamToken=e.streamToken,ve(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){ve(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const n=kV(e.writeResults,e.commitTime),r=rr(e.commitTime);return this.listener.g_(r,n)}p_(){const e={};e.database=ug(this.serializer),this.a_(e)}m_(e){const n={streamToken:this.lastStreamToken,writes:e.map(r=>TV(this.serializer,r))};this.a_(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pj extends class{}{constructor(e,n,r,s){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new H(j.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,n,r,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Mo(e,ag(n,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===j.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new H(j.UNKNOWN,i.toString())})}Lo(e,n,r,s,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Lo(e,ag(n,r),s,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===j.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new H(j.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class mj{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(jr(n),this.D_=!1):G("OnlineStateTracker",n)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gj{constructor(e,n,r,s,i){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(o=>{r.enqueueAndForget(async()=>{Qi(this)&&(G("RemoteStore","Restarting streams for network reachability change."),await async function(l){const u=se(l);u.L_.add(4),await Pu(u),u.q_.set("Unknown"),u.L_.delete(4),await Uh(u)}(this))})}),this.q_=new mj(r,s)}}async function Uh(t){if(Qi(t))for(const e of t.B_)await e(!0)}async function Pu(t){for(const e of t.B_)await e(!1)}function kI(t,e){const n=se(t);n.N_.has(e.targetId)||(n.N_.set(e.targetId,e),g0(n)?m0(n):xa(n).r_()&&p0(n,e))}function f0(t,e){const n=se(t),r=xa(n);n.N_.delete(e),r.r_()&&II(n,e),n.N_.size===0&&(r.r_()?r.o_():Qi(n)&&n.q_.set("Unknown"))}function p0(t,e){if(t.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(re.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}xa(t).A_(e)}function II(t,e){t.Q_.xe(e),xa(t).R_(e)}function m0(t){t.Q_=new yV({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>t.N_.get(e)||null,tt:()=>t.datastore.serializer.databaseId}),xa(t).start(),t.q_.v_()}function g0(t){return Qi(t)&&!xa(t).n_()&&t.N_.size>0}function Qi(t){return se(t).L_.size===0}function CI(t){t.Q_=void 0}async function yj(t){t.q_.set("Online")}async function vj(t){t.N_.forEach((e,n)=>{p0(t,e)})}async function _j(t,e){CI(t),g0(t)?(t.q_.M_(e),m0(t)):t.q_.set("Unknown")}async function wj(t,e,n){if(t.q_.set("Online"),e instanceof pI&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const a of i.targetIds)s.N_.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.N_.delete(a),s.Q_.removeTarget(a))}(t,e)}catch(r){G("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Wd(t,r)}else if(e instanceof id?t.Q_.Ke(e):e instanceof fI?t.Q_.He(e):t.Q_.We(e),!n.isEqual(re.min()))try{const r=await SI(t.localStore);n.compareTo(r)>=0&&await function(i,o){const a=i.Q_.rt(o);return a.targetChanges.forEach((l,u)=>{if(l.resumeToken.approximateByteSize()>0){const d=i.N_.get(u);d&&i.N_.set(u,d.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,u)=>{const d=i.N_.get(l);if(!d)return;i.N_.set(l,d.withResumeToken(vt.EMPTY_BYTE_STRING,d.snapshotVersion)),II(i,l);const h=new hs(d.target,l,u,d.sequenceNumber);p0(i,h)}),i.remoteSyncer.applyRemoteEvent(a)}(t,n)}catch(r){G("RemoteStore","Failed to raise snapshot:",r),await Wd(t,r)}}async function Wd(t,e,n){if(!Au(e))throw e;t.L_.add(1),await Pu(t),t.q_.set("Offline"),n||(n=()=>SI(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{G("RemoteStore","Retrying IndexedDB access"),await n(),t.L_.delete(1),await Uh(t)})}function AI(t,e){return e().catch(n=>Wd(t,n,e))}async function Bh(t){const e=se(t),n=js(e);let r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;xj(e);)try{const s=await sj(e.localStore,r);if(s===null){e.O_.length===0&&n.o_();break}r=s.batchId,Ej(e,s)}catch(s){await Wd(e,s)}NI(e)&&RI(e)}function xj(t){return Qi(t)&&t.O_.length<10}function Ej(t,e){t.O_.push(e);const n=js(t);n.r_()&&n.V_&&n.m_(e.mutations)}function NI(t){return Qi(t)&&!js(t).n_()&&t.O_.length>0}function RI(t){js(t).start()}async function Sj(t){js(t).p_()}async function bj(t){const e=js(t);for(const n of t.O_)e.m_(n.mutations)}async function Tj(t,e,n){const r=t.O_.shift(),s=a0.from(r,e,n);await AI(t,()=>t.remoteSyncer.applySuccessfulWrite(s)),await Bh(t)}async function kj(t,e){e&&js(t).V_&&await async function(r,s){if(function(o){return pV(o)&&o!==j.ABORTED}(s.code)){const i=r.O_.shift();js(r).s_(),await AI(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await Bh(r)}}(t,e),NI(t)&&RI(t)}async function Lx(t,e){const n=se(t);n.asyncQueue.verifyOperationInProgress(),G("RemoteStore","RemoteStore received new credentials");const r=Qi(n);n.L_.add(3),await Pu(n),r&&n.q_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.L_.delete(3),await Uh(n)}async function Ij(t,e){const n=se(t);e?(n.L_.delete(2),await Uh(n)):e||(n.L_.add(2),await Pu(n),n.q_.set("Unknown"))}function xa(t){return t.K_||(t.K_=function(n,r,s){const i=se(n);return i.w_(),new hj(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(t.datastore,t.asyncQueue,{Eo:yj.bind(null,t),Ro:vj.bind(null,t),mo:_j.bind(null,t),d_:wj.bind(null,t)}),t.B_.push(async e=>{e?(t.K_.s_(),g0(t)?m0(t):t.q_.set("Unknown")):(await t.K_.stop(),CI(t))})),t.K_}function js(t){return t.U_||(t.U_=function(n,r,s){const i=se(n);return i.w_(),new fj(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(t.datastore,t.asyncQueue,{Eo:()=>Promise.resolve(),Ro:Sj.bind(null,t),mo:kj.bind(null,t),f_:bj.bind(null,t),g_:Tj.bind(null,t)}),t.B_.push(async e=>{e?(t.U_.s_(),await Bh(t)):(await t.U_.stop(),t.O_.length>0&&(G("RemoteStore",`Stopping write stream with ${t.O_.length} pending writes`),t.O_=[]))})),t.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y0{constructor(e,n,r,s,i){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new Cr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,s,i){const o=Date.now()+r,a=new y0(e,n,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new H(j.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function v0(t,e){if(jr("AsyncQueue",`${e}: ${t}`),Au(t))return new H(j.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vo{constructor(e){this.comparator=e?(n,r)=>e(n,r)||J.comparator(n.key,r.key):(n,r)=>J.comparator(n.key,r.key),this.keyedMap=rl(),this.sortedSet=new Ve(this.comparator)}static emptySet(e){return new Vo(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((n,r)=>(e(n),!1))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof Vo)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const s=n.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(n=>{e.push(n.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new Vo;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vx{constructor(){this.W_=new Ve(J.comparator)}track(e){const n=e.doc.key,r=this.W_.get(n);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(n,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(n):e.type===1&&r.type===2?this.W_=this.W_.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(n,{type:2,doc:e.doc}):te():this.W_=this.W_.insert(n,e)}G_(){const e=[];return this.W_.inorderTraversal((n,r)=>{e.push(r)}),e}}class sa{constructor(e,n,r,s,i,o,a,l,u){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=u}static fromInitialDocuments(e,n,r,s,i){const o=[];return n.forEach(a=>{o.push({type:0,doc:a})}),new sa(e,n,Vo.emptySet(n),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Oh(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let s=0;s<n.length;s++)if(n[s].type!==r[s].type||!n[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cj{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class Aj{constructor(){this.queries=jx(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(n,r){const s=se(n),i=s.queries;s.queries=jx(),i.forEach((o,a)=>{for(const l of a.j_)l.onError(r)})})(this,new H(j.ABORTED,"Firestore shutting down"))}}function jx(){return new wa(t=>eI(t),Oh)}async function _0(t,e){const n=se(t);let r=3;const s=e.query;let i=n.queries.get(s);i?!i.H_()&&e.J_()&&(r=2):(i=new Cj,r=e.J_()?0:1);try{switch(r){case 0:i.z_=await n.onListen(s,!0);break;case 1:i.z_=await n.onListen(s,!1);break;case 2:await n.onFirstRemoteStoreListen(s)}}catch(o){const a=v0(o,`Initialization of query '${lo(e.query)}' failed`);return void e.onError(a)}n.queries.set(s,i),i.j_.push(e),e.Z_(n.onlineState),i.z_&&e.X_(i.z_)&&x0(n)}async function w0(t,e){const n=se(t),r=e.query;let s=3;const i=n.queries.get(r);if(i){const o=i.j_.indexOf(e);o>=0&&(i.j_.splice(o,1),i.j_.length===0?s=e.J_()?0:1:!i.H_()&&e.J_()&&(s=2))}switch(s){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function Nj(t,e){const n=se(t);let r=!1;for(const s of e){const i=s.query,o=n.queries.get(i);if(o){for(const a of o.j_)a.X_(s)&&(r=!0);o.z_=s}}r&&x0(n)}function Rj(t,e,n){const r=se(t),s=r.queries.get(e);if(s)for(const i of s.j_)i.onError(n);r.queries.delete(e)}function x0(t){t.Y_.forEach(e=>{e.next()})}var dg,Fx;(Fx=dg||(dg={})).ea="default",Fx.Cache="cache";class E0{constructor(e,n,r){this.query=e,this.ta=n,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new sa(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.na?this.ia(e)&&(this.ta.next(e),n=!0):this.sa(e,this.onlineState)&&(this.oa(e),n=!0),this.ra=e,n}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let n=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),n=!0),n}sa(e,n){if(!e.fromCache||!this.J_())return!0;const r=n!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const n=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}oa(e){e=sa.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==dg.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PI{constructor(e){this.key=e}}class DI{constructor(e){this.key=e}}class Pj{constructor(e,n){this.query=e,this.Ta=n,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=ce(),this.mutatedKeys=ce(),this.Aa=tI(e),this.Ra=new Vo(this.Aa)}get Va(){return this.Ta}ma(e,n){const r=n?n.fa:new Vx,s=n?n.Ra:this.Ra;let i=n?n.mutatedKeys:this.mutatedKeys,o=s,a=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,u=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((d,h)=>{const f=s.get(d),m=Mh(this.query,h)?h:null,y=!!f&&this.mutatedKeys.has(f.key),v=!!m&&(m.hasLocalMutations||this.mutatedKeys.has(m.key)&&m.hasCommittedMutations);let w=!1;f&&m?f.data.isEqual(m.data)?y!==v&&(r.track({type:3,doc:m}),w=!0):this.ga(f,m)||(r.track({type:2,doc:m}),w=!0,(l&&this.Aa(m,l)>0||u&&this.Aa(m,u)<0)&&(a=!0)):!f&&m?(r.track({type:0,doc:m}),w=!0):f&&!m&&(r.track({type:1,doc:f}),w=!0,(l||u)&&(a=!0)),w&&(m?(o=o.add(m),i=v?i.add(d):i.delete(d)):(o=o.delete(d),i=i.delete(d)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const d=this.query.limitType==="F"?o.last():o.first();o=o.delete(d.key),i=i.delete(d.key),r.track({type:1,doc:d})}return{Ra:o,fa:r,ns:a,mutatedKeys:i}}ga(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,s){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const o=e.fa.G_();o.sort((d,h)=>function(m,y){const v=w=>{switch(w){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return te()}};return v(m)-v(y)}(d.type,h.type)||this.Aa(d.doc,h.doc)),this.pa(r),s=s!=null&&s;const a=n&&!s?this.ya():[],l=this.da.size===0&&this.current&&!s?1:0,u=l!==this.Ea;return this.Ea=l,o.length!==0||u?{snapshot:new sa(this.query,e.Ra,i,o,e.mutatedKeys,l===0,u,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:a}:{wa:a}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new Vx,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(n=>this.Ta=this.Ta.add(n)),e.modifiedDocuments.forEach(n=>{}),e.removedDocuments.forEach(n=>this.Ta=this.Ta.delete(n)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=ce(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});const n=[];return e.forEach(r=>{this.da.has(r)||n.push(new DI(r))}),this.da.forEach(r=>{e.has(r)||n.push(new PI(r))}),n}ba(e){this.Ta=e.Ts,this.da=ce();const n=this.ma(e.documents);return this.applyChanges(n,!0)}Da(){return sa.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class Dj{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class Oj{constructor(e){this.key=e,this.va=!1}}class Mj{constructor(e,n,r,s,i,o){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new wa(a=>eI(a),Oh),this.Ma=new Map,this.xa=new Set,this.Oa=new Ve(J.comparator),this.Na=new Map,this.La=new c0,this.Ba={},this.ka=new Map,this.qa=ra.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function Lj(t,e,n=!0){const r=FI(t);let s;const i=r.Fa.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Da()):s=await OI(r,e,n,!0),s}async function Vj(t,e){const n=FI(t);await OI(n,e,!0,!1)}async function OI(t,e,n,r){const s=await ij(t.localStore,nr(e)),i=s.targetId,o=t.sharedClientState.addLocalQueryTarget(i,n);let a;return r&&(a=await jj(t,e,i,o==="current",s.resumeToken)),t.isPrimaryClient&&n&&kI(t.remoteStore,s),a}async function jj(t,e,n,r,s){t.Ka=(h,f,m)=>async function(v,w,x,S){let b=w.view.ma(x);b.ns&&(b=await Dx(v.localStore,w.query,!1).then(({documents:k})=>w.view.ma(k,b)));const N=S&&S.targetChanges.get(w.targetId),M=S&&S.targetMismatches.get(w.targetId)!=null,V=w.view.applyChanges(b,v.isPrimaryClient,N,M);return Bx(v,w.targetId,V.wa),V.snapshot}(t,h,f,m);const i=await Dx(t.localStore,e,!0),o=new Pj(e,i.Ts),a=o.ma(i.documents),l=Ru.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",s),u=o.applyChanges(a,t.isPrimaryClient,l);Bx(t,n,u.wa);const d=new Dj(e,n,o);return t.Fa.set(e,d),t.Ma.has(n)?t.Ma.get(n).push(e):t.Ma.set(n,[e]),u.snapshot}async function Fj(t,e,n){const r=se(t),s=r.Fa.get(e),i=r.Ma.get(s.targetId);if(i.length>1)return r.Ma.set(s.targetId,i.filter(o=>!Oh(o,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await cg(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),n&&f0(r.remoteStore,s.targetId),hg(r,s.targetId)}).catch(Cu)):(hg(r,s.targetId),await cg(r.localStore,s.targetId,!0))}async function Uj(t,e){const n=se(t),r=n.Fa.get(e),s=n.Ma.get(r.targetId);n.isPrimaryClient&&s.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),f0(n.remoteStore,r.targetId))}async function Bj(t,e,n){const r=Gj(t);try{const s=await function(o,a){const l=se(o),u=We.now(),d=a.reduce((m,y)=>m.add(y.key),ce());let h,f;return l.persistence.runTransaction("Locally write mutations","readwrite",m=>{let y=Fr(),v=ce();return l.cs.getEntries(m,d).next(w=>{y=w,y.forEach((x,S)=>{S.isValidDocument()||(v=v.add(x))})}).next(()=>l.localDocuments.getOverlayedDocuments(m,y)).next(w=>{h=w;const x=[];for(const S of a){const b=uV(S,h.get(S.key).overlayedDocument);b!=null&&x.push(new Js(S.key,b,Wk(b.value.mapValue),Tn.exists(!0)))}return l.mutationQueue.addMutationBatch(m,u,x,a)}).next(w=>{f=w;const x=w.applyToLocalDocumentSet(h,v);return l.documentOverlayCache.saveOverlays(m,w.batchId,x)})}).then(()=>({batchId:f.batchId,changes:rI(h)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,a,l){let u=o.Ba[o.currentUser.toKey()];u||(u=new Ve(me)),u=u.insert(a,l),o.Ba[o.currentUser.toKey()]=u}(r,s.batchId,n),await Du(r,s.changes),await Bh(r.remoteStore)}catch(s){const i=v0(s,"Failed to persist write");n.reject(i)}}async function MI(t,e){const n=se(t);try{const r=await nj(n.localStore,e);e.targetChanges.forEach((s,i)=>{const o=n.Na.get(i);o&&(ve(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.va=!0:s.modifiedDocuments.size>0?ve(o.va):s.removedDocuments.size>0&&(ve(o.va),o.va=!1))}),await Du(n,r,e)}catch(r){await Cu(r)}}function Ux(t,e,n){const r=se(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const s=[];r.Fa.forEach((i,o)=>{const a=o.view.Z_(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){const l=se(o);l.onlineState=a;let u=!1;l.queries.forEach((d,h)=>{for(const f of h.j_)f.Z_(a)&&(u=!0)}),u&&x0(l)}(r.eventManager,e),s.length&&r.Ca.d_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function zj(t,e,n){const r=se(t);r.sharedClientState.updateQueryState(e,"rejected",n);const s=r.Na.get(e),i=s&&s.key;if(i){let o=new Ve(J.comparator);o=o.insert(i,At.newNoDocument(i,re.min()));const a=ce().add(i),l=new jh(re.min(),new Map,new Ve(me),o,a);await MI(r,l),r.Oa=r.Oa.remove(i),r.Na.delete(e),S0(r)}else await cg(r.localStore,e,!1).then(()=>hg(r,e,n)).catch(Cu)}async function $j(t,e){const n=se(t),r=e.batch.batchId;try{const s=await tj(n.localStore,e);VI(n,r,null),LI(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Du(n,s)}catch(s){await Cu(s)}}async function qj(t,e,n){const r=se(t);try{const s=await function(o,a){const l=se(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let d;return l.mutationQueue.lookupMutationBatch(u,a).next(h=>(ve(h!==null),d=h.keys(),l.mutationQueue.removeMutationBatch(u,h))).next(()=>l.mutationQueue.performConsistencyCheck(u)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(u,d,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,d)).next(()=>l.localDocuments.getDocuments(u,d))})}(r.localStore,e);VI(r,e,n),LI(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await Du(r,s)}catch(s){await Cu(s)}}function LI(t,e){(t.ka.get(e)||[]).forEach(n=>{n.resolve()}),t.ka.delete(e)}function VI(t,e,n){const r=se(t);let s=r.Ba[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(n?i.reject(n):i.resolve(),s=s.remove(e)),r.Ba[r.currentUser.toKey()]=s}}function hg(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Ma.get(e))t.Fa.delete(r),n&&t.Ca.$a(r,n);t.Ma.delete(e),t.isPrimaryClient&&t.La.gr(e).forEach(r=>{t.La.containsKey(r)||jI(t,r)})}function jI(t,e){t.xa.delete(e.path.canonicalString());const n=t.Oa.get(e);n!==null&&(f0(t.remoteStore,n),t.Oa=t.Oa.remove(e),t.Na.delete(n),S0(t))}function Bx(t,e,n){for(const r of n)r instanceof PI?(t.La.addReference(r.key,e),Hj(t,r)):r instanceof DI?(G("SyncEngine","Document no longer in limbo: "+r.key),t.La.removeReference(r.key,e),t.La.containsKey(r.key)||jI(t,r.key)):te()}function Hj(t,e){const n=e.key,r=n.path.canonicalString();t.Oa.get(n)||t.xa.has(r)||(G("SyncEngine","New document in limbo: "+n),t.xa.add(r),S0(t))}function S0(t){for(;t.xa.size>0&&t.Oa.size<t.maxConcurrentLimboResolutions;){const e=t.xa.values().next().value;t.xa.delete(e);const n=new J(ke.fromString(e)),r=t.qa.next();t.Na.set(r,new Oj(n)),t.Oa=t.Oa.insert(n,r),kI(t.remoteStore,new hs(nr(Dh(n.path)),r,"TargetPurposeLimboResolution",Xy.oe))}}async function Du(t,e,n){const r=se(t),s=[],i=[],o=[];r.Fa.isEmpty()||(r.Fa.forEach((a,l)=>{o.push(r.Ka(l,e,n).then(u=>{var d;if((u||n)&&r.isPrimaryClient){const h=u?!u.fromCache:(d=n==null?void 0:n.targetChanges.get(l.targetId))===null||d===void 0?void 0:d.current;r.sharedClientState.updateQueryState(l.targetId,h?"current":"not-current")}if(u){s.push(u);const h=h0.Wi(l.targetId,u);i.push(h)}}))}),await Promise.all(o),r.Ca.d_(s),await async function(l,u){const d=se(l);try{await d.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>U.forEach(u,f=>U.forEach(f.$i,m=>d.persistence.referenceDelegate.addReference(h,f.targetId,m)).next(()=>U.forEach(f.Ui,m=>d.persistence.referenceDelegate.removeReference(h,f.targetId,m)))))}catch(h){if(!Au(h))throw h;G("LocalStore","Failed to update sequence numbers: "+h)}for(const h of u){const f=h.targetId;if(!h.fromCache){const m=d.os.get(f),y=m.snapshotVersion,v=m.withLastLimboFreeSnapshotVersion(y);d.os=d.os.insert(f,v)}}}(r.localStore,i))}async function Wj(t,e){const n=se(t);if(!n.currentUser.isEqual(e)){G("SyncEngine","User change. New user:",e.toKey());const r=await EI(n.localStore,e);n.currentUser=e,function(i,o){i.ka.forEach(a=>{a.forEach(l=>{l.reject(new H(j.CANCELLED,o))})}),i.ka.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Du(n,r.hs)}}function Kj(t,e){const n=se(t),r=n.Na.get(e);if(r&&r.va)return ce().add(r.key);{let s=ce();const i=n.Ma.get(e);if(!i)return s;for(const o of i){const a=n.Fa.get(o);s=s.unionWith(a.view.Va)}return s}}function FI(t){const e=se(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=MI.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Kj.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=zj.bind(null,e),e.Ca.d_=Nj.bind(null,e.eventManager),e.Ca.$a=Rj.bind(null,e.eventManager),e}function Gj(t){const e=se(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=$j.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=qj.bind(null,e),e}class Kd{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Fh(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,n){return null}Ha(e,n){return null}za(e){return ej(this.persistence,new XV,e.initialUser,this.serializer)}Ga(e){return new QV(d0.Zr,this.serializer)}Wa(e){return new aj}async terminate(){var e,n;(e=this.gcScheduler)===null||e===void 0||e.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Kd.provider={build:()=>new Kd};class fg{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Ux(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=Wj.bind(null,this.syncEngine),await Ij(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new Aj}()}createDatastore(e){const n=Fh(e.databaseInfo.databaseId),r=function(i){return new dj(i)}(e.databaseInfo);return function(i,o,a,l){return new pj(i,o,a,l)}(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return function(r,s,i,o,a){return new gj(r,s,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,n=>Ux(this.syncEngine,n,0),function(){return Mx.D()?new Mx:new lj}())}createSyncEngine(e,n){return function(s,i,o,a,l,u,d){const h=new Mj(s,i,o,a,l,u);return d&&(h.Qa=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){var e,n;await async function(s){const i=se(s);G("RemoteStore","RemoteStore shutting down."),i.L_.add(5),await Pu(i),i.k_.shutdown(),i.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(n=this.eventManager)===null||n===void 0||n.terminate()}}fg.provider={build:()=>new fg};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b0{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):jr("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,n){setTimeout(()=>{this.muted||e(n)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qj{constructor(e,n,r,s,i){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=s,this.user=It.UNAUTHENTICATED,this.clientId=$k.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{G("FirestoreClient","Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(G("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Cr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=v0(n,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function _p(t,e){t.asyncQueue.verifyOperationInProgress(),G("FirestoreClient","Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener(async s=>{r.isEqual(s)||(await EI(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function zx(t,e){t.asyncQueue.verifyOperationInProgress();const n=await Jj(t);G("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener(r=>Lx(e.remoteStore,r)),t.setAppCheckTokenChangeListener((r,s)=>Lx(e.remoteStore,s)),t._onlineComponents=e}async function Jj(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){G("FirestoreClient","Using user provided OfflineComponentProvider");try{await _p(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(s){return s.name==="FirebaseError"?s.code===j.FAILED_PRECONDITION||s.code===j.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(n))throw n;Yo("Error using user provided cache. Falling back to memory cache: "+n),await _p(t,new Kd)}}else G("FirestoreClient","Using default OfflineComponentProvider"),await _p(t,new Kd);return t._offlineComponents}async function UI(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(G("FirestoreClient","Using user provided OnlineComponentProvider"),await zx(t,t._uninitializedComponentsProvider._online)):(G("FirestoreClient","Using default OnlineComponentProvider"),await zx(t,new fg))),t._onlineComponents}function Yj(t){return UI(t).then(e=>e.syncEngine)}async function Gd(t){const e=await UI(t),n=e.eventManager;return n.onListen=Lj.bind(null,e.syncEngine),n.onUnlisten=Fj.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=Vj.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=Uj.bind(null,e.syncEngine),n}function Xj(t,e,n={}){const r=new Cr;return t.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,u){const d=new b0({next:f=>{d.Za(),o.enqueueAndForget(()=>w0(i,h));const m=f.docs.has(a);!m&&f.fromCache?u.reject(new H(j.UNAVAILABLE,"Failed to get document because the client is offline.")):m&&f.fromCache&&l&&l.source==="server"?u.reject(new H(j.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(f)},error:f=>u.reject(f)}),h=new E0(Dh(a.path),d,{includeMetadataChanges:!0,_a:!0});return _0(i,h)}(await Gd(t),t.asyncQueue,e,n,r)),r.promise}function Zj(t,e,n={}){const r=new Cr;return t.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,u){const d=new b0({next:f=>{d.Za(),o.enqueueAndForget(()=>w0(i,h)),f.fromCache&&l.source==="server"?u.reject(new H(j.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(f)},error:f=>u.reject(f)}),h=new E0(a,d,{includeMetadataChanges:!0,_a:!0});return _0(i,h)}(await Gd(t),t.asyncQueue,e,n,r)),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BI(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $x=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zI(t,e,n){if(!n)throw new H(j.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function eF(t,e,n,r){if(e===!0&&r===!0)throw new H(j.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function qx(t){if(!J.isDocumentKey(t))throw new H(j.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Hx(t){if(J.isDocumentKey(t))throw new H(j.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function zh(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":te()}function en(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new H(j.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=zh(t);throw new H(j.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wx{constructor(e){var n,r;if(e.host===void 0){if(e.ssl!==void 0)throw new H(j.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(n=e.ssl)===null||n===void 0||n;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new H(j.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}eF("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=BI((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new H(j.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new H(j.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new H(j.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class $h{constructor(e,n,r,s){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Wx({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new H(j.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new H(j.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Wx(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new vL;switch(r.type){case"firstParty":return new EL(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new H(j.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(n){const r=$x.get(n);r&&(G("ComponentProvider","Removing Datastore"),$x.delete(n),r.terminate())}(this),Promise.resolve()}}function tF(t,e,n,r={}){var s;const i=(t=en(t,$h))._getSettings(),o=`${e}:${n}`;if(i.host!=="firestore.googleapis.com"&&i.host!==o&&Yo("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=It.MOCK_USER;else{a=YT(r.mockUserToken,(s=t._app)===null||s===void 0?void 0:s.options.projectId);const u=r.mockUserToken.sub||r.mockUserToken.user_id;if(!u)throw new H(j.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new It(u)}t._authCredentials=new _L(new zk(a,l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ys{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Ys(this.firestore,e,this._query)}}class Rt{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Is(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Rt(this.firestore,e,this._key)}}class Is extends Ys{constructor(e,n,r){super(e,n,Dh(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Rt(this.firestore,null,new J(e))}withConverter(e){return new Is(this.firestore,e,this._path)}}function tn(t,e,...n){if(t=Ae(t),zI("collection","path",e),t instanceof $h){const r=ke.fromString(e,...n);return Hx(r),new Is(t,null,r)}{if(!(t instanceof Rt||t instanceof Is))throw new H(j.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(ke.fromString(e,...n));return Hx(r),new Is(t.firestore,null,r)}}function Ie(t,e,...n){if(t=Ae(t),arguments.length===1&&(e=$k.newId()),zI("doc","path",e),t instanceof $h){const r=ke.fromString(e,...n);return qx(r),new Rt(t,null,new J(r))}{if(!(t instanceof Rt||t instanceof Is))throw new H(j.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(ke.fromString(e,...n));return qx(r),new Rt(t.firestore,t instanceof Is?t.converter:null,new J(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kx{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new bI(this,"async_queue_retry"),this.Vu=()=>{const r=vp();r&&G("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;const n=vp();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const n=vp();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const n=new Cr;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!Au(e))throw e;G("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const n=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;const s=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw jr("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.du=!1,r))));return this.mu=n,n}enqueueAfterDelay(e,n,r){this.fu(),this.Ru.indexOf(e)>-1&&(n=0);const s=y0.createAndSchedule(this,e,n,r,i=>this.yu(i));return this.Tu.push(s),s}fu(){this.Eu&&te()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const n of this.Tu)if(n.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((n,r)=>n.targetTimeMs-r.targetTimeMs);for(const n of this.Tu)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const n=this.Tu.indexOf(e);this.Tu.splice(n,1)}}function Gx(t){return function(n,r){if(typeof n!="object"||n===null)return!1;const s=n;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(t,["next","error","complete"])}class Ur extends $h{constructor(e,n,r,s){super(e,n,r,s),this.type="firestore",this._queue=new Kx,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Kx(e),this._firestoreClient=void 0,await e}}}function nF(t,e){const n=typeof t=="object"?t:Fy(),r=typeof t=="string"?t:"(default)",s=Ch(n,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=GT("firestore");i&&tF(s,...i)}return s}function qh(t){if(t._terminated)throw new H(j.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||rF(t),t._firestoreClient}function rF(t){var e,n,r;const s=t._freezeSettings(),i=function(a,l,u,d){return new ML(a,l,u,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,BI(d.experimentalLongPollingOptions),d.useFetchStreams)}(t._databaseId,((e=t._app)===null||e===void 0?void 0:e.options.appId)||"",t._persistenceKey,s);t._componentsProvider||!((n=s.localCache)===null||n===void 0)&&n._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(t._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),t._firestoreClient=new Qj(t._authCredentials,t._appCheckCredentials,t._queue,i,t._componentsProvider&&function(a){const l=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(l),_online:l}}(t._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ia{constructor(e){this._byteString=e}static fromBase64String(e){try{return new ia(vt.fromBase64String(e))}catch(n){throw new H(j.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new ia(vt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hh{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new H(j.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new pt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ea{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T0{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new H(j.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new H(j.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return me(this._lat,e._lat)||me(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k0{constructor(e){this._values=(e||[]).map(n=>n)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sF=/^__.*__$/;class iF{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new Js(e,this.data,this.fieldMask,n,this.fieldTransforms):new Nu(e,this.data,n,this.fieldTransforms)}}class $I{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return new Js(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function qI(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw te()}}class Wh{constructor(e,n,r,s,i,o){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new Wh(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var n;const r=(n=this.path)===null||n===void 0?void 0:n.child(e),s=this.Fu({path:r,xu:!1});return s.Ou(e),s}Nu(e){var n;const r=(n=this.path)===null||n===void 0?void 0:n.child(e),s=this.Fu({path:r,xu:!1});return s.vu(),s}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Qd(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(qI(this.Cu)&&sF.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class oF{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||Fh(e)}Qu(e,n,r,s=!1){return new Wh({Cu:e,methodName:n,qu:r,path:pt.emptyPath(),xu:!1,ku:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Kh(t){const e=t._freezeSettings(),n=Fh(t._databaseId);return new oF(t._databaseId,!!e.ignoreUndefinedProperties,n)}function HI(t,e,n,r,s,i={}){const o=t.Qu(i.merge||i.mergeFields?2:0,e,n,s);N0("Data must be an object, but it was:",o,r);const a=KI(r,o);let l,u;if(i.merge)l=new cn(o.fieldMask),u=o.fieldTransforms;else if(i.mergeFields){const d=[];for(const h of i.mergeFields){const f=pg(e,h,n);if(!o.contains(f))throw new H(j.INVALID_ARGUMENT,`Field '${f}' is specified in your field mask but missing from your input data.`);QI(d,f)||d.push(f)}l=new cn(d),u=o.fieldTransforms.filter(h=>l.covers(h.field))}else l=null,u=o.fieldTransforms;return new iF(new Qt(a),l,u)}class Gh extends Ea{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Gh}}function WI(t,e,n){return new Wh({Cu:3,qu:e.settings.qu,methodName:t._methodName,xu:n},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class I0 extends Ea{_toFieldTransform(e){return new i0(e.path,new ru)}isEqual(e){return e instanceof I0}}class C0 extends Ea{constructor(e,n){super(e),this.Ku=n}_toFieldTransform(e){const n=WI(this,e,!0),r=this.Ku.map(i=>Ji(i,n)),s=new ta(r);return new i0(e.path,s)}isEqual(e){return e instanceof C0&&Qo(this.Ku,e.Ku)}}class A0 extends Ea{constructor(e,n){super(e),this.Ku=n}_toFieldTransform(e){const n=WI(this,e,!0),r=this.Ku.map(i=>Ji(i,n)),s=new na(r);return new i0(e.path,s)}isEqual(e){return e instanceof A0&&Qo(this.Ku,e.Ku)}}function aF(t,e,n,r){const s=t.Qu(1,e,n);N0("Data must be an object, but it was:",s,r);const i=[],o=Qt.empty();Gi(r,(l,u)=>{const d=R0(e,l,n);u=Ae(u);const h=s.Nu(d);if(u instanceof Gh)i.push(d);else{const f=Ji(u,h);f!=null&&(i.push(d),o.set(d,f))}});const a=new cn(i);return new $I(o,a,s.fieldTransforms)}function lF(t,e,n,r,s,i){const o=t.Qu(1,e,n),a=[pg(e,r,n)],l=[s];if(i.length%2!=0)throw new H(j.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let f=0;f<i.length;f+=2)a.push(pg(e,i[f])),l.push(i[f+1]);const u=[],d=Qt.empty();for(let f=a.length-1;f>=0;--f)if(!QI(u,a[f])){const m=a[f];let y=l[f];y=Ae(y);const v=o.Nu(m);if(y instanceof Gh)u.push(m);else{const w=Ji(y,v);w!=null&&(u.push(m),d.set(m,w))}}const h=new cn(u);return new $I(d,h,o.fieldTransforms)}function uF(t,e,n,r=!1){return Ji(n,t.Qu(r?4:3,e))}function Ji(t,e){if(GI(t=Ae(t)))return N0("Unsupported field value:",e,t),KI(t,e);if(t instanceof Ea)return function(r,s){if(!qI(s.Cu))throw s.Bu(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Bu(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const a of r){let l=Ji(a,s.Lu(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}}(t,e)}return function(r,s){if((r=Ae(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return rV(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=We.fromDate(r);return{timestampValue:Hd(s.serializer,i)}}if(r instanceof We){const i=new We(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Hd(s.serializer,i)}}if(r instanceof T0)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof ia)return{bytesValue:mI(s.serializer,r._byteString)};if(r instanceof Rt){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:u0(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof k0)return function(o,a){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(l=>{if(typeof l!="number")throw a.Bu("VectorValues must only contain numeric values.");return s0(a.serializer,l)})}}}}}}(r,s);throw s.Bu(`Unsupported field value: ${zh(r)}`)}(t,e)}function KI(t,e){const n={};return qk(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Gi(t,(r,s)=>{const i=Ji(s,e.Mu(r));i!=null&&(n[r]=i)}),{mapValue:{fields:n}}}function GI(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof We||t instanceof T0||t instanceof ia||t instanceof Rt||t instanceof Ea||t instanceof k0)}function N0(t,e,n){if(!GI(n)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(n)){const r=zh(n);throw r==="an object"?e.Bu(t+" a custom object"):e.Bu(t+" "+r)}}function pg(t,e,n){if((e=Ae(e))instanceof Hh)return e._internalPath;if(typeof e=="string")return R0(t,e);throw Qd("Field path arguments must be of type string or ",t,!1,void 0,n)}const cF=new RegExp("[~\\*/\\[\\]]");function R0(t,e,n){if(e.search(cF)>=0)throw Qd(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Hh(...e.split("."))._internalPath}catch{throw Qd(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Qd(t,e,n,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${r}`),o&&(l+=` in document ${s}`),l+=")"),new H(j.INVALID_ARGUMENT,a+t+l)}function QI(t,e){return t.some(n=>n.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JI{constructor(e,n,r,s,i){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Rt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new dF(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(Qh("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class dF extends JI{data(){return super.data()}}function Qh(t,e){return typeof e=="string"?R0(t,e):e instanceof Hh?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YI(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new H(j.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class P0{}class XI extends P0{}function Fs(t,e,...n){let r=[];e instanceof P0&&r.push(e),r=r.concat(n),function(i){const o=i.filter(l=>l instanceof D0).length,a=i.filter(l=>l instanceof Jh).length;if(o>1||o>0&&a>0)throw new H(j.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)t=s._apply(t);return t}class Jh extends XI{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new Jh(e,n,r)}_apply(e){const n=this._parse(e);return ZI(e._query,n),new Ys(e.firestore,e.converter,sg(e._query,n))}_parse(e){const n=Kh(e.firestore);return function(i,o,a,l,u,d,h){let f;if(u.isKeyField()){if(d==="array-contains"||d==="array-contains-any")throw new H(j.INVALID_ARGUMENT,`Invalid Query. You can't perform '${d}' queries on documentId().`);if(d==="in"||d==="not-in"){Jx(h,d);const m=[];for(const y of h)m.push(Qx(l,i,y));f={arrayValue:{values:m}}}else f=Qx(l,i,h)}else d!=="in"&&d!=="not-in"&&d!=="array-contains-any"||Jx(h,d),f=uF(a,o,h,d==="in"||d==="not-in");return Qe.create(u,d,f)}(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function bl(t,e,n){const r=e,s=Qh("where",t);return Jh._create(s,r,n)}class D0 extends P0{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new D0(e,n)}_parse(e){const n=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return n.length===1?n[0]:qn.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:(function(s,i){let o=s;const a=i.getFlattenedFilters();for(const l of a)ZI(o,l),o=sg(o,l)}(e._query,n),new Ys(e.firestore,e.converter,sg(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class O0 extends XI{constructor(e,n){super(),this._field=e,this._direction=n,this.type="orderBy"}static _create(e,n){return new O0(e,n)}_apply(e){const n=function(s,i,o){if(s.startAt!==null)throw new H(j.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new H(j.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new nu(i,o)}(e._query,this._field,this._direction);return new Ys(e.firestore,e.converter,function(s,i){const o=s.explicitOrderBy.concat([i]);return new _a(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,n))}}function Us(t,e="asc"){const n=e,r=Qh("orderBy",t);return O0._create(r,n)}function Qx(t,e,n){if(typeof(n=Ae(n))=="string"){if(n==="")throw new H(j.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Zk(e)&&n.indexOf("/")!==-1)throw new H(j.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(ke.fromString(n));if(!J.isDocumentKey(r))throw new H(j.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return gx(t,new J(r))}if(n instanceof Rt)return gx(t,n._key);throw new H(j.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${zh(n)}.`)}function Jx(t,e){if(!Array.isArray(t)||t.length===0)throw new H(j.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function ZI(t,e){const n=function(s,i){for(const o of s)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null}(t.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(n!==null)throw n===e.op?new H(j.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new H(j.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class hF{convertValue(e,n="none"){switch(Fi(e)){case 0:return null;case 1:return e.booleanValue;case 2:return $e(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(ji(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw te()}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const r={};return Gi(e,(s,i)=>{r[s]=this.convertValue(i,n)}),r}convertVectorValue(e){var n,r,s;const i=(s=(r=(n=e.fields)===null||n===void 0?void 0:n.value.arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(o=>$e(o.doubleValue));return new k0(i)}convertGeoPoint(e){return new T0($e(e.latitude),$e(e.longitude))}convertArray(e,n){return(e.values||[]).map(r=>this.convertValue(r,n))}convertServerTimestamp(e,n){switch(n){case"previous":const r=e0(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(Zl(e));default:return null}}convertTimestamp(e){const n=Vs(e);return new We(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=ke.fromString(e);ve(xI(r));const s=new eu(r.get(1),r.get(3)),i=new J(r.popFirst(5));return s.isEqual(n)||jr(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eC(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class il{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class tC extends JI{constructor(e,n,r,s,i,o){super(e,n,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new od(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(Qh("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}}class od extends tC{data(e={}){return super.data(e)}}class nC{constructor(e,n,r,s){this._firestore=e,this._userDataWriter=n,this._snapshot=s,this.metadata=new il(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(r=>{e.call(n,new od(this._firestore,this._userDataWriter,r.key,r,new il(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new H(j.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{const l=new od(s._firestore,s._userDataWriter,a.doc.key,a.doc,new il(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const l=new od(s._firestore,s._userDataWriter,a.doc.key,a.doc,new il(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let u=-1,d=-1;return a.type!==0&&(u=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),d=o.indexOf(a.doc.key)),{type:fF(a.type),doc:l,oldIndex:u,newIndex:d}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}}function fF(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return te()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bs(t){t=en(t,Rt);const e=en(t.firestore,Ur);return Xj(qh(e),t._key).then(n=>iC(e,t,n))}class M0 extends hF{constructor(e){super(),this.firestore=e}convertBytes(e){return new ia(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new Rt(this.firestore,null,n)}}function Ou(t){t=en(t,Ys);const e=en(t.firestore,Ur),n=qh(e),r=new M0(e);return YI(t._query),Zj(n,t._query).then(s=>new nC(e,r,t,s))}function rC(t,e,n){t=en(t,Rt);const r=en(t.firestore,Ur),s=eC(t.converter,e,n);return Yh(r,[HI(Kh(r),"setDoc",t._key,s,t.converter!==null,n).toMutation(t._key,Tn.none())])}function En(t,e,n,...r){t=en(t,Rt);const s=en(t.firestore,Ur),i=Kh(s);let o;return o=typeof(e=Ae(e))=="string"||e instanceof Hh?lF(i,"updateDoc",t._key,e,n,r):aF(i,"updateDoc",t._key,e),Yh(s,[o.toMutation(t._key,Tn.exists(!0))])}function Mu(t){return Yh(en(t.firestore,Ur),[new o0(t._key,Tn.none())])}function Lu(t,e){const n=en(t.firestore,Ur),r=Ie(t),s=eC(t.converter,e);return Yh(n,[HI(Kh(t.firestore),"addDoc",r._key,s,t.converter!==null,{}).toMutation(r._key,Tn.exists(!1))]).then(()=>r)}function sC(t,...e){var n,r,s;t=Ae(t);let i={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||Gx(e[o])||(i=e[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(Gx(e[o])){const h=e[o];e[o]=(n=h.next)===null||n===void 0?void 0:n.bind(h),e[o+1]=(r=h.error)===null||r===void 0?void 0:r.bind(h),e[o+2]=(s=h.complete)===null||s===void 0?void 0:s.bind(h)}let l,u,d;if(t instanceof Rt)u=en(t.firestore,Ur),d=Dh(t._key.path),l={next:h=>{e[o]&&e[o](iC(u,t,h))},error:e[o+1],complete:e[o+2]};else{const h=en(t,Ys);u=en(h.firestore,Ur),d=h._query;const f=new M0(u);l={next:m=>{e[o]&&e[o](new nC(u,f,h,m))},error:e[o+1],complete:e[o+2]},YI(t._query)}return function(f,m,y,v){const w=new b0(v),x=new E0(m,w,y);return f.asyncQueue.enqueueAndForget(async()=>_0(await Gd(f),x)),()=>{w.Za(),f.asyncQueue.enqueueAndForget(async()=>w0(await Gd(f),x))}}(qh(u),d,a,l)}function Yh(t,e){return function(r,s){const i=new Cr;return r.asyncQueue.enqueueAndForget(async()=>Bj(await Yj(r),s,i)),i.promise}(qh(t),e)}function iC(t,e,n){const r=n.docs.get(e._key),s=new M0(t);return new tC(t,s,e._key,r,new il(n.hasPendingWrites,n.fromCache),e.converter)}function xe(){return new I0("serverTimestamp")}function pF(...t){return new C0("arrayUnion",t)}function mF(...t){return new A0("arrayRemove",t)}(function(e,n=!0){(function(s){va=s})(Ki),Oi(new Ms("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),a=new Ur(new wL(r.getProvider("auth-internal")),new bL(r.getProvider("app-check-internal")),function(u,d){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new H(j.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new eu(u.options.projectId,d)}(o,s),o);return i=Object.assign({useFetchStreams:n},i),a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),er(dx,"4.7.3",e),er(dx,"4.7.3","esm2017")})();var gF="firebase",yF="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */er(gF,yF,"app");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oC="firebasestorage.googleapis.com",aC="storageBucket",vF=2*60*1e3,_F=10*60*1e3,wF=1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class je extends ar{constructor(e,n,r=0){super(wp(e),`Firebase Storage: ${n} (${wp(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,je.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return wp(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var Ne;(function(t){t.UNKNOWN="unknown",t.OBJECT_NOT_FOUND="object-not-found",t.BUCKET_NOT_FOUND="bucket-not-found",t.PROJECT_NOT_FOUND="project-not-found",t.QUOTA_EXCEEDED="quota-exceeded",t.UNAUTHENTICATED="unauthenticated",t.UNAUTHORIZED="unauthorized",t.UNAUTHORIZED_APP="unauthorized-app",t.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",t.INVALID_CHECKSUM="invalid-checksum",t.CANCELED="canceled",t.INVALID_EVENT_NAME="invalid-event-name",t.INVALID_URL="invalid-url",t.INVALID_DEFAULT_BUCKET="invalid-default-bucket",t.NO_DEFAULT_BUCKET="no-default-bucket",t.CANNOT_SLICE_BLOB="cannot-slice-blob",t.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",t.NO_DOWNLOAD_URL="no-download-url",t.INVALID_ARGUMENT="invalid-argument",t.INVALID_ARGUMENT_COUNT="invalid-argument-count",t.APP_DELETED="app-deleted",t.INVALID_ROOT_OPERATION="invalid-root-operation",t.INVALID_FORMAT="invalid-format",t.INTERNAL_ERROR="internal-error",t.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(Ne||(Ne={}));function wp(t){return"storage/"+t}function L0(){const t="An unknown error occurred, please check the error payload for server response.";return new je(Ne.UNKNOWN,t)}function xF(t){return new je(Ne.OBJECT_NOT_FOUND,"Object '"+t+"' does not exist.")}function EF(t){return new je(Ne.QUOTA_EXCEEDED,"Quota for bucket '"+t+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function SF(){const t="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new je(Ne.UNAUTHENTICATED,t)}function bF(){return new je(Ne.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function TF(t){return new je(Ne.UNAUTHORIZED,"User does not have permission to access '"+t+"'.")}function lC(){return new je(Ne.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function uC(){return new je(Ne.CANCELED,"User canceled the upload/download.")}function kF(t){return new je(Ne.INVALID_URL,"Invalid URL '"+t+"'.")}function IF(t){return new je(Ne.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}function CF(){return new je(Ne.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+aC+"' property when initializing the app?")}function cC(){return new je(Ne.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function AF(){return new je(Ne.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.")}function NF(){return new je(Ne.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function RF(t){return new je(Ne.UNSUPPORTED_ENVIRONMENT,`${t} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function mg(t){return new je(Ne.INVALID_ARGUMENT,t)}function dC(){return new je(Ne.APP_DELETED,"The Firebase app was deleted.")}function PF(t){return new je(Ne.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function Tl(t,e){return new je(Ne.INVALID_FORMAT,"String does not match format '"+t+"': "+e)}function Ka(t){throw new je(Ne.INTERNAL_ERROR,"Internal error: "+t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dn{constructor(e,n){this.bucket=e,this.path_=n}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,n){let r;try{r=dn.makeFromUrl(e,n)}catch{return new dn(e,"")}if(r.path==="")return r;throw IF(e)}static makeFromUrl(e,n){let r=null;const s="([A-Za-z0-9.\\-_]+)";function i(N){N.path.charAt(N.path.length-1)==="/"&&(N.path_=N.path_.slice(0,-1))}const o="(/(.*))?$",a=new RegExp("^gs://"+s+o,"i"),l={bucket:1,path:3};function u(N){N.path_=decodeURIComponent(N.path)}const d="v[A-Za-z0-9_]+",h=n.replace(/[.]/g,"\\."),f="(/([^?#]*).*)?$",m=new RegExp(`^https?://${h}/${d}/b/${s}/o${f}`,"i"),y={bucket:1,path:3},v=n===oC?"(?:storage.googleapis.com|storage.cloud.google.com)":n,w="([^?#]*)",x=new RegExp(`^https?://${v}/${s}/${w}`,"i"),b=[{regex:a,indices:l,postModify:i},{regex:m,indices:y,postModify:u},{regex:x,indices:{bucket:1,path:2},postModify:u}];for(let N=0;N<b.length;N++){const M=b[N],V=M.regex.exec(e);if(V){const k=V[M.indices.bucket];let E=V[M.indices.path];E||(E=""),r=new dn(k,E),M.postModify(r);break}}if(r==null)throw kF(e);return r}}class DF{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OF(t,e,n){let r=1,s=null,i=null,o=!1,a=0;function l(){return a===2}let u=!1;function d(...w){u||(u=!0,e.apply(null,w))}function h(w){s=setTimeout(()=>{s=null,t(m,l())},w)}function f(){i&&clearTimeout(i)}function m(w,...x){if(u){f();return}if(w){f(),d.call(null,w,...x);return}if(l()||o){f(),d.call(null,w,...x);return}r<64&&(r*=2);let b;a===1?(a=2,b=0):b=(r+Math.random())*1e3,h(b)}let y=!1;function v(w){y||(y=!0,f(),!u&&(s!==null?(w||(a=2),clearTimeout(s),h(0)):w||(a=1)))}return h(0),i=setTimeout(()=>{o=!0,v(!0)},n),v}function MF(t){t(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LF(t){return t!==void 0}function VF(t){return typeof t=="function"}function jF(t){return typeof t=="object"&&!Array.isArray(t)}function Xh(t){return typeof t=="string"||t instanceof String}function Yx(t){return V0()&&t instanceof Blob}function V0(){return typeof Blob<"u"}function Xx(t,e,n,r){if(r<e)throw mg(`Invalid value for '${t}'. Expected ${e} or greater.`);if(r>n)throw mg(`Invalid value for '${t}'. Expected ${n} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sa(t,e,n){let r=e;return n==null&&(r=`https://${e}`),`${n}://${r}/v0${t}`}function hC(t){const e=encodeURIComponent;let n="?";for(const r in t)if(t.hasOwnProperty(r)){const s=e(r)+"="+e(t[r]);n=n+s+"&"}return n=n.slice(0,-1),n}var Ei;(function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"})(Ei||(Ei={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fC(t,e){const n=t>=500&&t<600,s=[408,429].indexOf(t)!==-1,i=e.indexOf(t)!==-1;return n||s||i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FF{constructor(e,n,r,s,i,o,a,l,u,d,h,f=!0){this.url_=e,this.method_=n,this.headers_=r,this.body_=s,this.successCodes_=i,this.additionalRetryCodes_=o,this.callback_=a,this.errorCallback_=l,this.timeout_=u,this.progressCallback_=d,this.connectionFactory_=h,this.retry=f,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((m,y)=>{this.resolve_=m,this.reject_=y,this.start_()})}start_(){const e=(r,s)=>{if(s){r(!1,new Ic(!1,null,!0));return}const i=this.connectionFactory_();this.pendingConnection_=i;const o=a=>{const l=a.loaded,u=a.lengthComputable?a.total:-1;this.progressCallback_!==null&&this.progressCallback_(l,u)};this.progressCallback_!==null&&i.addUploadProgressListener(o),i.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&i.removeUploadProgressListener(o),this.pendingConnection_=null;const a=i.getErrorCode()===Ei.NO_ERROR,l=i.getStatus();if(!a||fC(l,this.additionalRetryCodes_)&&this.retry){const d=i.getErrorCode()===Ei.ABORT;r(!1,new Ic(!1,null,d));return}const u=this.successCodes_.indexOf(l)!==-1;r(!0,new Ic(u,i))})},n=(r,s)=>{const i=this.resolve_,o=this.reject_,a=s.connection;if(s.wasSuccessCode)try{const l=this.callback_(a,a.getResponse());LF(l)?i(l):i()}catch(l){o(l)}else if(a!==null){const l=L0();l.serverResponse=a.getErrorText(),this.errorCallback_?o(this.errorCallback_(a,l)):o(l)}else if(s.canceled){const l=this.appDelete_?dC():uC();o(l)}else{const l=lC();o(l)}};this.canceled_?n(!1,new Ic(!1,null,!0)):this.backoffId_=OF(e,n,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&MF(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class Ic{constructor(e,n,r){this.wasSuccessCode=e,this.connection=n,this.canceled=!!r}}function UF(t,e){e!==null&&e.length>0&&(t.Authorization="Firebase "+e)}function BF(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function zF(t,e){e&&(t["X-Firebase-GMPID"]=e)}function $F(t,e){e!==null&&(t["X-Firebase-AppCheck"]=e)}function qF(t,e,n,r,s,i,o=!0){const a=hC(t.urlParams),l=t.url+a,u=Object.assign({},t.headers);return zF(u,e),UF(u,n),BF(u,i),$F(u,r),new FF(l,t.method,u,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,s,o)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HF(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function WF(...t){const e=HF();if(e!==void 0){const n=new e;for(let r=0;r<t.length;r++)n.append(t[r]);return n.getBlob()}else{if(V0())return new Blob(t);throw new je(Ne.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function KF(t,e,n){return t.webkitSlice?t.webkitSlice(e,n):t.mozSlice?t.mozSlice(e,n):t.slice?t.slice(e,n):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GF(t){if(typeof atob>"u")throw RF("base-64");return atob(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jn={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class xp{constructor(e,n){this.data=e,this.contentType=n||null}}function QF(t,e){switch(t){case Jn.RAW:return new xp(pC(e));case Jn.BASE64:case Jn.BASE64URL:return new xp(mC(t,e));case Jn.DATA_URL:return new xp(YF(e),XF(e))}throw L0()}function pC(t){const e=[];for(let n=0;n<t.length;n++){let r=t.charCodeAt(n);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|r&63);else if((r&64512)===55296)if(!(n<t.length-1&&(t.charCodeAt(n+1)&64512)===56320))e.push(239,191,189);else{const i=r,o=t.charCodeAt(++n);r=65536|(i&1023)<<10|o&1023,e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|r&63)}else(r&64512)===56320?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|r&63)}return new Uint8Array(e)}function JF(t){let e;try{e=decodeURIComponent(t)}catch{throw Tl(Jn.DATA_URL,"Malformed data URL.")}return pC(e)}function mC(t,e){switch(t){case Jn.BASE64:{const s=e.indexOf("-")!==-1,i=e.indexOf("_")!==-1;if(s||i)throw Tl(t,"Invalid character '"+(s?"-":"_")+"' found: is it base64url encoded?");break}case Jn.BASE64URL:{const s=e.indexOf("+")!==-1,i=e.indexOf("/")!==-1;if(s||i)throw Tl(t,"Invalid character '"+(s?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=GF(e)}catch(s){throw s.message.includes("polyfill")?s:Tl(t,"Invalid character found")}const r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r}class gC{constructor(e){this.base64=!1,this.contentType=null;const n=e.match(/^data:([^,]+)?,/);if(n===null)throw Tl(Jn.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const r=n[1]||null;r!=null&&(this.base64=ZF(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=e.substring(e.indexOf(",")+1)}}function YF(t){const e=new gC(t);return e.base64?mC(Jn.BASE64,e.rest):JF(e.rest)}function XF(t){return new gC(t).contentType}function ZF(t,e){return t.length>=e.length?t.substring(t.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class as{constructor(e,n){let r=0,s="";Yx(e)?(this.data_=e,r=e.size,s=e.type):e instanceof ArrayBuffer?(n?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(n?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=s}size(){return this.size_}type(){return this.type_}slice(e,n){if(Yx(this.data_)){const r=this.data_,s=KF(r,e,n);return s===null?null:new as(s)}else{const r=new Uint8Array(this.data_.buffer,e,n-e);return new as(r,!0)}}static getBlob(...e){if(V0()){const n=e.map(r=>r instanceof as?r.data_:r);return new as(WF.apply(null,n))}else{const n=e.map(o=>Xh(o)?QF(Jn.RAW,o).data:o.data_);let r=0;n.forEach(o=>{r+=o.byteLength});const s=new Uint8Array(r);let i=0;return n.forEach(o=>{for(let a=0;a<o.length;a++)s[i++]=o[a]}),new as(s,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yC(t){let e;try{e=JSON.parse(t)}catch{return null}return jF(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function e4(t){if(t.length===0)return null;const e=t.lastIndexOf("/");return e===-1?"":t.slice(0,e)}function t4(t,e){const n=e.split("/").filter(r=>r.length>0).join("/");return t.length===0?n:t+"/"+n}function vC(t){const e=t.lastIndexOf("/",t.length-2);return e===-1?t:t.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function n4(t,e){return e}let Vt=class{constructor(e,n,r,s){this.server=e,this.local=n||e,this.writable=!!r,this.xform=s||n4}},Cc=null;function r4(t){return!Xh(t)||t.length<2?t:vC(t)}function _C(){if(Cc)return Cc;const t=[];t.push(new Vt("bucket")),t.push(new Vt("generation")),t.push(new Vt("metageneration")),t.push(new Vt("name","fullPath",!0));function e(i,o){return r4(o)}const n=new Vt("name");n.xform=e,t.push(n);function r(i,o){return o!==void 0?Number(o):o}const s=new Vt("size");return s.xform=r,t.push(s),t.push(new Vt("timeCreated")),t.push(new Vt("updated")),t.push(new Vt("md5Hash",null,!0)),t.push(new Vt("cacheControl",null,!0)),t.push(new Vt("contentDisposition",null,!0)),t.push(new Vt("contentEncoding",null,!0)),t.push(new Vt("contentLanguage",null,!0)),t.push(new Vt("contentType",null,!0)),t.push(new Vt("metadata","customMetadata",!0)),Cc=t,Cc}function s4(t,e){function n(){const r=t.bucket,s=t.fullPath,i=new dn(r,s);return e._makeStorageReference(i)}Object.defineProperty(t,"ref",{get:n})}function i4(t,e,n){const r={};r.type="file";const s=n.length;for(let i=0;i<s;i++){const o=n[i];r[o.local]=o.xform(r,e[o.server])}return s4(r,t),r}function wC(t,e,n){const r=yC(e);return r===null?null:i4(t,r,n)}function o4(t,e,n,r){const s=yC(e);if(s===null||!Xh(s.downloadTokens))return null;const i=s.downloadTokens;if(i.length===0)return null;const o=encodeURIComponent;return i.split(",").map(u=>{const d=t.bucket,h=t.fullPath,f="/b/"+o(d)+"/o/"+o(h),m=Sa(f,n,r),y=hC({alt:"media",token:u});return m+y})[0]}function xC(t,e){const n={},r=e.length;for(let s=0;s<r;s++){const i=e[s];i.writable&&(n[i.server]=t[i.local])}return JSON.stringify(n)}class Yi{constructor(e,n,r,s){this.url=e,this.method=n,this.handler=r,this.timeout=s,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ar(t){if(!t)throw L0()}function j0(t,e){function n(r,s){const i=wC(t,s,e);return Ar(i!==null),i}return n}function a4(t,e){function n(r,s){const i=wC(t,s,e);return Ar(i!==null),o4(i,s,t.host,t._protocol)}return n}function Vu(t){function e(n,r){let s;return n.getStatus()===401?n.getErrorText().includes("Firebase App Check token is invalid")?s=bF():s=SF():n.getStatus()===402?s=EF(t.bucket):n.getStatus()===403?s=TF(t.path):s=r,s.status=n.getStatus(),s.serverResponse=r.serverResponse,s}return e}function F0(t){const e=Vu(t);function n(r,s){let i=e(r,s);return r.getStatus()===404&&(i=xF(t.path)),i.serverResponse=s.serverResponse,i}return n}function l4(t,e,n){const r=e.fullServerUrl(),s=Sa(r,t.host,t._protocol),i="GET",o=t.maxOperationRetryTime,a=new Yi(s,i,j0(t,n),o);return a.errorHandler=F0(e),a}function u4(t,e,n){const r=e.fullServerUrl(),s=Sa(r,t.host,t._protocol),i="GET",o=t.maxOperationRetryTime,a=new Yi(s,i,a4(t,n),o);return a.errorHandler=F0(e),a}function c4(t,e){const n=e.fullServerUrl(),r=Sa(n,t.host,t._protocol),s="DELETE",i=t.maxOperationRetryTime;function o(l,u){}const a=new Yi(r,s,o,i);return a.successCodes=[200,204],a.errorHandler=F0(e),a}function d4(t,e){return t&&t.contentType||e&&e.type()||"application/octet-stream"}function EC(t,e,n){const r=Object.assign({},n);return r.fullPath=t.path,r.size=e.size(),r.contentType||(r.contentType=d4(null,e)),r}function h4(t,e,n,r,s){const i=e.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};function a(){let b="";for(let N=0;N<2;N++)b=b+Math.random().toString().slice(2);return b}const l=a();o["Content-Type"]="multipart/related; boundary="+l;const u=EC(e,r,s),d=xC(u,n),h="--"+l+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+d+`\r
--`+l+`\r
Content-Type: `+u.contentType+`\r
\r
`,f=`\r
--`+l+"--",m=as.getBlob(h,r,f);if(m===null)throw cC();const y={name:u.fullPath},v=Sa(i,t.host,t._protocol),w="POST",x=t.maxUploadRetryTime,S=new Yi(v,w,j0(t,n),x);return S.urlParams=y,S.headers=o,S.body=m.uploadData(),S.errorHandler=Vu(e),S}class Jd{constructor(e,n,r,s){this.current=e,this.total=n,this.finalized=!!r,this.metadata=s||null}}function U0(t,e){let n=null;try{n=t.getResponseHeader("X-Goog-Upload-Status")}catch{Ar(!1)}return Ar(!!n&&(e||["active"]).indexOf(n)!==-1),n}function f4(t,e,n,r,s){const i=e.bucketOnlyServerUrl(),o=EC(e,r,s),a={name:o.fullPath},l=Sa(i,t.host,t._protocol),u="POST",d={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${r.size()}`,"X-Goog-Upload-Header-Content-Type":o.contentType,"Content-Type":"application/json; charset=utf-8"},h=xC(o,n),f=t.maxUploadRetryTime;function m(v){U0(v);let w;try{w=v.getResponseHeader("X-Goog-Upload-URL")}catch{Ar(!1)}return Ar(Xh(w)),w}const y=new Yi(l,u,m,f);return y.urlParams=a,y.headers=d,y.body=h,y.errorHandler=Vu(e),y}function p4(t,e,n,r){const s={"X-Goog-Upload-Command":"query"};function i(u){const d=U0(u,["active","final"]);let h=null;try{h=u.getResponseHeader("X-Goog-Upload-Size-Received")}catch{Ar(!1)}h||Ar(!1);const f=Number(h);return Ar(!isNaN(f)),new Jd(f,r.size(),d==="final")}const o="POST",a=t.maxUploadRetryTime,l=new Yi(n,o,i,a);return l.headers=s,l.errorHandler=Vu(e),l}const Zx=256*1024;function m4(t,e,n,r,s,i,o,a){const l=new Jd(0,0);if(o?(l.current=o.current,l.total=o.total):(l.current=0,l.total=r.size()),r.size()!==l.total)throw AF();const u=l.total-l.current;let d=u;s>0&&(d=Math.min(d,s));const h=l.current,f=h+d;let m="";d===0?m="finalize":u===d?m="upload, finalize":m="upload";const y={"X-Goog-Upload-Command":m,"X-Goog-Upload-Offset":`${l.current}`},v=r.slice(h,f);if(v===null)throw cC();function w(N,M){const V=U0(N,["active","final"]),k=l.current+d,E=r.size();let I;return V==="final"?I=j0(e,i)(N,M):I=null,new Jd(k,E,V==="final",I)}const x="POST",S=e.maxUploadRetryTime,b=new Yi(n,x,w,S);return b.headers=y,b.body=v.uploadData(),b.progressCallback=a||null,b.errorHandler=Vu(t),b}const Kt={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function Ep(t){switch(t){case"running":case"pausing":case"canceling":return Kt.RUNNING;case"paused":return Kt.PAUSED;case"success":return Kt.SUCCESS;case"canceled":return Kt.CANCELED;case"error":return Kt.ERROR;default:return Kt.ERROR}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g4{constructor(e,n,r){if(VF(e)||n!=null||r!=null)this.next=e,this.error=n??void 0,this.complete=r??void 0;else{const i=e;this.next=i.next,this.error=i.error,this.complete=i.complete}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function so(t){return(...e)=>{Promise.resolve().then(()=>t(...e))}}class y4{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Ei.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Ei.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Ei.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,n,r,s){if(this.sent_)throw Ka("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(n,e,!0),s!==void 0)for(const i in s)s.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,s[i].toString());return r!==void 0?this.xhr_.send(r):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Ka("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Ka("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw Ka("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Ka("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class v4 extends y4{initXhr(){this.xhr_.responseType="text"}}function li(){return new v4}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _4{constructor(e,n,r=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=n,this._metadata=r,this._mappings=_C(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=s=>{if(this._request=void 0,this._chunkMultiplier=1,s._codeEquals(Ne.CANCELED))this._needToFetchStatus=!0,this.completeTransitions_();else{const i=this.isExponentialBackoffExpired();if(fC(s.status,[]))if(i)s=lC();else{this.sleepTime=Math.max(this.sleepTime*2,wF),this._needToFetchStatus=!0,this.completeTransitions_();return}this._error=s,this._transition("error")}},this._metadataErrorHandler=s=>{this._request=void 0,s._codeEquals(Ne.CANCELED)?this.completeTransitions_():(this._error=s,this._transition("error"))},this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise((s,i)=>{this._resolve=s,this._reject=i,this._start()}),this._promise.then(null,()=>{})}isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}_makeProgressCallback(){const e=this._transferred;return n=>this._updateProgress(e+n)}_shouldDoResumable(e){return e.size()>256*1024}_start(){this._state==="running"&&this._request===void 0&&(this._resumable?this._uploadUrl===void 0?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout(()=>{this.pendingTimeout=void 0,this._continueUpload()},this.sleepTime):this._oneShotUpload())}_resolveToken(e){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([n,r])=>{switch(this._state){case"running":e(n,r);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused");break}})}_createResumable(){this._resolveToken((e,n)=>{const r=f4(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),s=this._ref.storage._makeRequest(r,li,e,n);this._request=s,s.getPromise().then(i=>{this._request=void 0,this._uploadUrl=i,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){const e=this._uploadUrl;this._resolveToken((n,r)=>{const s=p4(this._ref.storage,this._ref._location,e,this._blob),i=this._ref.storage._makeRequest(s,li,n,r);this._request=i,i.getPromise().then(o=>{o=o,this._request=void 0,this._updateProgress(o.current),this._needToFetchStatus=!1,o.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){const e=Zx*this._chunkMultiplier,n=new Jd(this._transferred,this._blob.size()),r=this._uploadUrl;this._resolveToken((s,i)=>{let o;try{o=m4(this._ref._location,this._ref.storage,r,this._blob,e,this._mappings,n,this._makeProgressCallback())}catch(l){this._error=l,this._transition("error");return}const a=this._ref.storage._makeRequest(o,li,s,i,!1);this._request=a,a.getPromise().then(l=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(l.current),l.finalized?(this._metadata=l.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){Zx*this._chunkMultiplier*2<32*1024*1024&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((e,n)=>{const r=l4(this._ref.storage,this._ref._location,this._mappings),s=this._ref.storage._makeRequest(r,li,e,n);this._request=s,s.getPromise().then(i=>{this._request=void 0,this._metadata=i,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((e,n)=>{const r=h4(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),s=this._ref.storage._makeRequest(r,li,e,n);this._request=s,s.getPromise().then(i=>{this._request=void 0,this._metadata=i,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(e){const n=this._transferred;this._transferred=e,this._transferred!==n&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,this._request!==void 0?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":const n=this._state==="paused";this._state=e,n&&(this._notifyObservers(),this._start());break;case"paused":this._state=e,this._notifyObservers();break;case"canceled":this._error=uC(),this._state=e,this._notifyObservers();break;case"error":this._state=e,this._notifyObservers();break;case"success":this._state=e,this._notifyObservers();break}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start();break}}get snapshot(){const e=Ep(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,n,r,s){const i=new g4(n||void 0,r||void 0,s||void 0);return this._addObserver(i),()=>{this._removeObserver(i)}}then(e,n){return this._promise.then(e,n)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){const n=this._observers.indexOf(e);n!==-1&&this._observers.splice(n,1)}_notifyObservers(){this._finishPromise(),this._observers.slice().forEach(n=>{this._notifyObserver(n)})}_finishPromise(){if(this._resolve!==void 0){let e=!0;switch(Ep(this._state)){case Kt.SUCCESS:so(this._resolve.bind(null,this.snapshot))();break;case Kt.CANCELED:case Kt.ERROR:const n=this._reject;so(n.bind(null,this._error))();break;default:e=!1;break}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(Ep(this._state)){case Kt.RUNNING:case Kt.PAUSED:e.next&&so(e.next.bind(e,this.snapshot))();break;case Kt.SUCCESS:e.complete&&so(e.complete.bind(e))();break;case Kt.CANCELED:case Kt.ERROR:e.error&&so(e.error.bind(e,this._error))();break;default:e.error&&so(e.error.bind(e,this._error))()}}resume(){const e=this._state==="paused"||this._state==="pausing";return e&&this._transition("running"),e}pause(){const e=this._state==="running";return e&&this._transition("pausing"),e}cancel(){const e=this._state==="running"||this._state==="pausing";return e&&this._transition("canceling"),e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ui{constructor(e,n){this._service=e,n instanceof dn?this._location=n:this._location=dn.makeFromUrl(n,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,n){return new Ui(e,n)}get root(){const e=new dn(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return vC(this._location.path)}get storage(){return this._service}get parent(){const e=e4(this._location.path);if(e===null)return null;const n=new dn(this._location.bucket,e);return new Ui(this._service,n)}_throwIfRoot(e){if(this._location.path==="")throw PF(e)}}function w4(t,e,n){return t._throwIfRoot("uploadBytesResumable"),new _4(t,new as(e),n)}function x4(t){t._throwIfRoot("getDownloadURL");const e=u4(t.storage,t._location,_C());return t.storage.makeRequestWithTokens(e,li).then(n=>{if(n===null)throw NF();return n})}function E4(t){t._throwIfRoot("deleteObject");const e=c4(t.storage,t._location);return t.storage.makeRequestWithTokens(e,li)}function S4(t,e){const n=t4(t._location.path,e),r=new dn(t._location.bucket,n);return new Ui(t.storage,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function b4(t){return/^[A-Za-z]+:\/\//.test(t)}function T4(t,e){return new Ui(t,e)}function SC(t,e){if(t instanceof B0){const n=t;if(n._bucket==null)throw CF();const r=new Ui(n,n._bucket);return e!=null?SC(r,e):r}else return e!==void 0?S4(t,e):t}function k4(t,e){if(e&&b4(e)){if(t instanceof B0)return T4(t,e);throw mg("To use ref(service, url), the first argument must be a Storage instance.")}else return SC(t,e)}function eE(t,e){const n=e==null?void 0:e[aC];return n==null?null:dn.makeFromBucketSpec(n,t)}function I4(t,e,n,r={}){t.host=`${e}:${n}`,t._protocol="http";const{mockUserToken:s}=r;s&&(t._overrideAuthToken=typeof s=="string"?s:YT(s,t.app.options.projectId))}class B0{constructor(e,n,r,s,i){this.app=e,this._authProvider=n,this._appCheckProvider=r,this._url=s,this._firebaseVersion=i,this._bucket=null,this._host=oC,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=vF,this._maxUploadRetryTime=_F,this._requests=new Set,s!=null?this._bucket=dn.makeFromBucketSpec(s,this._host):this._bucket=eE(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=dn.makeFromBucketSpec(this._url,e):this._bucket=eE(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Xx("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Xx("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const n=await e.getToken();if(n!==null)return n.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Ui(this,e)}_makeRequest(e,n,r,s,i=!0){if(this._deleted)return new DF(dC());{const o=qF(e,this._appId,r,s,n,this._firebaseVersion,i);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}async makeRequestWithTokens(e,n){const[r,s]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,n,r,s).getPromise()}}const tE="@firebase/storage",nE="0.13.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bC="storage";function C4(t,e,n){return t=Ae(t),w4(t,e,n)}function A4(t){return t=Ae(t),x4(t)}function N4(t){return t=Ae(t),E4(t)}function Sp(t,e){return t=Ae(t),k4(t,e)}function R4(t=Fy(),e){t=Ae(t);const r=Ch(t,bC).getImmediate({identifier:e}),s=GT("storage");return s&&P4(r,...s),r}function P4(t,e,n,r={}){I4(t,e,n,r)}function D4(t,{instanceIdentifier:e}){const n=t.getProvider("app").getImmediate(),r=t.getProvider("auth-internal"),s=t.getProvider("app-check-internal");return new B0(n,r,s,e,Ki)}function O4(){Oi(new Ms(bC,D4,"PUBLIC").setMultipleInstances(!0)),er(tE,nE,""),er(tE,nE,"esm2017")}O4();const M4={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_BASE_URL:"https://us-central1-stenographer-dev.cloudfunctions.net",VITE_ENV:"development",VITE_FIREBASE_API_KEY:"AIzaSyDJJjKRAe6DfGflaHgGSDCd9ynQKbQqDGE",VITE_FIREBASE_APP_ID:"1:460595345839:web:6915a4b6280b403d73975a",VITE_FIREBASE_AUTH_DOMAIN:"stenographer-dev.firebaseapp.com",VITE_FIREBASE_MESSAGING_SENDER_ID:"460595345839",VITE_FIREBASE_PROJECT_ID:"stenographer-dev",VITE_FIREBASE_STORAGE_BUCKET:"stenographer-dev.firebasestorage.app"},L4={apiKey:"AIzaSyDJJjKRAe6DfGflaHgGSDCd9ynQKbQqDGE",authDomain:"stenographer-dev.firebaseapp.com",projectId:"stenographer-dev",storageBucket:"stenographer-dev.firebasestorage.app",messagingSenderId:"460595345839",appId:"1:460595345839:web:6915a4b6280b403d73975a"},V4=["VITE_FIREBASE_API_KEY","VITE_FIREBASE_AUTH_DOMAIN","VITE_FIREBASE_PROJECT_ID","VITE_FIREBASE_STORAGE_BUCKET","VITE_FIREBASE_MESSAGING_SENDER_ID","VITE_FIREBASE_APP_ID"],rE=V4.filter(t=>!M4[t]);if(rE.length>0)throw new Error(`Missing required Firebase environment variables: ${rE.join(", ")}`);let su;Bw().length===0?su=ek(L4):su=Bw()[0];const Gn=gL(su),le=nF(su),bp=R4(su);class Ga{static async signUp(e){try{const{email:n,password:r,displayName:s,role:i}=e,o=await XM(Gn,n,r);if(o.user){await t2(o.user,{displayName:s});const a=Ie(le,"users",o.user.uid);await rC(a,{email:n,displayName:s,role:i,createdAt:xe(),lastLoginAt:xe()},{merge:!0})}return o.user}catch(n){throw new Error(this.getErrorMessage(n))}}static async signIn(e){try{const{email:n,password:r}=e;return(await ZM(Gn,n,r)).user}catch(n){throw new Error(this.getErrorMessage(n))}}static async signInWithGoogle(){try{const e=new _r;return e.addScope("profile"),e.addScope("email"),(await T2(Gn,e)).user}catch(e){throw new Error(this.getErrorMessage(e))}}static async signOut(){try{await i2(Gn)}catch(e){throw new Error(this.getErrorMessage(e))}}static onAuthStateChanged(e){return s2(Gn,e)}static getCurrentUser(){return Gn.currentUser}static getErrorMessage(e){switch(e.code){case"auth/email-already-in-use":return"This email is already registered. Please sign in instead.";case"auth/invalid-email":return"Invalid email address. Please check and try again.";case"auth/operation-not-allowed":return"This sign-in method is not enabled. Please contact support.";case"auth/weak-password":return"Password is too weak. Please use at least 6 characters.";case"auth/user-disabled":return"This account has been disabled. Please contact support.";case"auth/user-not-found":return"No account found with this email. Please sign up first.";case"auth/wrong-password":return"Incorrect password. Please try again.";case"auth/invalid-credential":return"Invalid email or password. Please try again.";case"auth/popup-closed-by-user":return"Sign-in popup was closed. Please try again.";case"auth/cancelled-popup-request":return"Only one popup request is allowed at a time.";case"auth/popup-blocked":return"Popup was blocked by your browser. Please allow popups and try again.";default:return e.message||"An error occurred during authentication."}}}const TC=R.createContext(void 0),_t=()=>{const t=R.useContext(TC);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t},j4=({children:t})=>{const[e,n]=R.useState(null),[r,s]=R.useState(null),[i,o]=R.useState(!0),[a,l]=R.useState(null),u=async w=>{var x,S;try{const b=Ie(le,"users",w.uid),N=await Bs(b);if(N.exists()){const M=N.data();s({userId:w.uid,email:M.email||w.email||"",displayName:M.displayName||w.displayName||"",role:M.role||"paralegal",createdAt:((x=M.createdAt)==null?void 0:x.toDate())||new Date,lastLoginAt:((S=M.lastLoginAt)==null?void 0:S.toDate())||new Date})}else s({userId:w.uid,email:w.email||"",displayName:w.displayName||"",role:"paralegal",createdAt:new Date,lastLoginAt:new Date})}catch(b){console.error("Error fetching user profile:",b),l("Failed to load user profile")}},d=async()=>{e&&await u(e)};R.useEffect(()=>{o(!0);const w=Ga.onAuthStateChanged(async x=>{n(x),l(null),x?await u(x):s(null),o(!1)});return()=>w()},[]);const v={user:e,userProfile:r,loading:i,error:a,signUp:async w=>{try{l(null),o(!0),await Ga.signUp(w)}catch(x){throw l(x.message),x}finally{o(!1)}},signIn:async w=>{try{l(null),o(!0),await Ga.signIn(w)}catch(x){throw l(x.message),x}finally{o(!1)}},signInWithGoogle:async()=>{try{l(null),o(!0),await Ga.signInWithGoogle()}catch(w){throw l(w.message),w}finally{o(!1)}},signOut:async()=>{try{l(null),o(!0),await Ga.signOut(),n(null),s(null)}catch(w){throw l(w.message),w}finally{o(!1)}},refreshUserProfile:d};return p.jsx(TC.Provider,{value:v,children:t})},io=({children:t})=>{const{user:e,loading:n}=_t();return n?p.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:p.jsxs("div",{className:"text-center",children:[p.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),p.jsx("p",{className:"mt-2 text-gray-600",children:"Loading..."})]})}):e?p.jsx(p.Fragment,{children:t}):p.jsx(Bm,{to:"/login",replace:!0})};class F4 extends R.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,n){console.error("ErrorBoundary caught an error:",e,n)}render(){var e;return this.state.hasError?this.props.fallback?this.props.fallback:p.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center px-4",children:p.jsxs("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-6",children:[p.jsx("div",{className:"flex items-center justify-center w-12 h-12 mx-auto bg-red-100 rounded-full",children:p.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),p.jsx("h2",{className:"mt-4 text-lg font-semibold text-gray-900 text-center",children:"Something went wrong"}),p.jsx("p",{className:"mt-2 text-sm text-gray-600 text-center",children:((e=this.state.error)==null?void 0:e.message)||"An unexpected error occurred"}),p.jsx("button",{onClick:()=>{this.setState({hasError:!1,error:null}),window.location.reload()},className:"mt-4 w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Reload Page"})]})}):this.props.children}}function kC(t){return!t||t.trim()===""?{isValid:!1,error:"Email is required"}:/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)?{isValid:!0}:{isValid:!1,error:"Please enter a valid email address"}}function U4(t){return!t||t.trim()===""?{isValid:!1,error:"Password is required"}:t.length<6?{isValid:!1,error:"Password must be at least 6 characters long"}:t.length<8?{isValid:!0}:{isValid:!0}}function B4(t){return!t||t.trim()===""?{isValid:!1,error:"Display name is required"}:t.trim().length<2?{isValid:!1,error:"Display name must be at least 2 characters"}:t.trim().length>50?{isValid:!1,error:"Display name must be less than 50 characters"}:{isValid:!0}}function z4(t){return!t||t!=="attorney"&&t!=="paralegal"?{isValid:!1,error:"Please select a valid role (Attorney or Paralegal)"}:{isValid:!0}}function $4(t){const e={},n=kC(t.email);n.isValid||(e.email=n.error);const r=U4(t.password);r.isValid||(e.password=r.error),t.password!==t.confirmPassword&&(e.confirmPassword="Passwords do not match");const s=B4(t.displayName);s.isValid||(e.displayName=s.error);const i=z4(t.role);return i.isValid||(e.role=i.error),{isValid:Object.keys(e).length===0,errors:e}}function q4(t){const e={},n=kC(t.email);return n.isValid||(e.email=n.error),(!t.password||t.password.trim()==="")&&(e.password="Password is required"),{isValid:Object.keys(e).length===0,errors:e}}function H4(t){const e=[".pdf",".docx",".txt"],n=t.name.toLowerCase().substring(t.name.lastIndexOf("."));if(!e.includes(n))return{isValid:!1,error:"File type not allowed. Allowed types: PDF, DOCX, TXT"};let r;return n===".pdf"?r="pdf":n===".docx"?r="docx":r="txt",{isValid:!0,fileType:r}}function W4(t){return t.size>10485760?{isValid:!1,error:`File size exceeds 10MB limit. Current size: ${(t.size/1024/1024).toFixed(2)}MB`}:{isValid:!0}}function K4(t){const e=H4(t);if(!e.isValid)return e;const n=W4(t);return n.isValid?{isValid:!0,fileType:e.fileType}:n}function gg(t){if(t===0)return"0 Bytes";const e=1024,n=["Bytes","KB","MB","GB"],r=Math.floor(Math.log(t)/Math.log(e));return Math.round(t/Math.pow(e,r)*100)/100+" "+n[r]}const G4=({onSuccess:t})=>{const{signIn:e,loading:n,error:r}=_t(),[s,i]=R.useState({email:"",password:""}),[o,a]=R.useState({}),[l,u]=R.useState(!1),d=f=>{const{name:m,value:y}=f.target;i(v=>({...v,[m]:y})),o[m]&&a(v=>({...v,[m]:void 0}))},h=async f=>{f.preventDefault(),u(!0),a({});const m=q4(s);if(!m.isValid){a(m.errors),u(!1);return}try{await e(s),t==null||t()}catch(y){console.error("Login error:",y)}finally{u(!1)}};return p.jsxs("form",{onSubmit:h,className:"space-y-4",children:[p.jsxs("div",{children:[p.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),p.jsx("input",{type:"email",id:"email",name:"email",value:s.email,onChange:d,className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ${o.email?"border-red-500":"border-gray-300"}`,placeholder:"you@example.com",disabled:l||n}),o.email&&p.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.email})]}),p.jsxs("div",{children:[p.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),p.jsx("input",{type:"password",id:"password",name:"password",value:s.password,onChange:d,className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ${o.password?"border-red-500":"border-gray-300"}`,placeholder:"",disabled:l||n}),o.password&&p.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.password})]}),r&&p.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md",children:p.jsx("p",{className:"text-sm text-red-600",children:r})}),p.jsx("button",{type:"submit",disabled:l||n,className:"w-full py-2 px-4 bg-blue-600 text-white font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:l||n?"Signing in...":"Sign In"})]})},IC=({onSuccess:t,variant:e="default",className:n=""})=>{const{signInWithGoogle:r,loading:s,error:i}=_t(),[o,a]=R.useState(!1),l=async()=>{a(!0);try{await r(),t==null||t()}catch(h){console.error("Google sign-in error:",h)}finally{a(!1)}},u="w-full py-2 px-4 font-medium rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",d=e==="outline"?"border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 focus:ring-gray-500":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-50 focus:ring-gray-500";return p.jsxs("div",{children:[p.jsxs("button",{type:"button",onClick:l,disabled:o||s,className:`${u} ${d} ${n}`,children:[p.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[p.jsx("path",{d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z",fill:"#4285F4"}),p.jsx("path",{d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z",fill:"#34A853"}),p.jsx("path",{d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z",fill:"#FBBC05"}),p.jsx("path",{d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z",fill:"#EA4335"})]}),o||s?"Signing in...":"Continue with Google"]}),i&&p.jsx("p",{className:"mt-2 text-sm text-red-600 text-center",children:i})]})},Q4=()=>{const t=$r(),{user:e}=_t();if(e)return t("/dashboard"),null;const n=()=>{t("/dashboard")};return p.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8",children:p.jsxs("div",{className:"max-w-md w-full space-y-8",children:[p.jsxs("div",{children:[p.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Sign in to Stenographer"}),p.jsxs("p",{className:"mt-2 text-center text-sm text-gray-600",children:["Or"," ",p.jsx(Bn,{to:"/signup",className:"font-medium text-blue-600 hover:text-blue-500",children:"create a new account"})]})]}),p.jsxs("div",{className:"bg-white py-8 px-6 shadow rounded-lg",children:[p.jsx(G4,{onSuccess:n}),p.jsxs("div",{className:"mt-6",children:[p.jsxs("div",{className:"relative",children:[p.jsx("div",{className:"absolute inset-0 flex items-center",children:p.jsx("div",{className:"w-full border-t border-gray-300"})}),p.jsx("div",{className:"relative flex justify-center text-sm",children:p.jsx("span",{className:"px-2 bg-white text-gray-500",children:"Or continue with"})})]}),p.jsx("div",{className:"mt-6",children:p.jsx(IC,{onSuccess:n})})]})]})]})})},J4=({onSuccess:t})=>{const{signUp:e,loading:n,error:r}=_t(),[s,i]=R.useState({email:"",password:"",confirmPassword:"",displayName:"",role:"paralegal"}),[o,a]=R.useState({}),[l,u]=R.useState(!1),d=f=>{const{name:m,value:y}=f.target;i(v=>({...v,[m]:y})),o[m]&&a(v=>({...v,[m]:void 0}))},h=async f=>{f.preventDefault(),u(!0),a({});const m=$4(s);if(!m.isValid){a(m.errors),u(!1);return}try{await e({email:s.email,password:s.password,displayName:s.displayName,role:s.role}),t==null||t()}catch(y){console.error("Signup error:",y)}finally{u(!1)}};return p.jsxs("form",{onSubmit:h,className:"space-y-4",children:[p.jsxs("div",{children:[p.jsx("label",{htmlFor:"displayName",className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Name"}),p.jsx("input",{type:"text",id:"displayName",name:"displayName",value:s.displayName,onChange:d,className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ${o.displayName?"border-red-500":"border-gray-300"}`,placeholder:"John Doe",disabled:l||n}),o.displayName&&p.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.displayName})]}),p.jsxs("div",{children:[p.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),p.jsx("input",{type:"email",id:"email",name:"email",value:s.email,onChange:d,className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ${o.email?"border-red-500":"border-gray-300"}`,placeholder:"you@example.com",disabled:l||n}),o.email&&p.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.email})]}),p.jsxs("div",{children:[p.jsx("label",{htmlFor:"role",className:"block text-sm font-medium text-gray-700 mb-1",children:"Role"}),p.jsxs("select",{id:"role",name:"role",value:s.role,onChange:d,className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ${o.role?"border-red-500":"border-gray-300"}`,disabled:l||n,children:[p.jsx("option",{value:"paralegal",children:"Paralegal"}),p.jsx("option",{value:"attorney",children:"Attorney"})]}),o.role&&p.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.role})]}),p.jsxs("div",{children:[p.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),p.jsx("input",{type:"password",id:"password",name:"password",value:s.password,onChange:d,className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ${o.password?"border-red-500":"border-gray-300"}`,placeholder:"",disabled:l||n}),o.password&&p.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.password}),p.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Must be at least 6 characters"})]}),p.jsxs("div",{children:[p.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirm Password"}),p.jsx("input",{type:"password",id:"confirmPassword",name:"confirmPassword",value:s.confirmPassword,onChange:d,className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ${o.confirmPassword?"border-red-500":"border-gray-300"}`,placeholder:"",disabled:l||n}),o.confirmPassword&&p.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.confirmPassword})]}),r&&p.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md",children:p.jsx("p",{className:"text-sm text-red-600",children:r})}),p.jsx("button",{type:"submit",disabled:l||n,className:"w-full py-2 px-4 bg-blue-600 text-white font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:l||n?"Creating account...":"Create Account"})]})},Y4=()=>{const t=$r(),{user:e}=_t();if(e)return t("/dashboard"),null;const n=()=>{t("/dashboard")};return p.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8",children:p.jsxs("div",{className:"max-w-md w-full space-y-8",children:[p.jsxs("div",{children:[p.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Create your account"}),p.jsxs("p",{className:"mt-2 text-center text-sm text-gray-600",children:["Already have an account?"," ",p.jsx(Bn,{to:"/login",className:"font-medium text-blue-600 hover:text-blue-500",children:"Sign in"})]})]}),p.jsxs("div",{className:"bg-white py-8 px-6 shadow rounded-lg",children:[p.jsx(J4,{onSuccess:n}),p.jsxs("div",{className:"mt-6",children:[p.jsxs("div",{className:"relative",children:[p.jsx("div",{className:"absolute inset-0 flex items-center",children:p.jsx("div",{className:"w-full border-t border-gray-300"})}),p.jsx("div",{className:"relative flex justify-center text-sm",children:p.jsx("span",{className:"px-2 bg-white text-gray-500",children:"Or continue with"})})]}),p.jsx("div",{className:"mt-6",children:p.jsx(IC,{onSuccess:n})})]})]})]})})};class Si{static async createMatter(e,n){try{const r={title:e.title.trim(),clientName:e.clientName.trim(),status:e.status||"active",participants:e.participants||[n],createdBy:n,createdAt:xe(),updatedAt:xe()};return(await Lu(tn(le,"matters"),r)).id}catch(r){throw new Error(`Failed to create matter: ${r.message}`)}}static async getMatter(e){var n,r;try{const s=Ie(le,"matters",e),i=await Bs(s);if(!i.exists())return null;const o=i.data();return{matterId:i.id,title:o.title,clientName:o.clientName,status:o.status,participants:o.participants||[],createdBy:o.createdBy,createdAt:((n=o.createdAt)==null?void 0:n.toDate())||new Date,updatedAt:((r=o.updatedAt)==null?void 0:r.toDate())||new Date}}catch(s){throw new Error(`Failed to get matter: ${s.message}`)}}static async getMatters(e,n){try{let r=Fs(tn(le,"matters"),bl("createdBy","==",e),Us("createdAt","desc"));n!=null&&n.status&&(r=Fs(tn(le,"matters"),bl("createdBy","==",e),bl("status","==",n.status),Us("createdAt","desc")));const s=await Ou(r);let i=[];if(s.forEach(o=>{var l,u;const a=o.data();i.push({matterId:o.id,title:a.title,clientName:a.clientName,status:a.status,participants:a.participants||[],createdBy:a.createdBy,createdAt:((l=a.createdAt)==null?void 0:l.toDate())||new Date,updatedAt:((u=a.updatedAt)==null?void 0:u.toDate())||new Date})}),n!=null&&n.searchQuery){const o=n.searchQuery.toLowerCase();i=i.filter(a=>a.title.toLowerCase().includes(o)||a.clientName.toLowerCase().includes(o))}return i}catch(r){throw new Error(`Failed to get matters: ${r.message}`)}}static async updateMatter(e,n){try{const r=Ie(le,"matters",e),s={updatedAt:xe()};n.title!==void 0&&(s.title=n.title.trim()),n.clientName!==void 0&&(s.clientName=n.clientName.trim()),n.status!==void 0&&(s.status=n.status),n.participants!==void 0&&(s.participants=n.participants),await En(r,s)}catch(r){throw new Error(`Failed to update matter: ${r.message}`)}}static async deleteMatter(e){try{await this.updateMatter(e,{status:"archived"})}catch(n){throw new Error(`Failed to delete matter: ${n.message}`)}}static async permanentlyDeleteMatter(e){try{const n=Ie(le,"matters",e);await Mu(n)}catch(n){throw new Error(`Failed to permanently delete matter: ${n.message}`)}}}const X4=({matter:t})=>{const e=r=>{switch(r){case"active":return"bg-green-100 text-green-800";case"draft":return"bg-yellow-100 text-yellow-800";case"completed":return"bg-blue-100 text-blue-800";case"archived":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},n=r=>(typeof r=="string"?new Date(r):r).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return p.jsx(Bn,{to:`/matters/${t.matterId}`,className:"block bg-white rounded-lg shadow hover:shadow-md transition-shadow p-6 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2","aria-label":`View matter: ${t.title}`,children:p.jsxs("div",{className:"flex items-start justify-between",children:[p.jsxs("div",{className:"flex-1",children:[p.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:t.title}),p.jsx("p",{className:"text-sm text-gray-600 mb-3",children:t.clientName}),p.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[p.jsxs("span",{children:["Created ",n(t.createdAt)]}),t.participants.length>0&&p.jsxs("span",{children:[t.participants.length," participant(s)"]})]})]}),p.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium capitalize ${e(t.status)}`,children:t.status})]})})},Z4=({isOpen:t,onClose:e,onSuccess:n,userId:r})=>{const[s,i]=R.useState({title:"",clientName:"",status:"active"}),[o,a]=R.useState({}),[l,u]=R.useState(!1),d=m=>{const{name:y,value:v}=m.target;i(w=>({...w,[y]:v})),o[y]&&a(w=>({...w,[y]:void 0}))},h=()=>{const m={};return s.title.trim()?s.title.trim().length>100&&(m.title="Title must be less than 100 characters"):m.title="Title is required",s.clientName.trim()?s.clientName.trim().length>100&&(m.clientName="Client name must be less than 100 characters"):m.clientName="Client name is required",a(m),Object.keys(m).length===0},f=async m=>{if(m.preventDefault(),u(!0),!h()){u(!1);return}try{await Si.createMatter(s,r),i({title:"",clientName:"",status:"active"}),a({}),n(),e()}catch(y){console.error("Error creating matter:",y),a({title:y.message||"Failed to create matter"})}finally{u(!1)}};return t?p.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:p.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:p.jsxs("div",{className:"p-6",children:[p.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Create New Matter"}),p.jsxs("form",{onSubmit:f,className:"space-y-4",children:[p.jsxs("div",{children:[p.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 mb-1",children:"Title *"}),p.jsx("input",{type:"text",id:"title",name:"title",value:s.title,onChange:d,className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ${o.title?"border-red-500":"border-gray-300"}`,placeholder:"e.g., Personal Injury Case - John Doe",disabled:l,maxLength:100}),o.title&&p.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.title})]}),p.jsxs("div",{children:[p.jsx("label",{htmlFor:"clientName",className:"block text-sm font-medium text-gray-700 mb-1",children:"Client Name *"}),p.jsx("input",{type:"text",id:"clientName",name:"clientName",value:s.clientName,onChange:d,className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ${o.clientName?"border-red-500":"border-gray-300"}`,placeholder:"e.g., John Doe",disabled:l,maxLength:100}),o.clientName&&p.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.clientName})]}),p.jsxs("div",{children:[p.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),p.jsxs("select",{id:"status",name:"status",value:s.status,onChange:d,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:l,children:[p.jsx("option",{value:"active",children:"Active"}),p.jsx("option",{value:"draft",children:"Draft"}),p.jsx("option",{value:"completed",children:"Completed"}),p.jsx("option",{value:"archived",children:"Archived"})]})]}),o.title&&o.title.includes("Failed")&&p.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md",children:p.jsx("p",{className:"text-sm text-red-600",children:o.title})}),p.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[p.jsx("button",{type:"button",onClick:e,disabled:l,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-500 disabled:opacity-50",children:"Cancel"}),p.jsx("button",{type:"submit",disabled:l,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50",children:l?"Creating...":"Create Matter"})]})]})]})})}):null},z0=({size:t="md",text:e})=>{const n={sm:"h-4 w-4",md:"h-8 w-8",lg:"h-12 w-12"};return p.jsxs("div",{className:"flex flex-col items-center justify-center p-4",children:[p.jsx("div",{className:`${n[t]} border-4 border-gray-200 border-t-blue-600 rounded-full animate-spin`}),e&&p.jsx("p",{className:"mt-2 text-sm text-gray-600",children:e})]})},$0=({icon:t="",title:e,description:n,action:r})=>p.jsxs("div",{className:"text-center py-12 px-4",children:[p.jsx("div",{className:"text-6xl mb-4",children:t}),p.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:e}),n&&p.jsx("p",{className:"text-sm text-gray-500 mb-4 max-w-md mx-auto",children:n}),r&&p.jsx("button",{onClick:r.onClick,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:r.label})]}),eU=()=>{const{user:t,userProfile:e,signOut:n}=_t(),[r,s]=R.useState([]),[i,o]=R.useState(!0),[a,l]=R.useState(null),[u,d]=R.useState("all"),[h,f]=R.useState(""),[m,y]=R.useState(!1),v=(t==null?void 0:t.uid)||"",w=r.filter(b=>{if(!h)return!0;const N=h.toLowerCase();return b.title.toLowerCase().includes(N)||b.clientName.toLowerCase().includes(N)});R.useEffect(()=>{if(!v)return;(async()=>{try{o(!0),l(null);const N=u==="all"?void 0:u,M=await Si.getMatters(v,{status:N,searchQuery:h||void 0});s(M)}catch(N){l(N.message||"Failed to load matters")}finally{o(!1)}})()},[v,u,h]);const x=async()=>{try{await n()}catch(b){console.error("Sign out error:",b)}},S=async()=>{if(v)try{o(!0),l(null);const b=u==="all"?void 0:u,N=await Si.getMatters(v,{status:b,searchQuery:h||void 0});s(N)}catch(b){l(b.message||"Failed to reload matters")}finally{o(!1)}};return p.jsxs("div",{className:"min-h-screen bg-gray-50",children:[p.jsx("header",{className:"bg-white shadow",children:p.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:p.jsxs("div",{className:"flex justify-between items-center",children:[p.jsxs("div",{children:[p.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Stenographer"}),p.jsx("p",{className:"text-sm text-gray-600",children:"Demand Letter Generator"})]}),p.jsxs("div",{className:"flex items-center gap-4",children:[p.jsxs("div",{className:"text-right",children:[p.jsx("p",{className:"text-sm font-medium text-gray-900",children:(e==null?void 0:e.displayName)||(t==null?void 0:t.displayName)||"User"}),p.jsx("p",{className:"text-xs text-gray-500",children:(e==null?void 0:e.role)||"paralegal"})]}),p.jsx("button",{onClick:x,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:"Sign Out"})]})]})})}),p.jsxs("main",{id:"main-content",className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[p.jsxs("div",{className:"mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[p.jsxs("div",{children:[p.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Matters"}),p.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage your legal matters and demand letters"})]}),p.jsx("button",{onClick:()=>y(!0),className:"px-4 py-2 bg-blue-600 text-white font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"+ Create New Matter"})]}),p.jsx("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:p.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[p.jsx("div",{className:"flex-1",children:p.jsx("input",{type:"text",placeholder:"Search by title or client name...",value:h,onChange:b=>f(b.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})}),p.jsx("div",{children:p.jsxs("select",{value:u,onChange:b=>d(b.target.value),className:"px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[p.jsx("option",{value:"all",children:"All Status"}),p.jsx("option",{value:"active",children:"Active"}),p.jsx("option",{value:"draft",children:"Draft"}),p.jsx("option",{value:"completed",children:"Completed"}),p.jsx("option",{value:"archived",children:"Archived"})]})})]})}),a&&p.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-md",children:p.jsx("p",{className:"text-sm text-red-600",children:a})}),i?p.jsx("div",{className:"text-center py-12",children:p.jsx(z0,{size:"lg",text:"Loading matters..."})}):w.length===0?p.jsx($0,{icon:"",title:h||u!=="all"?"No matters found":"You don't have any matters yet",description:h||u!=="all"?"Try adjusting your search or filter criteria.":"Create your first matter to get started with managing your legal cases.",action:{label:"Create Matter",onClick:()=>y(!0)}}):p.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:w.map(b=>p.jsx(X4,{matter:b},b.matterId))})]}),p.jsx(Z4,{isOpen:m,onClose:()=>y(!1),onSuccess:S,userId:v})]})};class jo{static async uploadFile(e,n,r,s){try{const i=Ie(tn(le,"matters",e,"files")).id,o=`matters/${e}/files/${i}_${n.name}`,a=Sp(bp,o),l=C4(a,n);return new Promise((u,d)=>{l.on("state_changed",h=>{const f={bytesTransferred:h.bytesTransferred,totalBytes:h.totalBytes,percentage:Math.round(h.bytesTransferred/h.totalBytes*100)};s==null||s(f)},h=>{d(new Error(`Upload failed: ${h.message}`))},async()=>{try{const h=new Date;h.setDate(h.getDate()+7);const f={fileId:i,matterId:e,name:n.name,type:this.getFileType(n.name),size:n.size,storagePath:o,uploadedBy:r,uploadedAt:xe(),ocrStatus:null,ocrText:null,ocrConfidence:null,ocrPages:null,ocrError:null,purgeAt:We.fromDate(h),isPurged:!1};await Lu(tn(le,"matters",e,"files"),f),u(i)}catch(h){d(new Error(`Failed to finalize upload: ${h.message}`))}})})}catch(i){throw new Error(`Failed to upload file: ${i.message}`)}}static async getFiles(e){try{const n=tn(le,"matters",e,"files"),r=Fs(n,Us("uploadedAt","desc")),s=await Ou(r),i=[];return s.forEach(o=>{var u,d;const a=o.data();let l;(u=a.purgeAt)!=null&&u.toDate?l=a.purgeAt.toDate():typeof a.purgeAt=="string"?l=new Date(a.purgeAt):l=new Date,i.push({fileId:o.id,matterId:a.matterId,name:a.name,type:a.type,size:a.size,storagePath:a.storagePath,uploadedBy:a.uploadedBy,uploadedAt:((d=a.uploadedAt)==null?void 0:d.toDate())||new Date,ocrStatus:a.ocrStatus||null,ocrText:a.ocrText||null,ocrConfidence:a.ocrConfidence||null,ocrPages:a.ocrPages||null,ocrError:a.ocrError||null,purgeAt:l,isPurged:a.isPurged||!1})}),i}catch(n){throw new Error(`Failed to get files: ${n.message}`)}}static async getFile(e,n){var r,s;try{const i=Ie(le,"matters",e,"files",n),o=await Bs(i);if(!o.exists())return null;const a=o.data();let l;return(r=a.purgeAt)!=null&&r.toDate?l=a.purgeAt.toDate():typeof a.purgeAt=="string"?l=new Date(a.purgeAt):l=new Date,{fileId:o.id,matterId:a.matterId,name:a.name,type:a.type,size:a.size,storagePath:a.storagePath,uploadedBy:a.uploadedBy,uploadedAt:((s=a.uploadedAt)==null?void 0:s.toDate())||new Date,ocrStatus:a.ocrStatus||null,ocrText:a.ocrText||null,ocrConfidence:a.ocrConfidence||null,ocrPages:a.ocrPages||null,ocrError:a.ocrError||null,purgeAt:l,isPurged:a.isPurged||!1}}catch(i){throw new Error(`Failed to get file: ${i.message}`)}}static async deleteFile(e,n){try{const r=await this.getFile(e,n);if(!r)throw new Error("File not found");const s=Sp(bp,r.storagePath);await N4(s);const i=Ie(le,"matters",e,"files",n);await Mu(i)}catch(r){throw new Error(`Failed to delete file: ${r.message}`)}}static async getDownloadUrl(e){try{const n=Sp(bp,e);return await A4(n)}catch(n){throw new Error(`Failed to get download URL: ${n.message}`)}}static async triggerOcr(e,n,r){try{const s=Ie(le,"matters",e,"files",n);await En(s,{ocrStatus:"processing",ocrError:null})}catch(s){const i=Ie(le,"matters",e,"files",n);throw await En(i,{ocrStatus:"failed",ocrError:s.message||"Failed to trigger OCR"}),new Error(`Failed to trigger OCR: ${s.message}`)}}static getFileType(e){const n=e.toLowerCase().substring(e.lastIndexOf("."));return n===".pdf"?"pdf":n===".docx"?"docx":"txt"}}class iu{static async generateDraft(e){try{const n=Gn.currentUser;if(!n)throw new Error("User not authenticated");const r={matterId:e.matterId,templateId:e.templateId,state:"generating",sections:{facts:{content:"",generatedAt:null},liability:{content:"",generatedAt:null},damages:{content:"",generatedAt:null},demand:{content:"",generatedAt:null}},variables:e.variables,generatedBy:n.uid,lastGeneratedAt:xe(),lastEditedAt:xe(),lastEditedBy:n.uid,createdAt:xe(),updatedAt:xe()};return(await Lu(tn(le,"drafts"),r)).id}catch(n){throw new Error(`Failed to generate draft: ${n.message}`)}}static async getDraft(e){var n,r,s,i;try{const o=Ie(le,"drafts",e),a=await Bs(o);if(!a.exists())return null;const l=a.data();return{draftId:a.id,matterId:l.matterId,templateId:l.templateId,state:l.state,sections:l.sections,variables:l.variables||{},generatedBy:l.generatedBy,lastGeneratedAt:((n=l.lastGeneratedAt)==null?void 0:n.toDate())||new Date,lastEditedAt:((r=l.lastEditedAt)==null?void 0:r.toDate())||new Date,lastEditedBy:l.lastEditedBy,createdAt:((s=l.createdAt)==null?void 0:s.toDate())||new Date,updatedAt:((i=l.updatedAt)==null?void 0:i.toDate())||new Date,error:l.error}}catch(o){throw new Error(`Failed to get draft: ${o.message}`)}}static async getDrafts(e){try{const n=Fs(tn(le,"drafts"),bl("matterId","==",e),Us("createdAt","desc")),r=await Ou(n),s=[];return r.forEach(i=>{var a,l,u,d;const o=i.data();s.push({draftId:i.id,matterId:o.matterId,templateId:o.templateId,state:o.state,sections:o.sections,variables:o.variables||{},generatedBy:o.generatedBy,lastGeneratedAt:((a=o.lastGeneratedAt)==null?void 0:a.toDate())||new Date,lastEditedAt:((l=o.lastEditedAt)==null?void 0:l.toDate())||new Date,lastEditedBy:o.lastEditedBy,createdAt:((u=o.createdAt)==null?void 0:u.toDate())||new Date,updatedAt:((d=o.updatedAt)==null?void 0:d.toDate())||new Date,error:o.error})}),s}catch(n){throw new Error(`Failed to get drafts: ${n.message}`)}}static async updateDraftSection(e,n,r){try{const s=Gn.currentUser;if(!s)throw new Error("User not authenticated");const i=Ie(le,"drafts",e);await En(i,{[`sections.${n}.content`]:r,[`sections.${n}.generatedAt`]:xe(),lastEditedAt:xe(),lastEditedBy:s.uid,updatedAt:xe(),state:"editing"})}catch(s){throw new Error(`Failed to update draft section: ${s.message}`)}}static async refineSection(e,n,r,s=!0){try{const i=Gn.currentUser;if(!i)throw new Error("User not authenticated");const o=Ie(le,"drafts",e);await En(o,{[`sections.${n}.content`]:`[Refinement in progress: ${r}]`,[`sections.${n}.generatedAt`]:xe(),lastEditedAt:xe(),lastEditedBy:i.uid,updatedAt:xe(),state:"editing"})}catch(i){throw new Error(`Failed to refine section: ${i.message}`)}}static async deleteDraft(e){try{const n=Ie(le,"drafts",e);await Mu(n)}catch(n){throw new Error(`Failed to delete draft: ${n.message}`)}}}const tU=({type:t="file"})=>p.jsx("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-4",children:p.jsxs("div",{className:"flex",children:[p.jsx("div",{className:"flex-shrink-0",children:p.jsx("span",{className:"text-yellow-400 text-xl",children:""})}),p.jsx("div",{className:"ml-3",children:p.jsx("p",{className:"text-sm text-yellow-700",children:t==="file"?"Files are automatically deleted after 7 days. Export important documents to save permanently.":"Exports are automatically deleted after 7 days. Download important files to save permanently."})})]})}),nU=({matterId:t,userId:e,onUploadSuccess:n})=>{const[r,s]=R.useState(!1),[i,o]=R.useState(!1),[a,l]=R.useState(null),[u,d]=R.useState(null),h=R.useRef(null),f=S=>{S.preventDefault(),S.stopPropagation(),s(!0)},m=S=>{S.preventDefault(),S.stopPropagation(),s(!1)},y=S=>{S.preventDefault(),S.stopPropagation()},v=S=>{S.preventDefault(),S.stopPropagation(),s(!1);const b=Array.from(S.dataTransfer.files);b.length>0&&x(b[0])},w=S=>{const b=S.target.files;b&&b.length>0&&x(b[0])},x=async S=>{d(null),l(null);const b=K4(S);if(!b.isValid){d(b.error||"Invalid file");return}o(!0);try{await jo.uploadFile(t,S,e,N=>{l(N)}),h.current&&(h.current.value=""),l(null),n()}catch(N){d(N.message||"Failed to upload file")}finally{o(!1)}};return p.jsxs("div",{className:"mb-6",children:[p.jsx(tU,{type:"file"}),p.jsxs("div",{onDragEnter:f,onDragOver:y,onDragLeave:m,onDrop:v,className:`border-2 border-dashed rounded-lg p-8 text-center transition-colors ${r?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"} ${i?"opacity-50 pointer-events-none":""}`,children:[p.jsx("input",{ref:h,type:"file",accept:".pdf,.docx,.txt",onChange:w,className:"hidden",disabled:i}),i&&a?p.jsxs("div",{className:"space-y-2",children:[p.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:p.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full transition-all duration-300",style:{width:`${a.percentage}%`}})}),p.jsxs("p",{className:"text-sm text-gray-600",children:["Uploading... ",a.percentage,"% (",gg(a.bytesTransferred)," /"," ",gg(a.totalBytes),")"]})]}):p.jsxs(p.Fragment,{children:[p.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48",children:p.jsx("path",{d:"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"})}),p.jsxs("div",{className:"mt-4",children:[p.jsx("button",{type:"button",onClick:()=>{var S;return(S=h.current)==null?void 0:S.click()},className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Select File"}),p.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"or drag and drop"})]}),p.jsx("p",{className:"mt-2 text-xs text-gray-500",children:"PDF, DOCX, TXT up to 10MB"})]})]}),u&&p.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-md",children:p.jsx("p",{className:"text-sm text-red-600",children:u})})]})},rU=({file:t})=>{if(!t.ocrStatus)return null;const n=(()=>{switch(t.ocrStatus){case"pending":return{label:"OCR Pending",className:"bg-yellow-100 text-yellow-800",icon:""};case"processing":return{label:"Processing OCR",className:"bg-blue-100 text-blue-800",icon:""};case"done":const r=t.ocrConfidence!==null&&t.ocrConfidence<50;return{label:r?`OCR Complete (Needs Review - ${t.ocrConfidence}% confidence)`:`OCR Complete (${t.ocrConfidence}% confidence)`,className:r?"bg-orange-100 text-orange-800":"bg-green-100 text-green-800",icon:r?"":""};case"failed":return{label:`OCR Failed${t.ocrError?`: ${t.ocrError}`:""}`,className:"bg-red-100 text-red-800",icon:""};default:return null}})();return n?p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${n.className}`,title:t.ocrPages?`${t.ocrPages} page(s) processed`:"OCR status information",children:[p.jsx("span",{className:"mr-1",children:n.icon}),n.label]}),t.ocrPages&&p.jsxs("span",{className:"text-xs text-gray-500",children:[t.ocrPages," page",t.ocrPages!==1?"s":""]})]}):null},sU=({file:t,matterId:e,onDelete:n})=>{const r=u=>(typeof u=="string"?new Date(u):u).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),s=u=>{const d=typeof u=="string"?new Date(u):u,h=new Date,f=d.getTime()-h.getTime();return Math.ceil(f/(1e3*60*60*24))},i=u=>{switch(u){case"pdf":return"";case"docx":return"";case"txt":return"";default:return""}},o=async()=>{if(t.type!=="pdf"){alert("OCR is only available for PDF files");return}try{await jo.triggerOcr(e,t.fileId,t.storagePath)}catch(u){alert(`Failed to trigger OCR: ${u.message}`)}},a=async()=>{try{const u=await jo.getDownloadUrl(t.storagePath);window.open(u,"_blank")}catch(u){console.error("Failed to download file:",u),alert("Failed to download file. Please try again.")}},l=async()=>{if(window.confirm(`Are you sure you want to delete "${t.name}"?`))try{await jo.deleteFile(e,t.fileId),n(t.fileId)}catch(u){alert(`Failed to delete file: ${u.message}`)}};return p.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:p.jsxs("div",{className:"flex items-start justify-between",children:[p.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[p.jsx("div",{className:"text-3xl",children:i(t.type)}),p.jsxs("div",{className:"flex-1 min-w-0",children:[p.jsx("h4",{className:"text-sm font-medium text-gray-900 truncate",children:t.name}),p.jsxs("div",{className:"mt-1 flex flex-wrap items-center gap-2 text-xs text-gray-500",children:[p.jsx("span",{children:gg(t.size)}),p.jsx("span",{children:""}),p.jsx("span",{className:"uppercase",children:t.type}),p.jsx("span",{children:""}),p.jsxs("span",{children:["Uploaded ",r(t.uploadedAt)]})]}),t.purgeAt&&p.jsxs("div",{className:"mt-2 text-xs text-yellow-600",children:["Expires in ",s(t.purgeAt)," day",s(t.purgeAt)!==1?"s":""]}),t.ocrStatus&&p.jsxs("div",{className:"mt-2",children:[p.jsx(rU,{file:t}),t.ocrStatus==="failed"&&t.type==="pdf"&&p.jsx("button",{onClick:o,className:"mt-2 px-2 py-1 text-xs font-medium text-blue-600 hover:text-blue-700 hover:bg-blue-50 rounded",children:"Retry OCR"})]})]})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("button",{onClick:a,className:"px-3 py-1 text-xs font-medium text-blue-600 hover:text-blue-700 hover:bg-blue-50 rounded",children:"Download"}),p.jsx("button",{onClick:l,className:"px-3 py-1 text-xs font-medium text-red-600 hover:text-red-700 hover:bg-red-50 rounded",children:"Delete"})]})]})})},iU=({files:t,matterId:e,onFileDeleted:n})=>t.length===0?p.jsx($0,{icon:"",title:"No files uploaded yet",description:"Upload your first file to get started with OCR processing and draft generation."}):p.jsx("div",{className:"space-y-3",children:t.map(r=>p.jsx(sU,{file:r,matterId:e,onDelete:n},r.fileId))});class Fo{static async createTemplate(e,n){try{const r={name:e.name.trim(),description:e.description.trim(),sections:e.sections,variables:e.variables||[],createdBy:n,createdAt:xe(),updatedAt:xe(),isActive:e.isActive!==void 0?e.isActive:!0};return(await Lu(tn(le,"templates"),r)).id}catch(r){throw new Error(`Failed to create template: ${r.message}`)}}static async getTemplate(e){var n,r;try{const s=Ie(le,"templates",e),i=await Bs(s);if(!i.exists())return null;const o=i.data();return{templateId:i.id,name:o.name,description:o.description,sections:o.sections,variables:o.variables||[],createdBy:o.createdBy,createdAt:((n=o.createdAt)==null?void 0:n.toDate())||new Date,updatedAt:((r=o.updatedAt)==null?void 0:r.toDate())||new Date,isActive:o.isActive!==void 0?o.isActive:!0}}catch(s){throw new Error(`Failed to get template: ${s.message}`)}}static async getTemplates(e){try{let n=Fs(tn(le,"templates"),Us("createdAt","desc"));e!=null&&e.activeOnly&&(n=Fs(tn(le,"templates"),bl("isActive","==",!0),Us("createdAt","desc")));const r=await Ou(n);let s=[];if(r.forEach(i=>{var a,l;const o=i.data();s.push({templateId:i.id,name:o.name,description:o.description,sections:o.sections,variables:o.variables||[],createdBy:o.createdBy,createdAt:((a=o.createdAt)==null?void 0:a.toDate())||new Date,updatedAt:((l=o.updatedAt)==null?void 0:l.toDate())||new Date,isActive:o.isActive!==void 0?o.isActive:!0})}),e!=null&&e.searchQuery){const i=e.searchQuery.toLowerCase();s=s.filter(o=>o.name.toLowerCase().includes(i)||o.description.toLowerCase().includes(i))}return s}catch(n){throw new Error(`Failed to get templates: ${n.message}`)}}static async updateTemplate(e,n){try{const r=Ie(le,"templates",e),s={updatedAt:xe()};n.name!==void 0&&(s.name=n.name.trim()),n.description!==void 0&&(s.description=n.description.trim()),n.sections!==void 0&&(s.sections=n.sections),n.variables!==void 0&&(s.variables=n.variables),n.isActive!==void 0&&(s.isActive=n.isActive),await En(r,s)}catch(r){throw new Error(`Failed to update template: ${r.message}`)}}static async deleteTemplate(e){try{const n=Ie(le,"templates",e);await Mu(n)}catch(n){throw new Error(`Failed to delete template: ${n.message}`)}}}const oU=({variables:t,values:e,onChange:n})=>{const r=(s,i)=>{n({...e,[s]:i})};return t.length===0?p.jsx("div",{className:"text-sm text-gray-500 p-4 bg-gray-50 rounded-md",children:"This template has no variables."}):p.jsxs("div",{className:"space-y-4",children:[p.jsx("h4",{className:"text-sm font-semibold text-gray-900",children:"Template Variables"}),t.map(s=>{const i=e[s.name]||s.defaultValue||"";return p.jsxs("div",{children:[p.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[s.label,s.required&&p.jsx("span",{className:"text-red-600 ml-1",children:"*"})]}),s.type==="date"?p.jsx("input",{type:"date",value:i,onChange:o=>r(s.name,o.target.value),required:s.required,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}):s.type==="number"?p.jsx("input",{type:"number",value:i,onChange:o=>r(s.name,parseFloat(o.target.value)||0),required:s.required,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}):p.jsx("input",{type:"text",value:i,onChange:o=>r(s.name,o.target.value),required:s.required,placeholder:s.defaultValue||"",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),s.defaultValue&&p.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["Default: ",s.defaultValue]})]},s.name)})]})},aU=({currentSection:t,progress:e,estimatedTimeRemaining:n})=>{const r=i=>{if(!i)return"Preparing...";switch(i){case"facts":return"Generating Facts Section";case"liability":return"Generating Liability Section";case"damages":return"Generating Damages Section";case"demand":return"Generating Demand Section";default:return"Processing..."}},s=i=>{if(i<60)return`${i} seconds`;const o=Math.floor(i/60),a=i%60;return`${o}m ${a}s`};return p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{children:[p.jsxs("div",{className:"flex items-center justify-between mb-2",children:[p.jsx("span",{className:"text-sm font-medium text-gray-700",children:r(t)}),p.jsxs("span",{className:"text-sm text-gray-500",children:[Math.round(e),"%"]})]}),p.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:p.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${e}%`}})})]}),n!==void 0&&n>0&&p.jsxs("p",{className:"text-xs text-gray-500 text-center",children:["Estimated time remaining: ",s(n)]})]})},lU=({isOpen:t,onClose:e,onSuccess:n,matterId:r})=>{const s=$r(),[i,o]=R.useState([]),[a,l]=R.useState([]),[u,d]=R.useState(""),[h,f]=R.useState([]),[m,y]=R.useState({}),[v,w]=R.useState(!1),[x,S]=R.useState(!1),[b,N]=R.useState(null),[M,V]=R.useState(0),[k,E]=R.useState(null),I=i.find(Z=>Z.templateId===u);R.useEffect(()=>{t&&(C(),P())},[t,r]);const C=async()=>{try{S(!0),E(null);const Z=await Fo.getTemplates({activeOnly:!0});o(Z),Z.length===0&&E("No active templates found. Please create a template first.")}catch(Z){E(`Failed to load templates: ${Z.message}`)}finally{S(!1)}},P=async()=>{try{const Z=await jo.getFiles(r);l(Z)}catch(Z){E(`Failed to load files: ${Z.message}`)}},D=Z=>{f(Q=>Q.includes(Z)?Q.filter(ge=>ge!==Z):[...Q,Z])},A=async()=>{if(!u){E("Please select a template");return}if(h.length===0){E("Please select at least one source file");return}if(I){const Z=I.variables.filter(Q=>Q.required);for(const Q of Z)if(!m[Q.name]||m[Q.name].toString().trim()===""){E(`Please fill in required variable: ${Q.label}`);return}}E(null),w(!0),V(0);try{const Z=["facts","liability","damages","demand"];for(let Re=0;Re<Z.length;Re++)N(Z[Re]),V((Re+1)/Z.length*100),await new Promise($=>setTimeout($,1e3));const Q={matterId:r,templateId:u,fileIds:h,variables:m},ge=await iu.generateDraft(Q);n(ge),e()}catch(Z){E(`Failed to generate draft: ${Z.message}`)}finally{w(!1),N(null),V(0)}};return t?p.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:p.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:p.jsxs("div",{className:"p-6",children:[p.jsxs("div",{className:"flex items-center justify-between mb-6",children:[p.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Generate Draft"}),p.jsx("button",{onClick:e,disabled:v,className:"text-gray-400 hover:text-gray-600 disabled:opacity-50",children:""})]}),k&&p.jsx("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-md",children:p.jsx("p",{className:"text-sm text-red-800",children:k})}),v?p.jsxs("div",{className:"space-y-6",children:[p.jsx(aU,{currentSection:b,progress:M,estimatedTimeRemaining:Math.max(0,45-Math.floor(M/100*45))}),p.jsx("p",{className:"text-sm text-gray-600 text-center",children:"This may take up to 45 seconds. Please do not close this window."})]}):p.jsxs("div",{className:"space-y-6",children:[p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Template *"}),x?p.jsx("div",{className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50",children:p.jsx("span",{className:"text-sm text-gray-500",children:"Loading templates..."})}):p.jsxs("select",{value:u,onChange:Z=>{d(Z.target.value),y({})},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:i.length===0,children:[p.jsx("option",{value:"",children:i.length===0?"No templates available - Create one first":"Choose a template..."}),i.map(Z=>p.jsx("option",{value:Z.templateId,children:Z.name},Z.templateId))]}),i.length===0&&!x&&p.jsxs("p",{className:"mt-2 text-sm text-gray-500",children:["Go to"," ",p.jsx("button",{type:"button",className:"text-blue-600 hover:text-blue-700 underline",onClick:()=>{e(),s("/templates")},children:"Templates"})," ","to create your first template."]})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Source Files *"}),p.jsx("div",{className:"border border-gray-300 rounded-md p-4 max-h-48 overflow-y-auto",children:a.length===0?p.jsx("p",{className:"text-sm text-gray-500",children:"No files available"}):p.jsx("div",{className:"space-y-2",children:a.map(Z=>p.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded",children:[p.jsx("input",{type:"checkbox",checked:h.includes(Z.fileId),onChange:()=>D(Z.fileId),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),p.jsx("span",{className:"text-sm text-gray-700",children:Z.name}),p.jsxs("span",{className:"text-xs text-gray-500",children:["(",Z.type.toUpperCase(),")"]}),Z.ocrStatus==="done"&&p.jsx("span",{className:"text-xs text-green-600",children:" OCR Complete"})]},Z.fileId))})})]}),I&&p.jsx("div",{className:"border-t pt-6",children:p.jsx(oU,{variables:I.variables,values:m,onChange:y})}),p.jsxs("div",{className:"flex items-center justify-end gap-3 pt-4 border-t",children:[p.jsx("button",{onClick:e,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:"Cancel"}),p.jsx("button",{onClick:A,disabled:!u||h.length===0,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:"Generate Draft"})]})]})]})})}):null},uU=({matter:t})=>{const{user:e}=_t(),[n,r]=R.useState("overview"),[s,i]=R.useState([]),[o,a]=R.useState(!1),[l,u]=R.useState(null),[d,h]=R.useState([]),[f,m]=R.useState(!1),[y,v]=R.useState(null),[w,x]=R.useState(!1);R.useEffect(()=>{n==="files"&&t.matterId&&S()},[n,t.matterId]),R.useEffect(()=>{n==="drafts"&&t.matterId&&M()},[n,t.matterId]);const S=async()=>{try{a(!0),u(null);const E=await jo.getFiles(t.matterId);i(E)}catch(E){u(E.message||"Failed to load files")}finally{a(!1)}},b=()=>{S()},N=E=>{i(s.filter(I=>I.fileId!==E))},M=async()=>{try{m(!0),v(null);const E=await iu.getDrafts(t.matterId);h(E)}catch(E){v(E.message||"Failed to load drafts")}finally{m(!1)}},V=E=>{M(),window.location.href=`/drafts/${E}`},k=[{id:"overview",label:"Overview"},{id:"files",label:"Files"},{id:"drafts",label:"Drafts"},{id:"activity",label:"Activity"}];return p.jsxs("div",{className:"bg-white rounded-lg shadow",children:[p.jsx("div",{className:"border-b border-gray-200",children:p.jsx("nav",{className:"flex -mb-px",children:k.map(E=>p.jsx("button",{onClick:()=>r(E.id),className:`px-6 py-3 text-sm font-medium border-b-2 transition-colors ${n===E.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:E.label},E.id))})}),p.jsxs("div",{className:"p-6",children:[n==="overview"&&p.jsx("div",{className:"space-y-4",children:p.jsxs("div",{children:[p.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Matter Information"}),p.jsxs("dl",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[p.jsxs("div",{children:[p.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Title"}),p.jsx("dd",{className:"mt-1 text-sm text-gray-900",children:t.title})]}),p.jsxs("div",{children:[p.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Client Name"}),p.jsx("dd",{className:"mt-1 text-sm text-gray-900",children:t.clientName})]}),p.jsxs("div",{children:[p.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Status"}),p.jsx("dd",{className:"mt-1 text-sm text-gray-900 capitalize",children:t.status})]}),p.jsxs("div",{children:[p.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Participants"}),p.jsxs("dd",{className:"mt-1 text-sm text-gray-900",children:[t.participants.length," participant(s)"]})]})]})]})}),n==="files"&&p.jsxs("div",{className:"space-y-6",children:[e&&p.jsx(nU,{matterId:t.matterId,userId:e.uid,onUploadSuccess:b}),l&&p.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md",children:p.jsx("p",{className:"text-sm text-red-600",children:l})}),o?p.jsxs("div",{className:"text-center py-12",children:[p.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),p.jsx("p",{className:"mt-2 text-gray-600",children:"Loading files..."})]}):p.jsx(iU,{files:s,matterId:t.matterId,onFileDeleted:N})]}),n==="drafts"&&p.jsxs("div",{className:"space-y-6",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Drafts"}),p.jsx("button",{onClick:()=>x(!0),className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"+ Generate New Draft"})]}),y&&p.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md",children:p.jsx("p",{className:"text-sm text-red-600",children:y})}),f?p.jsxs("div",{className:"text-center py-12",children:[p.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),p.jsx("p",{className:"mt-2 text-gray-600",children:"Loading drafts..."})]}):d.length===0?p.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg",children:[p.jsx("p",{className:"text-gray-600 mb-4",children:"No drafts created yet."}),p.jsx("button",{onClick:()=>x(!0),className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700",children:"Generate Your First Draft"})]}):p.jsx("div",{className:"space-y-4",children:d.map(E=>p.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:p.jsxs("div",{className:"flex items-start justify-between",children:[p.jsxs("div",{className:"flex-1",children:[p.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[p.jsxs("h4",{className:"text-base font-semibold text-gray-900",children:["Draft #",E.draftId.slice(0,8)]}),p.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${E.state==="generating"?"bg-yellow-100 text-yellow-800":E.state==="editing"?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"}`,children:E.state})]}),p.jsxs("p",{className:"text-sm text-gray-600",children:["Generated ",new Date(E.createdAt).toLocaleDateString()]})]}),p.jsx(Bn,{to:`/drafts/${E.draftId}`,className:"px-3 py-1 text-xs font-medium text-blue-600 hover:text-blue-700 hover:bg-blue-50 rounded",children:"Edit"})]})},E.draftId))}),p.jsx(lU,{isOpen:w,onClose:()=>x(!1),onSuccess:V,matterId:t.matterId})]}),n==="activity"&&p.jsxs("div",{className:"text-center py-12",children:[p.jsx("p",{className:"text-gray-600 mb-4",children:"No activity recorded yet."}),p.jsx("p",{className:"text-sm text-gray-500",children:"Activity tracking will be implemented in future PRs."})]})]})]})},cU=()=>{const{matterId:t}=Ly(),e=$r(),[n,r]=R.useState(null),[s,i]=R.useState(!0),[o,a]=R.useState(null),[l,u]=R.useState(!1),[d,h]=R.useState({title:"",clientName:"",status:"active"}),f=async()=>{if(!t){e("/dashboard");return}try{i(!0),a(null);const w=await Si.getMatter(t);if(!w){a("Matter not found");return}r(w),h({title:w.title,clientName:w.clientName,status:w.status})}catch(w){a(w.message||"Failed to load matter")}finally{i(!1)}};R.useEffect(()=>{f()},[t,e]);const m=async()=>{if(t)try{await Si.updateMatter(t,d);const w=await Si.getMatter(t);w&&r(w),u(!1)}catch(w){a(w.message||"Failed to update matter")}},y=()=>{n&&h({title:n.title,clientName:n.clientName,status:n.status}),u(!1)},v=w=>(typeof w=="string"?new Date(w):w).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});return s?p.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:p.jsx(z0,{size:"lg",text:"Loading matter..."})}):o?p.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center px-4",children:p.jsx("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-6",children:p.jsxs("div",{className:"text-center",children:[p.jsx("div",{className:"text-red-600 text-4xl mb-4",children:""}),p.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Error Loading Matter"}),p.jsx("p",{className:"text-sm text-gray-600 mb-4",children:o}),p.jsxs("div",{className:"flex gap-2 justify-center",children:[p.jsx("button",{onClick:()=>{a(null),f()},className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Try Again"}),p.jsx(Bn,{to:"/dashboard",className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition-colors",children:"Back to Dashboard"})]})]})})}):o||!n?p.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:p.jsxs("div",{className:"text-center",children:[p.jsx("p",{className:"text-red-600 mb-4",children:o||"Matter not found"}),p.jsx(Bn,{to:"/dashboard",className:"text-blue-600 hover:text-blue-700 underline",children:"Back to Dashboard"})]})}):p.jsxs("div",{className:"min-h-screen bg-gray-50",children:[p.jsx("header",{className:"bg-white shadow",children:p.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:p.jsx("div",{className:"flex items-center justify-between",children:p.jsxs("div",{className:"flex items-center gap-4",children:[p.jsx(Bn,{to:"/dashboard",className:"text-gray-600 hover:text-gray-900",children:" Back to Dashboard"}),p.jsx("div",{className:"h-6 w-px bg-gray-300"}),p.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Matter Details"})]})})})}),p.jsxs("main",{id:"main-content",className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[p.jsx("div",{className:"bg-white rounded-lg shadow mb-6",children:p.jsx("div",{className:"p-6",children:p.jsxs("div",{className:"flex items-start justify-between mb-4",children:[p.jsx("div",{className:"flex-1",children:l?p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title"}),p.jsx("input",{type:"text",value:d.title,onChange:w=>h({...d,title:w.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Client Name"}),p.jsx("input",{type:"text",value:d.clientName,onChange:w=>h({...d,clientName:w.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),p.jsxs("select",{value:d.status,onChange:w=>h({...d,status:w.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[p.jsx("option",{value:"active",children:"Active"}),p.jsx("option",{value:"draft",children:"Draft"}),p.jsx("option",{value:"completed",children:"Completed"}),p.jsx("option",{value:"archived",children:"Archived"})]})]}),p.jsxs("div",{className:"flex gap-3",children:[p.jsx("button",{onClick:m,className:"px-4 py-2 bg-blue-600 text-white font-medium rounded-md hover:bg-blue-700",children:"Save"}),p.jsx("button",{onClick:y,className:"px-4 py-2 bg-gray-200 text-gray-700 font-medium rounded-md hover:bg-gray-300",children:"Cancel"})]})]}):p.jsxs(p.Fragment,{children:[p.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:n.title}),p.jsx("p",{className:"text-lg text-gray-600 mb-4",children:n.clientName}),p.jsxs("div",{className:"flex items-center gap-6 text-sm text-gray-500",children:[p.jsxs("span",{children:["Created: ",v(n.createdAt)]}),p.jsxs("span",{children:["Updated: ",v(n.updatedAt)]}),p.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full capitalize",children:n.status})]})]})}),!l&&p.jsx("button",{onClick:()=>u(!0),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:"Edit"})]})})}),p.jsx(uU,{matter:n})]})]})},dU=({template:t,onDelete:e,canEdit:n=!1})=>{const r=i=>(typeof i=="string"?new Date(i):i).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),s=async()=>{window.confirm(`Are you sure you want to delete "${t.name}"? This action cannot be undone.`)&&(e==null||e(t.templateId))};return p.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow",children:p.jsxs("div",{className:"flex items-start justify-between",children:[p.jsxs("div",{className:"flex-1",children:[p.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[p.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:t.name}),t.isActive?p.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs font-medium",children:"Active"}):p.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 rounded-full text-xs font-medium",children:"Inactive"})]}),p.jsx("p",{className:"text-sm text-gray-600 mb-4",children:t.description}),p.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-xs text-gray-500",children:[p.jsxs("span",{children:[t.variables.length," variable(s)"]}),p.jsx("span",{children:""}),p.jsxs("span",{children:["Created ",r(t.createdAt)]}),t.updatedAt!==t.createdAt&&p.jsxs(p.Fragment,{children:[p.jsx("span",{children:""}),p.jsxs("span",{children:["Updated ",r(t.updatedAt)]})]})]})]}),p.jsx("div",{className:"flex items-center gap-2",children:n&&p.jsxs(p.Fragment,{children:[p.jsx(Bn,{to:`/templates/${t.templateId}/edit`,className:"px-3 py-1 text-xs font-medium text-blue-600 hover:text-blue-700 hover:bg-blue-50 rounded",children:"Edit"}),p.jsx("button",{onClick:s,className:"px-3 py-1 text-xs font-medium text-red-600 hover:text-red-700 hover:bg-red-50 rounded",children:"Delete"})]})})]})})},hU=()=>{const{userProfile:t}=_t(),e=$r(),[n,r]=R.useState([]),[s,i]=R.useState(!0),[o,a]=R.useState(null),[l,u]=R.useState(""),[d,h]=R.useState(!0),f=(t==null?void 0:t.role)==="attorney";R.useEffect(()=>{m()},[d,l]);const m=async()=>{try{i(!0);const v=await Fo.getTemplates({activeOnly:d,searchQuery:l||void 0});r(v),a(null)}catch(v){a(v.message)}finally{i(!1)}},y=async v=>{try{await Fo.deleteTemplate(v),await m()}catch(w){alert(`Failed to delete template: ${w.message}`)}};return p.jsxs("main",{id:"main-content",className:"max-w-7xl mx-auto p-6",children:[p.jsxs("div",{className:"flex items-center justify-between mb-6",children:[p.jsxs("div",{children:[p.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Templates"}),p.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage demand letter templates"})]}),f&&p.jsx(Bn,{to:"/templates/new",className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"Create New Template"})]}),p.jsxs("div",{className:"mb-6 flex items-center gap-4",children:[p.jsx("div",{className:"flex-1",children:p.jsx("input",{type:"text",value:l,onChange:v=>u(v.target.value),placeholder:"Search templates by name or description...",className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})}),p.jsxs("div",{className:"flex items-center",children:[p.jsx("input",{type:"checkbox",id:"activeOnly",checked:d,onChange:v=>h(v.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),p.jsx("label",{htmlFor:"activeOnly",className:"ml-2 text-sm text-gray-700",children:"Active only"})]})]}),o&&p.jsx("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-md",children:p.jsx("p",{className:"text-sm text-red-800",children:o})}),s&&p.jsx("div",{className:"text-center py-12",children:p.jsx(z0,{size:"lg",text:"Loading templates..."})}),!s&&n.length===0&&p.jsx($0,{icon:"",title:"No templates found",description:l||!d?"Try adjusting your search or filter criteria.":"Create your first template to get started with draft generation.",action:!l&&d&&f?{label:"Create Template",onClick:()=>e("/templates/new")}:void 0}),!s&&n.length>0&&p.jsx("div",{className:"grid grid-cols-1 gap-4",children:n.map(v=>p.jsx(dU,{template:v,onDelete:f?y:void 0,canEdit:f},v.templateId))})]})},Ac=({section:t,sectionName:e,onChange:n})=>{const r=(i,o)=>{n({...t,[i]:o})},s=()=>{switch(e){case"facts":return"Facts Section";case"liability":return"Liability Section";case"damages":return"Damages Section";case"demand":return"Demand Section";default:return"Section"}};return p.jsxs("div",{className:"space-y-4 p-4 border border-gray-200 rounded-lg",children:[p.jsx("h4",{className:"text-sm font-semibold text-gray-900",children:s()}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Section Title"}),p.jsx("input",{type:"text",value:t.title,onChange:i=>r("title",i.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., Statement of Facts"})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"AI Prompt Instructions"}),p.jsx("textarea",{value:t.prompt,onChange:i=>r("prompt",i.target.value),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Instructions for the AI on how to generate this section..."}),p.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"These instructions guide the AI in generating content for this section. Be specific about what information to include."})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Default Content Template"}),p.jsx("textarea",{value:t.content,onChange:i=>r("content",i.target.value),rows:6,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono text-sm",placeholder:"Default content structure. Use {{variable_name}} for placeholders."}),p.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["Default content structure. Use ",p.jsx("code",{className:"bg-gray-100 px-1 rounded",children:"{{variable_name}}"})," for template variables."]})]})]})},fU=({variables:t,onChange:e})=>{const[n,r]=R.useState({name:"",label:"",type:"text",required:!1,defaultValue:null}),[s,i]=R.useState({}),o=u=>/^[a-zA-Z][a-zA-Z0-9_]*$/.test(u),a=()=>{const u={};if(!n.name||!n.name.trim()?u.name="Variable name is required":o(n.name)?t.some(h=>h.name.toLowerCase()===n.name.toLowerCase())&&(u.name="Variable name already exists"):u.name="Variable name must start with a letter and contain only letters, numbers, and underscores",(!n.label||!n.label.trim())&&(u.label="Label is required"),Object.keys(u).length>0){i(u);return}const d={name:n.name.trim(),label:n.label.trim(),type:n.type||"text",required:n.required||!1,defaultValue:n.defaultValue||null};e([...t,d]),r({name:"",label:"",type:"text",required:!1,defaultValue:null}),i({})},l=u=>{const d=t.filter((h,f)=>f!==u);e(d)};return p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{children:[p.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-2",children:"Template Variables"}),p.jsxs("p",{className:"text-xs text-gray-500 mb-4",children:["Variables can be used in template content as"," ",p.jsx("code",{className:"bg-gray-100 px-1 rounded",children:"{{variable_name}}"})]})]}),t.length>0&&p.jsx("div",{className:"space-y-2",children:t.map((u,d)=>p.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-md",children:[p.jsxs("div",{className:"flex-1 grid grid-cols-2 gap-2",children:[p.jsxs("div",{children:[p.jsx("span",{className:"text-xs font-medium text-gray-700",children:"Name:"}),p.jsx("code",{className:"ml-1 text-xs bg-white px-2 py-1 rounded",children:u.name})]}),p.jsxs("div",{children:[p.jsx("span",{className:"text-xs font-medium text-gray-700",children:"Label:"}),p.jsx("span",{className:"ml-1 text-xs",children:u.label})]}),p.jsxs("div",{children:[p.jsx("span",{className:"text-xs font-medium text-gray-700",children:"Type:"}),p.jsx("span",{className:"ml-1 text-xs capitalize",children:u.type})]}),p.jsxs("div",{children:[p.jsx("span",{className:"text-xs font-medium text-gray-700",children:"Required:"}),p.jsx("span",{className:"ml-1 text-xs",children:u.required?"Yes":"No"})]})]}),p.jsx("button",{onClick:()=>l(d),className:"px-2 py-1 text-xs font-medium text-red-600 hover:text-red-700 hover:bg-red-50 rounded",children:"Remove"})]},d))}),p.jsxs("div",{className:"border-t pt-4",children:[p.jsx("h5",{className:"text-sm font-medium text-gray-900 mb-3",children:"Add New Variable"}),p.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[p.jsxs("div",{children:[p.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Variable Name *"}),p.jsx("input",{type:"text",value:n.name||"",onChange:u=>{r({...n,name:u.target.value}),s.name&&i({...s,name:""})},className:`w-full px-3 py-2 text-sm border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${s.name?"border-red-500":"border-gray-300"}`,placeholder:"e.g., client_name"}),s.name&&p.jsx("p",{className:"mt-1 text-xs text-red-600",children:s.name}),p.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["Use in template as: ",p.jsx("code",{className:"bg-gray-100 px-1 rounded",children:`{{${n.name||"variable_name"}}}`})]})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Label *"}),p.jsx("input",{type:"text",value:n.label||"",onChange:u=>{r({...n,label:u.target.value}),s.label&&i({...s,label:""})},className:`w-full px-3 py-2 text-sm border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${s.label?"border-red-500":"border-gray-300"}`,placeholder:"e.g., Client Name"}),s.label&&p.jsx("p",{className:"mt-1 text-xs text-red-600",children:s.label})]}),p.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[p.jsxs("div",{children:[p.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Type"}),p.jsxs("select",{value:n.type||"text",onChange:u=>r({...n,type:u.target.value}),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[p.jsx("option",{value:"text",children:"Text"}),p.jsx("option",{value:"number",children:"Number"}),p.jsx("option",{value:"date",children:"Date"})]})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Default Value"}),p.jsx("input",{type:"text",value:n.defaultValue||"",onChange:u=>r({...n,defaultValue:u.target.value||null}),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Optional"})]})]}),p.jsxs("div",{className:"flex items-center",children:[p.jsx("input",{type:"checkbox",id:"required",checked:n.required||!1,onChange:u=>r({...n,required:u.target.checked}),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),p.jsx("label",{htmlFor:"required",className:"ml-2 text-xs text-gray-700",children:"Required field"})]}),p.jsx("button",{onClick:a,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"Add Variable"})]})]})]})},Nc={title:"",prompt:"",content:""},sE=()=>{const t=$r(),{templateId:e}=Ly(),{user:n}=_t(),r=!!e,[s,i]=R.useState({name:"",description:"",sections:{facts:{...Nc},liability:{...Nc},damages:{...Nc},demand:{...Nc}},variables:[],isActive:!0}),[o,a]=R.useState(!1),[l,u]=R.useState(null);R.useEffect(()=>{r&&e&&(async()=>{try{const m=await Fo.getTemplate(e);m?i({name:m.name,description:m.description,sections:m.sections,variables:m.variables,isActive:m.isActive}):u("Template not found")}catch(m){u(m.message)}})()},[r,e]);const d=(f,m)=>{i({...s,sections:{...s.sections,[f]:m}})},h=async f=>{if(f.preventDefault(),u(null),!s.name.trim()){u("Template name is required");return}if(!s.description.trim()){u("Template description is required");return}a(!0);try{if(r&&e)await Fo.updateTemplate(e,s);else{if(!(n!=null&&n.uid))throw new Error("User not authenticated");await Fo.createTemplate(s,n.uid)}t("/templates")}catch(m){u(m.message)}finally{a(!1)}};return p.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[p.jsxs("div",{className:"mb-6",children:[p.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:r?"Edit Template":"Create New Template"}),p.jsx("p",{className:"text-sm text-gray-600 mt-1",children:r?"Update template details and sections":"Create a new demand letter template with customizable sections"})]}),l&&p.jsx("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-md",children:p.jsx("p",{className:"text-sm text-red-800",children:l})}),p.jsxs("form",{onSubmit:h,className:"space-y-6",children:[p.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6 space-y-4",children:[p.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Basic Information"}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Template Name *"}),p.jsx("input",{type:"text",value:s.name,onChange:f=>i({...s,name:f.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., Standard Personal Injury Demand Letter",required:!0})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description *"}),p.jsx("textarea",{value:s.description,onChange:f=>i({...s,description:f.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Describe the purpose and use case for this template...",required:!0})]}),p.jsxs("div",{className:"flex items-center",children:[p.jsx("input",{type:"checkbox",id:"isActive",checked:s.isActive,onChange:f=>i({...s,isActive:f.target.checked}),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),p.jsx("label",{htmlFor:"isActive",className:"ml-2 text-sm text-gray-700",children:"Active (available for use)"})]})]}),p.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6 space-y-6",children:[p.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Template Sections"}),p.jsx(Ac,{section:s.sections.facts,sectionName:"facts",onChange:f=>d("facts",f)}),p.jsx(Ac,{section:s.sections.liability,sectionName:"liability",onChange:f=>d("liability",f)}),p.jsx(Ac,{section:s.sections.damages,sectionName:"damages",onChange:f=>d("damages",f)}),p.jsx(Ac,{section:s.sections.demand,sectionName:"demand",onChange:f=>d("demand",f)})]}),p.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:p.jsx(fU,{variables:s.variables,onChange:f=>i({...s,variables:f})})}),p.jsxs("div",{className:"flex items-center justify-end gap-3",children:[p.jsx("button",{type:"button",onClick:()=>t("/templates"),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"Cancel"}),p.jsx("button",{type:"submit",disabled:o,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:o?"Saving...":r?"Update Template":"Create Template"})]})]})]})},pU=({isOpen:t,onClose:e,onRefine:n,initialSection:r})=>{const[s,i]=R.useState(r||"facts"),[o,a]=R.useState(""),[l,u]=R.useState(!0),[d,h]=R.useState(!1),[f,m]=R.useState(null),y=async()=>{if(!o.trim()){m("Please provide refinement instructions");return}m(null),h(!0);try{await n(s,o.trim(),l),e(),a("")}catch(v){m(v.message||"Failed to refine section")}finally{h(!1)}};return t?p.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:p.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4",children:p.jsxs("div",{className:"p-6",children:[p.jsxs("div",{className:"flex items-center justify-between mb-6",children:[p.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Refine Section"}),p.jsx("button",{onClick:e,disabled:d,className:"text-gray-400 hover:text-gray-600 disabled:opacity-50",children:""})]}),f&&p.jsx("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-md",children:p.jsx("p",{className:"text-sm text-red-800",children:f})}),p.jsxs("div",{className:"space-y-6",children:[p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Section *"}),p.jsxs("select",{value:s,onChange:v=>i(v.target.value),disabled:d,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50",children:[p.jsx("option",{value:"facts",children:"Facts Section"}),p.jsx("option",{value:"liability",children:"Liability Section"}),p.jsx("option",{value:"damages",children:"Damages Section"}),p.jsx("option",{value:"demand",children:"Demand Section"})]})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Refinement Instructions *"}),p.jsx("textarea",{value:o,onChange:v=>a(v.target.value),disabled:d,rows:6,placeholder:"e.g., Add more detail on pain and suffering, or Expand on the medical expenses...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50"}),p.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Describe how you want to improve or modify this section"})]}),p.jsxs("div",{className:"flex items-start",children:[p.jsx("input",{type:"checkbox",id:"keepExisting",checked:l,onChange:v=>u(v.target.checked),disabled:d,className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded mt-1 disabled:opacity-50"}),p.jsxs("label",{htmlFor:"keepExisting",className:"ml-2 text-sm text-gray-700",children:[p.jsx("span",{className:"font-medium",children:"Keep existing content and expand"}),p.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"If checked, the AI will improve and expand the existing content. If unchecked, it will rewrite the section completely based on your instructions."})]})]}),p.jsxs("div",{className:"flex items-center justify-end gap-3 pt-4 border-t",children:[p.jsx("button",{onClick:e,disabled:d,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50",children:"Cancel"}),p.jsx("button",{onClick:y,disabled:d||!o.trim(),className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:d?"Refining...":"Refine Section"})]})]})]})})}):null};function ut(t){this.content=t}ut.prototype={constructor:ut,find:function(t){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===t)return e;return-1},get:function(t){var e=this.find(t);return e==-1?void 0:this.content[e+1]},update:function(t,e,n){var r=n&&n!=t?this.remove(n):this,s=r.find(t),i=r.content.slice();return s==-1?i.push(n||t,e):(i[s+1]=e,n&&(i[s]=n)),new ut(i)},remove:function(t){var e=this.find(t);if(e==-1)return this;var n=this.content.slice();return n.splice(e,2),new ut(n)},addToStart:function(t,e){return new ut([t,e].concat(this.remove(t).content))},addToEnd:function(t,e){var n=this.remove(t).content.slice();return n.push(t,e),new ut(n)},addBefore:function(t,e,n){var r=this.remove(e),s=r.content.slice(),i=r.find(t);return s.splice(i==-1?s.length:i,0,e,n),new ut(s)},forEach:function(t){for(var e=0;e<this.content.length;e+=2)t(this.content[e],this.content[e+1])},prepend:function(t){return t=ut.from(t),t.size?new ut(t.content.concat(this.subtract(t).content)):this},append:function(t){return t=ut.from(t),t.size?new ut(this.subtract(t).content.concat(t.content)):this},subtract:function(t){var e=this;t=ut.from(t);for(var n=0;n<t.content.length;n+=2)e=e.remove(t.content[n]);return e},toObject:function(){var t={};return this.forEach(function(e,n){t[e]=n}),t},get size(){return this.content.length>>1}};ut.from=function(t){if(t instanceof ut)return t;var e=[];if(t)for(var n in t)e.push(n,t[n]);return new ut(e)};function CC(t,e,n){for(let r=0;;r++){if(r==t.childCount||r==e.childCount)return t.childCount==e.childCount?null:n;let s=t.child(r),i=e.child(r);if(s==i){n+=s.nodeSize;continue}if(!s.sameMarkup(i))return n;if(s.isText&&s.text!=i.text){for(let o=0;s.text[o]==i.text[o];o++)n++;return n}if(s.content.size||i.content.size){let o=CC(s.content,i.content,n+1);if(o!=null)return o}n+=s.nodeSize}}function AC(t,e,n,r){for(let s=t.childCount,i=e.childCount;;){if(s==0||i==0)return s==i?null:{a:n,b:r};let o=t.child(--s),a=e.child(--i),l=o.nodeSize;if(o==a){n-=l,r-=l;continue}if(!o.sameMarkup(a))return{a:n,b:r};if(o.isText&&o.text!=a.text){let u=0,d=Math.min(o.text.length,a.text.length);for(;u<d&&o.text[o.text.length-u-1]==a.text[a.text.length-u-1];)u++,n--,r--;return{a:n,b:r}}if(o.content.size||a.content.size){let u=AC(o.content,a.content,n-1,r-1);if(u)return u}n-=l,r-=l}}class F{constructor(e,n){if(this.content=e,this.size=n||0,n==null)for(let r=0;r<e.length;r++)this.size+=e[r].nodeSize}nodesBetween(e,n,r,s=0,i){for(let o=0,a=0;a<n;o++){let l=this.content[o],u=a+l.nodeSize;if(u>e&&r(l,s+a,i||null,o)!==!1&&l.content.size){let d=a+1;l.nodesBetween(Math.max(0,e-d),Math.min(l.content.size,n-d),r,s+d)}a=u}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,n,r,s){let i="",o=!0;return this.nodesBetween(e,n,(a,l)=>{let u=a.isText?a.text.slice(Math.max(e,l)-l,n-l):a.isLeaf?s?typeof s=="function"?s(a):s:a.type.spec.leafText?a.type.spec.leafText(a):"":"";a.isBlock&&(a.isLeaf&&u||a.isTextblock)&&r&&(o?o=!1:i+=r),i+=u},0),i}append(e){if(!e.size)return this;if(!this.size)return e;let n=this.lastChild,r=e.firstChild,s=this.content.slice(),i=0;for(n.isText&&n.sameMarkup(r)&&(s[s.length-1]=n.withText(n.text+r.text),i=1);i<e.content.length;i++)s.push(e.content[i]);return new F(s,this.size+e.size)}cut(e,n=this.size){if(e==0&&n==this.size)return this;let r=[],s=0;if(n>e)for(let i=0,o=0;o<n;i++){let a=this.content[i],l=o+a.nodeSize;l>e&&((o<e||l>n)&&(a.isText?a=a.cut(Math.max(0,e-o),Math.min(a.text.length,n-o)):a=a.cut(Math.max(0,e-o-1),Math.min(a.content.size,n-o-1))),r.push(a),s+=a.nodeSize),o=l}return new F(r,s)}cutByIndex(e,n){return e==n?F.empty:e==0&&n==this.content.length?this:new F(this.content.slice(e,n))}replaceChild(e,n){let r=this.content[e];if(r==n)return this;let s=this.content.slice(),i=this.size+n.nodeSize-r.nodeSize;return s[e]=n,new F(s,i)}addToStart(e){return new F([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new F(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let n=0;n<this.content.length;n++)if(!this.content[n].eq(e.content[n]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let n=this.content[e];if(!n)throw new RangeError("Index "+e+" out of range for "+this);return n}maybeChild(e){return this.content[e]||null}forEach(e){for(let n=0,r=0;n<this.content.length;n++){let s=this.content[n];e(s,r,n),r+=s.nodeSize}}findDiffStart(e,n=0){return CC(this,e,n)}findDiffEnd(e,n=this.size,r=e.size){return AC(this,e,n,r)}findIndex(e){if(e==0)return Rc(0,e);if(e==this.size)return Rc(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let n=0,r=0;;n++){let s=this.child(n),i=r+s.nodeSize;if(i>=e)return i==e?Rc(n+1,i):Rc(n,r);r=i}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,n){if(!n)return F.empty;if(!Array.isArray(n))throw new RangeError("Invalid input for Fragment.fromJSON");return new F(n.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return F.empty;let n,r=0;for(let s=0;s<e.length;s++){let i=e[s];r+=i.nodeSize,s&&i.isText&&e[s-1].sameMarkup(i)?(n||(n=e.slice(0,s)),n[n.length-1]=i.withText(n[n.length-1].text+i.text)):n&&n.push(i)}return new F(n||e,r)}static from(e){if(!e)return F.empty;if(e instanceof F)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new F([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}F.empty=new F([],0);const Tp={index:0,offset:0};function Rc(t,e){return Tp.index=t,Tp.offset=e,Tp}function Yd(t,e){if(t===e)return!0;if(!(t&&typeof t=="object")||!(e&&typeof e=="object"))return!1;let n=Array.isArray(t);if(Array.isArray(e)!=n)return!1;if(n){if(t.length!=e.length)return!1;for(let r=0;r<t.length;r++)if(!Yd(t[r],e[r]))return!1}else{for(let r in t)if(!(r in e)||!Yd(t[r],e[r]))return!1;for(let r in e)if(!(r in t))return!1}return!0}let Ee=class yg{constructor(e,n){this.type=e,this.attrs=n}addToSet(e){let n,r=!1;for(let s=0;s<e.length;s++){let i=e[s];if(this.eq(i))return e;if(this.type.excludes(i.type))n||(n=e.slice(0,s));else{if(i.type.excludes(this.type))return e;!r&&i.type.rank>this.type.rank&&(n||(n=e.slice(0,s)),n.push(this),r=!0),n&&n.push(i)}}return n||(n=e.slice()),r||n.push(this),n}removeFromSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return e.slice(0,n).concat(e.slice(n+1));return e}isInSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return!0;return!1}eq(e){return this==e||this.type==e.type&&Yd(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Mark.fromJSON");let r=e.marks[n.type];if(!r)throw new RangeError(`There is no mark type ${n.type} in this schema`);let s=r.create(n.attrs);return r.checkAttrs(s.attrs),s}static sameSet(e,n){if(e==n)return!0;if(e.length!=n.length)return!1;for(let r=0;r<e.length;r++)if(!e[r].eq(n[r]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return yg.none;if(e instanceof yg)return[e];let n=e.slice();return n.sort((r,s)=>r.type.rank-s.type.rank),n}};Ee.none=[];class Xd extends Error{}class q{constructor(e,n,r){this.content=e,this.openStart=n,this.openEnd=r}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,n){let r=RC(this.content,e+this.openStart,n);return r&&new q(r,this.openStart,this.openEnd)}removeBetween(e,n){return new q(NC(this.content,e+this.openStart,n+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,n){if(!n)return q.empty;let r=n.openStart||0,s=n.openEnd||0;if(typeof r!="number"||typeof s!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new q(F.fromJSON(e,n.content),r,s)}static maxOpen(e,n=!0){let r=0,s=0;for(let i=e.firstChild;i&&!i.isLeaf&&(n||!i.type.spec.isolating);i=i.firstChild)r++;for(let i=e.lastChild;i&&!i.isLeaf&&(n||!i.type.spec.isolating);i=i.lastChild)s++;return new q(e,r,s)}}q.empty=new q(F.empty,0,0);function NC(t,e,n){let{index:r,offset:s}=t.findIndex(e),i=t.maybeChild(r),{index:o,offset:a}=t.findIndex(n);if(s==e||i.isText){if(a!=n&&!t.child(o).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(n))}if(r!=o)throw new RangeError("Removing non-flat range");return t.replaceChild(r,i.copy(NC(i.content,e-s-1,n-s-1)))}function RC(t,e,n,r){let{index:s,offset:i}=t.findIndex(e),o=t.maybeChild(s);if(i==e||o.isText)return r&&!r.canReplace(s,s,n)?null:t.cut(0,e).append(n).append(t.cut(e));let a=RC(o.content,e-i-1,n,o);return a&&t.replaceChild(s,o.copy(a))}function mU(t,e,n){if(n.openStart>t.depth)throw new Xd("Inserted content deeper than insertion position");if(t.depth-n.openStart!=e.depth-n.openEnd)throw new Xd("Inconsistent open depths");return PC(t,e,n,0)}function PC(t,e,n,r){let s=t.index(r),i=t.node(r);if(s==e.index(r)&&r<t.depth-n.openStart){let o=PC(t,e,n,r+1);return i.copy(i.content.replaceChild(s,o))}else if(n.content.size)if(!n.openStart&&!n.openEnd&&t.depth==r&&e.depth==r){let o=t.parent,a=o.content;return Ti(o,a.cut(0,t.parentOffset).append(n.content).append(a.cut(e.parentOffset)))}else{let{start:o,end:a}=gU(n,t);return Ti(i,OC(t,o,a,e,r))}else return Ti(i,Zd(t,e,r))}function DC(t,e){if(!e.type.compatibleContent(t.type))throw new Xd("Cannot join "+e.type.name+" onto "+t.type.name)}function vg(t,e,n){let r=t.node(n);return DC(r,e.node(n)),r}function bi(t,e){let n=e.length-1;n>=0&&t.isText&&t.sameMarkup(e[n])?e[n]=t.withText(e[n].text+t.text):e.push(t)}function kl(t,e,n,r){let s=(e||t).node(n),i=0,o=e?e.index(n):s.childCount;t&&(i=t.index(n),t.depth>n?i++:t.textOffset&&(bi(t.nodeAfter,r),i++));for(let a=i;a<o;a++)bi(s.child(a),r);e&&e.depth==n&&e.textOffset&&bi(e.nodeBefore,r)}function Ti(t,e){return t.type.checkContent(e),t.copy(e)}function OC(t,e,n,r,s){let i=t.depth>s&&vg(t,e,s+1),o=r.depth>s&&vg(n,r,s+1),a=[];return kl(null,t,s,a),i&&o&&e.index(s)==n.index(s)?(DC(i,o),bi(Ti(i,OC(t,e,n,r,s+1)),a)):(i&&bi(Ti(i,Zd(t,e,s+1)),a),kl(e,n,s,a),o&&bi(Ti(o,Zd(n,r,s+1)),a)),kl(r,null,s,a),new F(a)}function Zd(t,e,n){let r=[];if(kl(null,t,n,r),t.depth>n){let s=vg(t,e,n+1);bi(Ti(s,Zd(t,e,n+1)),r)}return kl(e,null,n,r),new F(r)}function gU(t,e){let n=e.depth-t.openStart,s=e.node(n).copy(t.content);for(let i=n-1;i>=0;i--)s=e.node(i).copy(F.from(s));return{start:s.resolveNoCache(t.openStart+n),end:s.resolveNoCache(s.content.size-t.openEnd-n)}}class ou{constructor(e,n,r){this.pos=e,this.path=n,this.parentOffset=r,this.depth=n.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,n=this.index(this.depth);if(n==e.childCount)return null;let r=this.pos-this.path[this.path.length-1],s=e.child(n);return r?e.child(n).cut(r):s}get nodeBefore(){let e=this.index(this.depth),n=this.pos-this.path[this.path.length-1];return n?this.parent.child(e).cut(0,n):e==0?null:this.parent.child(e-1)}posAtIndex(e,n){n=this.resolveDepth(n);let r=this.path[n*3],s=n==0?0:this.path[n*3-1]+1;for(let i=0;i<e;i++)s+=r.child(i).nodeSize;return s}marks(){let e=this.parent,n=this.index();if(e.content.size==0)return Ee.none;if(this.textOffset)return e.child(n).marks;let r=e.maybeChild(n-1),s=e.maybeChild(n);if(!r){let a=r;r=s,s=a}let i=r.marks;for(var o=0;o<i.length;o++)i[o].type.spec.inclusive===!1&&(!s||!i[o].isInSet(s.marks))&&(i=i[o--].removeFromSet(i));return i}marksAcross(e){let n=this.parent.maybeChild(this.index());if(!n||!n.isInline)return null;let r=n.marks,s=e.parent.maybeChild(e.index());for(var i=0;i<r.length;i++)r[i].type.spec.inclusive===!1&&(!s||!r[i].isInSet(s.marks))&&(r=r[i--].removeFromSet(r));return r}sharedDepth(e){for(let n=this.depth;n>0;n--)if(this.start(n)<=e&&this.end(n)>=e)return n;return 0}blockRange(e=this,n){if(e.pos<this.pos)return e.blockRange(this);for(let r=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);r>=0;r--)if(e.pos<=this.end(r)&&(!n||n(this.node(r))))return new eh(this,e,r);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let n=1;n<=this.depth;n++)e+=(e?"/":"")+this.node(n).type.name+"_"+this.index(n-1);return e+":"+this.parentOffset}static resolve(e,n){if(!(n>=0&&n<=e.content.size))throw new RangeError("Position "+n+" out of range");let r=[],s=0,i=n;for(let o=e;;){let{index:a,offset:l}=o.content.findIndex(i),u=i-l;if(r.push(o,a,s+l),!u||(o=o.child(a),o.isText))break;i=u-1,s+=l+1}return new ou(n,r,i)}static resolveCached(e,n){let r=iE.get(e);if(r)for(let i=0;i<r.elts.length;i++){let o=r.elts[i];if(o.pos==n)return o}else iE.set(e,r=new yU);let s=r.elts[r.i]=ou.resolve(e,n);return r.i=(r.i+1)%vU,s}}class yU{constructor(){this.elts=[],this.i=0}}const vU=12,iE=new WeakMap;class eh{constructor(e,n,r){this.$from=e,this.$to=n,this.depth=r}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const _U=Object.create(null);let Cs=class _g{constructor(e,n,r,s=Ee.none){this.type=e,this.attrs=n,this.marks=s,this.content=r||F.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,n,r,s=0){this.content.nodesBetween(e,n,r,s,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,n,r,s){return this.content.textBetween(e,n,r,s)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,n,r){return this.type==e&&Yd(this.attrs,n||e.defaultAttrs||_U)&&Ee.sameSet(this.marks,r||Ee.none)}copy(e=null){return e==this.content?this:new _g(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new _g(this.type,this.attrs,this.content,e)}cut(e,n=this.content.size){return e==0&&n==this.content.size?this:this.copy(this.content.cut(e,n))}slice(e,n=this.content.size,r=!1){if(e==n)return q.empty;let s=this.resolve(e),i=this.resolve(n),o=r?0:s.sharedDepth(n),a=s.start(o),u=s.node(o).content.cut(s.pos-a,i.pos-a);return new q(u,s.depth-o,i.depth-o)}replace(e,n,r){return mU(this.resolve(e),this.resolve(n),r)}nodeAt(e){for(let n=this;;){let{index:r,offset:s}=n.content.findIndex(e);if(n=n.maybeChild(r),!n)return null;if(s==e||n.isText)return n;e-=s+1}}childAfter(e){let{index:n,offset:r}=this.content.findIndex(e);return{node:this.content.maybeChild(n),index:n,offset:r}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:n,offset:r}=this.content.findIndex(e);if(r<e)return{node:this.content.child(n),index:n,offset:r};let s=this.content.child(n-1);return{node:s,index:n-1,offset:r-s.nodeSize}}resolve(e){return ou.resolveCached(this,e)}resolveNoCache(e){return ou.resolve(this,e)}rangeHasMark(e,n,r){let s=!1;return n>e&&this.nodesBetween(e,n,i=>(r.isInSet(i.marks)&&(s=!0),!s)),s}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),MC(this.marks,e)}contentMatchAt(e){let n=this.type.contentMatch.matchFragment(this.content,0,e);if(!n)throw new Error("Called contentMatchAt on a node with invalid content");return n}canReplace(e,n,r=F.empty,s=0,i=r.childCount){let o=this.contentMatchAt(e).matchFragment(r,s,i),a=o&&o.matchFragment(this.content,n);if(!a||!a.validEnd)return!1;for(let l=s;l<i;l++)if(!this.type.allowsMarks(r.child(l).marks))return!1;return!0}canReplaceWith(e,n,r,s){if(s&&!this.type.allowsMarks(s))return!1;let i=this.contentMatchAt(e).matchType(r),o=i&&i.matchFragment(this.content,n);return o?o.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=Ee.none;for(let n=0;n<this.marks.length;n++){let r=this.marks[n];r.type.checkAttrs(r.attrs),e=r.addToSet(e)}if(!Ee.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(n=>n.type.name)}`);this.content.forEach(n=>n.check())}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(n=>n.toJSON())),e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Node.fromJSON");let r;if(n.marks){if(!Array.isArray(n.marks))throw new RangeError("Invalid mark data for Node.fromJSON");r=n.marks.map(e.markFromJSON)}if(n.type=="text"){if(typeof n.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(n.text,r)}let s=F.fromJSON(e,n.content),i=e.nodeType(n.type).create(n.attrs,s,r);return i.type.checkAttrs(i.attrs),i}};Cs.prototype.text=void 0;class th extends Cs{constructor(e,n,r,s){if(super(e,n,null,s),!r)throw new RangeError("Empty text nodes are not allowed");this.text=r}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):MC(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,n){return this.text.slice(e,n)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new th(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new th(this.type,this.attrs,e,this.marks)}cut(e=0,n=this.text.length){return e==0&&n==this.text.length?this:this.withText(this.text.slice(e,n))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function MC(t,e){for(let n=t.length-1;n>=0;n--)e=t[n].type.name+"("+e+")";return e}class Bi{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,n){let r=new wU(e,n);if(r.next==null)return Bi.empty;let s=LC(r);r.next&&r.err("Unexpected trailing text");let i=IU(kU(s));return CU(i,r),i}matchType(e){for(let n=0;n<this.next.length;n++)if(this.next[n].type==e)return this.next[n].next;return null}matchFragment(e,n=0,r=e.childCount){let s=this;for(let i=n;s&&i<r;i++)s=s.matchType(e.child(i).type);return s}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:n}=this.next[e];if(!(n.isText||n.hasRequiredAttrs()))return n}return null}compatible(e){for(let n=0;n<this.next.length;n++)for(let r=0;r<e.next.length;r++)if(this.next[n].type==e.next[r].type)return!0;return!1}fillBefore(e,n=!1,r=0){let s=[this];function i(o,a){let l=o.matchFragment(e,r);if(l&&(!n||l.validEnd))return F.from(a.map(u=>u.createAndFill()));for(let u=0;u<o.next.length;u++){let{type:d,next:h}=o.next[u];if(!(d.isText||d.hasRequiredAttrs())&&s.indexOf(h)==-1){s.push(h);let f=i(h,a.concat(d));if(f)return f}}return null}return i(this,[])}findWrapping(e){for(let r=0;r<this.wrapCache.length;r+=2)if(this.wrapCache[r]==e)return this.wrapCache[r+1];let n=this.computeWrapping(e);return this.wrapCache.push(e,n),n}computeWrapping(e){let n=Object.create(null),r=[{match:this,type:null,via:null}];for(;r.length;){let s=r.shift(),i=s.match;if(i.matchType(e)){let o=[];for(let a=s;a.type;a=a.via)o.push(a.type);return o.reverse()}for(let o=0;o<i.next.length;o++){let{type:a,next:l}=i.next[o];!a.isLeaf&&!a.hasRequiredAttrs()&&!(a.name in n)&&(!s.type||l.validEnd)&&(r.push({match:a.contentMatch,type:a,via:s}),n[a.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function n(r){e.push(r);for(let s=0;s<r.next.length;s++)e.indexOf(r.next[s].next)==-1&&n(r.next[s].next)}return n(this),e.map((r,s)=>{let i=s+(r.validEnd?"*":" ")+" ";for(let o=0;o<r.next.length;o++)i+=(o?", ":"")+r.next[o].type.name+"->"+e.indexOf(r.next[o].next);return i}).join(`
`)}}Bi.empty=new Bi(!0);class wU{constructor(e,n){this.string=e,this.nodeTypes=n,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function LC(t){let e=[];do e.push(xU(t));while(t.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function xU(t){let e=[];do e.push(EU(t));while(t.next&&t.next!=")"&&t.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function EU(t){let e=TU(t);for(;;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else if(t.eat("{"))e=SU(t,e);else break;return e}function oE(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");let e=Number(t.next);return t.pos++,e}function SU(t,e){let n=oE(t),r=n;return t.eat(",")&&(t.next!="}"?r=oE(t):r=-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:n,max:r,expr:e}}function bU(t,e){let n=t.nodeTypes,r=n[e];if(r)return[r];let s=[];for(let i in n){let o=n[i];o.isInGroup(e)&&s.push(o)}return s.length==0&&t.err("No node type or group '"+e+"' found"),s}function TU(t){if(t.eat("(")){let e=LC(t);return t.eat(")")||t.err("Missing closing paren"),e}else if(/\W/.test(t.next))t.err("Unexpected token '"+t.next+"'");else{let e=bU(t,t.next).map(n=>(t.inline==null?t.inline=n.isInline:t.inline!=n.isInline&&t.err("Mixing inline and block content"),{type:"name",value:n}));return t.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function kU(t){let e=[[]];return s(i(t,0),n()),e;function n(){return e.push([])-1}function r(o,a,l){let u={term:l,to:a};return e[o].push(u),u}function s(o,a){o.forEach(l=>l.to=a)}function i(o,a){if(o.type=="choice")return o.exprs.reduce((l,u)=>l.concat(i(u,a)),[]);if(o.type=="seq")for(let l=0;;l++){let u=i(o.exprs[l],a);if(l==o.exprs.length-1)return u;s(u,a=n())}else if(o.type=="star"){let l=n();return r(a,l),s(i(o.expr,l),l),[r(l)]}else if(o.type=="plus"){let l=n();return s(i(o.expr,a),l),s(i(o.expr,l),l),[r(l)]}else{if(o.type=="opt")return[r(a)].concat(i(o.expr,a));if(o.type=="range"){let l=a;for(let u=0;u<o.min;u++){let d=n();s(i(o.expr,l),d),l=d}if(o.max==-1)s(i(o.expr,l),l);else for(let u=o.min;u<o.max;u++){let d=n();r(l,d),s(i(o.expr,l),d),l=d}return[r(l)]}else{if(o.type=="name")return[r(a,void 0,o.value)];throw new Error("Unknown expr type")}}}}function VC(t,e){return e-t}function aE(t,e){let n=[];return r(e),n.sort(VC);function r(s){let i=t[s];if(i.length==1&&!i[0].term)return r(i[0].to);n.push(s);for(let o=0;o<i.length;o++){let{term:a,to:l}=i[o];!a&&n.indexOf(l)==-1&&r(l)}}}function IU(t){let e=Object.create(null);return n(aE(t,0));function n(r){let s=[];r.forEach(o=>{t[o].forEach(({term:a,to:l})=>{if(!a)return;let u;for(let d=0;d<s.length;d++)s[d][0]==a&&(u=s[d][1]);aE(t,l).forEach(d=>{u||s.push([a,u=[]]),u.indexOf(d)==-1&&u.push(d)})})});let i=e[r.join(",")]=new Bi(r.indexOf(t.length-1)>-1);for(let o=0;o<s.length;o++){let a=s[o][1].sort(VC);i.next.push({type:s[o][0],next:e[a.join(",")]||n(a)})}return i}}function CU(t,e){for(let n=0,r=[t];n<r.length;n++){let s=r[n],i=!s.validEnd,o=[];for(let a=0;a<s.next.length;a++){let{type:l,next:u}=s.next[a];o.push(l.name),i&&!(l.isText||l.hasRequiredAttrs())&&(i=!1),r.indexOf(u)==-1&&r.push(u)}i&&e.err("Only non-generatable nodes ("+o.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function jC(t){let e=Object.create(null);for(let n in t){let r=t[n];if(!r.hasDefault)return null;e[n]=r.default}return e}function FC(t,e){let n=Object.create(null);for(let r in t){let s=e&&e[r];if(s===void 0){let i=t[r];if(i.hasDefault)s=i.default;else throw new RangeError("No value supplied for attribute "+r)}n[r]=s}return n}function UC(t,e,n,r){for(let s in e)if(!(s in t))throw new RangeError(`Unsupported attribute ${s} for ${n} of type ${s}`);for(let s in t){let i=t[s];i.validate&&i.validate(e[s])}}function BC(t,e){let n=Object.create(null);if(e)for(let r in e)n[r]=new NU(t,r,e[r]);return n}let lE=class zC{constructor(e,n,r){this.name=e,this.schema=n,this.spec=r,this.markSet=null,this.groups=r.group?r.group.split(" "):[],this.attrs=BC(e,r.attrs),this.defaultAttrs=jC(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(r.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==Bi.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:FC(this.attrs,e)}create(e=null,n,r){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Cs(this,this.computeAttrs(e),F.from(n),Ee.setFrom(r))}createChecked(e=null,n,r){return n=F.from(n),this.checkContent(n),new Cs(this,this.computeAttrs(e),n,Ee.setFrom(r))}createAndFill(e=null,n,r){if(e=this.computeAttrs(e),n=F.from(n),n.size){let o=this.contentMatch.fillBefore(n);if(!o)return null;n=o.append(n)}let s=this.contentMatch.matchFragment(n),i=s&&s.fillBefore(F.empty,!0);return i?new Cs(this,e,n.append(i),Ee.setFrom(r)):null}validContent(e){let n=this.contentMatch.matchFragment(e);if(!n||!n.validEnd)return!1;for(let r=0;r<e.childCount;r++)if(!this.allowsMarks(e.child(r).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){UC(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let n=0;n<e.length;n++)if(!this.allowsMarkType(e[n].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let n;for(let r=0;r<e.length;r++)this.allowsMarkType(e[r].type)?n&&n.push(e[r]):n||(n=e.slice(0,r));return n?n.length?n:Ee.none:e}static compile(e,n){let r=Object.create(null);e.forEach((i,o)=>r[i]=new zC(i,n,o));let s=n.spec.topNode||"doc";if(!r[s])throw new RangeError("Schema is missing its top node type ('"+s+"')");if(!r.text)throw new RangeError("Every schema needs a 'text' type");for(let i in r.text.attrs)throw new RangeError("The text node type should not have attributes");return r}};function AU(t,e,n){let r=n.split("|");return s=>{let i=s===null?"null":typeof s;if(r.indexOf(i)<0)throw new RangeError(`Expected value of type ${r} for attribute ${e} on type ${t}, got ${i}`)}}class NU{constructor(e,n,r){this.hasDefault=Object.prototype.hasOwnProperty.call(r,"default"),this.default=r.default,this.validate=typeof r.validate=="string"?AU(e,n,r.validate):r.validate}get isRequired(){return!this.hasDefault}}class Zh{constructor(e,n,r,s){this.name=e,this.rank=n,this.schema=r,this.spec=s,this.attrs=BC(e,s.attrs),this.excluded=null;let i=jC(this.attrs);this.instance=i?new Ee(this,i):null}create(e=null){return!e&&this.instance?this.instance:new Ee(this,FC(this.attrs,e))}static compile(e,n){let r=Object.create(null),s=0;return e.forEach((i,o)=>r[i]=new Zh(i,s++,n,o)),r}removeFromSet(e){for(var n=0;n<e.length;n++)e[n].type==this&&(e=e.slice(0,n).concat(e.slice(n+1)),n--);return e}isInSet(e){for(let n=0;n<e.length;n++)if(e[n].type==this)return e[n]}checkAttrs(e){UC(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}}class $C{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let n=this.spec={};for(let s in e)n[s]=e[s];n.nodes=ut.from(e.nodes),n.marks=ut.from(e.marks||{}),this.nodes=lE.compile(this.spec.nodes,this),this.marks=Zh.compile(this.spec.marks,this);let r=Object.create(null);for(let s in this.nodes){if(s in this.marks)throw new RangeError(s+" can not be both a node and a mark");let i=this.nodes[s],o=i.spec.content||"",a=i.spec.marks;if(i.contentMatch=r[o]||(r[o]=Bi.parse(o,this.nodes)),i.inlineContent=i.contentMatch.inlineContent,i.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!i.isInline||!i.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=i}i.markSet=a=="_"?null:a?uE(this,a.split(" ")):a==""||!i.inlineContent?[]:null}for(let s in this.marks){let i=this.marks[s],o=i.spec.excludes;i.excluded=o==null?[i]:o==""?[]:uE(this,o.split(" "))}this.nodeFromJSON=s=>Cs.fromJSON(this,s),this.markFromJSON=s=>Ee.fromJSON(this,s),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,n=null,r,s){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof lE){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(n,r,s)}text(e,n){let r=this.nodes.text;return new th(r,r.defaultAttrs,e,Ee.setFrom(n))}mark(e,n){return typeof e=="string"&&(e=this.marks[e]),e.create(n)}nodeType(e){let n=this.nodes[e];if(!n)throw new RangeError("Unknown node type: "+e);return n}}function uE(t,e){let n=[];for(let r=0;r<e.length;r++){let s=e[r],i=t.marks[s],o=i;if(i)n.push(i);else for(let a in t.marks){let l=t.marks[a];(s=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(s)>-1)&&n.push(o=l)}if(!o)throw new SyntaxError("Unknown mark type: '"+e[r]+"'")}return n}function RU(t){return t.tag!=null}function PU(t){return t.style!=null}class As{constructor(e,n){this.schema=e,this.rules=n,this.tags=[],this.styles=[];let r=this.matchedStyles=[];n.forEach(s=>{if(RU(s))this.tags.push(s);else if(PU(s)){let i=/[^=]*/.exec(s.style)[0];r.indexOf(i)<0&&r.push(i),this.styles.push(s)}}),this.normalizeLists=!this.tags.some(s=>{if(!/^(ul|ol)\b/.test(s.tag)||!s.node)return!1;let i=e.nodes[s.node];return i.contentMatch.matchType(i)})}parse(e,n={}){let r=new dE(this,n,!1);return r.addAll(e,Ee.none,n.from,n.to),r.finish()}parseSlice(e,n={}){let r=new dE(this,n,!0);return r.addAll(e,Ee.none,n.from,n.to),q.maxOpen(r.finish())}matchTag(e,n,r){for(let s=r?this.tags.indexOf(r)+1:0;s<this.tags.length;s++){let i=this.tags[s];if(MU(e,i.tag)&&(i.namespace===void 0||e.namespaceURI==i.namespace)&&(!i.context||n.matchesContext(i.context))){if(i.getAttrs){let o=i.getAttrs(e);if(o===!1)continue;i.attrs=o||void 0}return i}}}matchStyle(e,n,r,s){for(let i=s?this.styles.indexOf(s)+1:0;i<this.styles.length;i++){let o=this.styles[i],a=o.style;if(!(a.indexOf(e)!=0||o.context&&!r.matchesContext(o.context)||a.length>e.length&&(a.charCodeAt(e.length)!=61||a.slice(e.length+1)!=n))){if(o.getAttrs){let l=o.getAttrs(n);if(l===!1)continue;o.attrs=l||void 0}return o}}}static schemaRules(e){let n=[];function r(s){let i=s.priority==null?50:s.priority,o=0;for(;o<n.length;o++){let a=n[o];if((a.priority==null?50:a.priority)<i)break}n.splice(o,0,s)}for(let s in e.marks){let i=e.marks[s].spec.parseDOM;i&&i.forEach(o=>{r(o=hE(o)),o.mark||o.ignore||o.clearMark||(o.mark=s)})}for(let s in e.nodes){let i=e.nodes[s].spec.parseDOM;i&&i.forEach(o=>{r(o=hE(o)),o.node||o.ignore||o.mark||(o.node=s)})}return n}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new As(e,As.schemaRules(e)))}}const qC={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},DU={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},HC={ol:!0,ul:!0},au=1,wg=2,Il=4;function cE(t,e,n){return e!=null?(e?au:0)|(e==="full"?wg:0):t&&t.whitespace=="pre"?au|wg:n&~Il}class Pc{constructor(e,n,r,s,i,o){this.type=e,this.attrs=n,this.marks=r,this.solid=s,this.options=o,this.content=[],this.activeMarks=Ee.none,this.match=i||(o&Il?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let n=this.type.contentMatch.fillBefore(F.from(e));if(n)this.match=this.type.contentMatch.matchFragment(n);else{let r=this.type.contentMatch,s;return(s=r.findWrapping(e.type))?(this.match=r,s):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&au)){let r=this.content[this.content.length-1],s;if(r&&r.isText&&(s=/[ \t\r\n\u000c]+$/.exec(r.text))){let i=r;r.text.length==s[0].length?this.content.pop():this.content[this.content.length-1]=i.withText(i.text.slice(0,i.text.length-s[0].length))}}let n=F.from(this.content);return!e&&this.match&&(n=n.append(this.match.fillBefore(F.empty,!0))),this.type?this.type.create(this.attrs,n,this.marks):n}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!qC.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class dE{constructor(e,n,r){this.parser=e,this.options=n,this.isOpen=r,this.open=0,this.localPreserveWS=!1;let s=n.topNode,i,o=cE(null,n.preserveWhitespace,0)|(r?Il:0);s?i=new Pc(s.type,s.attrs,Ee.none,!0,n.topMatch||s.type.contentMatch,o):r?i=new Pc(null,null,Ee.none,!0,null,o):i=new Pc(e.schema.topNodeType,null,Ee.none,!0,null,o),this.nodes=[i],this.find=n.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,n){e.nodeType==3?this.addTextNode(e,n):e.nodeType==1&&this.addElement(e,n)}addTextNode(e,n){let r=e.nodeValue,s=this.top,i=s.options&wg?"full":this.localPreserveWS||(s.options&au)>0,{schema:o}=this.parser;if(i==="full"||s.inlineContext(e)||/[^ \t\r\n\u000c]/.test(r)){if(i)if(i==="full")r=r.replace(/\r\n?/g,`
`);else if(o.linebreakReplacement&&/[\r\n]/.test(r)&&this.top.findWrapping(o.linebreakReplacement.create())){let a=r.split(/\r?\n|\r/);for(let l=0;l<a.length;l++)l&&this.insertNode(o.linebreakReplacement.create(),n,!0),a[l]&&this.insertNode(o.text(a[l]),n,!/\S/.test(a[l]));r=""}else r=r.replace(/\r?\n|\r/g," ");else if(r=r.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(r)&&this.open==this.nodes.length-1){let a=s.content[s.content.length-1],l=e.previousSibling;(!a||l&&l.nodeName=="BR"||a.isText&&/[ \t\r\n\u000c]$/.test(a.text))&&(r=r.slice(1))}r&&this.insertNode(o.text(r),n,!/\S/.test(r)),this.findInText(e)}else this.findInside(e)}addElement(e,n,r){let s=this.localPreserveWS,i=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let o=e.nodeName.toLowerCase(),a;HC.hasOwnProperty(o)&&this.parser.normalizeLists&&OU(e);let l=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(a=this.parser.matchTag(e,this,r));e:if(l?l.ignore:DU.hasOwnProperty(o))this.findInside(e),this.ignoreFallback(e,n);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(e=l.skip);let u,d=this.needsBlock;if(qC.hasOwnProperty(o))i.content.length&&i.content[0].isInline&&this.open&&(this.open--,i=this.top),u=!0,i.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,n);break e}let h=l&&l.skip?n:this.readStyles(e,n);h&&this.addAll(e,h),u&&this.sync(i),this.needsBlock=d}else{let u=this.readStyles(e,n);u&&this.addElementByRule(e,l,u,l.consuming===!1?a:void 0)}this.localPreserveWS=s}leafFallback(e,n){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),n)}ignoreFallback(e,n){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),n,!0)}readStyles(e,n){let r=e.style;if(r&&r.length)for(let s=0;s<this.parser.matchedStyles.length;s++){let i=this.parser.matchedStyles[s],o=r.getPropertyValue(i);if(o)for(let a=void 0;;){let l=this.parser.matchStyle(i,o,this,a);if(!l)break;if(l.ignore)return null;if(l.clearMark?n=n.filter(u=>!l.clearMark(u)):n=n.concat(this.parser.schema.marks[l.mark].create(l.attrs)),l.consuming===!1)a=l;else break}}return n}addElementByRule(e,n,r,s){let i,o;if(n.node)if(o=this.parser.schema.nodes[n.node],o.isLeaf)this.insertNode(o.create(n.attrs),r,e.nodeName=="BR")||this.leafFallback(e,r);else{let l=this.enter(o,n.attrs||null,r,n.preserveWhitespace);l&&(i=!0,r=l)}else{let l=this.parser.schema.marks[n.mark];r=r.concat(l.create(n.attrs))}let a=this.top;if(o&&o.isLeaf)this.findInside(e);else if(s)this.addElement(e,r,s);else if(n.getContent)this.findInside(e),n.getContent(e,this.parser.schema).forEach(l=>this.insertNode(l,r,!1));else{let l=e;typeof n.contentElement=="string"?l=e.querySelector(n.contentElement):typeof n.contentElement=="function"?l=n.contentElement(e):n.contentElement&&(l=n.contentElement),this.findAround(e,l,!0),this.addAll(l,r),this.findAround(e,l,!1)}i&&this.sync(a)&&this.open--}addAll(e,n,r,s){let i=r||0;for(let o=r?e.childNodes[r]:e.firstChild,a=s==null?null:e.childNodes[s];o!=a;o=o.nextSibling,++i)this.findAtPoint(e,i),this.addDOM(o,n);this.findAtPoint(e,i)}findPlace(e,n,r){let s,i;for(let o=this.open,a=0;o>=0;o--){let l=this.nodes[o],u=l.findWrapping(e);if(u&&(!s||s.length>u.length+a)&&(s=u,i=l,!u.length))break;if(l.solid){if(r)break;a+=2}}if(!s)return null;this.sync(i);for(let o=0;o<s.length;o++)n=this.enterInner(s[o],null,n,!1);return n}insertNode(e,n,r){if(e.isInline&&this.needsBlock&&!this.top.type){let i=this.textblockFromContext();i&&(n=this.enterInner(i,null,n))}let s=this.findPlace(e,n,r);if(s){this.closeExtra();let i=this.top;i.match&&(i.match=i.match.matchType(e.type));let o=Ee.none;for(let a of s.concat(e.marks))(i.type?i.type.allowsMarkType(a.type):fE(a.type,e.type))&&(o=a.addToSet(o));return i.content.push(e.mark(o)),!0}return!1}enter(e,n,r,s){let i=this.findPlace(e.create(n),r,!1);return i&&(i=this.enterInner(e,n,r,!0,s)),i}enterInner(e,n,r,s=!1,i){this.closeExtra();let o=this.top;o.match=o.match&&o.match.matchType(e);let a=cE(e,i,o.options);o.options&Il&&o.content.length==0&&(a|=Il);let l=Ee.none;return r=r.filter(u=>(o.type?o.type.allowsMarkType(u.type):fE(u.type,e))?(l=u.addToSet(l),!1):!0),this.nodes.push(new Pc(e,n,l,s,null,a)),this.open++,r}closeExtra(e=!1){let n=this.nodes.length-1;if(n>this.open){for(;n>this.open;n--)this.nodes[n-1].content.push(this.nodes[n].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let n=this.open;n>=0;n--){if(this.nodes[n]==e)return this.open=n,!0;this.localPreserveWS&&(this.nodes[n].options|=au)}return!1}get currentPos(){this.closeExtra();let e=0;for(let n=this.open;n>=0;n--){let r=this.nodes[n].content;for(let s=r.length-1;s>=0;s--)e+=r[s].nodeSize;n&&e++}return e}findAtPoint(e,n){if(this.find)for(let r=0;r<this.find.length;r++)this.find[r].node==e&&this.find[r].offset==n&&(this.find[r].pos=this.currentPos)}findInside(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].pos==null&&e.nodeType==1&&e.contains(this.find[n].node)&&(this.find[n].pos=this.currentPos)}findAround(e,n,r){if(e!=n&&this.find)for(let s=0;s<this.find.length;s++)this.find[s].pos==null&&e.nodeType==1&&e.contains(this.find[s].node)&&n.compareDocumentPosition(this.find[s].node)&(r?2:4)&&(this.find[s].pos=this.currentPos)}findInText(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&(this.find[n].pos=this.currentPos-(e.nodeValue.length-this.find[n].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let n=e.split("/"),r=this.options.context,s=!this.isOpen&&(!r||r.parent.type==this.nodes[0].type),i=-(r?r.depth+1:0)+(s?0:1),o=(a,l)=>{for(;a>=0;a--){let u=n[a];if(u==""){if(a==n.length-1||a==0)continue;for(;l>=i;l--)if(o(a-1,l))return!0;return!1}else{let d=l>0||l==0&&s?this.nodes[l].type:r&&l>=i?r.node(l-i).type:null;if(!d||d.name!=u&&!d.isInGroup(u))return!1;l--}}return!0};return o(n.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let n=e.depth;n>=0;n--){let r=e.node(n).contentMatchAt(e.indexAfter(n)).defaultType;if(r&&r.isTextblock&&r.defaultAttrs)return r}for(let n in this.parser.schema.nodes){let r=this.parser.schema.nodes[n];if(r.isTextblock&&r.defaultAttrs)return r}}}function OU(t){for(let e=t.firstChild,n=null;e;e=e.nextSibling){let r=e.nodeType==1?e.nodeName.toLowerCase():null;r&&HC.hasOwnProperty(r)&&n?(n.appendChild(e),e=n):r=="li"?n=e:r&&(n=null)}}function MU(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function hE(t){let e={};for(let n in t)e[n]=t[n];return e}function fE(t,e){let n=e.schema.nodes;for(let r in n){let s=n[r];if(!s.allowsMarkType(t))continue;let i=[],o=a=>{i.push(a);for(let l=0;l<a.edgeCount;l++){let{type:u,next:d}=a.edge(l);if(u==e||i.indexOf(d)<0&&o(d))return!0}};if(o(s.contentMatch))return!0}}class Xi{constructor(e,n){this.nodes=e,this.marks=n}serializeFragment(e,n={},r){r||(r=kp(n).createDocumentFragment());let s=r,i=[];return e.forEach(o=>{if(i.length||o.marks.length){let a=0,l=0;for(;a<i.length&&l<o.marks.length;){let u=o.marks[l];if(!this.marks[u.type.name]){l++;continue}if(!u.eq(i[a][0])||u.type.spec.spanning===!1)break;a++,l++}for(;a<i.length;)s=i.pop()[1];for(;l<o.marks.length;){let u=o.marks[l++],d=this.serializeMark(u,o.isInline,n);d&&(i.push([u,s]),s.appendChild(d.dom),s=d.contentDOM||d.dom)}}s.appendChild(this.serializeNodeInner(o,n))}),r}serializeNodeInner(e,n){let{dom:r,contentDOM:s}=ad(kp(n),this.nodes[e.type.name](e),null,e.attrs);if(s){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,n,s)}return r}serializeNode(e,n={}){let r=this.serializeNodeInner(e,n);for(let s=e.marks.length-1;s>=0;s--){let i=this.serializeMark(e.marks[s],e.isInline,n);i&&((i.contentDOM||i.dom).appendChild(r),r=i.dom)}return r}serializeMark(e,n,r={}){let s=this.marks[e.type.name];return s&&ad(kp(r),s(e,n),null,e.attrs)}static renderSpec(e,n,r=null,s){return ad(e,n,r,s)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new Xi(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let n=pE(e.nodes);return n.text||(n.text=r=>r.text),n}static marksFromSchema(e){return pE(e.marks)}}function pE(t){let e={};for(let n in t){let r=t[n].spec.toDOM;r&&(e[n]=r)}return e}function kp(t){return t.document||window.document}const mE=new WeakMap;function LU(t){let e=mE.get(t);return e===void 0&&mE.set(t,e=VU(t)),e}function VU(t){let e=null;function n(r){if(r&&typeof r=="object")if(Array.isArray(r))if(typeof r[0]=="string")e||(e=[]),e.push(r);else for(let s=0;s<r.length;s++)n(r[s]);else for(let s in r)n(r[s])}return n(t),e}function ad(t,e,n,r){if(typeof e=="string")return{dom:t.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let s=e[0],i;if(typeof s!="string")throw new RangeError("Invalid array passed to renderSpec");if(r&&(i=LU(r))&&i.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let o=s.indexOf(" ");o>0&&(n=s.slice(0,o),s=s.slice(o+1));let a,l=n?t.createElementNS(n,s):t.createElement(s),u=e[1],d=1;if(u&&typeof u=="object"&&u.nodeType==null&&!Array.isArray(u)){d=2;for(let h in u)if(u[h]!=null){let f=h.indexOf(" ");f>0?l.setAttributeNS(h.slice(0,f),h.slice(f+1),u[h]):h=="style"&&l.style?l.style.cssText=u[h]:l.setAttribute(h,u[h])}}for(let h=d;h<e.length;h++){let f=e[h];if(f===0){if(h<e.length-1||h>d)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}else{let{dom:m,contentDOM:y}=ad(t,f,n,r);if(l.appendChild(m),y){if(a)throw new RangeError("Multiple content holes");a=y}}}return{dom:l,contentDOM:a}}const WC=65535,KC=Math.pow(2,16);function jU(t,e){return t+e*KC}function gE(t){return t&WC}function FU(t){return(t-(t&WC))/KC}const GC=1,QC=2,ld=4,JC=8;class xg{constructor(e,n,r){this.pos=e,this.delInfo=n,this.recover=r}get deleted(){return(this.delInfo&JC)>0}get deletedBefore(){return(this.delInfo&(GC|ld))>0}get deletedAfter(){return(this.delInfo&(QC|ld))>0}get deletedAcross(){return(this.delInfo&ld)>0}}class ln{constructor(e,n=!1){if(this.ranges=e,this.inverted=n,!e.length&&ln.empty)return ln.empty}recover(e){let n=0,r=gE(e);if(!this.inverted)for(let s=0;s<r;s++)n+=this.ranges[s*3+2]-this.ranges[s*3+1];return this.ranges[r*3]+n+FU(e)}mapResult(e,n=1){return this._map(e,n,!1)}map(e,n=1){return this._map(e,n,!0)}_map(e,n,r){let s=0,i=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?s:0);if(l>e)break;let u=this.ranges[a+i],d=this.ranges[a+o],h=l+u;if(e<=h){let f=u?e==l?-1:e==h?1:n:n,m=l+s+(f<0?0:d);if(r)return m;let y=e==(n<0?l:h)?null:jU(a/3,e-l),v=e==l?QC:e==h?GC:ld;return(n<0?e!=l:e!=h)&&(v|=JC),new xg(m,v,y)}s+=d-u}return r?e+s:new xg(e+s,0,null)}touches(e,n){let r=0,s=gE(n),i=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?r:0);if(l>e)break;let u=this.ranges[a+i],d=l+u;if(e<=d&&a==s*3)return!0;r+=this.ranges[a+o]-u}return!1}forEach(e){let n=this.inverted?2:1,r=this.inverted?1:2;for(let s=0,i=0;s<this.ranges.length;s+=3){let o=this.ranges[s],a=o-(this.inverted?i:0),l=o+(this.inverted?0:i),u=this.ranges[s+n],d=this.ranges[s+r];e(a,a+u,l,l+d),i+=d-u}}invert(){return new ln(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?ln.empty:new ln(e<0?[0,-e,0]:[0,0,e])}}ln.empty=new ln([]);class lu{constructor(e,n,r=0,s=e?e.length:0){this.mirror=n,this.from=r,this.to=s,this._maps=e||[],this.ownData=!(e||n)}get maps(){return this._maps}slice(e=0,n=this.maps.length){return new lu(this._maps,this.mirror,e,n)}appendMap(e,n){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),n!=null&&this.setMirror(this._maps.length-1,n)}appendMapping(e){for(let n=0,r=this._maps.length;n<e._maps.length;n++){let s=e.getMirror(n);this.appendMap(e._maps[n],s!=null&&s<n?r+s:void 0)}}getMirror(e){if(this.mirror){for(let n=0;n<this.mirror.length;n++)if(this.mirror[n]==e)return this.mirror[n+(n%2?-1:1)]}}setMirror(e,n){this.mirror||(this.mirror=[]),this.mirror.push(e,n)}appendMappingInverted(e){for(let n=e.maps.length-1,r=this._maps.length+e._maps.length;n>=0;n--){let s=e.getMirror(n);this.appendMap(e._maps[n].invert(),s!=null&&s>n?r-s-1:void 0)}}invert(){let e=new lu;return e.appendMappingInverted(this),e}map(e,n=1){if(this.mirror)return this._map(e,n,!0);for(let r=this.from;r<this.to;r++)e=this._maps[r].map(e,n);return e}mapResult(e,n=1){return this._map(e,n,!1)}_map(e,n,r){let s=0;for(let i=this.from;i<this.to;i++){let o=this._maps[i],a=o.mapResult(e,n);if(a.recover!=null){let l=this.getMirror(i);if(l!=null&&l>i&&l<this.to){i=l,e=this._maps[l].recover(a.recover);continue}}s|=a.delInfo,e=a.pos}return r?e:new xg(e,s,null)}}const Ip=Object.create(null);class Ot{getMap(){return ln.empty}merge(e){return null}static fromJSON(e,n){if(!n||!n.stepType)throw new RangeError("Invalid input for Step.fromJSON");let r=Ip[n.stepType];if(!r)throw new RangeError(`No step type ${n.stepType} defined`);return r.fromJSON(e,n)}static jsonID(e,n){if(e in Ip)throw new RangeError("Duplicate use of step JSON ID "+e);return Ip[e]=n,n.prototype.jsonID=e,n}}class Je{constructor(e,n){this.doc=e,this.failed=n}static ok(e){return new Je(e,null)}static fail(e){return new Je(null,e)}static fromReplace(e,n,r,s){try{return Je.ok(e.replace(n,r,s))}catch(i){if(i instanceof Xd)return Je.fail(i.message);throw i}}}function q0(t,e,n){let r=[];for(let s=0;s<t.childCount;s++){let i=t.child(s);i.content.size&&(i=i.copy(q0(i.content,e,i))),i.isInline&&(i=e(i,n,s)),r.push(i)}return F.fromArray(r)}class fs extends Ot{constructor(e,n,r){super(),this.from=e,this.to=n,this.mark=r}apply(e){let n=e.slice(this.from,this.to),r=e.resolve(this.from),s=r.node(r.sharedDepth(this.to)),i=new q(q0(n.content,(o,a)=>!o.isAtom||!a.type.allowsMarkType(this.mark.type)?o:o.mark(this.mark.addToSet(o.marks)),s),n.openStart,n.openEnd);return Je.fromReplace(e,this.from,this.to,i)}invert(){return new Yn(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new fs(n.pos,r.pos,this.mark)}merge(e){return e instanceof fs&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new fs(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new fs(n.from,n.to,e.markFromJSON(n.mark))}}Ot.jsonID("addMark",fs);class Yn extends Ot{constructor(e,n,r){super(),this.from=e,this.to=n,this.mark=r}apply(e){let n=e.slice(this.from,this.to),r=new q(q0(n.content,s=>s.mark(this.mark.removeFromSet(s.marks)),e),n.openStart,n.openEnd);return Je.fromReplace(e,this.from,this.to,r)}invert(){return new fs(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new Yn(n.pos,r.pos,this.mark)}merge(e){return e instanceof Yn&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Yn(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new Yn(n.from,n.to,e.markFromJSON(n.mark))}}Ot.jsonID("removeMark",Yn);class ps extends Ot{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return Je.fail("No node at mark step's position");let r=n.type.create(n.attrs,null,this.mark.addToSet(n.marks));return Je.fromReplace(e,this.pos,this.pos+1,new q(F.from(r),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);if(n){let r=this.mark.addToSet(n.marks);if(r.length==n.marks.length){for(let s=0;s<n.marks.length;s++)if(!n.marks[s].isInSet(r))return new ps(this.pos,n.marks[s]);return new ps(this.pos,this.mark)}}return new zi(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new ps(n.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new ps(n.pos,e.markFromJSON(n.mark))}}Ot.jsonID("addNodeMark",ps);class zi extends Ot{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return Je.fail("No node at mark step's position");let r=n.type.create(n.attrs,null,this.mark.removeFromSet(n.marks));return Je.fromReplace(e,this.pos,this.pos+1,new q(F.from(r),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);return!n||!this.mark.isInSet(n.marks)?this:new ps(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new zi(n.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new zi(n.pos,e.markFromJSON(n.mark))}}Ot.jsonID("removeNodeMark",zi);class nt extends Ot{constructor(e,n,r,s=!1){super(),this.from=e,this.to=n,this.slice=r,this.structure=s}apply(e){return this.structure&&Eg(e,this.from,this.to)?Je.fail("Structure replace would overwrite content"):Je.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new ln([this.from,this.to-this.from,this.slice.size])}invert(e){return new nt(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deletedAcross&&r.deletedAcross?null:new nt(n.pos,Math.max(n.pos,r.pos),this.slice,this.structure)}merge(e){if(!(e instanceof nt)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let n=this.slice.size+e.slice.size==0?q.empty:new q(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new nt(this.from,this.to+(e.to-e.from),n,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let n=this.slice.size+e.slice.size==0?q.empty:new q(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new nt(e.from,this.to,n,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new nt(n.from,n.to,q.fromJSON(e,n.slice),!!n.structure)}}Ot.jsonID("replace",nt);class st extends Ot{constructor(e,n,r,s,i,o,a=!1){super(),this.from=e,this.to=n,this.gapFrom=r,this.gapTo=s,this.slice=i,this.insert=o,this.structure=a}apply(e){if(this.structure&&(Eg(e,this.from,this.gapFrom)||Eg(e,this.gapTo,this.to)))return Je.fail("Structure gap-replace would overwrite content");let n=e.slice(this.gapFrom,this.gapTo);if(n.openStart||n.openEnd)return Je.fail("Gap is not a flat range");let r=this.slice.insertAt(this.insert,n.content);return r?Je.fromReplace(e,this.from,this.to,r):Je.fail("Content does not fit in gap")}getMap(){return new ln([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let n=this.gapTo-this.gapFrom;return new st(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1),s=this.from==this.gapFrom?n.pos:e.map(this.gapFrom,-1),i=this.to==this.gapTo?r.pos:e.map(this.gapTo,1);return n.deletedAcross&&r.deletedAcross||s<n.pos||i>r.pos?null:new st(n.pos,r.pos,s,i,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number"||typeof n.gapFrom!="number"||typeof n.gapTo!="number"||typeof n.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new st(n.from,n.to,n.gapFrom,n.gapTo,q.fromJSON(e,n.slice),n.insert,!!n.structure)}}Ot.jsonID("replaceAround",st);function Eg(t,e,n){let r=t.resolve(e),s=n-e,i=r.depth;for(;s>0&&i>0&&r.indexAfter(i)==r.node(i).childCount;)i--,s--;if(s>0){let o=r.node(i).maybeChild(r.indexAfter(i));for(;s>0;){if(!o||o.isLeaf)return!0;o=o.firstChild,s--}}return!1}function UU(t,e,n,r){let s=[],i=[],o,a;t.doc.nodesBetween(e,n,(l,u,d)=>{if(!l.isInline)return;let h=l.marks;if(!r.isInSet(h)&&d.type.allowsMarkType(r.type)){let f=Math.max(u,e),m=Math.min(u+l.nodeSize,n),y=r.addToSet(h);for(let v=0;v<h.length;v++)h[v].isInSet(y)||(o&&o.to==f&&o.mark.eq(h[v])?o.to=m:s.push(o=new Yn(f,m,h[v])));a&&a.to==f?a.to=m:i.push(a=new fs(f,m,r))}}),s.forEach(l=>t.step(l)),i.forEach(l=>t.step(l))}function BU(t,e,n,r){let s=[],i=0;t.doc.nodesBetween(e,n,(o,a)=>{if(!o.isInline)return;i++;let l=null;if(r instanceof Zh){let u=o.marks,d;for(;d=r.isInSet(u);)(l||(l=[])).push(d),u=d.removeFromSet(u)}else r?r.isInSet(o.marks)&&(l=[r]):l=o.marks;if(l&&l.length){let u=Math.min(a+o.nodeSize,n);for(let d=0;d<l.length;d++){let h=l[d],f;for(let m=0;m<s.length;m++){let y=s[m];y.step==i-1&&h.eq(s[m].style)&&(f=y)}f?(f.to=u,f.step=i):s.push({style:h,from:Math.max(a,e),to:u,step:i})}}}),s.forEach(o=>t.step(new Yn(o.from,o.to,o.style)))}function H0(t,e,n,r=n.contentMatch,s=!0){let i=t.doc.nodeAt(e),o=[],a=e+1;for(let l=0;l<i.childCount;l++){let u=i.child(l),d=a+u.nodeSize,h=r.matchType(u.type);if(!h)o.push(new nt(a,d,q.empty));else{r=h;for(let f=0;f<u.marks.length;f++)n.allowsMarkType(u.marks[f].type)||t.step(new Yn(a,d,u.marks[f]));if(s&&u.isText&&n.whitespace!="pre"){let f,m=/\r?\n|\r/g,y;for(;f=m.exec(u.text);)y||(y=new q(F.from(n.schema.text(" ",n.allowedMarks(u.marks))),0,0)),o.push(new nt(a+f.index,a+f.index+f[0].length,y))}}a=d}if(!r.validEnd){let l=r.fillBefore(F.empty,!0);t.replace(a,a,new q(l,0,0))}for(let l=o.length-1;l>=0;l--)t.step(o[l])}function zU(t,e,n){return(e==0||t.canReplace(e,t.childCount))&&(n==t.childCount||t.canReplace(0,n))}function ba(t){let n=t.parent.content.cutByIndex(t.startIndex,t.endIndex);for(let r=t.depth,s=0,i=0;;--r){let o=t.$from.node(r),a=t.$from.index(r)+s,l=t.$to.indexAfter(r)-i;if(r<t.depth&&o.canReplace(a,l,n))return r;if(r==0||o.type.spec.isolating||!zU(o,a,l))break;a&&(s=1),l<o.childCount&&(i=1)}return null}function $U(t,e,n){let{$from:r,$to:s,depth:i}=e,o=r.before(i+1),a=s.after(i+1),l=o,u=a,d=F.empty,h=0;for(let y=i,v=!1;y>n;y--)v||r.index(y)>0?(v=!0,d=F.from(r.node(y).copy(d)),h++):l--;let f=F.empty,m=0;for(let y=i,v=!1;y>n;y--)v||s.after(y+1)<s.end(y)?(v=!0,f=F.from(s.node(y).copy(f)),m++):u++;t.step(new st(l,u,o,a,new q(d.append(f),h,m),d.size-h,!0))}function W0(t,e,n=null,r=t){let s=qU(t,e),i=s&&HU(r,e);return i?s.map(yE).concat({type:e,attrs:n}).concat(i.map(yE)):null}function yE(t){return{type:t,attrs:null}}function qU(t,e){let{parent:n,startIndex:r,endIndex:s}=t,i=n.contentMatchAt(r).findWrapping(e);if(!i)return null;let o=i.length?i[0]:e;return n.canReplaceWith(r,s,o)?i:null}function HU(t,e){let{parent:n,startIndex:r,endIndex:s}=t,i=n.child(r),o=e.contentMatch.findWrapping(i.type);if(!o)return null;let l=(o.length?o[o.length-1]:e).contentMatch;for(let u=r;l&&u<s;u++)l=l.matchType(n.child(u).type);return!l||!l.validEnd?null:o}function WU(t,e,n){let r=F.empty;for(let o=n.length-1;o>=0;o--){if(r.size){let a=n[o].type.contentMatch.matchFragment(r);if(!a||!a.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}r=F.from(n[o].type.create(n[o].attrs,r))}let s=e.start,i=e.end;t.step(new st(s,i,s,i,new q(r,0,0),n.length,!0))}function KU(t,e,n,r,s){if(!r.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let i=t.steps.length;t.doc.nodesBetween(e,n,(o,a)=>{let l=typeof s=="function"?s(o):s;if(o.isTextblock&&!o.hasMarkup(r,l)&&GU(t.doc,t.mapping.slice(i).map(a),r)){let u=null;if(r.schema.linebreakReplacement){let m=r.whitespace=="pre",y=!!r.contentMatch.matchType(r.schema.linebreakReplacement);m&&!y?u=!1:!m&&y&&(u=!0)}u===!1&&XC(t,o,a,i),H0(t,t.mapping.slice(i).map(a,1),r,void 0,u===null);let d=t.mapping.slice(i),h=d.map(a,1),f=d.map(a+o.nodeSize,1);return t.step(new st(h,f,h+1,f-1,new q(F.from(r.create(l,null,o.marks)),0,0),1,!0)),u===!0&&YC(t,o,a,i),!1}})}function YC(t,e,n,r){e.forEach((s,i)=>{if(s.isText){let o,a=/\r?\n|\r/g;for(;o=a.exec(s.text);){let l=t.mapping.slice(r).map(n+1+i+o.index);t.replaceWith(l,l+1,e.type.schema.linebreakReplacement.create())}}})}function XC(t,e,n,r){e.forEach((s,i)=>{if(s.type==s.type.schema.linebreakReplacement){let o=t.mapping.slice(r).map(n+1+i);t.replaceWith(o,o+1,e.type.schema.text(`
`))}})}function GU(t,e,n){let r=t.resolve(e),s=r.index();return r.parent.canReplaceWith(s,s+1,n)}function QU(t,e,n,r,s){let i=t.doc.nodeAt(e);if(!i)throw new RangeError("No node at given position");n||(n=i.type);let o=n.create(r,null,s||i.marks);if(i.isLeaf)return t.replaceWith(e,e+i.nodeSize,o);if(!n.validContent(i.content))throw new RangeError("Invalid content for node type "+n.name);t.step(new st(e,e+i.nodeSize,e+1,e+i.nodeSize-1,new q(F.from(o),0,0),1,!0))}function Nr(t,e,n=1,r){let s=t.resolve(e),i=s.depth-n,o=r&&r[r.length-1]||s.parent;if(i<0||s.parent.type.spec.isolating||!s.parent.canReplace(s.index(),s.parent.childCount)||!o.type.validContent(s.parent.content.cutByIndex(s.index(),s.parent.childCount)))return!1;for(let u=s.depth-1,d=n-2;u>i;u--,d--){let h=s.node(u),f=s.index(u);if(h.type.spec.isolating)return!1;let m=h.content.cutByIndex(f,h.childCount),y=r&&r[d+1];y&&(m=m.replaceChild(0,y.type.create(y.attrs)));let v=r&&r[d]||h;if(!h.canReplace(f+1,h.childCount)||!v.type.validContent(m))return!1}let a=s.indexAfter(i),l=r&&r[0];return s.node(i).canReplaceWith(a,a,l?l.type:s.node(i+1).type)}function JU(t,e,n=1,r){let s=t.doc.resolve(e),i=F.empty,o=F.empty;for(let a=s.depth,l=s.depth-n,u=n-1;a>l;a--,u--){i=F.from(s.node(a).copy(i));let d=r&&r[u];o=F.from(d?d.type.create(d.attrs,o):s.node(a).copy(o))}t.step(new nt(e,e,new q(i.append(o),n,n),!0))}function Xs(t,e){let n=t.resolve(e),r=n.index();return ZC(n.nodeBefore,n.nodeAfter)&&n.parent.canReplace(r,r+1)}function YU(t,e){e.content.size||t.type.compatibleContent(e.type);let n=t.contentMatchAt(t.childCount),{linebreakReplacement:r}=t.type.schema;for(let s=0;s<e.childCount;s++){let i=e.child(s),o=i.type==r?t.type.schema.nodes.text:i.type;if(n=n.matchType(o),!n||!t.type.allowsMarks(i.marks))return!1}return n.validEnd}function ZC(t,e){return!!(t&&e&&!t.isLeaf&&YU(t,e))}function ef(t,e,n=-1){let r=t.resolve(e);for(let s=r.depth;;s--){let i,o,a=r.index(s);if(s==r.depth?(i=r.nodeBefore,o=r.nodeAfter):n>0?(i=r.node(s+1),a++,o=r.node(s).maybeChild(a)):(i=r.node(s).maybeChild(a-1),o=r.node(s+1)),i&&!i.isTextblock&&ZC(i,o)&&r.node(s).canReplace(a,a+1))return e;if(s==0)break;e=n<0?r.before(s):r.after(s)}}function XU(t,e,n){let r=null,{linebreakReplacement:s}=t.doc.type.schema,i=t.doc.resolve(e-n),o=i.node().type;if(s&&o.inlineContent){let d=o.whitespace=="pre",h=!!o.contentMatch.matchType(s);d&&!h?r=!1:!d&&h&&(r=!0)}let a=t.steps.length;if(r===!1){let d=t.doc.resolve(e+n);XC(t,d.node(),d.before(),a)}o.inlineContent&&H0(t,e+n-1,o,i.node().contentMatchAt(i.index()),r==null);let l=t.mapping.slice(a),u=l.map(e-n);if(t.step(new nt(u,l.map(e+n,-1),q.empty,!0)),r===!0){let d=t.doc.resolve(u);YC(t,d.node(),d.before(),t.steps.length)}return t}function ZU(t,e,n){let r=t.resolve(e);if(r.parent.canReplaceWith(r.index(),r.index(),n))return e;if(r.parentOffset==0)for(let s=r.depth-1;s>=0;s--){let i=r.index(s);if(r.node(s).canReplaceWith(i,i,n))return r.before(s+1);if(i>0)return null}if(r.parentOffset==r.parent.content.size)for(let s=r.depth-1;s>=0;s--){let i=r.indexAfter(s);if(r.node(s).canReplaceWith(i,i,n))return r.after(s+1);if(i<r.node(s).childCount)return null}return null}function e1(t,e,n){let r=t.resolve(e);if(!n.content.size)return e;let s=n.content;for(let i=0;i<n.openStart;i++)s=s.firstChild.content;for(let i=1;i<=(n.openStart==0&&n.size?2:1);i++)for(let o=r.depth;o>=0;o--){let a=o==r.depth?0:r.pos<=(r.start(o+1)+r.end(o+1))/2?-1:1,l=r.index(o)+(a>0?1:0),u=r.node(o),d=!1;if(i==1)d=u.canReplace(l,l,s);else{let h=u.contentMatchAt(l).findWrapping(s.firstChild.type);d=h&&u.canReplaceWith(l,l,h[0])}if(d)return a==0?r.pos:a<0?r.before(o+1):r.after(o+1)}return null}function tf(t,e,n=e,r=q.empty){if(e==n&&!r.size)return null;let s=t.resolve(e),i=t.resolve(n);return t1(s,i,r)?new nt(e,n,r):new eB(s,i,r).fit()}function t1(t,e,n){return!n.openStart&&!n.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),n.content)}class eB{constructor(e,n,r){this.$from=e,this.$to=n,this.unplaced=r,this.frontier=[],this.placed=F.empty;for(let s=0;s<=e.depth;s++){let i=e.node(s);this.frontier.push({type:i.type,match:i.contentMatchAt(e.indexAfter(s))})}for(let s=e.depth;s>0;s--)this.placed=F.from(e.node(s).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let u=this.findFittable();u?this.placeNodes(u):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),n=this.placed.size-this.depth-this.$from.depth,r=this.$from,s=this.close(e<0?this.$to:r.doc.resolve(e));if(!s)return null;let i=this.placed,o=r.depth,a=s.depth;for(;o&&a&&i.childCount==1;)i=i.firstChild.content,o--,a--;let l=new q(i,o,a);return e>-1?new st(r.pos,e,this.$to.pos,this.$to.end(),l,n):l.size||r.pos!=this.$to.pos?new nt(r.pos,s.pos,l):null}findFittable(){let e=this.unplaced.openStart;for(let n=this.unplaced.content,r=0,s=this.unplaced.openEnd;r<e;r++){let i=n.firstChild;if(n.childCount>1&&(s=0),i.type.spec.isolating&&s<=r){e=r;break}n=i.content}for(let n=1;n<=2;n++)for(let r=n==1?e:this.unplaced.openStart;r>=0;r--){let s,i=null;r?(i=Cp(this.unplaced.content,r-1).firstChild,s=i.content):s=this.unplaced.content;let o=s.firstChild;for(let a=this.depth;a>=0;a--){let{type:l,match:u}=this.frontier[a],d,h=null;if(n==1&&(o?u.matchType(o.type)||(h=u.fillBefore(F.from(o),!1)):i&&l.compatibleContent(i.type)))return{sliceDepth:r,frontierDepth:a,parent:i,inject:h};if(n==2&&o&&(d=u.findWrapping(o.type)))return{sliceDepth:r,frontierDepth:a,parent:i,wrap:d};if(i&&u.matchType(i.type))break}}}openMore(){let{content:e,openStart:n,openEnd:r}=this.unplaced,s=Cp(e,n);return!s.childCount||s.firstChild.isLeaf?!1:(this.unplaced=new q(e,n+1,Math.max(r,s.size+n>=e.size-r?n+1:0)),!0)}dropNode(){let{content:e,openStart:n,openEnd:r}=this.unplaced,s=Cp(e,n);if(s.childCount<=1&&n>0){let i=e.size-n<=n+s.size;this.unplaced=new q(ol(e,n-1,1),n-1,i?n-1:r)}else this.unplaced=new q(ol(e,n,1),n,r)}placeNodes({sliceDepth:e,frontierDepth:n,parent:r,inject:s,wrap:i}){for(;this.depth>n;)this.closeFrontierNode();if(i)for(let v=0;v<i.length;v++)this.openFrontierNode(i[v]);let o=this.unplaced,a=r?r.content:o.content,l=o.openStart-e,u=0,d=[],{match:h,type:f}=this.frontier[n];if(s){for(let v=0;v<s.childCount;v++)d.push(s.child(v));h=h.matchFragment(s)}let m=a.size+e-(o.content.size-o.openEnd);for(;u<a.childCount;){let v=a.child(u),w=h.matchType(v.type);if(!w)break;u++,(u>1||l==0||v.content.size)&&(h=w,d.push(n1(v.mark(f.allowedMarks(v.marks)),u==1?l:0,u==a.childCount?m:-1)))}let y=u==a.childCount;y||(m=-1),this.placed=al(this.placed,n,F.from(d)),this.frontier[n].match=h,y&&m<0&&r&&r.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let v=0,w=a;v<m;v++){let x=w.lastChild;this.frontier.push({type:x.type,match:x.contentMatchAt(x.childCount)}),w=x.content}this.unplaced=y?e==0?q.empty:new q(ol(o.content,e-1,1),e-1,m<0?o.openEnd:e-1):new q(ol(o.content,e,u),o.openStart,o.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],n;if(!e.type.isTextblock||!Ap(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(n=this.findCloseLevel(this.$to))&&n.depth==this.depth)return-1;let{depth:r}=this.$to,s=this.$to.after(r);for(;r>1&&s==this.$to.end(--r);)++s;return s}findCloseLevel(e){e:for(let n=Math.min(this.depth,e.depth);n>=0;n--){let{match:r,type:s}=this.frontier[n],i=n<e.depth&&e.end(n+1)==e.pos+(e.depth-(n+1)),o=Ap(e,n,s,r,i);if(o){for(let a=n-1;a>=0;a--){let{match:l,type:u}=this.frontier[a],d=Ap(e,a,u,l,!0);if(!d||d.childCount)continue e}return{depth:n,fit:o,move:i?e.doc.resolve(e.after(n+1)):e}}}}close(e){let n=this.findCloseLevel(e);if(!n)return null;for(;this.depth>n.depth;)this.closeFrontierNode();n.fit.childCount&&(this.placed=al(this.placed,n.depth,n.fit)),e=n.move;for(let r=n.depth+1;r<=e.depth;r++){let s=e.node(r),i=s.type.contentMatch.fillBefore(s.content,!0,e.index(r));this.openFrontierNode(s.type,s.attrs,i)}return e}openFrontierNode(e,n=null,r){let s=this.frontier[this.depth];s.match=s.match.matchType(e),this.placed=al(this.placed,this.depth,F.from(e.create(n,r))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let n=this.frontier.pop().match.fillBefore(F.empty,!0);n.childCount&&(this.placed=al(this.placed,this.frontier.length,n))}}function ol(t,e,n){return e==0?t.cutByIndex(n,t.childCount):t.replaceChild(0,t.firstChild.copy(ol(t.firstChild.content,e-1,n)))}function al(t,e,n){return e==0?t.append(n):t.replaceChild(t.childCount-1,t.lastChild.copy(al(t.lastChild.content,e-1,n)))}function Cp(t,e){for(let n=0;n<e;n++)t=t.firstChild.content;return t}function n1(t,e,n){if(e<=0)return t;let r=t.content;return e>1&&(r=r.replaceChild(0,n1(r.firstChild,e-1,r.childCount==1?n-1:0))),e>0&&(r=t.type.contentMatch.fillBefore(r).append(r),n<=0&&(r=r.append(t.type.contentMatch.matchFragment(r).fillBefore(F.empty,!0)))),t.copy(r)}function Ap(t,e,n,r,s){let i=t.node(e),o=s?t.indexAfter(e):t.index(e);if(o==i.childCount&&!n.compatibleContent(i.type))return null;let a=r.fillBefore(i.content,!0,o);return a&&!tB(n,i.content,o)?a:null}function tB(t,e,n){for(let r=n;r<e.childCount;r++)if(!t.allowsMarks(e.child(r).marks))return!0;return!1}function nB(t){return t.spec.defining||t.spec.definingForContent}function rB(t,e,n,r){if(!r.size)return t.deleteRange(e,n);let s=t.doc.resolve(e),i=t.doc.resolve(n);if(t1(s,i,r))return t.step(new nt(e,n,r));let o=s1(s,i);o[o.length-1]==0&&o.pop();let a=-(s.depth+1);o.unshift(a);for(let f=s.depth,m=s.pos-1;f>0;f--,m--){let y=s.node(f).type.spec;if(y.defining||y.definingAsContext||y.isolating)break;o.indexOf(f)>-1?a=f:s.before(f)==m&&o.splice(1,0,-f)}let l=o.indexOf(a),u=[],d=r.openStart;for(let f=r.content,m=0;;m++){let y=f.firstChild;if(u.push(y),m==r.openStart)break;f=y.content}for(let f=d-1;f>=0;f--){let m=u[f],y=nB(m.type);if(y&&!m.sameMarkup(s.node(Math.abs(a)-1)))d=f;else if(y||!m.type.isTextblock)break}for(let f=r.openStart;f>=0;f--){let m=(f+d+1)%(r.openStart+1),y=u[m];if(y)for(let v=0;v<o.length;v++){let w=o[(v+l)%o.length],x=!0;w<0&&(x=!1,w=-w);let S=s.node(w-1),b=s.index(w-1);if(S.canReplaceWith(b,b,y.type,y.marks))return t.replace(s.before(w),x?i.after(w):n,new q(r1(r.content,0,r.openStart,m),m,r.openEnd))}}let h=t.steps.length;for(let f=o.length-1;f>=0&&(t.replace(e,n,r),!(t.steps.length>h));f--){let m=o[f];m<0||(e=s.before(m),n=i.after(m))}}function r1(t,e,n,r,s){if(e<n){let i=t.firstChild;t=t.replaceChild(0,i.copy(r1(i.content,e+1,n,r,i)))}if(e>r){let i=s.contentMatchAt(0),o=i.fillBefore(t).append(t);t=o.append(i.matchFragment(o).fillBefore(F.empty,!0))}return t}function sB(t,e,n,r){if(!r.isInline&&e==n&&t.doc.resolve(e).parent.content.size){let s=ZU(t.doc,e,r.type);s!=null&&(e=n=s)}t.replaceRange(e,n,new q(F.from(r),0,0))}function iB(t,e,n){let r=t.doc.resolve(e),s=t.doc.resolve(n),i=s1(r,s);for(let o=0;o<i.length;o++){let a=i[o],l=o==i.length-1;if(l&&a==0||r.node(a).type.contentMatch.validEnd)return t.delete(r.start(a),s.end(a));if(a>0&&(l||r.node(a-1).canReplace(r.index(a-1),s.indexAfter(a-1))))return t.delete(r.before(a),s.after(a))}for(let o=1;o<=r.depth&&o<=s.depth;o++)if(e-r.start(o)==r.depth-o&&n>r.end(o)&&s.end(o)-n!=s.depth-o&&r.start(o-1)==s.start(o-1)&&r.node(o-1).canReplace(r.index(o-1),s.index(o-1)))return t.delete(r.before(o),n);t.delete(e,n)}function s1(t,e){let n=[],r=Math.min(t.depth,e.depth);for(let s=r;s>=0;s--){let i=t.start(s);if(i<t.pos-(t.depth-s)||e.end(s)>e.pos+(e.depth-s)||t.node(s).type.spec.isolating||e.node(s).type.spec.isolating)break;(i==e.start(s)||s==t.depth&&s==e.depth&&t.parent.inlineContent&&e.parent.inlineContent&&s&&e.start(s-1)==i-1)&&n.push(s)}return n}class Uo extends Ot{constructor(e,n,r){super(),this.pos=e,this.attr=n,this.value=r}apply(e){let n=e.nodeAt(this.pos);if(!n)return Je.fail("No node at attribute step's position");let r=Object.create(null);for(let i in n.attrs)r[i]=n.attrs[i];r[this.attr]=this.value;let s=n.type.create(r,null,n.marks);return Je.fromReplace(e,this.pos,this.pos+1,new q(F.from(s),0,n.isLeaf?0:1))}getMap(){return ln.empty}invert(e){return new Uo(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new Uo(n.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.pos!="number"||typeof n.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new Uo(n.pos,n.attr,n.value)}}Ot.jsonID("attr",Uo);class uu extends Ot{constructor(e,n){super(),this.attr=e,this.value=n}apply(e){let n=Object.create(null);for(let s in e.attrs)n[s]=e.attrs[s];n[this.attr]=this.value;let r=e.type.create(n,e.content,e.marks);return Je.ok(r)}getMap(){return ln.empty}invert(e){return new uu(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new uu(n.attr,n.value)}}Ot.jsonID("docAttr",uu);let oa=class extends Error{};oa=function t(e){let n=Error.call(this,e);return n.__proto__=t.prototype,n};oa.prototype=Object.create(Error.prototype);oa.prototype.constructor=oa;oa.prototype.name="TransformError";class oB{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new lu}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let n=this.maybeStep(e);if(n.failed)throw new oa(n.failed);return this}maybeStep(e){let n=e.apply(this.doc);return n.failed||this.addStep(e,n.doc),n}get docChanged(){return this.steps.length>0}addStep(e,n){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=n}replace(e,n=e,r=q.empty){let s=tf(this.doc,e,n,r);return s&&this.step(s),this}replaceWith(e,n,r){return this.replace(e,n,new q(F.from(r),0,0))}delete(e,n){return this.replace(e,n,q.empty)}insert(e,n){return this.replaceWith(e,e,n)}replaceRange(e,n,r){return rB(this,e,n,r),this}replaceRangeWith(e,n,r){return sB(this,e,n,r),this}deleteRange(e,n){return iB(this,e,n),this}lift(e,n){return $U(this,e,n),this}join(e,n=1){return XU(this,e,n),this}wrap(e,n){return WU(this,e,n),this}setBlockType(e,n=e,r,s=null){return KU(this,e,n,r,s),this}setNodeMarkup(e,n,r=null,s){return QU(this,e,n,r,s),this}setNodeAttribute(e,n,r){return this.step(new Uo(e,n,r)),this}setDocAttribute(e,n){return this.step(new uu(e,n)),this}addNodeMark(e,n){return this.step(new ps(e,n)),this}removeNodeMark(e,n){let r=this.doc.nodeAt(e);if(!r)throw new RangeError("No node at position "+e);if(n instanceof Ee)n.isInSet(r.marks)&&this.step(new zi(e,n));else{let s=r.marks,i,o=[];for(;i=n.isInSet(s);)o.push(new zi(e,i)),s=i.removeFromSet(s);for(let a=o.length-1;a>=0;a--)this.step(o[a])}return this}split(e,n=1,r){return JU(this,e,n,r),this}addMark(e,n,r){return UU(this,e,n,r),this}removeMark(e,n,r){return BU(this,e,n,r),this}clearIncompatible(e,n,r){return H0(this,e,n,r),this}}const Np=Object.create(null);class oe{constructor(e,n,r){this.$anchor=e,this.$head=n,this.ranges=r||[new aB(e.min(n),e.max(n))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let n=0;n<e.length;n++)if(e[n].$from.pos!=e[n].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,n=q.empty){let r=n.content.lastChild,s=null;for(let a=0;a<n.openEnd;a++)s=r,r=r.lastChild;let i=e.steps.length,o=this.ranges;for(let a=0;a<o.length;a++){let{$from:l,$to:u}=o[a],d=e.mapping.slice(i);e.replaceRange(d.map(l.pos),d.map(u.pos),a?q.empty:n),a==0&&wE(e,i,(r?r.isInline:s&&s.isTextblock)?-1:1)}}replaceWith(e,n){let r=e.steps.length,s=this.ranges;for(let i=0;i<s.length;i++){let{$from:o,$to:a}=s[i],l=e.mapping.slice(r),u=l.map(o.pos),d=l.map(a.pos);i?e.deleteRange(u,d):(e.replaceRangeWith(u,d,n),wE(e,r,n.isInline?-1:1))}}static findFrom(e,n,r=!1){let s=e.parent.inlineContent?new ne(e):ho(e.node(0),e.parent,e.pos,e.index(),n,r);if(s)return s;for(let i=e.depth-1;i>=0;i--){let o=n<0?ho(e.node(0),e.node(i),e.before(i+1),e.index(i),n,r):ho(e.node(0),e.node(i),e.after(i+1),e.index(i)+1,n,r);if(o)return o}return null}static near(e,n=1){return this.findFrom(e,n)||this.findFrom(e,-n)||new fn(e.node(0))}static atStart(e){return ho(e,e,0,0,1)||new fn(e)}static atEnd(e){return ho(e,e,e.content.size,e.childCount,-1)||new fn(e)}static fromJSON(e,n){if(!n||!n.type)throw new RangeError("Invalid input for Selection.fromJSON");let r=Np[n.type];if(!r)throw new RangeError(`No selection type ${n.type} defined`);return r.fromJSON(e,n)}static jsonID(e,n){if(e in Np)throw new RangeError("Duplicate use of selection JSON ID "+e);return Np[e]=n,n.prototype.jsonID=e,n}getBookmark(){return ne.between(this.$anchor,this.$head).getBookmark()}}oe.prototype.visible=!0;class aB{constructor(e,n){this.$from=e,this.$to=n}}let vE=!1;function _E(t){!vE&&!t.parent.inlineContent&&(vE=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+t.parent.type.name+")"))}class ne extends oe{constructor(e,n=e){_E(e),_E(n),super(e,n)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,n){let r=e.resolve(n.map(this.head));if(!r.parent.inlineContent)return oe.near(r);let s=e.resolve(n.map(this.anchor));return new ne(s.parent.inlineContent?s:r,r)}replace(e,n=q.empty){if(super.replace(e,n),n==q.empty){let r=this.$from.marksAcross(this.$to);r&&e.ensureMarks(r)}}eq(e){return e instanceof ne&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new nf(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,n){if(typeof n.anchor!="number"||typeof n.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new ne(e.resolve(n.anchor),e.resolve(n.head))}static create(e,n,r=n){let s=e.resolve(n);return new this(s,r==n?s:e.resolve(r))}static between(e,n,r){let s=e.pos-n.pos;if((!r||s)&&(r=s>=0?1:-1),!n.parent.inlineContent){let i=oe.findFrom(n,r,!0)||oe.findFrom(n,-r,!0);if(i)n=i.$head;else return oe.near(n,r)}return e.parent.inlineContent||(s==0?e=n:(e=(oe.findFrom(e,-r,!0)||oe.findFrom(e,r,!0)).$anchor,e.pos<n.pos!=s<0&&(e=n))),new ne(e,n)}}oe.jsonID("text",ne);class nf{constructor(e,n){this.anchor=e,this.head=n}map(e){return new nf(e.map(this.anchor),e.map(this.head))}resolve(e){return ne.between(e.resolve(this.anchor),e.resolve(this.head))}}class Y extends oe{constructor(e){let n=e.nodeAfter,r=e.node(0).resolve(e.pos+n.nodeSize);super(e,r),this.node=n}map(e,n){let{deleted:r,pos:s}=n.mapResult(this.anchor),i=e.resolve(s);return r?oe.near(i):new Y(i)}content(){return new q(F.from(this.node),0,0)}eq(e){return e instanceof Y&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new K0(this.anchor)}static fromJSON(e,n){if(typeof n.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new Y(e.resolve(n.anchor))}static create(e,n){return new Y(e.resolve(n))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}Y.prototype.visible=!1;oe.jsonID("node",Y);class K0{constructor(e){this.anchor=e}map(e){let{deleted:n,pos:r}=e.mapResult(this.anchor);return n?new nf(r,r):new K0(r)}resolve(e){let n=e.resolve(this.anchor),r=n.nodeAfter;return r&&Y.isSelectable(r)?new Y(n):oe.near(n)}}class fn extends oe{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,n=q.empty){if(n==q.empty){e.delete(0,e.doc.content.size);let r=oe.atStart(e.doc);r.eq(e.selection)||e.setSelection(r)}else super.replace(e,n)}toJSON(){return{type:"all"}}static fromJSON(e){return new fn(e)}map(e){return new fn(e)}eq(e){return e instanceof fn}getBookmark(){return lB}}oe.jsonID("all",fn);const lB={map(){return this},resolve(t){return new fn(t)}};function ho(t,e,n,r,s,i=!1){if(e.inlineContent)return ne.create(t,n);for(let o=r-(s>0?0:1);s>0?o<e.childCount:o>=0;o+=s){let a=e.child(o);if(a.isAtom){if(!i&&Y.isSelectable(a))return Y.create(t,n-(s<0?a.nodeSize:0))}else{let l=ho(t,a,n+s,s<0?a.childCount:0,s,i);if(l)return l}n+=a.nodeSize*s}return null}function wE(t,e,n){let r=t.steps.length-1;if(r<e)return;let s=t.steps[r];if(!(s instanceof nt||s instanceof st))return;let i=t.mapping.maps[r],o;i.forEach((a,l,u,d)=>{o==null&&(o=d)}),t.setSelection(oe.near(t.doc.resolve(o),n))}const xE=1,Dc=2,EE=4;class uB extends oB{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|xE)&~Dc,this.storedMarks=null,this}get selectionSet(){return(this.updated&xE)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=Dc,this}ensureMarks(e){return Ee.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&Dc)>0}addStep(e,n){super.addStep(e,n),this.updated=this.updated&~Dc,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,n=!0){let r=this.selection;return n&&(e=e.mark(this.storedMarks||(r.empty?r.$from.marks():r.$from.marksAcross(r.$to)||Ee.none))),r.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,n,r){let s=this.doc.type.schema;if(n==null)return e?this.replaceSelectionWith(s.text(e),!0):this.deleteSelection();{if(r==null&&(r=n),!e)return this.deleteRange(n,r);let i=this.storedMarks;if(!i){let o=this.doc.resolve(n);i=r==n?o.marks():o.marksAcross(this.doc.resolve(r))}return this.replaceRangeWith(n,r,s.text(e,i)),!this.selection.empty&&this.selection.to==n+e.length&&this.setSelection(oe.near(this.selection.$to)),this}}setMeta(e,n){return this.meta[typeof e=="string"?e:e.key]=n,this}getMeta(e){return this.meta[typeof e=="string"?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=EE,this}get scrolledIntoView(){return(this.updated&EE)>0}}function SE(t,e){return!e||!t?t:t.bind(e)}class ll{constructor(e,n,r){this.name=e,this.init=SE(n.init,r),this.apply=SE(n.apply,r)}}const cB=[new ll("doc",{init(t){return t.doc||t.schema.topNodeType.createAndFill()},apply(t){return t.doc}}),new ll("selection",{init(t,e){return t.selection||oe.atStart(e.doc)},apply(t){return t.selection}}),new ll("storedMarks",{init(t){return t.storedMarks||null},apply(t,e,n,r){return r.selection.$cursor?t.storedMarks:null}}),new ll("scrollToSelection",{init(){return 0},apply(t,e){return t.scrolledIntoView?e+1:e}})];class Rp{constructor(e,n){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=cB.slice(),n&&n.forEach(r=>{if(this.pluginsByKey[r.key])throw new RangeError("Adding different instances of a keyed plugin ("+r.key+")");this.plugins.push(r),this.pluginsByKey[r.key]=r,r.spec.state&&this.fields.push(new ll(r.key,r.spec.state,r))})}}class ko{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,n=-1){for(let r=0;r<this.config.plugins.length;r++)if(r!=n){let s=this.config.plugins[r];if(s.spec.filterTransaction&&!s.spec.filterTransaction.call(s,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let n=[e],r=this.applyInner(e),s=null;for(;;){let i=!1;for(let o=0;o<this.config.plugins.length;o++){let a=this.config.plugins[o];if(a.spec.appendTransaction){let l=s?s[o].n:0,u=s?s[o].state:this,d=l<n.length&&a.spec.appendTransaction.call(a,l?n.slice(l):n,u,r);if(d&&r.filterTransaction(d,o)){if(d.setMeta("appendedTransaction",e),!s){s=[];for(let h=0;h<this.config.plugins.length;h++)s.push(h<o?{state:r,n:n.length}:{state:this,n:0})}n.push(d),r=r.applyInner(d),i=!0}s&&(s[o]={state:r,n:n.length})}}if(!i)return{state:r,transactions:n}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let n=new ko(this.config),r=this.config.fields;for(let s=0;s<r.length;s++){let i=r[s];n[i.name]=i.apply(e,this[i.name],this,n)}return n}get tr(){return new uB(this)}static create(e){let n=new Rp(e.doc?e.doc.type.schema:e.schema,e.plugins),r=new ko(n);for(let s=0;s<n.fields.length;s++)r[n.fields[s].name]=n.fields[s].init(e,r);return r}reconfigure(e){let n=new Rp(this.schema,e.plugins),r=n.fields,s=new ko(n);for(let i=0;i<r.length;i++){let o=r[i].name;s[o]=this.hasOwnProperty(o)?this[o]:r[i].init(e,s)}return s}toJSON(e){let n={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(n.storedMarks=this.storedMarks.map(r=>r.toJSON())),e&&typeof e=="object")for(let r in e){if(r=="doc"||r=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let s=e[r],i=s.spec.state;i&&i.toJSON&&(n[r]=i.toJSON.call(s,this[s.key]))}return n}static fromJSON(e,n,r){if(!n)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let s=new Rp(e.schema,e.plugins),i=new ko(s);return s.fields.forEach(o=>{if(o.name=="doc")i.doc=Cs.fromJSON(e.schema,n.doc);else if(o.name=="selection")i.selection=oe.fromJSON(i.doc,n.selection);else if(o.name=="storedMarks")n.storedMarks&&(i.storedMarks=n.storedMarks.map(e.schema.markFromJSON));else{if(r)for(let a in r){let l=r[a],u=l.spec.state;if(l.key==o.name&&u&&u.fromJSON&&Object.prototype.hasOwnProperty.call(n,a)){i[o.name]=u.fromJSON.call(l,e,n[a],i);return}}i[o.name]=o.init(e,i)}}),i}}function i1(t,e,n){for(let r in t){let s=t[r];s instanceof Function?s=s.bind(e):r=="handleDOMEvents"&&(s=i1(s,e,{})),n[r]=s}return n}class sn{constructor(e){this.spec=e,this.props={},e.props&&i1(e.props,this,this.props),this.key=e.key?e.key.key:o1("plugin")}getState(e){return e[this.key]}}const Pp=Object.create(null);function o1(t){return t in Pp?t+"$"+ ++Pp[t]:(Pp[t]=0,t+"$")}class lr{constructor(e="key"){this.key=o1(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const ht=function(t){for(var e=0;;e++)if(t=t.previousSibling,!t)return e},aa=function(t){let e=t.assignedSlot||t.parentNode;return e&&e.nodeType==11?e.host:e};let Sg=null;const yr=function(t,e,n){let r=Sg||(Sg=document.createRange());return r.setEnd(t,n??t.nodeValue.length),r.setStart(t,e||0),r},dB=function(){Sg=null},$i=function(t,e,n,r){return n&&(bE(t,e,n,r,-1)||bE(t,e,n,r,1))},hB=/^(img|br|input|textarea|hr)$/i;function bE(t,e,n,r,s){for(var i;;){if(t==n&&e==r)return!0;if(e==(s<0?0:wn(t))){let o=t.parentNode;if(!o||o.nodeType!=1||ju(t)||hB.test(t.nodeName)||t.contentEditable=="false")return!1;e=ht(t)+(s<0?0:1),t=o}else if(t.nodeType==1){let o=t.childNodes[e+(s<0?-1:0)];if(o.nodeType==1&&o.contentEditable=="false")if(!((i=o.pmViewDesc)===null||i===void 0)&&i.ignoreForSelection)e+=s;else return!1;else t=o,e=s<0?wn(t):0}else return!1}}function wn(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function fB(t,e){for(;;){if(t.nodeType==3&&e)return t;if(t.nodeType==1&&e>0){if(t.contentEditable=="false")return null;t=t.childNodes[e-1],e=wn(t)}else if(t.parentNode&&!ju(t))e=ht(t),t=t.parentNode;else return null}}function pB(t,e){for(;;){if(t.nodeType==3&&e<t.nodeValue.length)return t;if(t.nodeType==1&&e<t.childNodes.length){if(t.contentEditable=="false")return null;t=t.childNodes[e],e=0}else if(t.parentNode&&!ju(t))e=ht(t)+1,t=t.parentNode;else return null}}function mB(t,e,n){for(let r=e==0,s=e==wn(t);r||s;){if(t==n)return!0;let i=ht(t);if(t=t.parentNode,!t)return!1;r=r&&i==0,s=s&&i==wn(t)}}function ju(t){let e;for(let n=t;n&&!(e=n.pmViewDesc);n=n.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==t||e.contentDOM==t)}const rf=function(t){return t.focusNode&&$i(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset)};function ui(t,e){let n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=t,n.key=n.code=e,n}function gB(t){let e=t.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function yB(t,e,n){if(t.caretPositionFromPoint)try{let r=t.caretPositionFromPoint(e,n);if(r)return{node:r.offsetNode,offset:Math.min(wn(r.offsetNode),r.offset)}}catch{}if(t.caretRangeFromPoint){let r=t.caretRangeFromPoint(e,n);if(r)return{node:r.startContainer,offset:Math.min(wn(r.startContainer),r.startOffset)}}}const ir=typeof navigator<"u"?navigator:null,TE=typeof document<"u"?document:null,Zs=ir&&ir.userAgent||"",bg=/Edge\/(\d+)/.exec(Zs),a1=/MSIE \d/.exec(Zs),Tg=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Zs),nn=!!(a1||Tg||bg),Ns=a1?document.documentMode:Tg?+Tg[1]:bg?+bg[1]:0,kn=!nn&&/gecko\/(\d+)/i.test(Zs);kn&&+(/Firefox\/(\d+)/.exec(Zs)||[0,0])[1];const kg=!nn&&/Chrome\/(\d+)/.exec(Zs),Nt=!!kg,l1=kg?+kg[1]:0,Ut=!nn&&!!ir&&/Apple Computer/.test(ir.vendor),la=Ut&&(/Mobile\/\w+/.test(Zs)||!!ir&&ir.maxTouchPoints>2),yn=la||(ir?/Mac/.test(ir.platform):!1),vB=ir?/Win/.test(ir.platform):!1,Tr=/Android \d/.test(Zs),Fu=!!TE&&"webkitFontSmoothing"in TE.documentElement.style,_B=Fu?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function wB(t){let e=t.defaultView&&t.defaultView.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:t.documentElement.clientWidth,top:0,bottom:t.documentElement.clientHeight}}function mr(t,e){return typeof t=="number"?t:t[e]}function xB(t){let e=t.getBoundingClientRect(),n=e.width/t.offsetWidth||1,r=e.height/t.offsetHeight||1;return{left:e.left,right:e.left+t.clientWidth*n,top:e.top,bottom:e.top+t.clientHeight*r}}function kE(t,e,n){let r=t.someProp("scrollThreshold")||0,s=t.someProp("scrollMargin")||5,i=t.dom.ownerDocument;for(let o=n||t.dom;o;){if(o.nodeType!=1){o=aa(o);continue}let a=o,l=a==i.body,u=l?wB(i):xB(a),d=0,h=0;if(e.top<u.top+mr(r,"top")?h=-(u.top-e.top+mr(s,"top")):e.bottom>u.bottom-mr(r,"bottom")&&(h=e.bottom-e.top>u.bottom-u.top?e.top+mr(s,"top")-u.top:e.bottom-u.bottom+mr(s,"bottom")),e.left<u.left+mr(r,"left")?d=-(u.left-e.left+mr(s,"left")):e.right>u.right-mr(r,"right")&&(d=e.right-u.right+mr(s,"right")),d||h)if(l)i.defaultView.scrollBy(d,h);else{let m=a.scrollLeft,y=a.scrollTop;h&&(a.scrollTop+=h),d&&(a.scrollLeft+=d);let v=a.scrollLeft-m,w=a.scrollTop-y;e={left:e.left-v,top:e.top-w,right:e.right-v,bottom:e.bottom-w}}let f=l?"fixed":getComputedStyle(o).position;if(/^(fixed|sticky)$/.test(f))break;o=f=="absolute"?o.offsetParent:aa(o)}}function EB(t){let e=t.dom.getBoundingClientRect(),n=Math.max(0,e.top),r,s;for(let i=(e.left+e.right)/2,o=n+1;o<Math.min(innerHeight,e.bottom);o+=5){let a=t.root.elementFromPoint(i,o);if(!a||a==t.dom||!t.dom.contains(a))continue;let l=a.getBoundingClientRect();if(l.top>=n-20){r=a,s=l.top;break}}return{refDOM:r,refTop:s,stack:u1(t.dom)}}function u1(t){let e=[],n=t.ownerDocument;for(let r=t;r&&(e.push({dom:r,top:r.scrollTop,left:r.scrollLeft}),t!=n);r=aa(r));return e}function SB({refDOM:t,refTop:e,stack:n}){let r=t?t.getBoundingClientRect().top:0;c1(n,r==0?0:r-e)}function c1(t,e){for(let n=0;n<t.length;n++){let{dom:r,top:s,left:i}=t[n];r.scrollTop!=s+e&&(r.scrollTop=s+e),r.scrollLeft!=i&&(r.scrollLeft=i)}}let oo=null;function bB(t){if(t.setActive)return t.setActive();if(oo)return t.focus(oo);let e=u1(t);t.focus(oo==null?{get preventScroll(){return oo={preventScroll:!0},!0}}:void 0),oo||(oo=!1,c1(e,0))}function d1(t,e){let n,r=2e8,s,i=0,o=e.top,a=e.top,l,u;for(let d=t.firstChild,h=0;d;d=d.nextSibling,h++){let f;if(d.nodeType==1)f=d.getClientRects();else if(d.nodeType==3)f=yr(d).getClientRects();else continue;for(let m=0;m<f.length;m++){let y=f[m];if(y.top<=o&&y.bottom>=a){o=Math.max(y.bottom,o),a=Math.min(y.top,a);let v=y.left>e.left?y.left-e.left:y.right<e.left?e.left-y.right:0;if(v<r){n=d,r=v,s=v&&n.nodeType==3?{left:y.right<e.left?y.right:y.left,top:e.top}:e,d.nodeType==1&&v&&(i=h+(e.left>=(y.left+y.right)/2?1:0));continue}}else y.top>e.top&&!l&&y.left<=e.left&&y.right>=e.left&&(l=d,u={left:Math.max(y.left,Math.min(y.right,e.left)),top:y.top});!n&&(e.left>=y.right&&e.top>=y.top||e.left>=y.left&&e.top>=y.bottom)&&(i=h+1)}}return!n&&l&&(n=l,s=u,r=0),n&&n.nodeType==3?TB(n,s):!n||r&&n.nodeType==1?{node:t,offset:i}:d1(n,s)}function TB(t,e){let n=t.nodeValue.length,r=document.createRange();for(let s=0;s<n;s++){r.setEnd(t,s+1),r.setStart(t,s);let i=Jr(r,1);if(i.top!=i.bottom&&G0(e,i))return{node:t,offset:s+(e.left>=(i.left+i.right)/2?1:0)}}return{node:t,offset:0}}function G0(t,e){return t.left>=e.left-1&&t.left<=e.right+1&&t.top>=e.top-1&&t.top<=e.bottom+1}function kB(t,e){let n=t.parentNode;return n&&/^li$/i.test(n.nodeName)&&e.left<t.getBoundingClientRect().left?n:t}function IB(t,e,n){let{node:r,offset:s}=d1(e,n),i=-1;if(r.nodeType==1&&!r.firstChild){let o=r.getBoundingClientRect();i=o.left!=o.right&&n.left>(o.left+o.right)/2?1:-1}return t.docView.posFromDOM(r,s,i)}function CB(t,e,n,r){let s=-1;for(let i=e,o=!1;i!=t.dom;){let a=t.docView.nearestDesc(i,!0),l;if(!a)return null;if(a.dom.nodeType==1&&(a.node.isBlock&&a.parent||!a.contentDOM)&&((l=a.dom.getBoundingClientRect()).width||l.height)&&(a.node.isBlock&&a.parent&&!/^T(R|BODY|HEAD|FOOT)$/.test(a.dom.nodeName)&&(!o&&l.left>r.left||l.top>r.top?s=a.posBefore:(!o&&l.right<r.left||l.bottom<r.top)&&(s=a.posAfter),o=!0),!a.contentDOM&&s<0&&!a.node.isText))return(a.node.isBlock?r.top<(l.top+l.bottom)/2:r.left<(l.left+l.right)/2)?a.posBefore:a.posAfter;i=a.dom.parentNode}return s>-1?s:t.docView.posFromDOM(e,n,-1)}function h1(t,e,n){let r=t.childNodes.length;if(r&&n.top<n.bottom)for(let s=Math.max(0,Math.min(r-1,Math.floor(r*(e.top-n.top)/(n.bottom-n.top))-2)),i=s;;){let o=t.childNodes[i];if(o.nodeType==1){let a=o.getClientRects();for(let l=0;l<a.length;l++){let u=a[l];if(G0(e,u))return h1(o,e,u)}}if((i=(i+1)%r)==s)break}return t}function AB(t,e){let n=t.dom.ownerDocument,r,s=0,i=yB(n,e.left,e.top);i&&({node:r,offset:s}=i);let o=(t.root.elementFromPoint?t.root:n).elementFromPoint(e.left,e.top),a;if(!o||!t.dom.contains(o.nodeType!=1?o.parentNode:o)){let u=t.dom.getBoundingClientRect();if(!G0(e,u)||(o=h1(t.dom,e,u),!o))return null}if(Ut)for(let u=o;r&&u;u=aa(u))u.draggable&&(r=void 0);if(o=kB(o,e),r){if(kn&&r.nodeType==1&&(s=Math.min(s,r.childNodes.length),s<r.childNodes.length)){let d=r.childNodes[s],h;d.nodeName=="IMG"&&(h=d.getBoundingClientRect()).right<=e.left&&h.bottom>e.top&&s++}let u;Fu&&s&&r.nodeType==1&&(u=r.childNodes[s-1]).nodeType==1&&u.contentEditable=="false"&&u.getBoundingClientRect().top>=e.top&&s--,r==t.dom&&s==r.childNodes.length-1&&r.lastChild.nodeType==1&&e.top>r.lastChild.getBoundingClientRect().bottom?a=t.state.doc.content.size:(s==0||r.nodeType!=1||r.childNodes[s-1].nodeName!="BR")&&(a=CB(t,r,s,e))}a==null&&(a=IB(t,o,e));let l=t.docView.nearestDesc(o,!0);return{pos:a,inside:l?l.posAtStart-l.border:-1}}function IE(t){return t.top<t.bottom||t.left<t.right}function Jr(t,e){let n=t.getClientRects();if(n.length){let r=n[e<0?0:n.length-1];if(IE(r))return r}return Array.prototype.find.call(n,IE)||t.getBoundingClientRect()}const NB=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function f1(t,e,n){let{node:r,offset:s,atom:i}=t.docView.domFromPos(e,n<0?-1:1),o=Fu||kn;if(r.nodeType==3)if(o&&(NB.test(r.nodeValue)||(n<0?!s:s==r.nodeValue.length))){let l=Jr(yr(r,s,s),n);if(kn&&s&&/\s/.test(r.nodeValue[s-1])&&s<r.nodeValue.length){let u=Jr(yr(r,s-1,s-1),-1);if(u.top==l.top){let d=Jr(yr(r,s,s+1),-1);if(d.top!=l.top)return Qa(d,d.left<u.left)}}return l}else{let l=s,u=s,d=n<0?1:-1;return n<0&&!s?(u++,d=-1):n>=0&&s==r.nodeValue.length?(l--,d=1):n<0?l--:u++,Qa(Jr(yr(r,l,u),d),d<0)}if(!t.state.doc.resolve(e-(i||0)).parent.inlineContent){if(i==null&&s&&(n<0||s==wn(r))){let l=r.childNodes[s-1];if(l.nodeType==1)return Dp(l.getBoundingClientRect(),!1)}if(i==null&&s<wn(r)){let l=r.childNodes[s];if(l.nodeType==1)return Dp(l.getBoundingClientRect(),!0)}return Dp(r.getBoundingClientRect(),n>=0)}if(i==null&&s&&(n<0||s==wn(r))){let l=r.childNodes[s-1],u=l.nodeType==3?yr(l,wn(l)-(o?0:1)):l.nodeType==1&&(l.nodeName!="BR"||!l.nextSibling)?l:null;if(u)return Qa(Jr(u,1),!1)}if(i==null&&s<wn(r)){let l=r.childNodes[s];for(;l.pmViewDesc&&l.pmViewDesc.ignoreForCoords;)l=l.nextSibling;let u=l?l.nodeType==3?yr(l,0,o?0:1):l.nodeType==1?l:null:null;if(u)return Qa(Jr(u,-1),!0)}return Qa(Jr(r.nodeType==3?yr(r):r,-n),n>=0)}function Qa(t,e){if(t.width==0)return t;let n=e?t.left:t.right;return{top:t.top,bottom:t.bottom,left:n,right:n}}function Dp(t,e){if(t.height==0)return t;let n=e?t.top:t.bottom;return{top:n,bottom:n,left:t.left,right:t.right}}function p1(t,e,n){let r=t.state,s=t.root.activeElement;r!=e&&t.updateState(e),s!=t.dom&&t.focus();try{return n()}finally{r!=e&&t.updateState(r),s!=t.dom&&s&&s.focus()}}function RB(t,e,n){let r=e.selection,s=n=="up"?r.$from:r.$to;return p1(t,e,()=>{let{node:i}=t.docView.domFromPos(s.pos,n=="up"?-1:1);for(;;){let a=t.docView.nearestDesc(i,!0);if(!a)break;if(a.node.isBlock){i=a.contentDOM||a.dom;break}i=a.dom.parentNode}let o=f1(t,s.pos,1);for(let a=i.firstChild;a;a=a.nextSibling){let l;if(a.nodeType==1)l=a.getClientRects();else if(a.nodeType==3)l=yr(a,0,a.nodeValue.length).getClientRects();else continue;for(let u=0;u<l.length;u++){let d=l[u];if(d.bottom>d.top+1&&(n=="up"?o.top-d.top>(d.bottom-o.top)*2:d.bottom-o.bottom>(o.bottom-d.top)*2))return!1}}return!0})}const PB=/[\u0590-\u08ac]/;function DB(t,e,n){let{$head:r}=e.selection;if(!r.parent.isTextblock)return!1;let s=r.parentOffset,i=!s,o=s==r.parent.content.size,a=t.domSelection();return a?!PB.test(r.parent.textContent)||!a.modify?n=="left"||n=="backward"?i:o:p1(t,e,()=>{let{focusNode:l,focusOffset:u,anchorNode:d,anchorOffset:h}=t.domSelectionRange(),f=a.caretBidiLevel;a.modify("move",n,"character");let m=r.depth?t.docView.domAfterPos(r.before()):t.dom,{focusNode:y,focusOffset:v}=t.domSelectionRange(),w=y&&!m.contains(y.nodeType==1?y:y.parentNode)||l==y&&u==v;try{a.collapse(d,h),l&&(l!=d||u!=h)&&a.extend&&a.extend(l,u)}catch{}return f!=null&&(a.caretBidiLevel=f),w}):r.pos==r.start()||r.pos==r.end()}let CE=null,AE=null,NE=!1;function OB(t,e,n){return CE==e&&AE==n?NE:(CE=e,AE=n,NE=n=="up"||n=="down"?RB(t,e,n):DB(t,e,n))}const In=0,RE=1,gi=2,or=3;class Uu{constructor(e,n,r,s){this.parent=e,this.children=n,this.dom=r,this.contentDOM=s,this.dirty=In,r.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,n,r){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let n=0;n<this.children.length;n++)e+=this.children[n].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let n=0,r=this.posAtStart;;n++){let s=this.children[n];if(s==e)return r;r+=s.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,n,r){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(r<0){let i,o;if(e==this.contentDOM)i=e.childNodes[n-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;i=e.previousSibling}for(;i&&!((o=i.pmViewDesc)&&o.parent==this);)i=i.previousSibling;return i?this.posBeforeChild(o)+o.size:this.posAtStart}else{let i,o;if(e==this.contentDOM)i=e.childNodes[n];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;i=e.nextSibling}for(;i&&!((o=i.pmViewDesc)&&o.parent==this);)i=i.nextSibling;return i?this.posBeforeChild(o):this.posAtEnd}let s;if(e==this.dom&&this.contentDOM)s=n>ht(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))s=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(n==0)for(let i=e;;i=i.parentNode){if(i==this.dom){s=!1;break}if(i.previousSibling)break}if(s==null&&n==e.childNodes.length)for(let i=e;;i=i.parentNode){if(i==this.dom){s=!0;break}if(i.nextSibling)break}}return s??r>0?this.posAtEnd:this.posAtStart}nearestDesc(e,n=!1){for(let r=!0,s=e;s;s=s.parentNode){let i=this.getDesc(s),o;if(i&&(!n||i.node))if(r&&(o=i.nodeDOM)&&!(o.nodeType==1?o.contains(e.nodeType==1?e:e.parentNode):o==e))r=!1;else return i}}getDesc(e){let n=e.pmViewDesc;for(let r=n;r;r=r.parent)if(r==this)return n}posFromDOM(e,n,r){for(let s=e;s;s=s.parentNode){let i=this.getDesc(s);if(i)return i.localPosFromDOM(e,n,r)}return-1}descAt(e){for(let n=0,r=0;n<this.children.length;n++){let s=this.children[n],i=r+s.size;if(r==e&&i!=r){for(;!s.border&&s.children.length;)for(let o=0;o<s.children.length;o++){let a=s.children[o];if(a.size){s=a;break}}return s}if(e<i)return s.descAt(e-r-s.border);r=i}}domFromPos(e,n){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let r=0,s=0;for(let i=0;r<this.children.length;r++){let o=this.children[r],a=i+o.size;if(a>e||o instanceof g1){s=e-i;break}i=a}if(s)return this.children[r].domFromPos(s-this.children[r].border,n);for(let i;r&&!(i=this.children[r-1]).size&&i instanceof m1&&i.side>=0;r--);if(n<=0){let i,o=!0;for(;i=r?this.children[r-1]:null,!(!i||i.dom.parentNode==this.contentDOM);r--,o=!1);return i&&n&&o&&!i.border&&!i.domAtom?i.domFromPos(i.size,n):{node:this.contentDOM,offset:i?ht(i.dom)+1:0}}else{let i,o=!0;for(;i=r<this.children.length?this.children[r]:null,!(!i||i.dom.parentNode==this.contentDOM);r++,o=!1);return i&&o&&!i.border&&!i.domAtom?i.domFromPos(0,n):{node:this.contentDOM,offset:i?ht(i.dom):this.contentDOM.childNodes.length}}}parseRange(e,n,r=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:n,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let s=-1,i=-1;for(let o=r,a=0;;a++){let l=this.children[a],u=o+l.size;if(s==-1&&e<=u){let d=o+l.border;if(e>=d&&n<=u-l.border&&l.node&&l.contentDOM&&this.contentDOM.contains(l.contentDOM))return l.parseRange(e,n,d);e=o;for(let h=a;h>0;h--){let f=this.children[h-1];if(f.size&&f.dom.parentNode==this.contentDOM&&!f.emptyChildAt(1)){s=ht(f.dom)+1;break}e-=f.size}s==-1&&(s=0)}if(s>-1&&(u>n||a==this.children.length-1)){n=u;for(let d=a+1;d<this.children.length;d++){let h=this.children[d];if(h.size&&h.dom.parentNode==this.contentDOM&&!h.emptyChildAt(-1)){i=ht(h.dom);break}n+=h.size}i==-1&&(i=this.contentDOM.childNodes.length);break}o=u}return{node:this.contentDOM,from:e,to:n,fromOffset:s,toOffset:i}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let n=this.children[e<0?0:this.children.length-1];return n.size==0||n.emptyChildAt(e)}domAfterPos(e){let{node:n,offset:r}=this.domFromPos(e,0);if(n.nodeType!=1||r==n.childNodes.length)throw new RangeError("No node after pos "+e);return n.childNodes[r]}setSelection(e,n,r,s=!1){let i=Math.min(e,n),o=Math.max(e,n);for(let m=0,y=0;m<this.children.length;m++){let v=this.children[m],w=y+v.size;if(i>y&&o<w)return v.setSelection(e-y-v.border,n-y-v.border,r,s);y=w}let a=this.domFromPos(e,e?-1:1),l=n==e?a:this.domFromPos(n,n?-1:1),u=r.root.getSelection(),d=r.domSelectionRange(),h=!1;if((kn||Ut)&&e==n){let{node:m,offset:y}=a;if(m.nodeType==3){if(h=!!(y&&m.nodeValue[y-1]==`
`),h&&y==m.nodeValue.length)for(let v=m,w;v;v=v.parentNode){if(w=v.nextSibling){w.nodeName=="BR"&&(a=l={node:w.parentNode,offset:ht(w)+1});break}let x=v.pmViewDesc;if(x&&x.node&&x.node.isBlock)break}}else{let v=m.childNodes[y-1];h=v&&(v.nodeName=="BR"||v.contentEditable=="false")}}if(kn&&d.focusNode&&d.focusNode!=l.node&&d.focusNode.nodeType==1){let m=d.focusNode.childNodes[d.focusOffset];m&&m.contentEditable=="false"&&(s=!0)}if(!(s||h&&Ut)&&$i(a.node,a.offset,d.anchorNode,d.anchorOffset)&&$i(l.node,l.offset,d.focusNode,d.focusOffset))return;let f=!1;if((u.extend||e==n)&&!(h&&kn)){u.collapse(a.node,a.offset);try{e!=n&&u.extend(l.node,l.offset),f=!0}catch{}}if(!f){if(e>n){let y=a;a=l,l=y}let m=document.createRange();m.setEnd(l.node,l.offset),m.setStart(a.node,a.offset),u.removeAllRanges(),u.addRange(m)}}ignoreMutation(e){return!this.contentDOM&&e.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,n){for(let r=0,s=0;s<this.children.length;s++){let i=this.children[s],o=r+i.size;if(r==o?e<=o&&n>=r:e<o&&n>r){let a=r+i.border,l=o-i.border;if(e>=a&&n<=l){this.dirty=e==r||n==o?gi:RE,e==a&&n==l&&(i.contentLost||i.dom.parentNode!=this.contentDOM)?i.dirty=or:i.markDirty(e-a,n-a);return}else i.dirty=i.dom==i.contentDOM&&i.dom.parentNode==this.contentDOM&&!i.children.length?gi:or}r=o}this.dirty=gi}markParentsDirty(){let e=1;for(let n=this.parent;n;n=n.parent,e++){let r=e==1?gi:RE;n.dirty<r&&(n.dirty=r)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(e){return!1}}class m1 extends Uu{constructor(e,n,r,s){let i,o=n.type.toDOM;if(typeof o=="function"&&(o=o(r,()=>{if(!i)return s;if(i.parent)return i.parent.posBeforeChild(i)})),!n.type.spec.raw){if(o.nodeType!=1){let a=document.createElement("span");a.appendChild(o),o=a}o.contentEditable="false",o.classList.add("ProseMirror-widget")}super(e,[],o,null),this.widget=n,this.widget=n,i=this}matchesWidget(e){return this.dirty==In&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let n=this.widget.spec.stopEvent;return n?n(e):!1}ignoreMutation(e){return e.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}}class MB extends Uu{constructor(e,n,r,s){super(e,[],n,null),this.textDOM=r,this.text=s}get size(){return this.text.length}localPosFromDOM(e,n){return e!=this.textDOM?this.posAtStart+(n?this.size:0):this.posAtStart+n}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type==="characterData"&&e.target.nodeValue==e.oldValue}}class qi extends Uu{constructor(e,n,r,s,i){super(e,[],r,s),this.mark=n,this.spec=i}static create(e,n,r,s){let i=s.nodeViews[n.type.name],o=i&&i(n,s,r);return(!o||!o.dom)&&(o=Xi.renderSpec(document,n.type.spec.toDOM(n,r),null,n.attrs)),new qi(e,n,o.dom,o.contentDOM||o.dom,o)}parseRule(){return this.dirty&or||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return this.dirty!=or&&this.mark.eq(e)}markDirty(e,n){if(super.markDirty(e,n),this.dirty!=In){let r=this.parent;for(;!r.node;)r=r.parent;r.dirty<this.dirty&&(r.dirty=this.dirty),this.dirty=In}}slice(e,n,r){let s=qi.create(this.parent,this.mark,!0,r),i=this.children,o=this.size;n<o&&(i=Cg(i,n,o,r)),e>0&&(i=Cg(i,0,e,r));for(let a=0;a<i.length;a++)i[a].parent=s;return s.children=i,s}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class Rs extends Uu{constructor(e,n,r,s,i,o,a,l,u){super(e,[],i,o),this.node=n,this.outerDeco=r,this.innerDeco=s,this.nodeDOM=a}static create(e,n,r,s,i,o){let a=i.nodeViews[n.type.name],l,u=a&&a(n,i,()=>{if(!l)return o;if(l.parent)return l.parent.posBeforeChild(l)},r,s),d=u&&u.dom,h=u&&u.contentDOM;if(n.isText){if(!d)d=document.createTextNode(n.text);else if(d.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else d||({dom:d,contentDOM:h}=Xi.renderSpec(document,n.type.spec.toDOM(n),null,n.attrs));!h&&!n.isText&&d.nodeName!="BR"&&(d.hasAttribute("contenteditable")||(d.contentEditable="false"),n.type.spec.draggable&&(d.draggable=!0));let f=d;return d=_1(d,r,n),u?l=new LB(e,n,r,s,d,h||null,f,u,i,o+1):n.isText?new sf(e,n,r,s,d,f,i):new Rs(e,n,r,s,d,h||null,f,i,o+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(e.preserveWhitespace="full"),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let n=this.children.length-1;n>=0;n--){let r=this.children[n];if(this.dom.contains(r.dom.parentNode)){e.contentElement=r.dom.parentNode;break}}e.contentElement||(e.getContent=()=>F.empty)}return e}matchesNode(e,n,r){return this.dirty==In&&e.eq(this.node)&&nh(n,this.outerDeco)&&r.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,n){let r=this.node.inlineContent,s=n,i=e.composing?this.localCompositionInfo(e,n):null,o=i&&i.pos>-1?i:null,a=i&&i.pos<0,l=new jB(this,o&&o.node,e);BB(this.node,this.innerDeco,(u,d,h)=>{u.spec.marks?l.syncToMarks(u.spec.marks,r,e):u.type.side>=0&&!h&&l.syncToMarks(d==this.node.childCount?Ee.none:this.node.child(d).marks,r,e),l.placeWidget(u,e,s)},(u,d,h,f)=>{l.syncToMarks(u.marks,r,e);let m;l.findNodeMatch(u,d,h,f)||a&&e.state.selection.from>s&&e.state.selection.to<s+u.nodeSize&&(m=l.findIndexWithChild(i.node))>-1&&l.updateNodeAt(u,d,h,m,e)||l.updateNextNode(u,d,h,e,f,s)||l.addNode(u,d,h,e,s),s+=u.nodeSize}),l.syncToMarks([],r,e),this.node.isTextblock&&l.addTextblockHacks(),l.destroyRest(),(l.changed||this.dirty==gi)&&(o&&this.protectLocalComposition(e,o),y1(this.contentDOM,this.children,e),la&&zB(this.dom))}localCompositionInfo(e,n){let{from:r,to:s}=e.state.selection;if(!(e.state.selection instanceof ne)||r<n||s>n+this.node.content.size)return null;let i=e.input.compositionNode;if(!i||!this.dom.contains(i.parentNode))return null;if(this.node.inlineContent){let o=i.nodeValue,a=$B(this.node.content,o,r-n,s-n);return a<0?null:{node:i,pos:a,text:o}}else return{node:i,pos:-1,text:""}}protectLocalComposition(e,{node:n,pos:r,text:s}){if(this.getDesc(n))return;let i=n;for(;i.parentNode!=this.contentDOM;i=i.parentNode){for(;i.previousSibling;)i.parentNode.removeChild(i.previousSibling);for(;i.nextSibling;)i.parentNode.removeChild(i.nextSibling);i.pmViewDesc&&(i.pmViewDesc=void 0)}let o=new MB(this,i,n,s);e.input.compositionNodes.push(o),this.children=Cg(this.children,r,r+s.length,e,o)}update(e,n,r,s){return this.dirty==or||!e.sameMarkup(this.node)?!1:(this.updateInner(e,n,r,s),!0)}updateInner(e,n,r,s){this.updateOuterDeco(n),this.node=e,this.innerDeco=r,this.contentDOM&&this.updateChildren(s,this.posAtStart),this.dirty=In}updateOuterDeco(e){if(nh(e,this.outerDeco))return;let n=this.nodeDOM.nodeType!=1,r=this.dom;this.dom=v1(this.dom,this.nodeDOM,Ig(this.outerDeco,this.node,n),Ig(e,this.node,n)),this.dom!=r&&(r.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.nodeDOM.draggable=!0))}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.nodeDOM.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function PE(t,e,n,r,s){_1(r,e,t);let i=new Rs(void 0,t,e,n,r,r,r,s,0);return i.contentDOM&&i.updateChildren(s,0),i}class sf extends Rs{constructor(e,n,r,s,i,o,a){super(e,n,r,s,i,null,o,a,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,n,r,s){return this.dirty==or||this.dirty!=In&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(n),(this.dirty!=In||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,s.trackWrites==this.nodeDOM&&(s.trackWrites=null)),this.node=e,this.dirty=In,!0)}inParent(){let e=this.parent.contentDOM;for(let n=this.nodeDOM;n;n=n.parentNode)if(n==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,n,r){return e==this.nodeDOM?this.posAtStart+Math.min(n,this.node.text.length):super.localPosFromDOM(e,n,r)}ignoreMutation(e){return e.type!="characterData"&&e.type!="selection"}slice(e,n,r){let s=this.node.cut(e,n),i=document.createTextNode(s.text);return new sf(this.parent,s,this.outerDeco,this.innerDeco,i,i,r)}markDirty(e,n){super.markDirty(e,n),this.dom!=this.nodeDOM&&(e==0||n==this.nodeDOM.nodeValue.length)&&(this.dirty=or)}get domAtom(){return!1}isText(e){return this.node.text==e}}class g1 extends Uu{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==In&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class LB extends Rs{constructor(e,n,r,s,i,o,a,l,u,d){super(e,n,r,s,i,o,a,u,d),this.spec=l}update(e,n,r,s){if(this.dirty==or)return!1;if(this.spec.update&&(this.node.type==e.type||this.spec.multiType)){let i=this.spec.update(e,n,r);return i&&this.updateInner(e,n,r,s),i}else return!this.contentDOM&&!e.isLeaf?!1:super.update(e,n,r,s)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,n,r,s){this.spec.setSelection?this.spec.setSelection(e,n,r.root):super.setSelection(e,n,r,s)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function y1(t,e,n){let r=t.firstChild,s=!1;for(let i=0;i<e.length;i++){let o=e[i],a=o.dom;if(a.parentNode==t){for(;a!=r;)r=DE(r),s=!0;r=r.nextSibling}else s=!0,t.insertBefore(a,r);if(o instanceof qi){let l=r?r.previousSibling:t.lastChild;y1(o.contentDOM,o.children,n),r=l?l.nextSibling:t.firstChild}}for(;r;)r=DE(r),s=!0;s&&n.trackWrites==t&&(n.trackWrites=null)}const Cl=function(t){t&&(this.nodeName=t)};Cl.prototype=Object.create(null);const yi=[new Cl];function Ig(t,e,n){if(t.length==0)return yi;let r=n?yi[0]:new Cl,s=[r];for(let i=0;i<t.length;i++){let o=t[i].type.attrs;if(o){o.nodeName&&s.push(r=new Cl(o.nodeName));for(let a in o){let l=o[a];l!=null&&(n&&s.length==1&&s.push(r=new Cl(e.isInline?"span":"div")),a=="class"?r.class=(r.class?r.class+" ":"")+l:a=="style"?r.style=(r.style?r.style+";":"")+l:a!="nodeName"&&(r[a]=l))}}}return s}function v1(t,e,n,r){if(n==yi&&r==yi)return e;let s=e;for(let i=0;i<r.length;i++){let o=r[i],a=n[i];if(i){let l;a&&a.nodeName==o.nodeName&&s!=t&&(l=s.parentNode)&&l.nodeName.toLowerCase()==o.nodeName||(l=document.createElement(o.nodeName),l.pmIsDeco=!0,l.appendChild(s),a=yi[0]),s=l}VB(s,a||yi[0],o)}return s}function VB(t,e,n){for(let r in e)r!="class"&&r!="style"&&r!="nodeName"&&!(r in n)&&t.removeAttribute(r);for(let r in n)r!="class"&&r!="style"&&r!="nodeName"&&n[r]!=e[r]&&t.setAttribute(r,n[r]);if(e.class!=n.class){let r=e.class?e.class.split(" ").filter(Boolean):[],s=n.class?n.class.split(" ").filter(Boolean):[];for(let i=0;i<r.length;i++)s.indexOf(r[i])==-1&&t.classList.remove(r[i]);for(let i=0;i<s.length;i++)r.indexOf(s[i])==-1&&t.classList.add(s[i]);t.classList.length==0&&t.removeAttribute("class")}if(e.style!=n.style){if(e.style){let r=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,s;for(;s=r.exec(e.style);)t.style.removeProperty(s[1])}n.style&&(t.style.cssText+=n.style)}}function _1(t,e,n){return v1(t,t,yi,Ig(e,n,t.nodeType!=1))}function nh(t,e){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!t[n].type.eq(e[n].type))return!1;return!0}function DE(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}class jB{constructor(e,n,r){this.lock=n,this.view=r,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=FB(e.node.content,e)}destroyBetween(e,n){if(e!=n){for(let r=e;r<n;r++)this.top.children[r].destroy();this.top.children.splice(e,n-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,n,r){let s=0,i=this.stack.length>>1,o=Math.min(i,e.length);for(;s<o&&(s==i-1?this.top:this.stack[s+1<<1]).matchesMark(e[s])&&e[s].type.spec.spanning!==!1;)s++;for(;s<i;)this.destroyRest(),this.top.dirty=In,this.index=this.stack.pop(),this.top=this.stack.pop(),i--;for(;i<e.length;){this.stack.push(this.top,this.index+1);let a=-1;for(let l=this.index;l<Math.min(this.index+3,this.top.children.length);l++){let u=this.top.children[l];if(u.matchesMark(e[i])&&!this.isLocked(u.dom)){a=l;break}}if(a>-1)a>this.index&&(this.changed=!0,this.destroyBetween(this.index,a)),this.top=this.top.children[this.index];else{let l=qi.create(this.top,e[i],n,r);this.top.children.splice(this.index,0,l),this.top=l,this.changed=!0}this.index=0,i++}}findNodeMatch(e,n,r,s){let i=-1,o;if(s>=this.preMatch.index&&(o=this.preMatch.matches[s-this.preMatch.index]).parent==this.top&&o.matchesNode(e,n,r))i=this.top.children.indexOf(o,this.index);else for(let a=this.index,l=Math.min(this.top.children.length,a+5);a<l;a++){let u=this.top.children[a];if(u.matchesNode(e,n,r)&&!this.preMatch.matched.has(u)){i=a;break}}return i<0?!1:(this.destroyBetween(this.index,i),this.index++,!0)}updateNodeAt(e,n,r,s,i){let o=this.top.children[s];return o.dirty==or&&o.dom==o.contentDOM&&(o.dirty=gi),o.update(e,n,r,i)?(this.destroyBetween(this.index,s),this.index++,!0):!1}findIndexWithChild(e){for(;;){let n=e.parentNode;if(!n)return-1;if(n==this.top.contentDOM){let r=e.pmViewDesc;if(r){for(let s=this.index;s<this.top.children.length;s++)if(this.top.children[s]==r)return s}return-1}e=n}}updateNextNode(e,n,r,s,i,o){for(let a=this.index;a<this.top.children.length;a++){let l=this.top.children[a];if(l instanceof Rs){let u=this.preMatch.matched.get(l);if(u!=null&&u!=i)return!1;let d=l.dom,h,f=this.isLocked(d)&&!(e.isText&&l.node&&l.node.isText&&l.nodeDOM.nodeValue==e.text&&l.dirty!=or&&nh(n,l.outerDeco));if(!f&&l.update(e,n,r,s))return this.destroyBetween(this.index,a),l.dom!=d&&(this.changed=!0),this.index++,!0;if(!f&&(h=this.recreateWrapper(l,e,n,r,s,o)))return this.destroyBetween(this.index,a),this.top.children[this.index]=h,h.contentDOM&&(h.dirty=gi,h.updateChildren(s,o+1),h.dirty=In),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,n,r,s,i,o){if(e.dirty||n.isAtom||!e.children.length||!e.node.content.eq(n.content)||!nh(r,e.outerDeco)||!s.eq(e.innerDeco))return null;let a=Rs.create(this.top,n,r,s,i,o);if(a.contentDOM){a.children=e.children,e.children=[];for(let l of a.children)l.parent=a}return e.destroy(),a}addNode(e,n,r,s,i){let o=Rs.create(this.top,e,n,r,s,i);o.contentDOM&&o.updateChildren(s,i+1),this.top.children.splice(this.index++,0,o),this.changed=!0}placeWidget(e,n,r){let s=this.index<this.top.children.length?this.top.children[this.index]:null;if(s&&s.matchesWidget(e)&&(e==s.widget||!s.widget.type.toDOM.parentNode))this.index++;else{let i=new m1(this.top,e,n,r);this.top.children.splice(this.index++,0,i),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],n=this.top;for(;e instanceof qi;)n=e,e=n.children[n.children.length-1];(!e||!(e instanceof sf)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((Ut||Nt)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG",n),this.addHackNode("BR",this.top))}addHackNode(e,n){if(n==this.top&&this.index<n.children.length&&n.children[this.index].matchesHack(e))this.index++;else{let r=document.createElement(e);e=="IMG"&&(r.className="ProseMirror-separator",r.alt=""),e=="BR"&&(r.className="ProseMirror-trailingBreak");let s=new g1(this.top,[],r,null);n!=this.top?n.children.push(s):n.children.splice(this.index++,0,s),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||e.nodeType==1&&e.contains(this.lock.parentNode))}}function FB(t,e){let n=e,r=n.children.length,s=t.childCount,i=new Map,o=[];e:for(;s>0;){let a;for(;;)if(r){let u=n.children[r-1];if(u instanceof qi)n=u,r=u.children.length;else{a=u,r--;break}}else{if(n==e)break e;r=n.parent.children.indexOf(n),n=n.parent}let l=a.node;if(l){if(l!=t.child(s-1))break;--s,i.set(a,s),o.push(a)}}return{index:s,matched:i,matches:o.reverse()}}function UB(t,e){return t.type.side-e.type.side}function BB(t,e,n,r){let s=e.locals(t),i=0;if(s.length==0){for(let u=0;u<t.childCount;u++){let d=t.child(u);r(d,s,e.forChild(i,d),u),i+=d.nodeSize}return}let o=0,a=[],l=null;for(let u=0;;){let d,h;for(;o<s.length&&s[o].to==i;){let w=s[o++];w.widget&&(d?(h||(h=[d])).push(w):d=w)}if(d)if(h){h.sort(UB);for(let w=0;w<h.length;w++)n(h[w],u,!!l)}else n(d,u,!!l);let f,m;if(l)m=-1,f=l,l=null;else if(u<t.childCount)m=u,f=t.child(u++);else break;for(let w=0;w<a.length;w++)a[w].to<=i&&a.splice(w--,1);for(;o<s.length&&s[o].from<=i&&s[o].to>i;)a.push(s[o++]);let y=i+f.nodeSize;if(f.isText){let w=y;o<s.length&&s[o].from<w&&(w=s[o].from);for(let x=0;x<a.length;x++)a[x].to<w&&(w=a[x].to);w<y&&(l=f.cut(w-i),f=f.cut(0,w-i),y=w,m=-1)}else for(;o<s.length&&s[o].to<y;)o++;let v=f.isInline&&!f.isLeaf?a.filter(w=>!w.inline):a.slice();r(f,v,e.forChild(i,f),m),i=y}}function zB(t){if(t.nodeName=="UL"||t.nodeName=="OL"){let e=t.style.cssText;t.style.cssText=e+"; list-style: square !important",window.getComputedStyle(t).listStyle,t.style.cssText=e}}function $B(t,e,n,r){for(let s=0,i=0;s<t.childCount&&i<=r;){let o=t.child(s++),a=i;if(i+=o.nodeSize,!o.isText)continue;let l=o.text;for(;s<t.childCount;){let u=t.child(s++);if(i+=u.nodeSize,!u.isText)break;l+=u.text}if(i>=n){if(i>=r&&l.slice(r-e.length-a,r-a)==e)return r-e.length;let u=a<r?l.lastIndexOf(e,r-a-1):-1;if(u>=0&&u+e.length+a>=n)return a+u;if(n==r&&l.length>=r+e.length-a&&l.slice(r-a,r-a+e.length)==e)return r}}return-1}function Cg(t,e,n,r,s){let i=[];for(let o=0,a=0;o<t.length;o++){let l=t[o],u=a,d=a+=l.size;u>=n||d<=e?i.push(l):(u<e&&i.push(l.slice(0,e-u,r)),s&&(i.push(s),s=void 0),d>n&&i.push(l.slice(n-u,l.size,r)))}return i}function Q0(t,e=null){let n=t.domSelectionRange(),r=t.state.doc;if(!n.focusNode)return null;let s=t.docView.nearestDesc(n.focusNode),i=s&&s.size==0,o=t.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(o<0)return null;let a=r.resolve(o),l,u;if(rf(n)){for(l=o;s&&!s.node;)s=s.parent;let h=s.node;if(s&&h.isAtom&&Y.isSelectable(h)&&s.parent&&!(h.isInline&&mB(n.focusNode,n.focusOffset,s.dom))){let f=s.posBefore;u=new Y(o==f?a:r.resolve(f))}}else{if(n instanceof t.dom.ownerDocument.defaultView.Selection&&n.rangeCount>1){let h=o,f=o;for(let m=0;m<n.rangeCount;m++){let y=n.getRangeAt(m);h=Math.min(h,t.docView.posFromDOM(y.startContainer,y.startOffset,1)),f=Math.max(f,t.docView.posFromDOM(y.endContainer,y.endOffset,-1))}if(h<0)return null;[l,o]=f==t.state.selection.anchor?[f,h]:[h,f],a=r.resolve(o)}else l=t.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(l<0)return null}let d=r.resolve(l);if(!u){let h=e=="pointer"||t.state.selection.head<a.pos&&!i?1:-1;u=J0(t,d,a,h)}return u}function w1(t){return t.editable?t.hasFocus():E1(t)&&document.activeElement&&document.activeElement.contains(t.dom)}function Rr(t,e=!1){let n=t.state.selection;if(x1(t,n),!!w1(t)){if(!e&&t.input.mouseDown&&t.input.mouseDown.allowDefault&&Nt){let r=t.domSelectionRange(),s=t.domObserver.currentSelection;if(r.anchorNode&&s.anchorNode&&$i(r.anchorNode,r.anchorOffset,s.anchorNode,s.anchorOffset)){t.input.mouseDown.delayedSelectionSync=!0,t.domObserver.setCurSelection();return}}if(t.domObserver.disconnectSelection(),t.cursorWrapper)HB(t);else{let{anchor:r,head:s}=n,i,o;OE&&!(n instanceof ne)&&(n.$from.parent.inlineContent||(i=ME(t,n.from)),!n.empty&&!n.$from.parent.inlineContent&&(o=ME(t,n.to))),t.docView.setSelection(r,s,t,e),OE&&(i&&LE(i),o&&LE(o)),n.visible?t.dom.classList.remove("ProseMirror-hideselection"):(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&qB(t))}t.domObserver.setCurSelection(),t.domObserver.connectSelection()}}const OE=Ut||Nt&&l1<63;function ME(t,e){let{node:n,offset:r}=t.docView.domFromPos(e,0),s=r<n.childNodes.length?n.childNodes[r]:null,i=r?n.childNodes[r-1]:null;if(Ut&&s&&s.contentEditable=="false")return Op(s);if((!s||s.contentEditable=="false")&&(!i||i.contentEditable=="false")){if(s)return Op(s);if(i)return Op(i)}}function Op(t){return t.contentEditable="true",Ut&&t.draggable&&(t.draggable=!1,t.wasDraggable=!0),t}function LE(t){t.contentEditable="false",t.wasDraggable&&(t.draggable=!0,t.wasDraggable=null)}function qB(t){let e=t.dom.ownerDocument;e.removeEventListener("selectionchange",t.input.hideSelectionGuard);let n=t.domSelectionRange(),r=n.anchorNode,s=n.anchorOffset;e.addEventListener("selectionchange",t.input.hideSelectionGuard=()=>{(n.anchorNode!=r||n.anchorOffset!=s)&&(e.removeEventListener("selectionchange",t.input.hideSelectionGuard),setTimeout(()=>{(!w1(t)||t.state.selection.visible)&&t.dom.classList.remove("ProseMirror-hideselection")},20))})}function HB(t){let e=t.domSelection();if(!e)return;let n=t.cursorWrapper.dom,r=n.nodeName=="IMG";r?e.collapse(n.parentNode,ht(n)+1):e.collapse(n,0),!r&&!t.state.selection.visible&&nn&&Ns<=11&&(n.disabled=!0,n.disabled=!1)}function x1(t,e){if(e instanceof Y){let n=t.docView.descAt(e.from);n!=t.lastSelectedViewDesc&&(VE(t),n&&n.selectNode(),t.lastSelectedViewDesc=n)}else VE(t)}function VE(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.parent&&t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=void 0)}function J0(t,e,n,r){return t.someProp("createSelectionBetween",s=>s(t,e,n))||ne.between(e,n,r)}function jE(t){return t.editable&&!t.hasFocus()?!1:E1(t)}function E1(t){let e=t.domSelectionRange();if(!e.anchorNode)return!1;try{return t.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(t.editable||t.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function WB(t){let e=t.docView.domFromPos(t.state.selection.anchor,0),n=t.domSelectionRange();return $i(e.node,e.offset,n.anchorNode,n.anchorOffset)}function Ag(t,e){let{$anchor:n,$head:r}=t.selection,s=e>0?n.max(r):n.min(r),i=s.parent.inlineContent?s.depth?t.doc.resolve(e>0?s.after():s.before()):null:s;return i&&oe.findFrom(i,e)}function Zr(t,e){return t.dispatch(t.state.tr.setSelection(e).scrollIntoView()),!0}function FE(t,e,n){let r=t.state.selection;if(r instanceof ne)if(n.indexOf("s")>-1){let{$head:s}=r,i=s.textOffset?null:e<0?s.nodeBefore:s.nodeAfter;if(!i||i.isText||!i.isLeaf)return!1;let o=t.state.doc.resolve(s.pos+i.nodeSize*(e<0?-1:1));return Zr(t,new ne(r.$anchor,o))}else if(r.empty){if(t.endOfTextblock(e>0?"forward":"backward")){let s=Ag(t.state,e);return s&&s instanceof Y?Zr(t,s):!1}else if(!(yn&&n.indexOf("m")>-1)){let s=r.$head,i=s.textOffset?null:e<0?s.nodeBefore:s.nodeAfter,o;if(!i||i.isText)return!1;let a=e<0?s.pos-i.nodeSize:s.pos;return i.isAtom||(o=t.docView.descAt(a))&&!o.contentDOM?Y.isSelectable(i)?Zr(t,new Y(e<0?t.state.doc.resolve(s.pos-i.nodeSize):s)):Fu?Zr(t,new ne(t.state.doc.resolve(e<0?a:a+i.nodeSize))):!1:!1}}else return!1;else{if(r instanceof Y&&r.node.isInline)return Zr(t,new ne(e>0?r.$to:r.$from));{let s=Ag(t.state,e);return s?Zr(t,s):!1}}}function rh(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function Al(t,e){let n=t.pmViewDesc;return n&&n.size==0&&(e<0||t.nextSibling||t.nodeName!="BR")}function ao(t,e){return e<0?KB(t):GB(t)}function KB(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let s,i,o=!1;for(kn&&n.nodeType==1&&r<rh(n)&&Al(n.childNodes[r],-1)&&(o=!0);;)if(r>0){if(n.nodeType!=1)break;{let a=n.childNodes[r-1];if(Al(a,-1))s=n,i=--r;else if(a.nodeType==3)n=a,r=n.nodeValue.length;else break}}else{if(S1(n))break;{let a=n.previousSibling;for(;a&&Al(a,-1);)s=n.parentNode,i=ht(a),a=a.previousSibling;if(a)n=a,r=rh(n);else{if(n=n.parentNode,n==t.dom)break;r=0}}}o?Ng(t,n,r):s&&Ng(t,s,i)}function GB(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let s=rh(n),i,o;for(;;)if(r<s){if(n.nodeType!=1)break;let a=n.childNodes[r];if(Al(a,1))i=n,o=++r;else break}else{if(S1(n))break;{let a=n.nextSibling;for(;a&&Al(a,1);)i=a.parentNode,o=ht(a)+1,a=a.nextSibling;if(a)n=a,r=0,s=rh(n);else{if(n=n.parentNode,n==t.dom)break;r=s=0}}}i&&Ng(t,i,o)}function S1(t){let e=t.pmViewDesc;return e&&e.node&&e.node.isBlock}function QB(t,e){for(;t&&e==t.childNodes.length&&!ju(t);)e=ht(t)+1,t=t.parentNode;for(;t&&e<t.childNodes.length;){let n=t.childNodes[e];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;t=n,e=0}}function JB(t,e){for(;t&&!e&&!ju(t);)e=ht(t),t=t.parentNode;for(;t&&e;){let n=t.childNodes[e-1];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;t=n,e=t.childNodes.length}}function Ng(t,e,n){if(e.nodeType!=3){let i,o;(o=QB(e,n))?(e=o,n=0):(i=JB(e,n))&&(e=i,n=i.nodeValue.length)}let r=t.domSelection();if(!r)return;if(rf(r)){let i=document.createRange();i.setEnd(e,n),i.setStart(e,n),r.removeAllRanges(),r.addRange(i)}else r.extend&&r.extend(e,n);t.domObserver.setCurSelection();let{state:s}=t;setTimeout(()=>{t.state==s&&Rr(t)},50)}function UE(t,e){let n=t.state.doc.resolve(e);if(!(Nt||vB)&&n.parent.inlineContent){let s=t.coordsAtPos(e);if(e>n.start()){let i=t.coordsAtPos(e-1),o=(i.top+i.bottom)/2;if(o>s.top&&o<s.bottom&&Math.abs(i.left-s.left)>1)return i.left<s.left?"ltr":"rtl"}if(e<n.end()){let i=t.coordsAtPos(e+1),o=(i.top+i.bottom)/2;if(o>s.top&&o<s.bottom&&Math.abs(i.left-s.left)>1)return i.left>s.left?"ltr":"rtl"}}return getComputedStyle(t.dom).direction=="rtl"?"rtl":"ltr"}function BE(t,e,n){let r=t.state.selection;if(r instanceof ne&&!r.empty||n.indexOf("s")>-1||yn&&n.indexOf("m")>-1)return!1;let{$from:s,$to:i}=r;if(!s.parent.inlineContent||t.endOfTextblock(e<0?"up":"down")){let o=Ag(t.state,e);if(o&&o instanceof Y)return Zr(t,o)}if(!s.parent.inlineContent){let o=e<0?s:i,a=r instanceof fn?oe.near(o,e):oe.findFrom(o,e);return a?Zr(t,a):!1}return!1}function zE(t,e){if(!(t.state.selection instanceof ne))return!0;let{$head:n,$anchor:r,empty:s}=t.state.selection;if(!n.sameParent(r))return!0;if(!s)return!1;if(t.endOfTextblock(e>0?"forward":"backward"))return!0;let i=!n.textOffset&&(e<0?n.nodeBefore:n.nodeAfter);if(i&&!i.isText){let o=t.state.tr;return e<0?o.delete(n.pos-i.nodeSize,n.pos):o.delete(n.pos,n.pos+i.nodeSize),t.dispatch(o),!0}return!1}function $E(t,e,n){t.domObserver.stop(),e.contentEditable=n,t.domObserver.start()}function YB(t){if(!Ut||t.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:n}=t.domSelectionRange();if(e&&e.nodeType==1&&n==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let r=e.firstChild;$E(t,r,"true"),setTimeout(()=>$E(t,r,"false"),20)}return!1}function XB(t){let e="";return t.ctrlKey&&(e+="c"),t.metaKey&&(e+="m"),t.altKey&&(e+="a"),t.shiftKey&&(e+="s"),e}function ZB(t,e){let n=e.keyCode,r=XB(e);if(n==8||yn&&n==72&&r=="c")return zE(t,-1)||ao(t,-1);if(n==46&&!e.shiftKey||yn&&n==68&&r=="c")return zE(t,1)||ao(t,1);if(n==13||n==27)return!0;if(n==37||yn&&n==66&&r=="c"){let s=n==37?UE(t,t.state.selection.from)=="ltr"?-1:1:-1;return FE(t,s,r)||ao(t,s)}else if(n==39||yn&&n==70&&r=="c"){let s=n==39?UE(t,t.state.selection.from)=="ltr"?1:-1:1;return FE(t,s,r)||ao(t,s)}else{if(n==38||yn&&n==80&&r=="c")return BE(t,-1,r)||ao(t,-1);if(n==40||yn&&n==78&&r=="c")return YB(t)||BE(t,1,r)||ao(t,1);if(r==(yn?"m":"c")&&(n==66||n==73||n==89||n==90))return!0}return!1}function Y0(t,e){t.someProp("transformCopied",m=>{e=m(e,t)});let n=[],{content:r,openStart:s,openEnd:i}=e;for(;s>1&&i>1&&r.childCount==1&&r.firstChild.childCount==1;){s--,i--;let m=r.firstChild;n.push(m.type.name,m.attrs!=m.type.defaultAttrs?m.attrs:null),r=m.content}let o=t.someProp("clipboardSerializer")||Xi.fromSchema(t.state.schema),a=A1(),l=a.createElement("div");l.appendChild(o.serializeFragment(r,{document:a}));let u=l.firstChild,d,h=0;for(;u&&u.nodeType==1&&(d=C1[u.nodeName.toLowerCase()]);){for(let m=d.length-1;m>=0;m--){let y=a.createElement(d[m]);for(;l.firstChild;)y.appendChild(l.firstChild);l.appendChild(y),h++}u=l.firstChild}u&&u.nodeType==1&&u.setAttribute("data-pm-slice",`${s} ${i}${h?` -${h}`:""} ${JSON.stringify(n)}`);let f=t.someProp("clipboardTextSerializer",m=>m(e,t))||e.content.textBetween(0,e.content.size,`

`);return{dom:l,text:f,slice:e}}function b1(t,e,n,r,s){let i=s.parent.type.spec.code,o,a;if(!n&&!e)return null;let l=!!e&&(r||i||!n);if(l){if(t.someProp("transformPastedText",f=>{e=f(e,i||r,t)}),i)return a=new q(F.from(t.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0),t.someProp("transformPasted",f=>{a=f(a,t,!0)}),a;let h=t.someProp("clipboardTextParser",f=>f(e,s,r,t));if(h)a=h;else{let f=s.marks(),{schema:m}=t.state,y=Xi.fromSchema(m);o=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(v=>{let w=o.appendChild(document.createElement("p"));v&&w.appendChild(y.serializeNode(m.text(v,f)))})}}else t.someProp("transformPastedHTML",h=>{n=h(n,t)}),o=r3(n),Fu&&s3(o);let u=o&&o.querySelector("[data-pm-slice]"),d=u&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(u.getAttribute("data-pm-slice")||"");if(d&&d[3])for(let h=+d[3];h>0;h--){let f=o.firstChild;for(;f&&f.nodeType!=1;)f=f.nextSibling;if(!f)break;o=f}if(a||(a=(t.someProp("clipboardParser")||t.someProp("domParser")||As.fromSchema(t.state.schema)).parseSlice(o,{preserveWhitespace:!!(l||d),context:s,ruleFromNode(f){return f.nodeName=="BR"&&!f.nextSibling&&f.parentNode&&!e3.test(f.parentNode.nodeName)?{ignore:!0}:null}})),d)a=i3(qE(a,+d[1],+d[2]),d[4]);else if(a=q.maxOpen(t3(a.content,s),!0),a.openStart||a.openEnd){let h=0,f=0;for(let m=a.content.firstChild;h<a.openStart&&!m.type.spec.isolating;h++,m=m.firstChild);for(let m=a.content.lastChild;f<a.openEnd&&!m.type.spec.isolating;f++,m=m.lastChild);a=qE(a,h,f)}return t.someProp("transformPasted",h=>{a=h(a,t,l)}),a}const e3=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function t3(t,e){if(t.childCount<2)return t;for(let n=e.depth;n>=0;n--){let s=e.node(n).contentMatchAt(e.index(n)),i,o=[];if(t.forEach(a=>{if(!o)return;let l=s.findWrapping(a.type),u;if(!l)return o=null;if(u=o.length&&i.length&&k1(l,i,a,o[o.length-1],0))o[o.length-1]=u;else{o.length&&(o[o.length-1]=I1(o[o.length-1],i.length));let d=T1(a,l);o.push(d),s=s.matchType(d.type),i=l}}),o)return F.from(o)}return t}function T1(t,e,n=0){for(let r=e.length-1;r>=n;r--)t=e[r].create(null,F.from(t));return t}function k1(t,e,n,r,s){if(s<t.length&&s<e.length&&t[s]==e[s]){let i=k1(t,e,n,r.lastChild,s+1);if(i)return r.copy(r.content.replaceChild(r.childCount-1,i));if(r.contentMatchAt(r.childCount).matchType(s==t.length-1?n.type:t[s+1]))return r.copy(r.content.append(F.from(T1(n,t,s+1))))}}function I1(t,e){if(e==0)return t;let n=t.content.replaceChild(t.childCount-1,I1(t.lastChild,e-1)),r=t.contentMatchAt(t.childCount).fillBefore(F.empty,!0);return t.copy(n.append(r))}function Rg(t,e,n,r,s,i){let o=e<0?t.firstChild:t.lastChild,a=o.content;return t.childCount>1&&(i=0),s<r-1&&(a=Rg(a,e,n,r,s+1,i)),s>=n&&(a=e<0?o.contentMatchAt(0).fillBefore(a,i<=s).append(a):a.append(o.contentMatchAt(o.childCount).fillBefore(F.empty,!0))),t.replaceChild(e<0?0:t.childCount-1,o.copy(a))}function qE(t,e,n){return e<t.openStart&&(t=new q(Rg(t.content,-1,e,t.openStart,0,t.openEnd),e,t.openEnd)),n<t.openEnd&&(t=new q(Rg(t.content,1,n,t.openEnd,0,0),t.openStart,n)),t}const C1={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let HE=null;function A1(){return HE||(HE=document.implementation.createHTMLDocument("title"))}let Mp=null;function n3(t){let e=window.trustedTypes;return e?(Mp||(Mp=e.defaultPolicy||e.createPolicy("ProseMirrorClipboard",{createHTML:n=>n})),Mp.createHTML(t)):t}function r3(t){let e=/^(\s*<meta [^>]*>)*/.exec(t);e&&(t=t.slice(e[0].length));let n=A1().createElement("div"),r=/<([a-z][^>\s]+)/i.exec(t),s;if((s=r&&C1[r[1].toLowerCase()])&&(t=s.map(i=>"<"+i+">").join("")+t+s.map(i=>"</"+i+">").reverse().join("")),n.innerHTML=n3(t),s)for(let i=0;i<s.length;i++)n=n.querySelector(s[i])||n;return n}function s3(t){let e=t.querySelectorAll(Nt?"span:not([class]):not([style])":"span.Apple-converted-space");for(let n=0;n<e.length;n++){let r=e[n];r.childNodes.length==1&&r.textContent==""&&r.parentNode&&r.parentNode.replaceChild(t.ownerDocument.createTextNode(" "),r)}}function i3(t,e){if(!t.size)return t;let n=t.content.firstChild.type.schema,r;try{r=JSON.parse(e)}catch{return t}let{content:s,openStart:i,openEnd:o}=t;for(let a=r.length-2;a>=0;a-=2){let l=n.nodes[r[a]];if(!l||l.hasRequiredAttrs())break;s=F.from(l.create(r[a+1],s)),i++,o++}return new q(s,i,o)}const Bt={},zt={},o3={touchstart:!0,touchmove:!0};class a3{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function l3(t){for(let e in Bt){let n=Bt[e];t.dom.addEventListener(e,t.input.eventHandlers[e]=r=>{c3(t,r)&&!X0(t,r)&&(t.editable||!(r.type in zt))&&n(t,r)},o3[e]?{passive:!0}:void 0)}Ut&&t.dom.addEventListener("input",()=>null),Pg(t)}function ms(t,e){t.input.lastSelectionOrigin=e,t.input.lastSelectionTime=Date.now()}function u3(t){t.domObserver.stop();for(let e in t.input.eventHandlers)t.dom.removeEventListener(e,t.input.eventHandlers[e]);clearTimeout(t.input.composingTimeout),clearTimeout(t.input.lastIOSEnterFallbackTimeout)}function Pg(t){t.someProp("handleDOMEvents",e=>{for(let n in e)t.input.eventHandlers[n]||t.dom.addEventListener(n,t.input.eventHandlers[n]=r=>X0(t,r))})}function X0(t,e){return t.someProp("handleDOMEvents",n=>{let r=n[e.type];return r?r(t,e)||e.defaultPrevented:!1})}function c3(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let n=e.target;n!=t.dom;n=n.parentNode)if(!n||n.nodeType==11||n.pmViewDesc&&n.pmViewDesc.stopEvent(e))return!1;return!0}function d3(t,e){!X0(t,e)&&Bt[e.type]&&(t.editable||!(e.type in zt))&&Bt[e.type](t,e)}zt.keydown=(t,e)=>{let n=e;if(t.input.shiftKey=n.keyCode==16||n.shiftKey,!R1(t,n)&&(t.input.lastKeyCode=n.keyCode,t.input.lastKeyCodeTime=Date.now(),!(Tr&&Nt&&n.keyCode==13)))if(n.keyCode!=229&&t.domObserver.forceFlush(),la&&n.keyCode==13&&!n.ctrlKey&&!n.altKey&&!n.metaKey){let r=Date.now();t.input.lastIOSEnter=r,t.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{t.input.lastIOSEnter==r&&(t.someProp("handleKeyDown",s=>s(t,ui(13,"Enter"))),t.input.lastIOSEnter=0)},200)}else t.someProp("handleKeyDown",r=>r(t,n))||ZB(t,n)?n.preventDefault():ms(t,"key")};zt.keyup=(t,e)=>{e.keyCode==16&&(t.input.shiftKey=!1)};zt.keypress=(t,e)=>{let n=e;if(R1(t,n)||!n.charCode||n.ctrlKey&&!n.altKey||yn&&n.metaKey)return;if(t.someProp("handleKeyPress",s=>s(t,n))){n.preventDefault();return}let r=t.state.selection;if(!(r instanceof ne)||!r.$from.sameParent(r.$to)){let s=String.fromCharCode(n.charCode),i=()=>t.state.tr.insertText(s).scrollIntoView();!/[\r\n]/.test(s)&&!t.someProp("handleTextInput",o=>o(t,r.$from.pos,r.$to.pos,s,i))&&t.dispatch(i()),n.preventDefault()}};function of(t){return{left:t.clientX,top:t.clientY}}function h3(t,e){let n=e.x-t.clientX,r=e.y-t.clientY;return n*n+r*r<100}function Z0(t,e,n,r,s){if(r==-1)return!1;let i=t.state.doc.resolve(r);for(let o=i.depth+1;o>0;o--)if(t.someProp(e,a=>o>i.depth?a(t,n,i.nodeAfter,i.before(o),s,!0):a(t,n,i.node(o),i.before(o),s,!1)))return!0;return!1}function Bo(t,e,n){if(t.focused||t.focus(),t.state.selection.eq(e))return;let r=t.state.tr.setSelection(e);r.setMeta("pointer",!0),t.dispatch(r)}function f3(t,e){if(e==-1)return!1;let n=t.state.doc.resolve(e),r=n.nodeAfter;return r&&r.isAtom&&Y.isSelectable(r)?(Bo(t,new Y(n)),!0):!1}function p3(t,e){if(e==-1)return!1;let n=t.state.selection,r,s;n instanceof Y&&(r=n.node);let i=t.state.doc.resolve(e);for(let o=i.depth+1;o>0;o--){let a=o>i.depth?i.nodeAfter:i.node(o);if(Y.isSelectable(a)){r&&n.$from.depth>0&&o>=n.$from.depth&&i.before(n.$from.depth+1)==n.$from.pos?s=i.before(n.$from.depth):s=i.before(o);break}}return s!=null?(Bo(t,Y.create(t.state.doc,s)),!0):!1}function m3(t,e,n,r,s){return Z0(t,"handleClickOn",e,n,r)||t.someProp("handleClick",i=>i(t,e,r))||(s?p3(t,n):f3(t,n))}function g3(t,e,n,r){return Z0(t,"handleDoubleClickOn",e,n,r)||t.someProp("handleDoubleClick",s=>s(t,e,r))}function y3(t,e,n,r){return Z0(t,"handleTripleClickOn",e,n,r)||t.someProp("handleTripleClick",s=>s(t,e,r))||v3(t,n,r)}function v3(t,e,n){if(n.button!=0)return!1;let r=t.state.doc;if(e==-1)return r.inlineContent?(Bo(t,ne.create(r,0,r.content.size)),!0):!1;let s=r.resolve(e);for(let i=s.depth+1;i>0;i--){let o=i>s.depth?s.nodeAfter:s.node(i),a=s.before(i);if(o.inlineContent)Bo(t,ne.create(r,a+1,a+1+o.content.size));else if(Y.isSelectable(o))Bo(t,Y.create(r,a));else continue;return!0}}function ev(t){return sh(t)}const N1=yn?"metaKey":"ctrlKey";Bt.mousedown=(t,e)=>{let n=e;t.input.shiftKey=n.shiftKey;let r=ev(t),s=Date.now(),i="singleClick";s-t.input.lastClick.time<500&&h3(n,t.input.lastClick)&&!n[N1]&&t.input.lastClick.button==n.button&&(t.input.lastClick.type=="singleClick"?i="doubleClick":t.input.lastClick.type=="doubleClick"&&(i="tripleClick")),t.input.lastClick={time:s,x:n.clientX,y:n.clientY,type:i,button:n.button};let o=t.posAtCoords(of(n));o&&(i=="singleClick"?(t.input.mouseDown&&t.input.mouseDown.done(),t.input.mouseDown=new _3(t,o,n,!!r)):(i=="doubleClick"?g3:y3)(t,o.pos,o.inside,n)?n.preventDefault():ms(t,"pointer"))};class _3{constructor(e,n,r,s){this.view=e,this.pos=n,this.event=r,this.flushed=s,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!r[N1],this.allowDefault=r.shiftKey;let i,o;if(n.inside>-1)i=e.state.doc.nodeAt(n.inside),o=n.inside;else{let d=e.state.doc.resolve(n.pos);i=d.parent,o=d.depth?d.before():0}const a=s?null:r.target,l=a?e.docView.nearestDesc(a,!0):null;this.target=l&&l.nodeDOM.nodeType==1?l.nodeDOM:null;let{selection:u}=e.state;(r.button==0&&i.type.spec.draggable&&i.type.spec.selectable!==!1||u instanceof Y&&u.from<=o&&u.to>o)&&(this.mightDrag={node:i,pos:o,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&kn&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),ms(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>Rr(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let n=this.pos;this.view.state.doc!=this.startDoc&&(n=this.view.posAtCoords(of(e))),this.updateAllowDefault(e),this.allowDefault||!n?ms(this.view,"pointer"):m3(this.view,n.pos,n.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||Ut&&this.mightDrag&&!this.mightDrag.node.isAtom||Nt&&!this.view.state.selection.visible&&Math.min(Math.abs(n.pos-this.view.state.selection.from),Math.abs(n.pos-this.view.state.selection.to))<=2)?(Bo(this.view,oe.near(this.view.state.doc.resolve(n.pos))),e.preventDefault()):ms(this.view,"pointer")}move(e){this.updateAllowDefault(e),ms(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}Bt.touchstart=t=>{t.input.lastTouch=Date.now(),ev(t),ms(t,"pointer")};Bt.touchmove=t=>{t.input.lastTouch=Date.now(),ms(t,"pointer")};Bt.contextmenu=t=>ev(t);function R1(t,e){return t.composing?!0:Ut&&Math.abs(e.timeStamp-t.input.compositionEndedAt)<500?(t.input.compositionEndedAt=-2e8,!0):!1}const w3=Tr?5e3:-1;zt.compositionstart=zt.compositionupdate=t=>{if(!t.composing){t.domObserver.flush();let{state:e}=t,n=e.selection.$to;if(e.selection instanceof ne&&(e.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some(r=>r.type.spec.inclusive===!1)))t.markCursor=t.state.storedMarks||n.marks(),sh(t,!0),t.markCursor=null;else if(sh(t,!e.selection.empty),kn&&e.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length){let r=t.domSelectionRange();for(let s=r.focusNode,i=r.focusOffset;s&&s.nodeType==1&&i!=0;){let o=i<0?s.lastChild:s.childNodes[i-1];if(!o)break;if(o.nodeType==3){let a=t.domSelection();a&&a.collapse(o,o.nodeValue.length);break}else s=o,i=-1}}t.input.composing=!0}P1(t,w3)};zt.compositionend=(t,e)=>{t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=e.timeStamp,t.input.compositionPendingChanges=t.domObserver.pendingRecords().length?t.input.compositionID:0,t.input.compositionNode=null,t.input.compositionPendingChanges&&Promise.resolve().then(()=>t.domObserver.flush()),t.input.compositionID++,P1(t,20))};function P1(t,e){clearTimeout(t.input.composingTimeout),e>-1&&(t.input.composingTimeout=setTimeout(()=>sh(t),e))}function D1(t){for(t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=E3());t.input.compositionNodes.length>0;)t.input.compositionNodes.pop().markParentsDirty()}function x3(t){let e=t.domSelectionRange();if(!e.focusNode)return null;let n=fB(e.focusNode,e.focusOffset),r=pB(e.focusNode,e.focusOffset);if(n&&r&&n!=r){let s=r.pmViewDesc,i=t.domObserver.lastChangedTextNode;if(n==i||r==i)return i;if(!s||!s.isText(r.nodeValue))return r;if(t.input.compositionNode==r){let o=n.pmViewDesc;if(!(!o||!o.isText(n.nodeValue)))return r}}return n||r}function E3(){let t=document.createEvent("Event");return t.initEvent("event",!0,!0),t.timeStamp}function sh(t,e=!1){if(!(Tr&&t.domObserver.flushingSoon>=0)){if(t.domObserver.forceFlush(),D1(t),e||t.docView&&t.docView.dirty){let n=Q0(t),r=t.state.selection;return n&&!n.eq(r)?t.dispatch(t.state.tr.setSelection(n)):(t.markCursor||e)&&!r.$from.node(r.$from.sharedDepth(r.to)).inlineContent?t.dispatch(t.state.tr.deleteSelection()):t.updateState(t.state),!0}return!1}}function S3(t,e){if(!t.dom.parentNode)return;let n=t.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(e),n.style.cssText="position: fixed; left: -10000px; top: 10px";let r=getSelection(),s=document.createRange();s.selectNodeContents(e),t.dom.blur(),r.removeAllRanges(),r.addRange(s),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n),t.focus()},50)}const cu=nn&&Ns<15||la&&_B<604;Bt.copy=zt.cut=(t,e)=>{let n=e,r=t.state.selection,s=n.type=="cut";if(r.empty)return;let i=cu?null:n.clipboardData,o=r.content(),{dom:a,text:l}=Y0(t,o);i?(n.preventDefault(),i.clearData(),i.setData("text/html",a.innerHTML),i.setData("text/plain",l)):S3(t,a),s&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function b3(t){return t.openStart==0&&t.openEnd==0&&t.content.childCount==1?t.content.firstChild:null}function T3(t,e){if(!t.dom.parentNode)return;let n=t.input.shiftKey||t.state.selection.$from.parent.type.spec.code,r=t.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus();let s=t.input.shiftKey&&t.input.lastKeyCode!=45;setTimeout(()=>{t.focus(),r.parentNode&&r.parentNode.removeChild(r),n?du(t,r.value,null,s,e):du(t,r.textContent,r.innerHTML,s,e)},50)}function du(t,e,n,r,s){let i=b1(t,e,n,r,t.state.selection.$from);if(t.someProp("handlePaste",l=>l(t,s,i||q.empty)))return!0;if(!i)return!1;let o=b3(i),a=o?t.state.tr.replaceSelectionWith(o,r):t.state.tr.replaceSelection(i);return t.dispatch(a.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function O1(t){let e=t.getData("text/plain")||t.getData("Text");if(e)return e;let n=t.getData("text/uri-list");return n?n.replace(/\r?\n/g," "):""}zt.paste=(t,e)=>{let n=e;if(t.composing&&!Tr)return;let r=cu?null:n.clipboardData,s=t.input.shiftKey&&t.input.lastKeyCode!=45;r&&du(t,O1(r),r.getData("text/html"),s,n)?n.preventDefault():T3(t,n)};class M1{constructor(e,n,r){this.slice=e,this.move=n,this.node=r}}const k3=yn?"altKey":"ctrlKey";function L1(t,e){let n=t.someProp("dragCopies",r=>!r(e));return n??!e[k3]}Bt.dragstart=(t,e)=>{let n=e,r=t.input.mouseDown;if(r&&r.done(),!n.dataTransfer)return;let s=t.state.selection,i=s.empty?null:t.posAtCoords(of(n)),o;if(!(i&&i.pos>=s.from&&i.pos<=(s instanceof Y?s.to-1:s.to))){if(r&&r.mightDrag)o=Y.create(t.state.doc,r.mightDrag.pos);else if(n.target&&n.target.nodeType==1){let h=t.docView.nearestDesc(n.target,!0);h&&h.node.type.spec.draggable&&h!=t.docView&&(o=Y.create(t.state.doc,h.posBefore))}}let a=(o||t.state.selection).content(),{dom:l,text:u,slice:d}=Y0(t,a);(!n.dataTransfer.files.length||!Nt||l1>120)&&n.dataTransfer.clearData(),n.dataTransfer.setData(cu?"Text":"text/html",l.innerHTML),n.dataTransfer.effectAllowed="copyMove",cu||n.dataTransfer.setData("text/plain",u),t.dragging=new M1(d,L1(t,n),o)};Bt.dragend=t=>{let e=t.dragging;window.setTimeout(()=>{t.dragging==e&&(t.dragging=null)},50)};zt.dragover=zt.dragenter=(t,e)=>e.preventDefault();zt.drop=(t,e)=>{let n=e,r=t.dragging;if(t.dragging=null,!n.dataTransfer)return;let s=t.posAtCoords(of(n));if(!s)return;let i=t.state.doc.resolve(s.pos),o=r&&r.slice;o?t.someProp("transformPasted",y=>{o=y(o,t,!1)}):o=b1(t,O1(n.dataTransfer),cu?null:n.dataTransfer.getData("text/html"),!1,i);let a=!!(r&&L1(t,n));if(t.someProp("handleDrop",y=>y(t,n,o||q.empty,a))){n.preventDefault();return}if(!o)return;n.preventDefault();let l=o?e1(t.state.doc,i.pos,o):i.pos;l==null&&(l=i.pos);let u=t.state.tr;if(a){let{node:y}=r;y?y.replace(u):u.deleteSelection()}let d=u.mapping.map(l),h=o.openStart==0&&o.openEnd==0&&o.content.childCount==1,f=u.doc;if(h?u.replaceRangeWith(d,d,o.content.firstChild):u.replaceRange(d,d,o),u.doc.eq(f))return;let m=u.doc.resolve(d);if(h&&Y.isSelectable(o.content.firstChild)&&m.nodeAfter&&m.nodeAfter.sameMarkup(o.content.firstChild))u.setSelection(new Y(m));else{let y=u.mapping.map(l);u.mapping.maps[u.mapping.maps.length-1].forEach((v,w,x,S)=>y=S),u.setSelection(J0(t,m,u.doc.resolve(y)))}t.focus(),t.dispatch(u.setMeta("uiEvent","drop"))};Bt.focus=t=>{t.input.lastFocus=Date.now(),t.focused||(t.domObserver.stop(),t.dom.classList.add("ProseMirror-focused"),t.domObserver.start(),t.focused=!0,setTimeout(()=>{t.docView&&t.hasFocus()&&!t.domObserver.currentSelection.eq(t.domSelectionRange())&&Rr(t)},20))};Bt.blur=(t,e)=>{let n=e;t.focused&&(t.domObserver.stop(),t.dom.classList.remove("ProseMirror-focused"),t.domObserver.start(),n.relatedTarget&&t.dom.contains(n.relatedTarget)&&t.domObserver.currentSelection.clear(),t.focused=!1)};Bt.beforeinput=(t,e)=>{if(Nt&&Tr&&e.inputType=="deleteContentBackward"){t.domObserver.flushSoon();let{domChangeCount:r}=t.input;setTimeout(()=>{if(t.input.domChangeCount!=r||(t.dom.blur(),t.focus(),t.someProp("handleKeyDown",i=>i(t,ui(8,"Backspace")))))return;let{$cursor:s}=t.state.selection;s&&s.pos>0&&t.dispatch(t.state.tr.delete(s.pos-1,s.pos).scrollIntoView())},50)}};for(let t in zt)Bt[t]=zt[t];function hu(t,e){if(t==e)return!0;for(let n in t)if(t[n]!==e[n])return!1;for(let n in e)if(!(n in t))return!1;return!0}class ih{constructor(e,n){this.toDOM=e,this.spec=n||ki,this.side=this.spec.side||0}map(e,n,r,s){let{pos:i,deleted:o}=e.mapResult(n.from+s,this.side<0?-1:1);return o?null:new Sn(i-r,i-r,this)}valid(){return!0}eq(e){return this==e||e instanceof ih&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&hu(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class Ps{constructor(e,n){this.attrs=e,this.spec=n||ki}map(e,n,r,s){let i=e.map(n.from+s,this.spec.inclusiveStart?-1:1)-r,o=e.map(n.to+s,this.spec.inclusiveEnd?1:-1)-r;return i>=o?null:new Sn(i,o,this)}valid(e,n){return n.from<n.to}eq(e){return this==e||e instanceof Ps&&hu(this.attrs,e.attrs)&&hu(this.spec,e.spec)}static is(e){return e.type instanceof Ps}destroy(){}}class tv{constructor(e,n){this.attrs=e,this.spec=n||ki}map(e,n,r,s){let i=e.mapResult(n.from+s,1);if(i.deleted)return null;let o=e.mapResult(n.to+s,-1);return o.deleted||o.pos<=i.pos?null:new Sn(i.pos-r,o.pos-r,this)}valid(e,n){let{index:r,offset:s}=e.content.findIndex(n.from),i;return s==n.from&&!(i=e.child(r)).isText&&s+i.nodeSize==n.to}eq(e){return this==e||e instanceof tv&&hu(this.attrs,e.attrs)&&hu(this.spec,e.spec)}destroy(){}}class Sn{constructor(e,n,r){this.from=e,this.to=n,this.type=r}copy(e,n){return new Sn(e,n,this.type)}eq(e,n=0){return this.type.eq(e.type)&&this.from+n==e.from&&this.to+n==e.to}map(e,n,r){return this.type.map(e,this,n,r)}static widget(e,n,r){return new Sn(e,e,new ih(n,r))}static inline(e,n,r,s){return new Sn(e,n,new Ps(r,s))}static node(e,n,r,s){return new Sn(e,n,new tv(r,s))}get spec(){return this.type.spec}get inline(){return this.type instanceof Ps}get widget(){return this.type instanceof ih}}const fo=[],ki={};class Xe{constructor(e,n){this.local=e.length?e:fo,this.children=n.length?n:fo}static create(e,n){return n.length?oh(n,e,0,ki):kt}find(e,n,r){let s=[];return this.findInner(e??0,n??1e9,s,0,r),s}findInner(e,n,r,s,i){for(let o=0;o<this.local.length;o++){let a=this.local[o];a.from<=n&&a.to>=e&&(!i||i(a.spec))&&r.push(a.copy(a.from+s,a.to+s))}for(let o=0;o<this.children.length;o+=3)if(this.children[o]<n&&this.children[o+1]>e){let a=this.children[o]+1;this.children[o+2].findInner(e-a,n-a,r,s+a,i)}}map(e,n,r){return this==kt||e.maps.length==0?this:this.mapInner(e,n,0,0,r||ki)}mapInner(e,n,r,s,i){let o;for(let a=0;a<this.local.length;a++){let l=this.local[a].map(e,r,s);l&&l.type.valid(n,l)?(o||(o=[])).push(l):i.onRemove&&i.onRemove(this.local[a].spec)}return this.children.length?I3(this.children,o||[],e,n,r,s,i):o?new Xe(o.sort(Ii),fo):kt}add(e,n){return n.length?this==kt?Xe.create(e,n):this.addInner(e,n,0):this}addInner(e,n,r){let s,i=0;e.forEach((a,l)=>{let u=l+r,d;if(d=j1(n,a,u)){for(s||(s=this.children.slice());i<s.length&&s[i]<l;)i+=3;s[i]==l?s[i+2]=s[i+2].addInner(a,d,u+1):s.splice(i,0,l,l+a.nodeSize,oh(d,a,u+1,ki)),i+=3}});let o=V1(i?F1(n):n,-r);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||o.splice(a--,1);return new Xe(o.length?this.local.concat(o).sort(Ii):this.local,s||this.children)}remove(e){return e.length==0||this==kt?this:this.removeInner(e,0)}removeInner(e,n){let r=this.children,s=this.local;for(let i=0;i<r.length;i+=3){let o,a=r[i]+n,l=r[i+1]+n;for(let d=0,h;d<e.length;d++)(h=e[d])&&h.from>a&&h.to<l&&(e[d]=null,(o||(o=[])).push(h));if(!o)continue;r==this.children&&(r=this.children.slice());let u=r[i+2].removeInner(o,a+1);u!=kt?r[i+2]=u:(r.splice(i,3),i-=3)}if(s.length){for(let i=0,o;i<e.length;i++)if(o=e[i])for(let a=0;a<s.length;a++)s[a].eq(o,n)&&(s==this.local&&(s=this.local.slice()),s.splice(a--,1))}return r==this.children&&s==this.local?this:s.length||r.length?new Xe(s,r):kt}forChild(e,n){if(this==kt)return this;if(n.isLeaf)return Xe.empty;let r,s;for(let a=0;a<this.children.length;a+=3)if(this.children[a]>=e){this.children[a]==e&&(r=this.children[a+2]);break}let i=e+1,o=i+n.content.size;for(let a=0;a<this.local.length;a++){let l=this.local[a];if(l.from<o&&l.to>i&&l.type instanceof Ps){let u=Math.max(i,l.from)-i,d=Math.min(o,l.to)-i;u<d&&(s||(s=[])).push(l.copy(u,d))}}if(s){let a=new Xe(s.sort(Ii),fo);return r?new ls([a,r]):a}return r||kt}eq(e){if(this==e)return!0;if(!(e instanceof Xe)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let n=0;n<this.local.length;n++)if(!this.local[n].eq(e.local[n]))return!1;for(let n=0;n<this.children.length;n+=3)if(this.children[n]!=e.children[n]||this.children[n+1]!=e.children[n+1]||!this.children[n+2].eq(e.children[n+2]))return!1;return!0}locals(e){return nv(this.localsInner(e))}localsInner(e){if(this==kt)return fo;if(e.inlineContent||!this.local.some(Ps.is))return this.local;let n=[];for(let r=0;r<this.local.length;r++)this.local[r].type instanceof Ps||n.push(this.local[r]);return n}forEachSet(e){e(this)}}Xe.empty=new Xe([],[]);Xe.removeOverlap=nv;const kt=Xe.empty;class ls{constructor(e){this.members=e}map(e,n){const r=this.members.map(s=>s.map(e,n,ki));return ls.from(r)}forChild(e,n){if(n.isLeaf)return Xe.empty;let r=[];for(let s=0;s<this.members.length;s++){let i=this.members[s].forChild(e,n);i!=kt&&(i instanceof ls?r=r.concat(i.members):r.push(i))}return ls.from(r)}eq(e){if(!(e instanceof ls)||e.members.length!=this.members.length)return!1;for(let n=0;n<this.members.length;n++)if(!this.members[n].eq(e.members[n]))return!1;return!0}locals(e){let n,r=!0;for(let s=0;s<this.members.length;s++){let i=this.members[s].localsInner(e);if(i.length)if(!n)n=i;else{r&&(n=n.slice(),r=!1);for(let o=0;o<i.length;o++)n.push(i[o])}}return n?nv(r?n:n.sort(Ii)):fo}static from(e){switch(e.length){case 0:return kt;case 1:return e[0];default:return new ls(e.every(n=>n instanceof Xe)?e:e.reduce((n,r)=>n.concat(r instanceof Xe?r:r.members),[]))}}forEachSet(e){for(let n=0;n<this.members.length;n++)this.members[n].forEachSet(e)}}function I3(t,e,n,r,s,i,o){let a=t.slice();for(let u=0,d=i;u<n.maps.length;u++){let h=0;n.maps[u].forEach((f,m,y,v)=>{let w=v-y-(m-f);for(let x=0;x<a.length;x+=3){let S=a[x+1];if(S<0||f>S+d-h)continue;let b=a[x]+d-h;m>=b?a[x+1]=f<=b?-2:-1:f>=d&&w&&(a[x]+=w,a[x+1]+=w)}h+=w}),d=n.maps[u].map(d,-1)}let l=!1;for(let u=0;u<a.length;u+=3)if(a[u+1]<0){if(a[u+1]==-2){l=!0,a[u+1]=-1;continue}let d=n.map(t[u]+i),h=d-s;if(h<0||h>=r.content.size){l=!0;continue}let f=n.map(t[u+1]+i,-1),m=f-s,{index:y,offset:v}=r.content.findIndex(h),w=r.maybeChild(y);if(w&&v==h&&v+w.nodeSize==m){let x=a[u+2].mapInner(n,w,d+1,t[u]+i+1,o);x!=kt?(a[u]=h,a[u+1]=m,a[u+2]=x):(a[u+1]=-2,l=!0)}else l=!0}if(l){let u=C3(a,t,e,n,s,i,o),d=oh(u,r,0,o);e=d.local;for(let h=0;h<a.length;h+=3)a[h+1]<0&&(a.splice(h,3),h-=3);for(let h=0,f=0;h<d.children.length;h+=3){let m=d.children[h];for(;f<a.length&&a[f]<m;)f+=3;a.splice(f,0,d.children[h],d.children[h+1],d.children[h+2])}}return new Xe(e.sort(Ii),a)}function V1(t,e){if(!e||!t.length)return t;let n=[];for(let r=0;r<t.length;r++){let s=t[r];n.push(new Sn(s.from+e,s.to+e,s.type))}return n}function C3(t,e,n,r,s,i,o){function a(l,u){for(let d=0;d<l.local.length;d++){let h=l.local[d].map(r,s,u);h?n.push(h):o.onRemove&&o.onRemove(l.local[d].spec)}for(let d=0;d<l.children.length;d+=3)a(l.children[d+2],l.children[d]+u+1)}for(let l=0;l<t.length;l+=3)t[l+1]==-1&&a(t[l+2],e[l]+i+1);return n}function j1(t,e,n){if(e.isLeaf)return null;let r=n+e.nodeSize,s=null;for(let i=0,o;i<t.length;i++)(o=t[i])&&o.from>n&&o.to<r&&((s||(s=[])).push(o),t[i]=null);return s}function F1(t){let e=[];for(let n=0;n<t.length;n++)t[n]!=null&&e.push(t[n]);return e}function oh(t,e,n,r){let s=[],i=!1;e.forEach((a,l)=>{let u=j1(t,a,l+n);if(u){i=!0;let d=oh(u,a,n+l+1,r);d!=kt&&s.push(l,l+a.nodeSize,d)}});let o=V1(i?F1(t):t,-n).sort(Ii);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||(r.onRemove&&r.onRemove(o[a].spec),o.splice(a--,1));return o.length||s.length?new Xe(o,s):kt}function Ii(t,e){return t.from-e.from||t.to-e.to}function nv(t){let e=t;for(let n=0;n<e.length-1;n++){let r=e[n];if(r.from!=r.to)for(let s=n+1;s<e.length;s++){let i=e[s];if(i.from==r.from){i.to!=r.to&&(e==t&&(e=t.slice()),e[s]=i.copy(i.from,r.to),WE(e,s+1,i.copy(r.to,i.to)));continue}else{i.from<r.to&&(e==t&&(e=t.slice()),e[n]=r.copy(r.from,i.from),WE(e,s,r.copy(i.from,r.to)));break}}}return e}function WE(t,e,n){for(;e<t.length&&Ii(n,t[e])>0;)e++;t.splice(e,0,n)}function Lp(t){let e=[];return t.someProp("decorations",n=>{let r=n(t.state);r&&r!=kt&&e.push(r)}),t.cursorWrapper&&e.push(Xe.create(t.state.doc,[t.cursorWrapper.deco])),ls.from(e)}const A3={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},N3=nn&&Ns<=11;class R3{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class P3{constructor(e,n){this.view=e,this.handleDOMChange=n,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new R3,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(r=>{for(let s=0;s<r.length;s++)this.queue.push(r[s]);nn&&Ns<=11&&r.some(s=>s.type=="childList"&&s.removedNodes.length||s.type=="characterData"&&s.oldValue.length>s.target.nodeValue.length)?this.flushSoon():this.flush()}),N3&&(this.onCharData=r=>{this.queue.push({target:r.target,type:"characterData",oldValue:r.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,A3)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let n=0;n<e.length;n++)this.queue.push(e[n]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(jE(this.view)){if(this.suppressingSelectionUpdates)return Rr(this.view);if(nn&&Ns<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&$i(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let n=new Set,r;for(let i=e.focusNode;i;i=aa(i))n.add(i);for(let i=e.anchorNode;i;i=aa(i))if(n.has(i)){r=i;break}let s=r&&this.view.docView.nearestDesc(r);if(s&&s.ignoreMutation({type:"selection",target:r.nodeType==3?r.parentNode:r}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let n=this.pendingRecords();n.length&&(this.queue=[]);let r=e.domSelectionRange(),s=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(r)&&jE(e)&&!this.ignoreSelectionChange(r),i=-1,o=-1,a=!1,l=[];if(e.editable)for(let d=0;d<n.length;d++){let h=this.registerMutation(n[d],l);h&&(i=i<0?h.from:Math.min(h.from,i),o=o<0?h.to:Math.max(h.to,o),h.typeOver&&(a=!0))}if(kn&&l.length){let d=l.filter(h=>h.nodeName=="BR");if(d.length==2){let[h,f]=d;h.parentNode&&h.parentNode.parentNode==f.parentNode?f.remove():h.remove()}else{let{focusNode:h}=this.currentSelection;for(let f of d){let m=f.parentNode;m&&m.nodeName=="LI"&&(!h||M3(e,h)!=m)&&f.remove()}}}let u=null;i<0&&s&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&rf(r)&&(u=Q0(e))&&u.eq(oe.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,Rr(e),this.currentSelection.set(r),e.scrollToSelection()):(i>-1||s)&&(i>-1&&(e.docView.markDirty(i,o),D3(e)),this.handleDOMChange(i,o,a,l),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(r)||Rr(e),this.currentSelection.set(r))}registerMutation(e,n){if(n.indexOf(e.target)>-1)return null;let r=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(r==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!r||r.ignoreMutation(e))return null;if(e.type=="childList"){for(let d=0;d<e.addedNodes.length;d++){let h=e.addedNodes[d];n.push(h),h.nodeType==3&&(this.lastChangedTextNode=h)}if(r.contentDOM&&r.contentDOM!=r.dom&&!r.contentDOM.contains(e.target))return{from:r.posBefore,to:r.posAfter};let s=e.previousSibling,i=e.nextSibling;if(nn&&Ns<=11&&e.addedNodes.length)for(let d=0;d<e.addedNodes.length;d++){let{previousSibling:h,nextSibling:f}=e.addedNodes[d];(!h||Array.prototype.indexOf.call(e.addedNodes,h)<0)&&(s=h),(!f||Array.prototype.indexOf.call(e.addedNodes,f)<0)&&(i=f)}let o=s&&s.parentNode==e.target?ht(s)+1:0,a=r.localPosFromDOM(e.target,o,-1),l=i&&i.parentNode==e.target?ht(i):e.target.childNodes.length,u=r.localPosFromDOM(e.target,l,1);return{from:a,to:u}}else return e.type=="attributes"?{from:r.posAtStart-r.border,to:r.posAtEnd+r.border}:(this.lastChangedTextNode=e.target,{from:r.posAtStart,to:r.posAtEnd,typeOver:e.target.nodeValue==e.oldValue})}}let KE=new WeakMap,GE=!1;function D3(t){if(!KE.has(t)&&(KE.set(t,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(t.dom).whiteSpace)!==-1)){if(t.requiresGeckoHackNode=kn,GE)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),GE=!0}}function QE(t,e){let n=e.startContainer,r=e.startOffset,s=e.endContainer,i=e.endOffset,o=t.domAtPos(t.state.selection.anchor);return $i(o.node,o.offset,s,i)&&([n,r,s,i]=[s,i,n,r]),{anchorNode:n,anchorOffset:r,focusNode:s,focusOffset:i}}function O3(t,e){if(e.getComposedRanges){let s=e.getComposedRanges(t.root)[0];if(s)return QE(t,s)}let n;function r(s){s.preventDefault(),s.stopImmediatePropagation(),n=s.getTargetRanges()[0]}return t.dom.addEventListener("beforeinput",r,!0),document.execCommand("indent"),t.dom.removeEventListener("beforeinput",r,!0),n?QE(t,n):null}function M3(t,e){for(let n=e.parentNode;n&&n!=t.dom;n=n.parentNode){let r=t.docView.nearestDesc(n,!0);if(r&&r.node.isBlock)return n}return null}function L3(t,e,n){let{node:r,fromOffset:s,toOffset:i,from:o,to:a}=t.docView.parseRange(e,n),l=t.domSelectionRange(),u,d=l.anchorNode;if(d&&t.dom.contains(d.nodeType==1?d:d.parentNode)&&(u=[{node:d,offset:l.anchorOffset}],rf(l)||u.push({node:l.focusNode,offset:l.focusOffset})),Nt&&t.input.lastKeyCode===8)for(let w=i;w>s;w--){let x=r.childNodes[w-1],S=x.pmViewDesc;if(x.nodeName=="BR"&&!S){i=w;break}if(!S||S.size)break}let h=t.state.doc,f=t.someProp("domParser")||As.fromSchema(t.state.schema),m=h.resolve(o),y=null,v=f.parse(r,{topNode:m.parent,topMatch:m.parent.contentMatchAt(m.index()),topOpen:!0,from:s,to:i,preserveWhitespace:m.parent.type.whitespace=="pre"?"full":!0,findPositions:u,ruleFromNode:V3,context:m});if(u&&u[0].pos!=null){let w=u[0].pos,x=u[1]&&u[1].pos;x==null&&(x=w),y={anchor:w+o,head:x+o}}return{doc:v,sel:y,from:o,to:a}}function V3(t){let e=t.pmViewDesc;if(e)return e.parseRule();if(t.nodeName=="BR"&&t.parentNode){if(Ut&&/^(ul|ol)$/i.test(t.parentNode.nodeName)){let n=document.createElement("div");return n.appendChild(document.createElement("li")),{skip:n}}else if(t.parentNode.lastChild==t||Ut&&/^(tr|table)$/i.test(t.parentNode.nodeName))return{ignore:!0}}else if(t.nodeName=="IMG"&&t.getAttribute("mark-placeholder"))return{ignore:!0};return null}const j3=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|img|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function F3(t,e,n,r,s){let i=t.input.compositionPendingChanges||(t.composing?t.input.compositionID:0);if(t.input.compositionPendingChanges=0,e<0){let k=t.input.lastSelectionTime>Date.now()-50?t.input.lastSelectionOrigin:null,E=Q0(t,k);if(E&&!t.state.selection.eq(E)){if(Nt&&Tr&&t.input.lastKeyCode===13&&Date.now()-100<t.input.lastKeyCodeTime&&t.someProp("handleKeyDown",C=>C(t,ui(13,"Enter"))))return;let I=t.state.tr.setSelection(E);k=="pointer"?I.setMeta("pointer",!0):k=="key"&&I.scrollIntoView(),i&&I.setMeta("composition",i),t.dispatch(I)}return}let o=t.state.doc.resolve(e),a=o.sharedDepth(n);e=o.before(a+1),n=t.state.doc.resolve(n).after(a+1);let l=t.state.selection,u=L3(t,e,n),d=t.state.doc,h=d.slice(u.from,u.to),f,m;t.input.lastKeyCode===8&&Date.now()-100<t.input.lastKeyCodeTime?(f=t.state.selection.to,m="end"):(f=t.state.selection.from,m="start"),t.input.lastKeyCode=null;let y=z3(h.content,u.doc.content,u.from,f,m);if(y&&t.input.domChangeCount++,(la&&t.input.lastIOSEnter>Date.now()-225||Tr)&&s.some(k=>k.nodeType==1&&!j3.test(k.nodeName))&&(!y||y.endA>=y.endB)&&t.someProp("handleKeyDown",k=>k(t,ui(13,"Enter")))){t.input.lastIOSEnter=0;return}if(!y)if(r&&l instanceof ne&&!l.empty&&l.$head.sameParent(l.$anchor)&&!t.composing&&!(u.sel&&u.sel.anchor!=u.sel.head))y={start:l.from,endA:l.to,endB:l.to};else{if(u.sel){let k=JE(t,t.state.doc,u.sel);if(k&&!k.eq(t.state.selection)){let E=t.state.tr.setSelection(k);i&&E.setMeta("composition",i),t.dispatch(E)}}return}t.state.selection.from<t.state.selection.to&&y.start==y.endB&&t.state.selection instanceof ne&&(y.start>t.state.selection.from&&y.start<=t.state.selection.from+2&&t.state.selection.from>=u.from?y.start=t.state.selection.from:y.endA<t.state.selection.to&&y.endA>=t.state.selection.to-2&&t.state.selection.to<=u.to&&(y.endB+=t.state.selection.to-y.endA,y.endA=t.state.selection.to)),nn&&Ns<=11&&y.endB==y.start+1&&y.endA==y.start&&y.start>u.from&&u.doc.textBetween(y.start-u.from-1,y.start-u.from+1)==" "&&(y.start--,y.endA--,y.endB--);let v=u.doc.resolveNoCache(y.start-u.from),w=u.doc.resolveNoCache(y.endB-u.from),x=d.resolve(y.start),S=v.sameParent(w)&&v.parent.inlineContent&&x.end()>=y.endA;if((la&&t.input.lastIOSEnter>Date.now()-225&&(!S||s.some(k=>k.nodeName=="DIV"||k.nodeName=="P"))||!S&&v.pos<u.doc.content.size&&(!v.sameParent(w)||!v.parent.inlineContent)&&v.pos<w.pos&&!/\S/.test(u.doc.textBetween(v.pos,w.pos,"","")))&&t.someProp("handleKeyDown",k=>k(t,ui(13,"Enter")))){t.input.lastIOSEnter=0;return}if(t.state.selection.anchor>y.start&&B3(d,y.start,y.endA,v,w)&&t.someProp("handleKeyDown",k=>k(t,ui(8,"Backspace")))){Tr&&Nt&&t.domObserver.suppressSelectionUpdates();return}Nt&&y.endB==y.start&&(t.input.lastChromeDelete=Date.now()),Tr&&!S&&v.start()!=w.start()&&w.parentOffset==0&&v.depth==w.depth&&u.sel&&u.sel.anchor==u.sel.head&&u.sel.head==y.endA&&(y.endB-=2,w=u.doc.resolveNoCache(y.endB-u.from),setTimeout(()=>{t.someProp("handleKeyDown",function(k){return k(t,ui(13,"Enter"))})},20));let b=y.start,N=y.endA,M=k=>{let E=k||t.state.tr.replace(b,N,u.doc.slice(y.start-u.from,y.endB-u.from));if(u.sel){let I=JE(t,E.doc,u.sel);I&&!(Nt&&t.composing&&I.empty&&(y.start!=y.endB||t.input.lastChromeDelete<Date.now()-100)&&(I.head==b||I.head==E.mapping.map(N)-1)||nn&&I.empty&&I.head==b)&&E.setSelection(I)}return i&&E.setMeta("composition",i),E.scrollIntoView()},V;if(S)if(v.pos==w.pos){nn&&Ns<=11&&v.parentOffset==0&&(t.domObserver.suppressSelectionUpdates(),setTimeout(()=>Rr(t),20));let k=M(t.state.tr.delete(b,N)),E=d.resolve(y.start).marksAcross(d.resolve(y.endA));E&&k.ensureMarks(E),t.dispatch(k)}else if(y.endA==y.endB&&(V=U3(v.parent.content.cut(v.parentOffset,w.parentOffset),x.parent.content.cut(x.parentOffset,y.endA-x.start())))){let k=M(t.state.tr);V.type=="add"?k.addMark(b,N,V.mark):k.removeMark(b,N,V.mark),t.dispatch(k)}else if(v.parent.child(v.index()).isText&&v.index()==w.index()-(w.textOffset?0:1)){let k=v.parent.textBetween(v.parentOffset,w.parentOffset),E=()=>M(t.state.tr.insertText(k,b,N));t.someProp("handleTextInput",I=>I(t,b,N,k,E))||t.dispatch(E())}else t.dispatch(M());else t.dispatch(M())}function JE(t,e,n){return Math.max(n.anchor,n.head)>e.content.size?null:J0(t,e.resolve(n.anchor),e.resolve(n.head))}function U3(t,e){let n=t.firstChild.marks,r=e.firstChild.marks,s=n,i=r,o,a,l;for(let d=0;d<r.length;d++)s=r[d].removeFromSet(s);for(let d=0;d<n.length;d++)i=n[d].removeFromSet(i);if(s.length==1&&i.length==0)a=s[0],o="add",l=d=>d.mark(a.addToSet(d.marks));else if(s.length==0&&i.length==1)a=i[0],o="remove",l=d=>d.mark(a.removeFromSet(d.marks));else return null;let u=[];for(let d=0;d<e.childCount;d++)u.push(l(e.child(d)));if(F.from(u).eq(t))return{mark:a,type:o}}function B3(t,e,n,r,s){if(n-e<=s.pos-r.pos||Vp(r,!0,!1)<s.pos)return!1;let i=t.resolve(e);if(!r.parent.isTextblock){let a=i.nodeAfter;return a!=null&&n==e+a.nodeSize}if(i.parentOffset<i.parent.content.size||!i.parent.isTextblock)return!1;let o=t.resolve(Vp(i,!0,!0));return!o.parent.isTextblock||o.pos>n||Vp(o,!0,!1)<n?!1:r.parent.content.cut(r.parentOffset).eq(o.parent.content)}function Vp(t,e,n){let r=t.depth,s=e?t.end():t.pos;for(;r>0&&(e||t.indexAfter(r)==t.node(r).childCount);)r--,s++,e=!1;if(n){let i=t.node(r).maybeChild(t.indexAfter(r));for(;i&&!i.isLeaf;)i=i.firstChild,s++}return s}function z3(t,e,n,r,s){let i=t.findDiffStart(e,n);if(i==null)return null;let{a:o,b:a}=t.findDiffEnd(e,n+t.size,n+e.size);if(s=="end"){let l=Math.max(0,i-Math.min(o,a));r-=o+l-i}if(o<i&&t.size<e.size){let l=r<=i&&r>=o?i-r:0;i-=l,i&&i<e.size&&YE(e.textBetween(i-1,i+1))&&(i+=l?1:-1),a=i+(a-o),o=i}else if(a<i){let l=r<=i&&r>=a?i-r:0;i-=l,i&&i<t.size&&YE(t.textBetween(i-1,i+1))&&(i+=l?1:-1),o=i+(o-a),a=i}return{start:i,endA:o,endB:a}}function YE(t){if(t.length!=2)return!1;let e=t.charCodeAt(0),n=t.charCodeAt(1);return e>=56320&&e<=57343&&n>=55296&&n<=56319}class U1{constructor(e,n){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new a3,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=n,this.state=n.state,this.directPlugins=n.plugins||[],this.directPlugins.forEach(nS),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):typeof e=="function"?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=eS(this),ZE(this),this.nodeViews=tS(this),this.docView=PE(this.state.doc,XE(this),Lp(this),this.dom,this),this.domObserver=new P3(this,(r,s,i,o)=>F3(this,r,s,i,o)),this.domObserver.start(),l3(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let n in e)this._props[n]=e[n];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&Pg(this);let n=this._props;this._props=e,e.plugins&&(e.plugins.forEach(nS),this.directPlugins=e.plugins),this.updateStateInner(e.state,n)}setProps(e){let n={};for(let r in this._props)n[r]=this._props[r];n.state=this.state;for(let r in e)n[r]=e[r];this.update(n)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,n){var r;let s=this.state,i=!1,o=!1;e.storedMarks&&this.composing&&(D1(this),o=!0),this.state=e;let a=s.plugins!=e.plugins||this._props.plugins!=n.plugins;if(a||this._props.plugins!=n.plugins||this._props.nodeViews!=n.nodeViews){let m=tS(this);q3(m,this.nodeViews)&&(this.nodeViews=m,i=!0)}(a||n.handleDOMEvents!=this._props.handleDOMEvents)&&Pg(this),this.editable=eS(this),ZE(this);let l=Lp(this),u=XE(this),d=s.plugins!=e.plugins&&!s.doc.eq(e.doc)?"reset":e.scrollToSelection>s.scrollToSelection?"to selection":"preserve",h=i||!this.docView.matchesNode(e.doc,u,l);(h||!e.selection.eq(s.selection))&&(o=!0);let f=d=="preserve"&&o&&this.dom.style.overflowAnchor==null&&EB(this);if(o){this.domObserver.stop();let m=h&&(nn||Nt)&&!this.composing&&!s.selection.empty&&!e.selection.empty&&$3(s.selection,e.selection);if(h){let y=Nt?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=x3(this)),(i||!this.docView.update(e.doc,u,l,this))&&(this.docView.updateOuterDeco(u),this.docView.destroy(),this.docView=PE(e.doc,u,l,this.dom,this)),y&&!this.trackWrites&&(m=!0)}m||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&WB(this))?Rr(this,m):(x1(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(s),!((r=this.dragging)===null||r===void 0)&&r.node&&!s.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,s),d=="reset"?this.dom.scrollTop=0:d=="to selection"?this.scrollToSelection():f&&SB(f)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(!(!e||!this.dom.contains(e.nodeType==1?e:e.parentNode))){if(!this.someProp("handleScrollToSelection",n=>n(this)))if(this.state.selection instanceof Y){let n=this.docView.domAfterPos(this.state.selection.from);n.nodeType==1&&kE(this,n.getBoundingClientRect(),e)}else kE(this,this.coordsAtPos(this.state.selection.head,1),e)}}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let n=0;n<this.directPlugins.length;n++){let r=this.directPlugins[n];r.spec.view&&this.pluginViews.push(r.spec.view(this))}for(let n=0;n<this.state.plugins.length;n++){let r=this.state.plugins[n];r.spec.view&&this.pluginViews.push(r.spec.view(this))}}else for(let n=0;n<this.pluginViews.length;n++){let r=this.pluginViews[n];r.update&&r.update(this,e)}}updateDraggedNode(e,n){let r=e.node,s=-1;if(this.state.doc.nodeAt(r.from)==r.node)s=r.from;else{let i=r.from+(this.state.doc.content.size-n.doc.content.size);(i>0&&this.state.doc.nodeAt(i))==r.node&&(s=i)}this.dragging=new M1(e.slice,e.move,s<0?void 0:Y.create(this.state.doc,s))}someProp(e,n){let r=this._props&&this._props[e],s;if(r!=null&&(s=n?n(r):r))return s;for(let o=0;o<this.directPlugins.length;o++){let a=this.directPlugins[o].props[e];if(a!=null&&(s=n?n(a):a))return s}let i=this.state.plugins;if(i)for(let o=0;o<i.length;o++){let a=i[o].props[e];if(a!=null&&(s=n?n(a):a))return s}}hasFocus(){if(nn){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if(e.contentEditable=="false")return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&bB(this.dom),Rr(this),this.domObserver.start()}get root(){let e=this._root;if(e==null){for(let n=this.dom.parentNode;n;n=n.parentNode)if(n.nodeType==9||n.nodeType==11&&n.host)return n.getSelection||(Object.getPrototypeOf(n).getSelection=()=>n.ownerDocument.getSelection()),this._root=n}return e||document}updateRoot(){this._root=null}posAtCoords(e){return AB(this,e)}coordsAtPos(e,n=1){return f1(this,e,n)}domAtPos(e,n=0){return this.docView.domFromPos(e,n)}nodeDOM(e){let n=this.docView.descAt(e);return n?n.nodeDOM:null}posAtDOM(e,n,r=-1){let s=this.docView.posFromDOM(e,n,r);if(s==null)throw new RangeError("DOM position not inside the editor");return s}endOfTextblock(e,n){return OB(this,n||this.state,e)}pasteHTML(e,n){return du(this,"",e,!1,n||new ClipboardEvent("paste"))}pasteText(e,n){return du(this,e,null,!0,n||new ClipboardEvent("paste"))}serializeForClipboard(e){return Y0(this,e)}destroy(){this.docView&&(u3(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],Lp(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,dB())}get isDestroyed(){return this.docView==null}dispatchEvent(e){return d3(this,e)}domSelectionRange(){let e=this.domSelection();return e?Ut&&this.root.nodeType===11&&gB(this.dom.ownerDocument)==this.dom&&O3(this,e)||e:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}U1.prototype.dispatch=function(t){let e=this._props.dispatchTransaction;e?e.call(this,t):this.updateState(this.state.apply(t))};function XE(t){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(t.editable),t.someProp("attributes",n=>{if(typeof n=="function"&&(n=n(t.state)),n)for(let r in n)r=="class"?e.class+=" "+n[r]:r=="style"?e.style=(e.style?e.style+";":"")+n[r]:!e[r]&&r!="contenteditable"&&r!="nodeName"&&(e[r]=String(n[r]))}),e.translate||(e.translate="no"),[Sn.node(0,t.state.doc.content.size,e)]}function ZE(t){if(t.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),t.cursorWrapper={dom:e,deco:Sn.widget(t.state.selection.from,e,{raw:!0,marks:t.markCursor})}}else t.cursorWrapper=null}function eS(t){return!t.someProp("editable",e=>e(t.state)===!1)}function $3(t,e){let n=Math.min(t.$anchor.sharedDepth(t.head),e.$anchor.sharedDepth(e.head));return t.$anchor.start(n)!=e.$anchor.start(n)}function tS(t){let e=Object.create(null);function n(r){for(let s in r)Object.prototype.hasOwnProperty.call(e,s)||(e[s]=r[s])}return t.someProp("nodeViews",n),t.someProp("markViews",n),e}function q3(t,e){let n=0,r=0;for(let s in t){if(t[s]!=e[s])return!0;n++}for(let s in e)r++;return n!=r}function nS(t){if(t.spec.state||t.spec.filterTransaction||t.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var zs={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},ah={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},H3=typeof navigator<"u"&&/Mac/.test(navigator.platform),W3=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var ft=0;ft<10;ft++)zs[48+ft]=zs[96+ft]=String(ft);for(var ft=1;ft<=24;ft++)zs[ft+111]="F"+ft;for(var ft=65;ft<=90;ft++)zs[ft]=String.fromCharCode(ft+32),ah[ft]=String.fromCharCode(ft);for(var jp in zs)ah.hasOwnProperty(jp)||(ah[jp]=zs[jp]);function K3(t){var e=H3&&t.metaKey&&t.shiftKey&&!t.ctrlKey&&!t.altKey||W3&&t.shiftKey&&t.key&&t.key.length==1||t.key=="Unidentified",n=!e&&t.key||(t.shiftKey?ah:zs)[t.keyCode]||t.key||"Unidentified";return n=="Esc"&&(n="Escape"),n=="Del"&&(n="Delete"),n=="Left"&&(n="ArrowLeft"),n=="Up"&&(n="ArrowUp"),n=="Right"&&(n="ArrowRight"),n=="Down"&&(n="ArrowDown"),n}const G3=typeof navigator<"u"&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),Q3=typeof navigator<"u"&&/Win/.test(navigator.platform);function J3(t){let e=t.split(/-(?!$)/),n=e[e.length-1];n=="Space"&&(n=" ");let r,s,i,o;for(let a=0;a<e.length-1;a++){let l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))s=!0;else if(/^s(hift)?$/i.test(l))i=!0;else if(/^mod$/i.test(l))G3?o=!0:s=!0;else throw new Error("Unrecognized modifier name: "+l)}return r&&(n="Alt-"+n),s&&(n="Ctrl-"+n),o&&(n="Meta-"+n),i&&(n="Shift-"+n),n}function Y3(t){let e=Object.create(null);for(let n in t)e[J3(n)]=t[n];return e}function Fp(t,e,n=!0){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),n&&e.shiftKey&&(t="Shift-"+t),t}function X3(t){return new sn({props:{handleKeyDown:B1(t)}})}function B1(t){let e=Y3(t);return function(n,r){let s=K3(r),i,o=e[Fp(s,r)];if(o&&o(n.state,n.dispatch,n))return!0;if(s.length==1&&s!=" "){if(r.shiftKey){let a=e[Fp(s,r,!1)];if(a&&a(n.state,n.dispatch,n))return!0}if((r.altKey||r.metaKey||r.ctrlKey)&&!(Q3&&r.ctrlKey&&r.altKey)&&(i=zs[r.keyCode])&&i!=s){let a=e[Fp(i,r)];if(a&&a(n.state,n.dispatch,n))return!0}}return!1}}const rv=(t,e)=>t.selection.empty?!1:(e&&e(t.tr.deleteSelection().scrollIntoView()),!0);function z1(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("backward",t):n.parentOffset>0)?null:n}const $1=(t,e,n)=>{let r=z1(t,n);if(!r)return!1;let s=sv(r);if(!s){let o=r.blockRange(),a=o&&ba(o);return a==null?!1:(e&&e(t.tr.lift(o,a).scrollIntoView()),!0)}let i=s.nodeBefore;if(X1(t,s,e,-1))return!0;if(r.parent.content.size==0&&(ua(i,"end")||Y.isSelectable(i)))for(let o=r.depth;;o--){let a=tf(t.doc,r.before(o),r.after(o),q.empty);if(a&&a.slice.size<a.to-a.from){if(e){let l=t.tr.step(a);l.setSelection(ua(i,"end")?oe.findFrom(l.doc.resolve(l.mapping.map(s.pos,-1)),-1):Y.create(l.doc,s.pos-i.nodeSize)),e(l.scrollIntoView())}return!0}if(o==1||r.node(o-1).childCount>1)break}return i.isAtom&&s.depth==r.depth-1?(e&&e(t.tr.delete(s.pos-i.nodeSize,s.pos).scrollIntoView()),!0):!1},Z3=(t,e,n)=>{let r=z1(t,n);if(!r)return!1;let s=sv(r);return s?q1(t,s,e):!1},ez=(t,e,n)=>{let r=W1(t,n);if(!r)return!1;let s=iv(r);return s?q1(t,s,e):!1};function q1(t,e,n){let r=e.nodeBefore,s=r,i=e.pos-1;for(;!s.isTextblock;i--){if(s.type.spec.isolating)return!1;let d=s.lastChild;if(!d)return!1;s=d}let o=e.nodeAfter,a=o,l=e.pos+1;for(;!a.isTextblock;l++){if(a.type.spec.isolating)return!1;let d=a.firstChild;if(!d)return!1;a=d}let u=tf(t.doc,i,l,q.empty);if(!u||u.from!=i||u instanceof nt&&u.slice.size>=l-i)return!1;if(n){let d=t.tr.step(u);d.setSelection(ne.create(d.doc,i)),n(d.scrollIntoView())}return!0}function ua(t,e,n=!1){for(let r=t;r;r=e=="start"?r.firstChild:r.lastChild){if(r.isTextblock)return!0;if(n&&r.childCount!=1)return!1}return!1}const H1=(t,e,n)=>{let{$head:r,empty:s}=t.selection,i=r;if(!s)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("backward",t):r.parentOffset>0)return!1;i=sv(r)}let o=i&&i.nodeBefore;return!o||!Y.isSelectable(o)?!1:(e&&e(t.tr.setSelection(Y.create(t.doc,i.pos-o.nodeSize)).scrollIntoView()),!0)};function sv(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){if(t.index(e)>0)return t.doc.resolve(t.before(e+1));if(t.node(e).type.spec.isolating)break}return null}function W1(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("forward",t):n.parentOffset<n.parent.content.size)?null:n}const K1=(t,e,n)=>{let r=W1(t,n);if(!r)return!1;let s=iv(r);if(!s)return!1;let i=s.nodeAfter;if(X1(t,s,e,1))return!0;if(r.parent.content.size==0&&(ua(i,"start")||Y.isSelectable(i))){let o=tf(t.doc,r.before(),r.after(),q.empty);if(o&&o.slice.size<o.to-o.from){if(e){let a=t.tr.step(o);a.setSelection(ua(i,"start")?oe.findFrom(a.doc.resolve(a.mapping.map(s.pos)),1):Y.create(a.doc,a.mapping.map(s.pos))),e(a.scrollIntoView())}return!0}}return i.isAtom&&s.depth==r.depth-1?(e&&e(t.tr.delete(s.pos,s.pos+i.nodeSize).scrollIntoView()),!0):!1},G1=(t,e,n)=>{let{$head:r,empty:s}=t.selection,i=r;if(!s)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("forward",t):r.parentOffset<r.parent.content.size)return!1;i=iv(r)}let o=i&&i.nodeAfter;return!o||!Y.isSelectable(o)?!1:(e&&e(t.tr.setSelection(Y.create(t.doc,i.pos)).scrollIntoView()),!0)};function iv(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){let n=t.node(e);if(t.index(e)+1<n.childCount)return t.doc.resolve(t.after(e+1));if(n.type.spec.isolating)break}return null}const tz=(t,e)=>{let n=t.selection,r=n instanceof Y,s;if(r){if(n.node.isTextblock||!Xs(t.doc,n.from))return!1;s=n.from}else if(s=ef(t.doc,n.from,-1),s==null)return!1;if(e){let i=t.tr.join(s);r&&i.setSelection(Y.create(i.doc,s-t.doc.resolve(s).nodeBefore.nodeSize)),e(i.scrollIntoView())}return!0},nz=(t,e)=>{let n=t.selection,r;if(n instanceof Y){if(n.node.isTextblock||!Xs(t.doc,n.to))return!1;r=n.to}else if(r=ef(t.doc,n.to,1),r==null)return!1;return e&&e(t.tr.join(r).scrollIntoView()),!0},rz=(t,e)=>{let{$from:n,$to:r}=t.selection,s=n.blockRange(r),i=s&&ba(s);return i==null?!1:(e&&e(t.tr.lift(s,i).scrollIntoView()),!0)},Q1=(t,e)=>{let{$head:n,$anchor:r}=t.selection;return!n.parent.type.spec.code||!n.sameParent(r)?!1:(e&&e(t.tr.insertText(`
`).scrollIntoView()),!0)};function ov(t){for(let e=0;e<t.edgeCount;e++){let{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}const sz=(t,e)=>{let{$head:n,$anchor:r}=t.selection;if(!n.parent.type.spec.code||!n.sameParent(r))return!1;let s=n.node(-1),i=n.indexAfter(-1),o=ov(s.contentMatchAt(i));if(!o||!s.canReplaceWith(i,i,o))return!1;if(e){let a=n.after(),l=t.tr.replaceWith(a,a,o.createAndFill());l.setSelection(oe.near(l.doc.resolve(a),1)),e(l.scrollIntoView())}return!0},J1=(t,e)=>{let n=t.selection,{$from:r,$to:s}=n;if(n instanceof fn||r.parent.inlineContent||s.parent.inlineContent)return!1;let i=ov(s.parent.contentMatchAt(s.indexAfter()));if(!i||!i.isTextblock)return!1;if(e){let o=(!r.parentOffset&&s.index()<s.parent.childCount?r:s).pos,a=t.tr.insert(o,i.createAndFill());a.setSelection(ne.create(a.doc,o+1)),e(a.scrollIntoView())}return!0},Y1=(t,e)=>{let{$cursor:n}=t.selection;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){let i=n.before();if(Nr(t.doc,i))return e&&e(t.tr.split(i).scrollIntoView()),!0}let r=n.blockRange(),s=r&&ba(r);return s==null?!1:(e&&e(t.tr.lift(r,s).scrollIntoView()),!0)};function iz(t){return(e,n)=>{let{$from:r,$to:s}=e.selection;if(e.selection instanceof Y&&e.selection.node.isBlock)return!r.parentOffset||!Nr(e.doc,r.pos)?!1:(n&&n(e.tr.split(r.pos).scrollIntoView()),!0);if(!r.depth)return!1;let i=[],o,a,l=!1,u=!1;for(let m=r.depth;;m--)if(r.node(m).isBlock){l=r.end(m)==r.pos+(r.depth-m),u=r.start(m)==r.pos-(r.depth-m),a=ov(r.node(m-1).contentMatchAt(r.indexAfter(m-1))),i.unshift(l&&a?{type:a}:null),o=m;break}else{if(m==1)return!1;i.unshift(null)}let d=e.tr;(e.selection instanceof ne||e.selection instanceof fn)&&d.deleteSelection();let h=d.mapping.map(r.pos),f=Nr(d.doc,h,i.length,i);if(f||(i[0]=a?{type:a}:null,f=Nr(d.doc,h,i.length,i)),!f)return!1;if(d.split(h,i.length,i),!l&&u&&r.node(o).type!=a){let m=d.mapping.map(r.before(o)),y=d.doc.resolve(m);a&&r.node(o-1).canReplaceWith(y.index(),y.index()+1,a)&&d.setNodeMarkup(d.mapping.map(r.before(o)),a)}return n&&n(d.scrollIntoView()),!0}}const oz=iz(),az=(t,e)=>{let{$from:n,to:r}=t.selection,s,i=n.sharedDepth(r);return i==0?!1:(s=n.before(i),e&&e(t.tr.setSelection(Y.create(t.doc,s))),!0)};function lz(t,e,n){let r=e.nodeBefore,s=e.nodeAfter,i=e.index();return!r||!s||!r.type.compatibleContent(s.type)?!1:!r.content.size&&e.parent.canReplace(i-1,i)?(n&&n(t.tr.delete(e.pos-r.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(i,i+1)||!(s.isTextblock||Xs(t.doc,e.pos))?!1:(n&&n(t.tr.join(e.pos).scrollIntoView()),!0)}function X1(t,e,n,r){let s=e.nodeBefore,i=e.nodeAfter,o,a,l=s.type.spec.isolating||i.type.spec.isolating;if(!l&&lz(t,e,n))return!0;let u=!l&&e.parent.canReplace(e.index(),e.index()+1);if(u&&(o=(a=s.contentMatchAt(s.childCount)).findWrapping(i.type))&&a.matchType(o[0]||i.type).validEnd){if(n){let m=e.pos+i.nodeSize,y=F.empty;for(let x=o.length-1;x>=0;x--)y=F.from(o[x].create(null,y));y=F.from(s.copy(y));let v=t.tr.step(new st(e.pos-1,m,e.pos,m,new q(y,1,0),o.length,!0)),w=v.doc.resolve(m+2*o.length);w.nodeAfter&&w.nodeAfter.type==s.type&&Xs(v.doc,w.pos)&&v.join(w.pos),n(v.scrollIntoView())}return!0}let d=i.type.spec.isolating||r>0&&l?null:oe.findFrom(e,1),h=d&&d.$from.blockRange(d.$to),f=h&&ba(h);if(f!=null&&f>=e.depth)return n&&n(t.tr.lift(h,f).scrollIntoView()),!0;if(u&&ua(i,"start",!0)&&ua(s,"end")){let m=s,y=[];for(;y.push(m),!m.isTextblock;)m=m.lastChild;let v=i,w=1;for(;!v.isTextblock;v=v.firstChild)w++;if(m.canReplace(m.childCount,m.childCount,v.content)){if(n){let x=F.empty;for(let b=y.length-1;b>=0;b--)x=F.from(y[b].copy(x));let S=t.tr.step(new st(e.pos-y.length,e.pos+i.nodeSize,e.pos+w,e.pos+i.nodeSize-w,new q(x,y.length,0),0,!0));n(S.scrollIntoView())}return!0}}return!1}function Z1(t){return function(e,n){let r=e.selection,s=t<0?r.$from:r.$to,i=s.depth;for(;s.node(i).isInline;){if(!i)return!1;i--}return s.node(i).isTextblock?(n&&n(e.tr.setSelection(ne.create(e.doc,t<0?s.start(i):s.end(i)))),!0):!1}}const uz=Z1(-1),cz=Z1(1);function dz(t,e=null){return function(n,r){let{$from:s,$to:i}=n.selection,o=s.blockRange(i),a=o&&W0(o,t,e);return a?(r&&r(n.tr.wrap(o,a).scrollIntoView()),!0):!1}}function rS(t,e=null){return function(n,r){let s=!1;for(let i=0;i<n.selection.ranges.length&&!s;i++){let{$from:{pos:o},$to:{pos:a}}=n.selection.ranges[i];n.doc.nodesBetween(o,a,(l,u)=>{if(s)return!1;if(!(!l.isTextblock||l.hasMarkup(t,e)))if(l.type==t)s=!0;else{let d=n.doc.resolve(u),h=d.index();s=d.parent.canReplaceWith(h,h+1,t)}})}if(!s)return!1;if(r){let i=n.tr;for(let o=0;o<n.selection.ranges.length;o++){let{$from:{pos:a},$to:{pos:l}}=n.selection.ranges[o];i.setBlockType(a,l,t,e)}r(i.scrollIntoView())}return!0}}function av(...t){return function(e,n,r){for(let s=0;s<t.length;s++)if(t[s](e,n,r))return!0;return!1}}av(rv,$1,H1);av(rv,K1,G1);av(Q1,J1,Y1,oz);typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform&&os.platform()=="darwin";function hz(t,e=null){return function(n,r){let{$from:s,$to:i}=n.selection,o=s.blockRange(i);if(!o)return!1;let a=r?n.tr:null;return fz(a,o,t,e)?(r&&r(a.scrollIntoView()),!0):!1}}function fz(t,e,n,r=null){let s=!1,i=e,o=e.$from.doc;if(e.depth>=2&&e.$from.node(e.depth-1).type.compatibleContent(n)&&e.startIndex==0){if(e.$from.index(e.depth-1)==0)return!1;let l=o.resolve(e.start-2);i=new eh(l,l,e.depth),e.endIndex<e.parent.childCount&&(e=new eh(e.$from,o.resolve(e.$to.end(e.depth)),e.depth)),s=!0}let a=W0(i,n,r,e);return a?(t&&pz(t,e,a,s,n),!0):!1}function pz(t,e,n,r,s){let i=F.empty;for(let d=n.length-1;d>=0;d--)i=F.from(n[d].type.create(n[d].attrs,i));t.step(new st(e.start-(r?2:0),e.end,e.start,e.end,new q(i,0,0),n.length,!0));let o=0;for(let d=0;d<n.length;d++)n[d].type==s&&(o=d+1);let a=n.length-o,l=e.start+n.length-(r?2:0),u=e.parent;for(let d=e.startIndex,h=e.endIndex,f=!0;d<h;d++,f=!1)!f&&Nr(t.doc,l,a)&&(t.split(l,a),l+=2*a),l+=u.child(d).nodeSize;return t}function mz(t){return function(e,n){let{$from:r,$to:s}=e.selection,i=r.blockRange(s,o=>o.childCount>0&&o.firstChild.type==t);return i?n?r.node(i.depth-1).type==t?gz(e,n,t,i):yz(e,n,i):!0:!1}}function gz(t,e,n,r){let s=t.tr,i=r.end,o=r.$to.end(r.depth);i<o&&(s.step(new st(i-1,o,i,o,new q(F.from(n.create(null,r.parent.copy())),1,0),1,!0)),r=new eh(s.doc.resolve(r.$from.pos),s.doc.resolve(o),r.depth));const a=ba(r);if(a==null)return!1;s.lift(r,a);let l=s.doc.resolve(s.mapping.map(i,-1)-1);return Xs(s.doc,l.pos)&&l.nodeBefore.type==l.nodeAfter.type&&s.join(l.pos),e(s.scrollIntoView()),!0}function yz(t,e,n){let r=t.tr,s=n.parent;for(let m=n.end,y=n.endIndex-1,v=n.startIndex;y>v;y--)m-=s.child(y).nodeSize,r.delete(m-1,m+1);let i=r.doc.resolve(n.start),o=i.nodeAfter;if(r.mapping.map(n.end)!=n.start+i.nodeAfter.nodeSize)return!1;let a=n.startIndex==0,l=n.endIndex==s.childCount,u=i.node(-1),d=i.index(-1);if(!u.canReplace(d+(a?0:1),d+1,o.content.append(l?F.empty:F.from(s))))return!1;let h=i.pos,f=h+o.nodeSize;return r.step(new st(h-(a?1:0),f+(l?1:0),h+1,f-1,new q((a?F.empty:F.from(s.copy(F.empty))).append(l?F.empty:F.from(s.copy(F.empty))),a?0:1,l?0:1),a?0:1)),e(r.scrollIntoView()),!0}function vz(t){return function(e,n){let{$from:r,$to:s}=e.selection,i=r.blockRange(s,u=>u.childCount>0&&u.firstChild.type==t);if(!i)return!1;let o=i.startIndex;if(o==0)return!1;let a=i.parent,l=a.child(o-1);if(l.type!=t)return!1;if(n){let u=l.lastChild&&l.lastChild.type==a.type,d=F.from(u?t.create():null),h=new q(F.from(t.create(null,F.from(a.type.create(null,d)))),u?3:1,0),f=i.start,m=i.end;n(e.tr.step(new st(f-(u?3:1),m,f,m,h,1,!0)).scrollIntoView())}return!0}}function af(t){const{state:e,transaction:n}=t;let{selection:r}=n,{doc:s}=n,{storedMarks:i}=n;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return i},get selection(){return r},get doc(){return s},get tr(){return r=n.selection,s=n.doc,i=n.storedMarks,n}}}class lf{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:n,state:r}=this,{view:s}=n,{tr:i}=r,o=this.buildProps(i);return Object.fromEntries(Object.entries(e).map(([a,l])=>[a,(...d)=>{const h=l(...d)(o);return!i.getMeta("preventDispatch")&&!this.hasCustomState&&s.dispatch(i),h}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,n=!0){const{rawCommands:r,editor:s,state:i}=this,{view:o}=s,a=[],l=!!e,u=e||i.tr,d=()=>(!l&&n&&!u.getMeta("preventDispatch")&&!this.hasCustomState&&o.dispatch(u),a.every(f=>f===!0)),h={...Object.fromEntries(Object.entries(r).map(([f,m])=>[f,(...v)=>{const w=this.buildProps(u,n),x=m(...v)(w);return a.push(x),h}])),run:d};return h}createCan(e){const{rawCommands:n,state:r}=this,s=!1,i=e||r.tr,o=this.buildProps(i,s);return{...Object.fromEntries(Object.entries(n).map(([l,u])=>[l,(...d)=>u(...d)({...o,dispatch:void 0})])),chain:()=>this.createChain(i,s)}}buildProps(e,n=!0){const{rawCommands:r,editor:s,state:i}=this,{view:o}=s,a={tr:e,editor:s,view:o,state:af({state:i,transaction:e}),dispatch:n?()=>{}:void 0,chain:()=>this.createChain(e,n),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(r).map(([l,u])=>[l,(...d)=>u(...d)(a)]))}};return a}}class _z{constructor(){this.callbacks={}}on(e,n){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(n),this}emit(e,...n){const r=this.callbacks[e];return r&&r.forEach(s=>s.apply(this,n)),this}off(e,n){const r=this.callbacks[e];return r&&(n?this.callbacks[e]=r.filter(s=>s!==n):delete this.callbacks[e]),this}once(e,n){const r=(...s)=>{this.off(e,r),n.apply(this,s)};return this.on(e,r)}removeAllListeners(){this.callbacks={}}}function K(t,e,n){return t.config[e]===void 0&&t.parent?K(t.parent,e,n):typeof t.config[e]=="function"?t.config[e].bind({...n,parent:t.parent?K(t.parent,e,n):null}):t.config[e]}function uf(t){const e=t.filter(s=>s.type==="extension"),n=t.filter(s=>s.type==="node"),r=t.filter(s=>s.type==="mark");return{baseExtensions:e,nodeExtensions:n,markExtensions:r}}function eA(t){const e=[],{nodeExtensions:n,markExtensions:r}=uf(t),s=[...n,...r],i={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return t.forEach(o=>{const a={name:o.name,options:o.options,storage:o.storage,extensions:s},l=K(o,"addGlobalAttributes",a);if(!l)return;l().forEach(d=>{d.types.forEach(h=>{Object.entries(d.attributes).forEach(([f,m])=>{e.push({type:h,name:f,attribute:{...i,...m}})})})})}),s.forEach(o=>{const a={name:o.name,options:o.options,storage:o.storage},l=K(o,"addAttributes",a);if(!l)return;const u=l();Object.entries(u).forEach(([d,h])=>{const f={...i,...h};typeof(f==null?void 0:f.default)=="function"&&(f.default=f.default()),f!=null&&f.isRequired&&(f==null?void 0:f.default)===void 0&&delete f.default,e.push({type:o.name,name:d,attribute:f})})}),e}function ot(t,e){if(typeof t=="string"){if(!e.nodes[t])throw Error(`There is no node type named '${t}'. Maybe you forgot to add the extension?`);return e.nodes[t]}return t}function $t(...t){return t.filter(e=>!!e).reduce((e,n)=>{const r={...e};return Object.entries(n).forEach(([s,i])=>{if(!r[s]){r[s]=i;return}if(s==="class"){const a=i?String(i).split(" "):[],l=r[s]?r[s].split(" "):[],u=a.filter(d=>!l.includes(d));r[s]=[...l,...u].join(" ")}else if(s==="style"){const a=i?i.split(";").map(d=>d.trim()).filter(Boolean):[],l=r[s]?r[s].split(";").map(d=>d.trim()).filter(Boolean):[],u=new Map;l.forEach(d=>{const[h,f]=d.split(":").map(m=>m.trim());u.set(h,f)}),a.forEach(d=>{const[h,f]=d.split(":").map(m=>m.trim());u.set(h,f)}),r[s]=Array.from(u.entries()).map(([d,h])=>`${d}: ${h}`).join("; ")}else r[s]=i}),r},{})}function Dg(t,e){return e.filter(n=>n.type===t.type.name).filter(n=>n.attribute.rendered).map(n=>n.attribute.renderHTML?n.attribute.renderHTML(t.attrs)||{}:{[n.name]:t.attrs[n.name]}).reduce((n,r)=>$t(n,r),{})}function tA(t){return typeof t=="function"}function ae(t,e=void 0,...n){return tA(t)?e?t.bind(e)(...n):t(...n):t}function wz(t={}){return Object.keys(t).length===0&&t.constructor===Object}function xz(t){return typeof t!="string"?t:t.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(t):t==="true"?!0:t==="false"?!1:t}function sS(t,e){return"style"in t?t:{...t,getAttrs:n=>{const r=t.getAttrs?t.getAttrs(n):t.attrs;if(r===!1)return!1;const s=e.reduce((i,o)=>{const a=o.attribute.parseHTML?o.attribute.parseHTML(n):xz(n.getAttribute(o.name));return a==null?i:{...i,[o.name]:a}},{});return{...r,...s}}}}function iS(t){return Object.fromEntries(Object.entries(t).filter(([e,n])=>e==="attrs"&&wz(n)?!1:n!=null))}function Ez(t,e){var n;const r=eA(t),{nodeExtensions:s,markExtensions:i}=uf(t),o=(n=s.find(u=>K(u,"topNode")))===null||n===void 0?void 0:n.name,a=Object.fromEntries(s.map(u=>{const d=r.filter(x=>x.type===u.name),h={name:u.name,options:u.options,storage:u.storage,editor:e},f=t.reduce((x,S)=>{const b=K(S,"extendNodeSchema",h);return{...x,...b?b(u):{}}},{}),m=iS({...f,content:ae(K(u,"content",h)),marks:ae(K(u,"marks",h)),group:ae(K(u,"group",h)),inline:ae(K(u,"inline",h)),atom:ae(K(u,"atom",h)),selectable:ae(K(u,"selectable",h)),draggable:ae(K(u,"draggable",h)),code:ae(K(u,"code",h)),whitespace:ae(K(u,"whitespace",h)),linebreakReplacement:ae(K(u,"linebreakReplacement",h)),defining:ae(K(u,"defining",h)),isolating:ae(K(u,"isolating",h)),attrs:Object.fromEntries(d.map(x=>{var S;return[x.name,{default:(S=x==null?void 0:x.attribute)===null||S===void 0?void 0:S.default}]}))}),y=ae(K(u,"parseHTML",h));y&&(m.parseDOM=y.map(x=>sS(x,d)));const v=K(u,"renderHTML",h);v&&(m.toDOM=x=>v({node:x,HTMLAttributes:Dg(x,d)}));const w=K(u,"renderText",h);return w&&(m.toText=w),[u.name,m]})),l=Object.fromEntries(i.map(u=>{const d=r.filter(w=>w.type===u.name),h={name:u.name,options:u.options,storage:u.storage,editor:e},f=t.reduce((w,x)=>{const S=K(x,"extendMarkSchema",h);return{...w,...S?S(u):{}}},{}),m=iS({...f,inclusive:ae(K(u,"inclusive",h)),excludes:ae(K(u,"excludes",h)),group:ae(K(u,"group",h)),spanning:ae(K(u,"spanning",h)),code:ae(K(u,"code",h)),attrs:Object.fromEntries(d.map(w=>{var x;return[w.name,{default:(x=w==null?void 0:w.attribute)===null||x===void 0?void 0:x.default}]}))}),y=ae(K(u,"parseHTML",h));y&&(m.parseDOM=y.map(w=>sS(w,d)));const v=K(u,"renderHTML",h);return v&&(m.toDOM=w=>v({mark:w,HTMLAttributes:Dg(w,d)})),[u.name,m]}));return new $C({topNode:o,nodes:a,marks:l})}function Up(t,e){return e.nodes[t]||e.marks[t]||null}function oS(t,e){return Array.isArray(e)?e.some(n=>(typeof n=="string"?n:n.name)===t.name):e}function lv(t,e){const n=Xi.fromSchema(e).serializeFragment(t),s=document.implementation.createHTMLDocument().createElement("div");return s.appendChild(n),s.innerHTML}const Sz=(t,e=500)=>{let n="";const r=t.parentOffset;return t.parent.nodesBetween(Math.max(0,r-e),r,(s,i,o,a)=>{var l,u;const d=((u=(l=s.type.spec).toText)===null||u===void 0?void 0:u.call(l,{node:s,pos:i,parent:o,index:a}))||s.textContent||"%leaf%";n+=s.isAtom&&!s.isText?d:d.slice(0,Math.max(0,r-i))}),n};function uv(t){return Object.prototype.toString.call(t)==="[object RegExp]"}class cf{constructor(e){this.find=e.find,this.handler=e.handler}}const bz=(t,e)=>{if(uv(e))return e.exec(t);const n=e(t);if(!n)return null;const r=[n.text];return r.index=n.index,r.input=t,r.data=n.data,n.replaceWith&&(n.text.includes(n.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),r.push(n.replaceWith)),r};function Oc(t){var e;const{editor:n,from:r,to:s,text:i,rules:o,plugin:a}=t,{view:l}=n;if(l.composing)return!1;const u=l.state.doc.resolve(r);if(u.parent.type.spec.code||!((e=u.nodeBefore||u.nodeAfter)===null||e===void 0)&&e.marks.find(f=>f.type.spec.code))return!1;let d=!1;const h=Sz(u)+i;return o.forEach(f=>{if(d)return;const m=bz(h,f.find);if(!m)return;const y=l.state.tr,v=af({state:l.state,transaction:y}),w={from:r-(m[0].length-i.length),to:s},{commands:x,chain:S,can:b}=new lf({editor:n,state:v});f.handler({state:v,range:w,match:m,commands:x,chain:S,can:b})===null||!y.steps.length||(y.setMeta(a,{transform:y,from:r,to:s,text:i}),l.dispatch(y),d=!0)}),d}function Tz(t){const{editor:e,rules:n}=t,r=new sn({state:{init(){return null},apply(s,i,o){const a=s.getMeta(r);if(a)return a;const l=s.getMeta("applyInputRules");return!!l&&setTimeout(()=>{let{text:d}=l;typeof d=="string"?d=d:d=lv(F.from(d),o.schema);const{from:h}=l,f=h+d.length;Oc({editor:e,from:h,to:f,text:d,rules:n,plugin:r})}),s.selectionSet||s.docChanged?null:i}},props:{handleTextInput(s,i,o,a){return Oc({editor:e,from:i,to:o,text:a,rules:n,plugin:r})},handleDOMEvents:{compositionend:s=>(setTimeout(()=>{const{$cursor:i}=s.state.selection;i&&Oc({editor:e,from:i.pos,to:i.pos,text:"",rules:n,plugin:r})}),!1)},handleKeyDown(s,i){if(i.key!=="Enter")return!1;const{$cursor:o}=s.state.selection;return o?Oc({editor:e,from:o.pos,to:o.pos,text:`
`,rules:n,plugin:r}):!1}},isInputRules:!0});return r}function kz(t){return Object.prototype.toString.call(t).slice(8,-1)}function Mc(t){return kz(t)!=="Object"?!1:t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype}function df(t,e){const n={...t};return Mc(t)&&Mc(e)&&Object.keys(e).forEach(r=>{Mc(e[r])&&Mc(t[r])?n[r]=df(t[r],e[r]):n[r]=e[r]}),n}class $s{constructor(e={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=ae(K(this,"addOptions",{name:this.name}))),this.storage=ae(K(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new $s(e)}configure(e={}){const n=this.extend({...this.config,addOptions:()=>df(this.options,e)});return n.name=this.name,n.parent=this.parent,n}extend(e={}){const n=new $s(e);return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=ae(K(n,"addOptions",{name:n.name})),n.storage=ae(K(n,"addStorage",{name:n.name,options:n.options})),n}static handleExit({editor:e,mark:n}){const{tr:r}=e.state,s=e.state.selection.$from;if(s.pos===s.end()){const o=s.marks();if(!!!o.find(u=>(u==null?void 0:u.type.name)===n.name))return!1;const l=o.find(u=>(u==null?void 0:u.type.name)===n.name);return l&&r.removeStoredMark(l),r.insertText(" ",s.pos),e.view.dispatch(r),!0}return!1}}function Iz(t){return typeof t=="number"}class Cz{constructor(e){this.find=e.find,this.handler=e.handler}}const Az=(t,e,n)=>{if(uv(e))return[...t.matchAll(e)];const r=e(t,n);return r?r.map(s=>{const i=[s.text];return i.index=s.index,i.input=t,i.data=s.data,s.replaceWith&&(s.text.includes(s.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),i.push(s.replaceWith)),i}):[]};function Nz(t){const{editor:e,state:n,from:r,to:s,rule:i,pasteEvent:o,dropEvent:a}=t,{commands:l,chain:u,can:d}=new lf({editor:e,state:n}),h=[];return n.doc.nodesBetween(r,s,(m,y)=>{if(!m.isTextblock||m.type.spec.code)return;const v=Math.max(r,y),w=Math.min(s,y+m.content.size),x=m.textBetween(v-y,w-y,void 0,"");Az(x,i.find,o).forEach(b=>{if(b.index===void 0)return;const N=v+b.index+1,M=N+b[0].length,V={from:n.tr.mapping.map(N),to:n.tr.mapping.map(M)},k=i.handler({state:n,range:V,match:b,commands:l,chain:u,can:d,pasteEvent:o,dropEvent:a});h.push(k)})}),h.every(m=>m!==null)}let Lc=null;const Rz=t=>{var e;const n=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(e=n.clipboardData)===null||e===void 0||e.setData("text/html",t),n};function Pz(t){const{editor:e,rules:n}=t;let r=null,s=!1,i=!1,o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,a;try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}const l=({state:d,from:h,to:f,rule:m,pasteEvt:y})=>{const v=d.tr,w=af({state:d,transaction:v});if(!(!Nz({editor:e,state:w,from:Math.max(h-1,0),to:f.b-1,rule:m,pasteEvent:y,dropEvent:a})||!v.steps.length)){try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}return o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,v}};return n.map(d=>new sn({view(h){const f=y=>{var v;r=!((v=h.dom.parentElement)===null||v===void 0)&&v.contains(y.target)?h.dom.parentElement:null,r&&(Lc=e)},m=()=>{Lc&&(Lc=null)};return window.addEventListener("dragstart",f),window.addEventListener("dragend",m),{destroy(){window.removeEventListener("dragstart",f),window.removeEventListener("dragend",m)}}},props:{handleDOMEvents:{drop:(h,f)=>{if(i=r===h.dom.parentElement,a=f,!i){const m=Lc;m!=null&&m.isEditable&&setTimeout(()=>{const y=m.state.selection;y&&m.commands.deleteRange({from:y.from,to:y.to})},10)}return!1},paste:(h,f)=>{var m;const y=(m=f.clipboardData)===null||m===void 0?void 0:m.getData("text/html");return o=f,s=!!(y!=null&&y.includes("data-pm-slice")),!1}}},appendTransaction:(h,f,m)=>{const y=h[0],v=y.getMeta("uiEvent")==="paste"&&!s,w=y.getMeta("uiEvent")==="drop"&&!i,x=y.getMeta("applyPasteRules"),S=!!x;if(!v&&!w&&!S)return;if(S){let{text:M}=x;typeof M=="string"?M=M:M=lv(F.from(M),m.schema);const{from:V}=x,k=V+M.length,E=Rz(M);return l({rule:d,state:m,from:V,to:{b:k},pasteEvt:E})}const b=f.doc.content.findDiffStart(m.doc.content),N=f.doc.content.findDiffEnd(m.doc.content);if(!(!Iz(b)||!N||b===N.b))return l({rule:d,state:m,from:b,to:N,pasteEvt:o})}}))}function Dz(t){const e=t.filter((n,r)=>t.indexOf(n)!==r);return Array.from(new Set(e))}class Io{constructor(e,n){this.splittableMarks=[],this.editor=n,this.extensions=Io.resolve(e),this.schema=Ez(this.extensions,n),this.setupExtensions()}static resolve(e){const n=Io.sort(Io.flatten(e)),r=Dz(n.map(s=>s.name));return r.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${r.map(s=>`'${s}'`).join(", ")}]. This can lead to issues.`),n}static flatten(e){return e.map(n=>{const r={name:n.name,options:n.options,storage:n.storage},s=K(n,"addExtensions",r);return s?[n,...this.flatten(s())]:n}).flat(10)}static sort(e){return e.sort((r,s)=>{const i=K(r,"priority")||100,o=K(s,"priority")||100;return i>o?-1:i<o?1:0})}get commands(){return this.extensions.reduce((e,n)=>{const r={name:n.name,options:n.options,storage:n.storage,editor:this.editor,type:Up(n.name,this.schema)},s=K(n,"addCommands",r);return s?{...e,...s()}:e},{})}get plugins(){const{editor:e}=this,n=Io.sort([...this.extensions].reverse()),r=[],s=[],i=n.map(o=>{const a={name:o.name,options:o.options,storage:o.storage,editor:e,type:Up(o.name,this.schema)},l=[],u=K(o,"addKeyboardShortcuts",a);let d={};if(o.type==="mark"&&K(o,"exitable",a)&&(d.ArrowRight=()=>$s.handleExit({editor:e,mark:o})),u){const v=Object.fromEntries(Object.entries(u()).map(([w,x])=>[w,()=>x({editor:e})]));d={...d,...v}}const h=X3(d);l.push(h);const f=K(o,"addInputRules",a);oS(o,e.options.enableInputRules)&&f&&r.push(...f());const m=K(o,"addPasteRules",a);oS(o,e.options.enablePasteRules)&&m&&s.push(...m());const y=K(o,"addProseMirrorPlugins",a);if(y){const v=y();l.push(...v)}return l}).flat();return[Tz({editor:e,rules:r}),...Pz({editor:e,rules:s}),...i]}get attributes(){return eA(this.extensions)}get nodeViews(){const{editor:e}=this,{nodeExtensions:n}=uf(this.extensions);return Object.fromEntries(n.filter(r=>!!K(r,"addNodeView")).map(r=>{const s=this.attributes.filter(l=>l.type===r.name),i={name:r.name,options:r.options,storage:r.storage,editor:e,type:ot(r.name,this.schema)},o=K(r,"addNodeView",i);if(!o)return[];const a=(l,u,d,h,f)=>{const m=Dg(l,s);return o()({node:l,view:u,getPos:d,decorations:h,innerDecorations:f,editor:e,extension:r,HTMLAttributes:m})};return[r.name,a]}))}setupExtensions(){this.extensions.forEach(e=>{var n;this.editor.extensionStorage[e.name]=e.storage;const r={name:e.name,options:e.options,storage:e.storage,editor:this.editor,type:Up(e.name,this.schema)};e.type==="mark"&&(!((n=ae(K(e,"keepOnSplit",r)))!==null&&n!==void 0)||n)&&this.splittableMarks.push(e.name);const s=K(e,"onBeforeCreate",r),i=K(e,"onCreate",r),o=K(e,"onUpdate",r),a=K(e,"onSelectionUpdate",r),l=K(e,"onTransaction",r),u=K(e,"onFocus",r),d=K(e,"onBlur",r),h=K(e,"onDestroy",r);s&&this.editor.on("beforeCreate",s),i&&this.editor.on("create",i),o&&this.editor.on("update",o),a&&this.editor.on("selectionUpdate",a),l&&this.editor.on("transaction",l),u&&this.editor.on("focus",u),d&&this.editor.on("blur",d),h&&this.editor.on("destroy",h)})}}class qt{constructor(e={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=ae(K(this,"addOptions",{name:this.name}))),this.storage=ae(K(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new qt(e)}configure(e={}){const n=this.extend({...this.config,addOptions:()=>df(this.options,e)});return n.name=this.name,n.parent=this.parent,n}extend(e={}){const n=new qt({...this.config,...e});return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=ae(K(n,"addOptions",{name:n.name})),n.storage=ae(K(n,"addStorage",{name:n.name,options:n.options})),n}}function nA(t,e,n){const{from:r,to:s}=e,{blockSeparator:i=`

`,textSerializers:o={}}=n||{};let a="";return t.nodesBetween(r,s,(l,u,d,h)=>{var f;l.isBlock&&u>r&&(a+=i);const m=o==null?void 0:o[l.type.name];if(m)return d&&(a+=m({node:l,pos:u,parent:d,index:h,range:e})),!1;l.isText&&(a+=(f=l==null?void 0:l.text)===null||f===void 0?void 0:f.slice(Math.max(r,u)-u,s-u))}),a}function rA(t){return Object.fromEntries(Object.entries(t.nodes).filter(([,e])=>e.spec.toText).map(([e,n])=>[e,n.spec.toText]))}const Oz=qt.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new sn({key:new lr("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:t}=this,{state:e,schema:n}=t,{doc:r,selection:s}=e,{ranges:i}=s,o=Math.min(...i.map(d=>d.$from.pos)),a=Math.max(...i.map(d=>d.$to.pos)),l=rA(n);return nA(r,{from:o,to:a},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),Mz=()=>({editor:t,view:e})=>(requestAnimationFrame(()=>{var n;t.isDestroyed||(e.dom.blur(),(n=window==null?void 0:window.getSelection())===null||n===void 0||n.removeAllRanges())}),!0),Lz=(t=!1)=>({commands:e})=>e.setContent("",t),Vz=()=>({state:t,tr:e,dispatch:n})=>{const{selection:r}=e,{ranges:s}=r;return n&&s.forEach(({$from:i,$to:o})=>{t.doc.nodesBetween(i.pos,o.pos,(a,l)=>{if(a.type.isText)return;const{doc:u,mapping:d}=e,h=u.resolve(d.map(l)),f=u.resolve(d.map(l+a.nodeSize)),m=h.blockRange(f);if(!m)return;const y=ba(m);if(a.type.isTextblock){const{defaultType:v}=h.parent.contentMatchAt(h.index());e.setNodeMarkup(m.start,v)}(y||y===0)&&e.lift(m,y)})}),!0},jz=t=>e=>t(e),Fz=()=>({state:t,dispatch:e})=>J1(t,e),Uz=(t,e)=>({editor:n,tr:r})=>{const{state:s}=n,i=s.doc.slice(t.from,t.to);r.deleteRange(t.from,t.to);const o=r.mapping.map(e);return r.insert(o,i.content),r.setSelection(new ne(r.doc.resolve(Math.max(o-1,0)))),!0},Bz=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,r=n.$anchor.node();if(r.content.size>0)return!1;const s=t.selection.$anchor;for(let i=s.depth;i>0;i-=1)if(s.node(i).type===r.type){if(e){const a=s.before(i),l=s.after(i);t.delete(a,l).scrollIntoView()}return!0}return!1},zz=t=>({tr:e,state:n,dispatch:r})=>{const s=ot(t,n.schema),i=e.selection.$anchor;for(let o=i.depth;o>0;o-=1)if(i.node(o).type===s){if(r){const l=i.before(o),u=i.after(o);e.delete(l,u).scrollIntoView()}return!0}return!1},$z=t=>({tr:e,dispatch:n})=>{const{from:r,to:s}=t;return n&&e.delete(r,s),!0},qz=()=>({state:t,dispatch:e})=>rv(t,e),Hz=()=>({commands:t})=>t.keyboardShortcut("Enter"),Wz=()=>({state:t,dispatch:e})=>sz(t,e);function lh(t,e,n={strict:!0}){const r=Object.keys(e);return r.length?r.every(s=>n.strict?e[s]===t[s]:uv(e[s])?e[s].test(t[s]):e[s]===t[s]):!0}function sA(t,e,n={}){return t.find(r=>r.type===e&&lh(Object.fromEntries(Object.keys(n).map(s=>[s,r.attrs[s]])),n))}function aS(t,e,n={}){return!!sA(t,e,n)}function cv(t,e,n){var r;if(!t||!e)return;let s=t.parent.childAfter(t.parentOffset);if((!s.node||!s.node.marks.some(d=>d.type===e))&&(s=t.parent.childBefore(t.parentOffset)),!s.node||!s.node.marks.some(d=>d.type===e)||(n=n||((r=s.node.marks[0])===null||r===void 0?void 0:r.attrs),!sA([...s.node.marks],e,n)))return;let o=s.index,a=t.start()+s.offset,l=o+1,u=a+s.node.nodeSize;for(;o>0&&aS([...t.parent.child(o-1).marks],e,n);)o-=1,a-=t.parent.child(o).nodeSize;for(;l<t.parent.childCount&&aS([...t.parent.child(l).marks],e,n);)u+=t.parent.child(l).nodeSize,l+=1;return{from:a,to:u}}function ei(t,e){if(typeof t=="string"){if(!e.marks[t])throw Error(`There is no mark type named '${t}'. Maybe you forgot to add the extension?`);return e.marks[t]}return t}const Kz=(t,e={})=>({tr:n,state:r,dispatch:s})=>{const i=ei(t,r.schema),{doc:o,selection:a}=n,{$from:l,from:u,to:d}=a;if(s){const h=cv(l,i,e);if(h&&h.from<=u&&h.to>=d){const f=ne.create(o,h.from,h.to);n.setSelection(f)}}return!0},Gz=t=>e=>{const n=typeof t=="function"?t(e):t;for(let r=0;r<n.length;r+=1)if(n[r](e))return!0;return!1};function iA(t){return t instanceof ne}function vi(t=0,e=0,n=0){return Math.min(Math.max(t,e),n)}function oA(t,e=null){if(!e)return null;const n=oe.atStart(t),r=oe.atEnd(t);if(e==="start"||e===!0)return n;if(e==="end")return r;const s=n.from,i=r.to;return e==="all"?ne.create(t,vi(0,s,i),vi(t.content.size,s,i)):ne.create(t,vi(e,s,i),vi(e,s,i))}function Qz(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function dv(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}const Jz=(t=null,e={})=>({editor:n,view:r,tr:s,dispatch:i})=>{e={scrollIntoView:!0,...e};const o=()=>{(dv()||Qz())&&r.dom.focus(),requestAnimationFrame(()=>{n.isDestroyed||(r.focus(),e!=null&&e.scrollIntoView&&n.commands.scrollIntoView())})};if(r.hasFocus()&&t===null||t===!1)return!0;if(i&&t===null&&!iA(n.state.selection))return o(),!0;const a=oA(s.doc,t)||n.state.selection,l=n.state.selection.eq(a);return i&&(l||s.setSelection(a),l&&s.storedMarks&&s.setStoredMarks(s.storedMarks),o()),!0},Yz=(t,e)=>n=>t.every((r,s)=>e(r,{...n,index:s})),Xz=(t,e)=>({tr:n,commands:r})=>r.insertContentAt({from:n.selection.from,to:n.selection.to},t,e),aA=t=>{const e=t.childNodes;for(let n=e.length-1;n>=0;n-=1){const r=e[n];r.nodeType===3&&r.nodeValue&&/^(\n\s\s|\n)$/.test(r.nodeValue)?t.removeChild(r):r.nodeType===1&&aA(r)}return t};function Vc(t){const e=`<body>${t}</body>`,n=new window.DOMParser().parseFromString(e,"text/html").body;return aA(n)}function fu(t,e,n){if(t instanceof Cs||t instanceof F)return t;n={slice:!0,parseOptions:{},...n};const r=typeof t=="object"&&t!==null,s=typeof t=="string";if(r)try{if(Array.isArray(t)&&t.length>0)return F.fromArray(t.map(a=>e.nodeFromJSON(a)));const o=e.nodeFromJSON(t);return n.errorOnInvalidContent&&o.check(),o}catch(i){if(n.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:i});return console.warn("[tiptap warn]: Invalid content.","Passed value:",t,"Error:",i),fu("",e,n)}if(s){if(n.errorOnInvalidContent){let o=!1,a="";const l=new $C({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:u=>(o=!0,a=typeof u=="string"?u:u.outerHTML,null)}]}})});if(n.slice?As.fromSchema(l).parseSlice(Vc(t),n.parseOptions):As.fromSchema(l).parse(Vc(t),n.parseOptions),n.errorOnInvalidContent&&o)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${a}`)})}const i=As.fromSchema(e);return n.slice?i.parseSlice(Vc(t),n.parseOptions).content:i.parse(Vc(t),n.parseOptions)}return fu("",e,n)}function Zz(t,e,n){const r=t.steps.length-1;if(r<e)return;const s=t.steps[r];if(!(s instanceof nt||s instanceof st))return;const i=t.mapping.maps[r];let o=0;i.forEach((a,l,u,d)=>{o===0&&(o=d)}),t.setSelection(oe.near(t.doc.resolve(o),n))}const e6=t=>!("type"in t),t6=(t,e,n)=>({tr:r,dispatch:s,editor:i})=>{var o;if(s){n={parseOptions:i.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...n};let a;const l=w=>{i.emit("contentError",{editor:i,error:w,disableCollaboration:()=>{i.storage.collaboration&&(i.storage.collaboration.isDisabled=!0)}})},u={preserveWhitespace:"full",...n.parseOptions};if(!n.errorOnInvalidContent&&!i.options.enableContentCheck&&i.options.emitContentError)try{fu(e,i.schema,{parseOptions:u,errorOnInvalidContent:!0})}catch(w){l(w)}try{a=fu(e,i.schema,{parseOptions:u,errorOnInvalidContent:(o=n.errorOnInvalidContent)!==null&&o!==void 0?o:i.options.enableContentCheck})}catch(w){return l(w),!1}let{from:d,to:h}=typeof t=="number"?{from:t,to:t}:{from:t.from,to:t.to},f=!0,m=!0;if((e6(a)?a:[a]).forEach(w=>{w.check(),f=f?w.isText&&w.marks.length===0:!1,m=m?w.isBlock:!1}),d===h&&m){const{parent:w}=r.doc.resolve(d);w.isTextblock&&!w.type.spec.code&&!w.childCount&&(d-=1,h+=1)}let v;if(f){if(Array.isArray(e))v=e.map(w=>w.text||"").join("");else if(e instanceof F){let w="";e.forEach(x=>{x.text&&(w+=x.text)}),v=w}else typeof e=="object"&&e&&e.text?v=e.text:v=e;r.insertText(v,d,h)}else v=a,r.replaceWith(d,h,v);n.updateSelection&&Zz(r,r.steps.length-1,-1),n.applyInputRules&&r.setMeta("applyInputRules",{from:d,text:v}),n.applyPasteRules&&r.setMeta("applyPasteRules",{from:d,text:v})}return!0},n6=()=>({state:t,dispatch:e})=>tz(t,e),r6=()=>({state:t,dispatch:e})=>nz(t,e),s6=()=>({state:t,dispatch:e})=>$1(t,e),i6=()=>({state:t,dispatch:e})=>K1(t,e),o6=()=>({state:t,dispatch:e,tr:n})=>{try{const r=ef(t.doc,t.selection.$from.pos,-1);return r==null?!1:(n.join(r,2),e&&e(n),!0)}catch{return!1}},a6=()=>({state:t,dispatch:e,tr:n})=>{try{const r=ef(t.doc,t.selection.$from.pos,1);return r==null?!1:(n.join(r,2),e&&e(n),!0)}catch{return!1}},l6=()=>({state:t,dispatch:e})=>Z3(t,e),u6=()=>({state:t,dispatch:e})=>ez(t,e);function lA(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function c6(t){const e=t.split(/-(?!$)/);let n=e[e.length-1];n==="Space"&&(n=" ");let r,s,i,o;for(let a=0;a<e.length-1;a+=1){const l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))s=!0;else if(/^s(hift)?$/i.test(l))i=!0;else if(/^mod$/i.test(l))dv()||lA()?o=!0:s=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return r&&(n=`Alt-${n}`),s&&(n=`Ctrl-${n}`),o&&(n=`Meta-${n}`),i&&(n=`Shift-${n}`),n}const d6=t=>({editor:e,view:n,tr:r,dispatch:s})=>{const i=c6(t).split(/-(?!$)/),o=i.find(u=>!["Alt","Ctrl","Meta","Shift"].includes(u)),a=new KeyboardEvent("keydown",{key:o==="Space"?" ":o,altKey:i.includes("Alt"),ctrlKey:i.includes("Ctrl"),metaKey:i.includes("Meta"),shiftKey:i.includes("Shift"),bubbles:!0,cancelable:!0}),l=e.captureTransaction(()=>{n.someProp("handleKeyDown",u=>u(n,a))});return l==null||l.steps.forEach(u=>{const d=u.map(r.mapping);d&&s&&r.maybeStep(d)}),!0};function pu(t,e,n={}){const{from:r,to:s,empty:i}=t.selection,o=e?ot(e,t.schema):null,a=[];t.doc.nodesBetween(r,s,(h,f)=>{if(h.isText)return;const m=Math.max(r,f),y=Math.min(s,f+h.nodeSize);a.push({node:h,from:m,to:y})});const l=s-r,u=a.filter(h=>o?o.name===h.node.type.name:!0).filter(h=>lh(h.node.attrs,n,{strict:!1}));return i?!!u.length:u.reduce((h,f)=>h+f.to-f.from,0)>=l}const h6=(t,e={})=>({state:n,dispatch:r})=>{const s=ot(t,n.schema);return pu(n,s,e)?rz(n,r):!1},f6=()=>({state:t,dispatch:e})=>Y1(t,e),p6=t=>({state:e,dispatch:n})=>{const r=ot(t,e.schema);return mz(r)(e,n)},m6=()=>({state:t,dispatch:e})=>Q1(t,e);function hf(t,e){return e.nodes[t]?"node":e.marks[t]?"mark":null}function lS(t,e){const n=typeof e=="string"?[e]:e;return Object.keys(t).reduce((r,s)=>(n.includes(s)||(r[s]=t[s]),r),{})}const g6=(t,e)=>({tr:n,state:r,dispatch:s})=>{let i=null,o=null;const a=hf(typeof t=="string"?t:t.name,r.schema);return a?(a==="node"&&(i=ot(t,r.schema)),a==="mark"&&(o=ei(t,r.schema)),s&&n.selection.ranges.forEach(l=>{r.doc.nodesBetween(l.$from.pos,l.$to.pos,(u,d)=>{i&&i===u.type&&n.setNodeMarkup(d,void 0,lS(u.attrs,e)),o&&u.marks.length&&u.marks.forEach(h=>{o===h.type&&n.addMark(d,d+u.nodeSize,o.create(lS(h.attrs,e)))})})}),!0):!1},y6=()=>({tr:t,dispatch:e})=>(e&&t.scrollIntoView(),!0),v6=()=>({tr:t,dispatch:e})=>{if(e){const n=new fn(t.doc);t.setSelection(n)}return!0},_6=()=>({state:t,dispatch:e})=>H1(t,e),w6=()=>({state:t,dispatch:e})=>G1(t,e),x6=()=>({state:t,dispatch:e})=>az(t,e),E6=()=>({state:t,dispatch:e})=>cz(t,e),S6=()=>({state:t,dispatch:e})=>uz(t,e);function Og(t,e,n={},r={}){return fu(t,e,{slice:!1,parseOptions:n,errorOnInvalidContent:r.errorOnInvalidContent})}const b6=(t,e=!1,n={},r={})=>({editor:s,tr:i,dispatch:o,commands:a})=>{var l,u;const{doc:d}=i;if(n.preserveWhitespace!=="full"){const h=Og(t,s.schema,n,{errorOnInvalidContent:(l=r.errorOnInvalidContent)!==null&&l!==void 0?l:s.options.enableContentCheck});return o&&i.replaceWith(0,d.content.size,h).setMeta("preventUpdate",!e),!0}return o&&i.setMeta("preventUpdate",!e),a.insertContentAt({from:0,to:d.content.size},t,{parseOptions:n,errorOnInvalidContent:(u=r.errorOnInvalidContent)!==null&&u!==void 0?u:s.options.enableContentCheck})};function uA(t,e){const n=ei(e,t.schema),{from:r,to:s,empty:i}=t.selection,o=[];i?(t.storedMarks&&o.push(...t.storedMarks),o.push(...t.selection.$head.marks())):t.doc.nodesBetween(r,s,l=>{o.push(...l.marks)});const a=o.find(l=>l.type.name===n.name);return a?{...a.attrs}:{}}function T6(t){for(let e=0;e<t.edgeCount;e+=1){const{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}function k6(t,e){for(let n=t.depth;n>0;n-=1){const r=t.node(n);if(e(r))return{pos:n>0?t.before(n):0,start:t.start(n),depth:n,node:r}}}function hv(t){return e=>k6(e.$from,t)}function I6(t,e){const n={from:0,to:t.content.size};return nA(t,n,e)}function C6(t,e){const n=ot(e,t.schema),{from:r,to:s}=t.selection,i=[];t.doc.nodesBetween(r,s,a=>{i.push(a)});const o=i.reverse().find(a=>a.type.name===n.name);return o?{...o.attrs}:{}}function A6(t,e){const n=hf(typeof e=="string"?e:e.name,t.schema);return n==="node"?C6(t,e):n==="mark"?uA(t,e):{}}function cA(t,e,n){const r=[];return t===e?n.resolve(t).marks().forEach(s=>{const i=n.resolve(t),o=cv(i,s.type);o&&r.push({mark:s,...o})}):n.nodesBetween(t,e,(s,i)=>{!s||(s==null?void 0:s.nodeSize)===void 0||r.push(...s.marks.map(o=>({from:i,to:i+s.nodeSize,mark:o})))}),r}function ud(t,e,n){return Object.fromEntries(Object.entries(n).filter(([r])=>{const s=t.find(i=>i.type===e&&i.name===r);return s?s.attribute.keepOnSplit:!1}))}function Mg(t,e,n={}){const{empty:r,ranges:s}=t.selection,i=e?ei(e,t.schema):null;if(r)return!!(t.storedMarks||t.selection.$from.marks()).filter(h=>i?i.name===h.type.name:!0).find(h=>lh(h.attrs,n,{strict:!1}));let o=0;const a=[];if(s.forEach(({$from:h,$to:f})=>{const m=h.pos,y=f.pos;t.doc.nodesBetween(m,y,(v,w)=>{if(!v.isText&&!v.marks.length)return;const x=Math.max(m,w),S=Math.min(y,w+v.nodeSize),b=S-x;o+=b,a.push(...v.marks.map(N=>({mark:N,from:x,to:S})))})}),o===0)return!1;const l=a.filter(h=>i?i.name===h.mark.type.name:!0).filter(h=>lh(h.mark.attrs,n,{strict:!1})).reduce((h,f)=>h+f.to-f.from,0),u=a.filter(h=>i?h.mark.type!==i&&h.mark.type.excludes(i):!0).reduce((h,f)=>h+f.to-f.from,0);return(l>0?l+u:l)>=o}function N6(t,e,n={}){if(!e)return pu(t,null,n)||Mg(t,null,n);const r=hf(e,t.schema);return r==="node"?pu(t,e,n):r==="mark"?Mg(t,e,n):!1}function uS(t,e){const{nodeExtensions:n}=uf(e),r=n.find(o=>o.name===t);if(!r)return!1;const s={name:r.name,options:r.options,storage:r.storage},i=ae(K(r,"group",s));return typeof i!="string"?!1:i.split(" ").includes("list")}function fv(t,{checkChildren:e=!0,ignoreWhitespace:n=!1}={}){var r;if(n){if(t.type.name==="hardBreak")return!0;if(t.isText)return/^\s*$/m.test((r=t.text)!==null&&r!==void 0?r:"")}if(t.isText)return!t.text;if(t.isAtom||t.isLeaf)return!1;if(t.content.childCount===0)return!0;if(e){let s=!0;return t.content.forEach(i=>{s!==!1&&(fv(i,{ignoreWhitespace:n,checkChildren:e})||(s=!1))}),s}return!1}function R6(t){return t instanceof Y}function P6(t,e,n){var r;const{selection:s}=e;let i=null;if(iA(s)&&(i=s.$cursor),i){const a=(r=t.storedMarks)!==null&&r!==void 0?r:i.marks();return!!n.isInSet(a)||!a.some(l=>l.type.excludes(n))}const{ranges:o}=s;return o.some(({$from:a,$to:l})=>{let u=a.depth===0?t.doc.inlineContent&&t.doc.type.allowsMarkType(n):!1;return t.doc.nodesBetween(a.pos,l.pos,(d,h,f)=>{if(u)return!1;if(d.isInline){const m=!f||f.type.allowsMarkType(n),y=!!n.isInSet(d.marks)||!d.marks.some(v=>v.type.excludes(n));u=m&&y}return!u}),u})}const D6=(t,e={})=>({tr:n,state:r,dispatch:s})=>{const{selection:i}=n,{empty:o,ranges:a}=i,l=ei(t,r.schema);if(s)if(o){const u=uA(r,l);n.addStoredMark(l.create({...u,...e}))}else a.forEach(u=>{const d=u.$from.pos,h=u.$to.pos;r.doc.nodesBetween(d,h,(f,m)=>{const y=Math.max(m,d),v=Math.min(m+f.nodeSize,h);f.marks.find(x=>x.type===l)?f.marks.forEach(x=>{l===x.type&&n.addMark(y,v,l.create({...x.attrs,...e}))}):n.addMark(y,v,l.create(e))})});return P6(r,n,l)},O6=(t,e)=>({tr:n})=>(n.setMeta(t,e),!0),M6=(t,e={})=>({state:n,dispatch:r,chain:s})=>{const i=ot(t,n.schema);let o;return n.selection.$anchor.sameParent(n.selection.$head)&&(o=n.selection.$anchor.parent.attrs),i.isTextblock?s().command(({commands:a})=>rS(i,{...o,...e})(n)?!0:a.clearNodes()).command(({state:a})=>rS(i,{...o,...e})(a,r)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},L6=t=>({tr:e,dispatch:n})=>{if(n){const{doc:r}=e,s=vi(t,0,r.content.size),i=Y.create(r,s);e.setSelection(i)}return!0},V6=t=>({tr:e,dispatch:n})=>{if(n){const{doc:r}=e,{from:s,to:i}=typeof t=="number"?{from:t,to:t}:t,o=ne.atStart(r).from,a=ne.atEnd(r).to,l=vi(s,o,a),u=vi(i,o,a),d=ne.create(r,l,u);e.setSelection(d)}return!0},j6=t=>({state:e,dispatch:n})=>{const r=ot(t,e.schema);return vz(r)(e,n)};function cS(t,e){const n=t.storedMarks||t.selection.$to.parentOffset&&t.selection.$from.marks();if(n){const r=n.filter(s=>e==null?void 0:e.includes(s.type.name));t.tr.ensureMarks(r)}}const F6=({keepMarks:t=!0}={})=>({tr:e,state:n,dispatch:r,editor:s})=>{const{selection:i,doc:o}=e,{$from:a,$to:l}=i,u=s.extensionManager.attributes,d=ud(u,a.node().type.name,a.node().attrs);if(i instanceof Y&&i.node.isBlock)return!a.parentOffset||!Nr(o,a.pos)?!1:(r&&(t&&cS(n,s.extensionManager.splittableMarks),e.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;const h=l.parentOffset===l.parent.content.size,f=a.depth===0?void 0:T6(a.node(-1).contentMatchAt(a.indexAfter(-1)));let m=h&&f?[{type:f,attrs:d}]:void 0,y=Nr(e.doc,e.mapping.map(a.pos),1,m);if(!m&&!y&&Nr(e.doc,e.mapping.map(a.pos),1,f?[{type:f}]:void 0)&&(y=!0,m=f?[{type:f,attrs:d}]:void 0),r){if(y&&(i instanceof ne&&e.deleteSelection(),e.split(e.mapping.map(a.pos),1,m),f&&!h&&!a.parentOffset&&a.parent.type!==f)){const v=e.mapping.map(a.before()),w=e.doc.resolve(v);a.node(-1).canReplaceWith(w.index(),w.index()+1,f)&&e.setNodeMarkup(e.mapping.map(a.before()),f)}t&&cS(n,s.extensionManager.splittableMarks),e.scrollIntoView()}return y},U6=(t,e={})=>({tr:n,state:r,dispatch:s,editor:i})=>{var o;const a=ot(t,r.schema),{$from:l,$to:u}=r.selection,d=r.selection.node;if(d&&d.isBlock||l.depth<2||!l.sameParent(u))return!1;const h=l.node(-1);if(h.type!==a)return!1;const f=i.extensionManager.attributes;if(l.parent.content.size===0&&l.node(-1).childCount===l.indexAfter(-1)){if(l.depth===2||l.node(-3).type!==a||l.index(-2)!==l.node(-2).childCount-1)return!1;if(s){let x=F.empty;const S=l.index(-1)?1:l.index(-2)?2:3;for(let E=l.depth-S;E>=l.depth-3;E-=1)x=F.from(l.node(E).copy(x));const b=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,N={...ud(f,l.node().type.name,l.node().attrs),...e},M=((o=a.contentMatch.defaultType)===null||o===void 0?void 0:o.createAndFill(N))||void 0;x=x.append(F.from(a.createAndFill(null,M)||void 0));const V=l.before(l.depth-(S-1));n.replace(V,l.after(-b),new q(x,4-S,0));let k=-1;n.doc.nodesBetween(V,n.doc.content.size,(E,I)=>{if(k>-1)return!1;E.isTextblock&&E.content.size===0&&(k=I+1)}),k>-1&&n.setSelection(ne.near(n.doc.resolve(k))),n.scrollIntoView()}return!0}const m=u.pos===l.end()?h.contentMatchAt(0).defaultType:null,y={...ud(f,h.type.name,h.attrs),...e},v={...ud(f,l.node().type.name,l.node().attrs),...e};n.delete(l.pos,u.pos);const w=m?[{type:a,attrs:y},{type:m,attrs:v}]:[{type:a,attrs:y}];if(!Nr(n.doc,l.pos,2))return!1;if(s){const{selection:x,storedMarks:S}=r,{splittableMarks:b}=i.extensionManager,N=S||x.$to.parentOffset&&x.$from.marks();if(n.split(l.pos,2,w).scrollIntoView(),!N||!s)return!0;const M=N.filter(V=>b.includes(V.type.name));n.ensureMarks(M)}return!0},Bp=(t,e)=>{const n=hv(o=>o.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(Math.max(0,n.pos-1)).before(n.depth);if(r===void 0)return!0;const s=t.doc.nodeAt(r);return n.node.type===(s==null?void 0:s.type)&&Xs(t.doc,n.pos)&&t.join(n.pos),!0},zp=(t,e)=>{const n=hv(o=>o.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(n.start).after(n.depth);if(r===void 0)return!0;const s=t.doc.nodeAt(r);return n.node.type===(s==null?void 0:s.type)&&Xs(t.doc,r)&&t.join(r),!0},B6=(t,e,n,r={})=>({editor:s,tr:i,state:o,dispatch:a,chain:l,commands:u,can:d})=>{const{extensions:h,splittableMarks:f}=s.extensionManager,m=ot(t,o.schema),y=ot(e,o.schema),{selection:v,storedMarks:w}=o,{$from:x,$to:S}=v,b=x.blockRange(S),N=w||v.$to.parentOffset&&v.$from.marks();if(!b)return!1;const M=hv(V=>uS(V.type.name,h))(v);if(b.depth>=1&&M&&b.depth-M.depth<=1){if(M.node.type===m)return u.liftListItem(y);if(uS(M.node.type.name,h)&&m.validContent(M.node.content)&&a)return l().command(()=>(i.setNodeMarkup(M.pos,m),!0)).command(()=>Bp(i,m)).command(()=>zp(i,m)).run()}return!n||!N||!a?l().command(()=>d().wrapInList(m,r)?!0:u.clearNodes()).wrapInList(m,r).command(()=>Bp(i,m)).command(()=>zp(i,m)).run():l().command(()=>{const V=d().wrapInList(m,r),k=N.filter(E=>f.includes(E.type.name));return i.ensureMarks(k),V?!0:u.clearNodes()}).wrapInList(m,r).command(()=>Bp(i,m)).command(()=>zp(i,m)).run()},z6=(t,e={},n={})=>({state:r,commands:s})=>{const{extendEmptyMarkRange:i=!1}=n,o=ei(t,r.schema);return Mg(r,o,e)?s.unsetMark(o,{extendEmptyMarkRange:i}):s.setMark(o,e)},$6=(t,e,n={})=>({state:r,commands:s})=>{const i=ot(t,r.schema),o=ot(e,r.schema),a=pu(r,i,n);let l;return r.selection.$anchor.sameParent(r.selection.$head)&&(l=r.selection.$anchor.parent.attrs),a?s.setNode(o,l):s.setNode(i,{...l,...n})},q6=(t,e={})=>({state:n,commands:r})=>{const s=ot(t,n.schema);return pu(n,s,e)?r.lift(s):r.wrapIn(s,e)},H6=()=>({state:t,dispatch:e})=>{const n=t.plugins;for(let r=0;r<n.length;r+=1){const s=n[r];let i;if(s.spec.isInputRules&&(i=s.getState(t))){if(e){const o=t.tr,a=i.transform;for(let l=a.steps.length-1;l>=0;l-=1)o.step(a.steps[l].invert(a.docs[l]));if(i.text){const l=o.doc.resolve(i.from).marks();o.replaceWith(i.from,i.to,t.schema.text(i.text,l))}else o.delete(i.from,i.to)}return!0}}return!1},W6=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,{empty:r,ranges:s}=n;return r||e&&s.forEach(i=>{t.removeMark(i.$from.pos,i.$to.pos)}),!0},K6=(t,e={})=>({tr:n,state:r,dispatch:s})=>{var i;const{extendEmptyMarkRange:o=!1}=e,{selection:a}=n,l=ei(t,r.schema),{$from:u,empty:d,ranges:h}=a;if(!s)return!0;if(d&&o){let{from:f,to:m}=a;const y=(i=u.marks().find(w=>w.type===l))===null||i===void 0?void 0:i.attrs,v=cv(u,l,y);v&&(f=v.from,m=v.to),n.removeMark(f,m,l)}else h.forEach(f=>{n.removeMark(f.$from.pos,f.$to.pos,l)});return n.removeStoredMark(l),!0},G6=(t,e={})=>({tr:n,state:r,dispatch:s})=>{let i=null,o=null;const a=hf(typeof t=="string"?t:t.name,r.schema);return a?(a==="node"&&(i=ot(t,r.schema)),a==="mark"&&(o=ei(t,r.schema)),s&&n.selection.ranges.forEach(l=>{const u=l.$from.pos,d=l.$to.pos;let h,f,m,y;n.selection.empty?r.doc.nodesBetween(u,d,(v,w)=>{i&&i===v.type&&(m=Math.max(w,u),y=Math.min(w+v.nodeSize,d),h=w,f=v)}):r.doc.nodesBetween(u,d,(v,w)=>{w<u&&i&&i===v.type&&(m=Math.max(w,u),y=Math.min(w+v.nodeSize,d),h=w,f=v),w>=u&&w<=d&&(i&&i===v.type&&n.setNodeMarkup(w,void 0,{...v.attrs,...e}),o&&v.marks.length&&v.marks.forEach(x=>{if(o===x.type){const S=Math.max(w,u),b=Math.min(w+v.nodeSize,d);n.addMark(S,b,o.create({...x.attrs,...e}))}}))}),f&&(h!==void 0&&n.setNodeMarkup(h,void 0,{...f.attrs,...e}),o&&f.marks.length&&f.marks.forEach(v=>{o===v.type&&n.addMark(m,y,o.create({...v.attrs,...e}))}))}),!0):!1},Q6=(t,e={})=>({state:n,dispatch:r})=>{const s=ot(t,n.schema);return dz(s,e)(n,r)},J6=(t,e={})=>({state:n,dispatch:r})=>{const s=ot(t,n.schema);return hz(s,e)(n,r)};var Y6=Object.freeze({__proto__:null,blur:Mz,clearContent:Lz,clearNodes:Vz,command:jz,createParagraphNear:Fz,cut:Uz,deleteCurrentNode:Bz,deleteNode:zz,deleteRange:$z,deleteSelection:qz,enter:Hz,exitCode:Wz,extendMarkRange:Kz,first:Gz,focus:Jz,forEach:Yz,insertContent:Xz,insertContentAt:t6,joinBackward:s6,joinDown:r6,joinForward:i6,joinItemBackward:o6,joinItemForward:a6,joinTextblockBackward:l6,joinTextblockForward:u6,joinUp:n6,keyboardShortcut:d6,lift:h6,liftEmptyBlock:f6,liftListItem:p6,newlineInCode:m6,resetAttributes:g6,scrollIntoView:y6,selectAll:v6,selectNodeBackward:_6,selectNodeForward:w6,selectParentNode:x6,selectTextblockEnd:E6,selectTextblockStart:S6,setContent:b6,setMark:D6,setMeta:O6,setNode:M6,setNodeSelection:L6,setTextSelection:V6,sinkListItem:j6,splitBlock:F6,splitListItem:U6,toggleList:B6,toggleMark:z6,toggleNode:$6,toggleWrap:q6,undoInputRule:H6,unsetAllMarks:W6,unsetMark:K6,updateAttributes:G6,wrapIn:Q6,wrapInList:J6});const X6=qt.create({name:"commands",addCommands(){return{...Y6}}}),Z6=qt.create({name:"drop",addProseMirrorPlugins(){return[new sn({key:new lr("tiptapDrop"),props:{handleDrop:(t,e,n,r)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:n,moved:r})}}})]}}),e$=qt.create({name:"editable",addProseMirrorPlugins(){return[new sn({key:new lr("editable"),props:{editable:()=>this.editor.options.editable}})]}}),t$=new lr("focusEvents"),n$=qt.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:t}=this;return[new sn({key:t$,props:{handleDOMEvents:{focus:(e,n)=>{t.isFocused=!0;const r=t.state.tr.setMeta("focus",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1},blur:(e,n)=>{t.isFocused=!1;const r=t.state.tr.setMeta("blur",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1}}}})]}}),r$=qt.create({name:"keymap",addKeyboardShortcuts(){const t=()=>this.editor.commands.first(({commands:o})=>[()=>o.undoInputRule(),()=>o.command(({tr:a})=>{const{selection:l,doc:u}=a,{empty:d,$anchor:h}=l,{pos:f,parent:m}=h,y=h.parent.isTextblock&&f>0?a.doc.resolve(f-1):h,v=y.parent.type.spec.isolating,w=h.pos-h.parentOffset,x=v&&y.parent.childCount===1?w===h.pos:oe.atStart(u).from===f;return!d||!m.type.isTextblock||m.textContent.length||!x||x&&h.parent.type.name==="paragraph"?!1:o.clearNodes()}),()=>o.deleteSelection(),()=>o.joinBackward(),()=>o.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:o})=>[()=>o.deleteSelection(),()=>o.deleteCurrentNode(),()=>o.joinForward(),()=>o.selectNodeForward()]),r={Enter:()=>this.editor.commands.first(({commands:o})=>[()=>o.newlineInCode(),()=>o.createParagraphNear(),()=>o.liftEmptyBlock(),()=>o.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:t,"Mod-Backspace":t,"Shift-Backspace":t,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},s={...r},i={...r,"Ctrl-h":t,"Alt-Backspace":t,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return dv()||lA()?i:s},addProseMirrorPlugins(){return[new sn({key:new lr("clearDocument"),appendTransaction:(t,e,n)=>{if(t.some(v=>v.getMeta("composition")))return;const r=t.some(v=>v.docChanged)&&!e.doc.eq(n.doc),s=t.some(v=>v.getMeta("preventClearDocument"));if(!r||s)return;const{empty:i,from:o,to:a}=e.selection,l=oe.atStart(e.doc).from,u=oe.atEnd(e.doc).to;if(i||!(o===l&&a===u)||!fv(n.doc))return;const f=n.tr,m=af({state:n,transaction:f}),{commands:y}=new lf({editor:this.editor,state:m});if(y.clearNodes(),!!f.steps.length)return f}})]}}),s$=qt.create({name:"paste",addProseMirrorPlugins(){return[new sn({key:new lr("tiptapPaste"),props:{handlePaste:(t,e,n)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:n})}}})]}}),i$=qt.create({name:"tabindex",addProseMirrorPlugins(){return[new sn({key:new lr("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}});class ci{get name(){return this.node.type.name}constructor(e,n,r=!1,s=null){this.currentNode=null,this.actualDepth=null,this.isBlock=r,this.resolvedPos=e,this.editor=n,this.currentNode=s}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var e;return(e=this.actualDepth)!==null&&e!==void 0?e:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(e){let n=this.from,r=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You cant set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}n=this.from+1,r=this.to-1}this.editor.commands.insertContentAt({from:n,to:r},e)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;const e=this.resolvedPos.start(this.resolvedPos.depth-1),n=this.resolvedPos.doc.resolve(e);return new ci(n,this.editor)}get before(){let e=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.from-3)),new ci(e,this.editor)}get after(){let e=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.to+3)),new ci(e,this.editor)}get children(){const e=[];return this.node.content.forEach((n,r)=>{const s=n.isBlock&&!n.isTextblock,i=n.isAtom&&!n.isText,o=this.pos+r+(i?0:1);if(o<0||o>this.resolvedPos.doc.nodeSize-2)return;const a=this.resolvedPos.doc.resolve(o);if(!s&&a.depth<=this.depth)return;const l=new ci(a,this.editor,s,s?n:null);s&&(l.actualDepth=this.depth+1),e.push(new ci(a,this.editor,s,s?n:null))}),e}get firstChild(){return this.children[0]||null}get lastChild(){const e=this.children;return e[e.length-1]||null}closest(e,n={}){let r=null,s=this.parent;for(;s&&!r;){if(s.node.type.name===e)if(Object.keys(n).length>0){const i=s.node.attrs,o=Object.keys(n);for(let a=0;a<o.length;a+=1){const l=o[a];if(i[l]!==n[l])break}}else r=s;s=s.parent}return r}querySelector(e,n={}){return this.querySelectorAll(e,n,!0)[0]||null}querySelectorAll(e,n={},r=!1){let s=[];if(!this.children||this.children.length===0)return s;const i=Object.keys(n);return this.children.forEach(o=>{r&&s.length>0||(o.node.type.name===e&&i.every(l=>n[l]===o.node.attrs[l])&&s.push(o),!(r&&s.length>0)&&(s=s.concat(o.querySelectorAll(e,n,r))))}),s}setAttribute(e){const{tr:n}=this.editor.state;n.setNodeMarkup(this.from,void 0,{...this.node.attrs,...e}),this.editor.view.dispatch(n)}}const o$=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}

.tippy-box[data-animation=fade][data-state=hidden] {
  opacity: 0
}`;function a$(t,e,n){const r=document.querySelector("style[data-tiptap-style]");if(r!==null)return r;const s=document.createElement("style");return e&&s.setAttribute("nonce",e),s.setAttribute("data-tiptap-style",""),s.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(s),s}class l$ extends _z{constructor(e={}){super(),this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.options={element:document.createElement("div"),content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:n})=>{throw n},onPaste:()=>null,onDrop:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(e),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("contentError",this.options.onContentError),this.createView(),this.injectCSS(),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:n,slice:r,moved:s})=>this.options.onDrop(n,r,s)),this.on("paste",({event:n,slice:r})=>this.options.onPaste(n,r)),window.setTimeout(()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&document&&(this.css=a$(o$,this.options.injectNonce))}setOptions(e={}){this.options={...this.options,...e},!(!this.view||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(e,n=!0){this.setOptions({editable:e}),n&&this.emit("update",{editor:this,transaction:this.state.tr})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get state(){return this.view.state}registerPlugin(e,n){const r=tA(n)?n(e,[...this.state.plugins]):[...this.state.plugins,e],s=this.state.reconfigure({plugins:r});return this.view.updateState(s),s}unregisterPlugin(e){if(this.isDestroyed)return;const n=this.state.plugins;let r=n;if([].concat(e).forEach(i=>{const o=typeof i=="string"?`${i}$`:i.key;r=r.filter(a=>!a.key.startsWith(o))}),n.length===r.length)return;const s=this.state.reconfigure({plugins:r});return this.view.updateState(s),s}createExtensionManager(){var e,n;const s=[...this.options.enableCoreExtensions?[e$,Oz.configure({blockSeparator:(n=(e=this.options.coreExtensionOptions)===null||e===void 0?void 0:e.clipboardTextSerializer)===null||n===void 0?void 0:n.blockSeparator}),X6,n$,r$,i$,Z6,s$].filter(i=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[i.name]!==!1:!0):[],...this.options.extensions].filter(i=>["extension","node","mark"].includes(i==null?void 0:i.type));this.extensionManager=new Io(s,this)}createCommandManager(){this.commandManager=new lf({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createView(){var e;let n;try{n=Og(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(o){if(!(o instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(o.message))throw o;this.emit("contentError",{editor:this,error:o,disableCollaboration:()=>{this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(a=>a.name!=="collaboration"),this.createExtensionManager()}}),n=Og(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}const r=oA(n,this.options.autofocus);this.view=new U1(this.options.element,{...this.options.editorProps,attributes:{role:"textbox",...(e=this.options.editorProps)===null||e===void 0?void 0:e.attributes},dispatchTransaction:this.dispatchTransaction.bind(this),state:ko.create({doc:n,selection:r||void 0})});const s=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(s),this.createNodeViews(),this.prependClass();const i=this.view.dom;i.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`tiptap ${this.view.dom.className}`}captureTransaction(e){this.isCapturingTransaction=!0,e(),this.isCapturingTransaction=!1;const n=this.capturedTransaction;return this.capturedTransaction=null,n}dispatchTransaction(e){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=e;return}e.steps.forEach(o=>{var a;return(a=this.capturedTransaction)===null||a===void 0?void 0:a.step(o)});return}const n=this.state.apply(e),r=!this.state.selection.eq(n.selection);this.emit("beforeTransaction",{editor:this,transaction:e,nextState:n}),this.view.updateState(n),this.emit("transaction",{editor:this,transaction:e}),r&&this.emit("selectionUpdate",{editor:this,transaction:e});const s=e.getMeta("focus"),i=e.getMeta("blur");s&&this.emit("focus",{editor:this,event:s.event,transaction:e}),i&&this.emit("blur",{editor:this,event:i.event,transaction:e}),!(!e.docChanged||e.getMeta("preventUpdate"))&&this.emit("update",{editor:this,transaction:e})}getAttributes(e){return A6(this.state,e)}isActive(e,n){const r=typeof e=="string"?e:null,s=typeof e=="string"?n:e;return N6(this.state,r,s)}getJSON(){return this.state.doc.toJSON()}getHTML(){return lv(this.state.doc.content,this.schema)}getText(e){const{blockSeparator:n=`

`,textSerializers:r={}}=e||{};return I6(this.state.doc,{blockSeparator:n,textSerializers:{...rA(this.schema),...r}})}get isEmpty(){return fv(this.state.doc)}getCharacterCount(){return console.warn('[tiptap warn]: "editor.getCharacterCount()" is deprecated. Please use "editor.storage.characterCount.characters()" instead.'),this.state.doc.content.size-2}destroy(){if(this.emit("destroy"),this.view){const e=this.view.dom;e&&e.editor&&delete e.editor,this.view.destroy()}this.removeAllListeners()}get isDestroyed(){var e;return!(!((e=this.view)===null||e===void 0)&&e.docView)}$node(e,n){var r;return((r=this.$doc)===null||r===void 0?void 0:r.querySelector(e,n))||null}$nodes(e,n){var r;return((r=this.$doc)===null||r===void 0?void 0:r.querySelectorAll(e,n))||null}$pos(e){const n=this.state.doc.resolve(e);return new ci(n,this)}get $doc(){return this.$pos(0)}}function ca(t){return new cf({find:t.find,handler:({state:e,range:n,match:r})=>{const s=ae(t.getAttributes,void 0,r);if(s===!1||s===null)return null;const{tr:i}=e,o=r[r.length-1],a=r[0];if(o){const l=a.search(/\S/),u=n.from+a.indexOf(o),d=u+o.length;if(cA(n.from,n.to,e.doc).filter(m=>m.mark.type.excluded.find(v=>v===t.type&&v!==m.mark.type)).filter(m=>m.to>u).length)return null;d<n.to&&i.delete(d,n.to),u>n.from&&i.delete(n.from+l,u);const f=n.from+l+o.length;i.addMark(n.from+l,f,t.type.create(s||{})),i.removeStoredMark(t.type)}}})}function u$(t){return new cf({find:t.find,handler:({state:e,range:n,match:r})=>{const s=ae(t.getAttributes,void 0,r)||{},{tr:i}=e,o=n.from;let a=n.to;const l=t.type.create(s);if(r[1]){const u=r[0].lastIndexOf(r[1]);let d=o+u;d>a?d=a:a=d+r[1].length;const h=r[0][r[0].length-1];i.insertText(h,o+r[0].length-1),i.replaceWith(d,a,l)}else if(r[0]){const u=t.type.isInline?o:o-1;i.insert(u,t.type.create(s)).delete(i.mapping.map(o),i.mapping.map(a))}i.scrollIntoView()}})}function Lg(t){return new cf({find:t.find,handler:({state:e,range:n,match:r})=>{const s=e.doc.resolve(n.from),i=ae(t.getAttributes,void 0,r)||{};if(!s.node(-1).canReplaceWith(s.index(-1),s.indexAfter(-1),t.type))return null;e.tr.delete(n.from,n.to).setBlockType(n.from,n.from,t.type,i)}})}function mu(t){return new cf({find:t.find,handler:({state:e,range:n,match:r,chain:s})=>{const i=ae(t.getAttributes,void 0,r)||{},o=e.tr.delete(n.from,n.to),l=o.doc.resolve(n.from).blockRange(),u=l&&W0(l,t.type,i);if(!u)return null;if(o.wrap(l,u),t.keepMarks&&t.editor){const{selection:h,storedMarks:f}=e,{splittableMarks:m}=t.editor.extensionManager,y=f||h.$to.parentOffset&&h.$from.marks();if(y){const v=y.filter(w=>m.includes(w.type.name));o.ensureMarks(v)}}if(t.keepAttributes){const h=t.type.name==="bulletList"||t.type.name==="orderedList"?"listItem":"taskList";s().updateAttributes(h,i).run()}const d=o.doc.resolve(n.from-1).nodeBefore;d&&d.type===t.type&&Xs(o.doc,n.from-1)&&(!t.joinPredicate||t.joinPredicate(r,d))&&o.join(n.from-1)}})}class rn{constructor(e={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=ae(K(this,"addOptions",{name:this.name}))),this.storage=ae(K(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new rn(e)}configure(e={}){const n=this.extend({...this.config,addOptions:()=>df(this.options,e)});return n.name=this.name,n.parent=this.parent,n}extend(e={}){const n=new rn(e);return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=ae(K(n,"addOptions",{name:n.name})),n.storage=ae(K(n,"addStorage",{name:n.name,options:n.options})),n}}function da(t){return new Cz({find:t.find,handler:({state:e,range:n,match:r,pasteEvent:s})=>{const i=ae(t.getAttributes,void 0,r,s);if(i===!1||i===null)return null;const{tr:o}=e,a=r[r.length-1],l=r[0];let u=n.to;if(a){const d=l.search(/\S/),h=n.from+l.indexOf(a),f=h+a.length;if(cA(n.from,n.to,e.doc).filter(y=>y.mark.type.excluded.find(w=>w===t.type&&w!==y.mark.type)).filter(y=>y.to>h).length)return null;f<n.to&&o.delete(f,n.to),h>n.from&&o.delete(n.from+d,h),u=n.from+d+a.length,o.addMark(n.from+d,u,t.type.create(i||{})),o.removeStoredMark(t.type)}}})}function c$(t,e){const{selection:n}=t,{$from:r}=n;if(n instanceof Y){const i=r.index();return r.parent.canReplaceWith(i,i+1,e)}let s=r.depth;for(;s>=0;){const i=r.index(s);if(r.node(s).contentMatchAt(i).matchType(e))return!0;s-=1}return!1}function d$(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var dA={exports:{}},$p={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var dS;function h$(){if(dS)return $p;dS=1;var t=dt;function e(h,f){return h===f&&(h!==0||1/h===1/f)||h!==h&&f!==f}var n=typeof Object.is=="function"?Object.is:e,r=t.useState,s=t.useEffect,i=t.useLayoutEffect,o=t.useDebugValue;function a(h,f){var m=f(),y=r({inst:{value:m,getSnapshot:f}}),v=y[0].inst,w=y[1];return i(function(){v.value=m,v.getSnapshot=f,l(v)&&w({inst:v})},[h,m,f]),s(function(){return l(v)&&w({inst:v}),h(function(){l(v)&&w({inst:v})})},[h]),o(m),m}function l(h){var f=h.getSnapshot;h=h.value;try{var m=f();return!n(h,m)}catch{return!0}}function u(h,f){return f()}var d=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?u:a;return $p.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:d,$p}dA.exports=h$();var pv=dA.exports;const f$=(...t)=>e=>{t.forEach(n=>{typeof n=="function"?n(e):n&&(n.current=e)})},p$=({contentComponent:t})=>{const e=pv.useSyncExternalStore(t.subscribe,t.getSnapshot,t.getServerSnapshot);return dt.createElement(dt.Fragment,null,Object.values(e))};function m$(){const t=new Set;let e={};return{subscribe(n){return t.add(n),()=>{t.delete(n)}},getSnapshot(){return e},getServerSnapshot(){return e},setRenderer(n,r){e={...e,[n]:SP.createPortal(r.reactElement,r.element,n)},t.forEach(s=>s())},removeRenderer(n){const r={...e};delete r[n],e=r,t.forEach(s=>s())}}}class g$ extends dt.Component{constructor(e){var n;super(e),this.editorContentRef=dt.createRef(),this.initialized=!1,this.state={hasContentComponentInitialized:!!(!((n=e.editor)===null||n===void 0)&&n.contentComponent)}}componentDidMount(){this.init()}componentDidUpdate(){this.init()}init(){const e=this.props.editor;if(e&&!e.isDestroyed&&e.options.element){if(e.contentComponent)return;const n=this.editorContentRef.current;n.append(...e.options.element.childNodes),e.setOptions({element:n}),e.contentComponent=m$(),this.state.hasContentComponentInitialized||(this.unsubscribeToContentComponent=e.contentComponent.subscribe(()=>{this.setState(r=>r.hasContentComponentInitialized?r:{hasContentComponentInitialized:!0}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent()})),e.createNodeViews(),this.initialized=!0}}componentWillUnmount(){const e=this.props.editor;if(!e||(this.initialized=!1,e.isDestroyed||e.view.setProps({nodeViews:{}}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent(),e.contentComponent=null,!e.options.element.firstChild))return;const n=document.createElement("div");n.append(...e.options.element.childNodes),e.setOptions({element:n})}render(){const{editor:e,innerRef:n,...r}=this.props;return dt.createElement(dt.Fragment,null,dt.createElement("div",{ref:f$(n,this.editorContentRef),...r}),(e==null?void 0:e.contentComponent)&&dt.createElement(p$,{contentComponent:e.contentComponent}))}}const y$=R.forwardRef((t,e)=>{const n=dt.useMemo(()=>Math.floor(Math.random()*4294967295).toString(),[t.editor]);return dt.createElement(g$,{key:n,innerRef:e,...t})}),v$=dt.memo(y$);var _$=function t(e,n){if(e===n)return!0;if(e&&n&&typeof e=="object"&&typeof n=="object"){if(e.constructor!==n.constructor)return!1;var r,s,i;if(Array.isArray(e)){if(r=e.length,r!=n.length)return!1;for(s=r;s--!==0;)if(!t(e[s],n[s]))return!1;return!0}if(e instanceof Map&&n instanceof Map){if(e.size!==n.size)return!1;for(s of e.entries())if(!n.has(s[0]))return!1;for(s of e.entries())if(!t(s[1],n.get(s[0])))return!1;return!0}if(e instanceof Set&&n instanceof Set){if(e.size!==n.size)return!1;for(s of e.entries())if(!n.has(s[0]))return!1;return!0}if(ArrayBuffer.isView(e)&&ArrayBuffer.isView(n)){if(r=e.length,r!=n.length)return!1;for(s=r;s--!==0;)if(e[s]!==n[s])return!1;return!0}if(e.constructor===RegExp)return e.source===n.source&&e.flags===n.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===n.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===n.toString();if(i=Object.keys(e),r=i.length,r!==Object.keys(n).length)return!1;for(s=r;s--!==0;)if(!Object.prototype.hasOwnProperty.call(n,i[s]))return!1;for(s=r;s--!==0;){var o=i[s];if(!(o==="_owner"&&e.$$typeof)&&!t(e[o],n[o]))return!1}return!0}return e!==e&&n!==n},w$=d$(_$),hA={exports:{}},qp={};/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hS;function x$(){if(hS)return qp;hS=1;var t=dt,e=pv;function n(u,d){return u===d&&(u!==0||1/u===1/d)||u!==u&&d!==d}var r=typeof Object.is=="function"?Object.is:n,s=e.useSyncExternalStore,i=t.useRef,o=t.useEffect,a=t.useMemo,l=t.useDebugValue;return qp.useSyncExternalStoreWithSelector=function(u,d,h,f,m){var y=i(null);if(y.current===null){var v={hasValue:!1,value:null};y.current=v}else v=y.current;y=a(function(){function x(V){if(!S){if(S=!0,b=V,V=f(V),m!==void 0&&v.hasValue){var k=v.value;if(m(k,V))return N=k}return N=V}if(k=N,r(b,V))return k;var E=f(V);return m!==void 0&&m(k,E)?k:(b=V,N=E)}var S=!1,b,N,M=h===void 0?null:h;return[function(){return x(d())},M===null?void 0:function(){return x(M())}]},[d,h,f,m]);var w=s(u,y[0],y[1]);return o(function(){v.hasValue=!0,v.value=w},[w]),l(w),w},qp}hA.exports=x$();var E$=hA.exports;const S$=typeof window<"u"?R.useLayoutEffect:R.useEffect;class b${constructor(e){this.transactionNumber=0,this.lastTransactionNumber=0,this.subscribers=new Set,this.editor=e,this.lastSnapshot={editor:e,transactionNumber:0},this.getSnapshot=this.getSnapshot.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.watch=this.watch.bind(this),this.subscribe=this.subscribe.bind(this)}getSnapshot(){return this.transactionNumber===this.lastTransactionNumber?this.lastSnapshot:(this.lastTransactionNumber=this.transactionNumber,this.lastSnapshot={editor:this.editor,transactionNumber:this.transactionNumber},this.lastSnapshot)}getServerSnapshot(){return{editor:null,transactionNumber:0}}subscribe(e){return this.subscribers.add(e),()=>{this.subscribers.delete(e)}}watch(e){if(this.editor=e,this.editor){const n=()=>{this.transactionNumber+=1,this.subscribers.forEach(s=>s())},r=this.editor;return r.on("transaction",n),()=>{r.off("transaction",n)}}}}function T$(t){var e;const[n]=R.useState(()=>new b$(t.editor)),r=E$.useSyncExternalStoreWithSelector(n.subscribe,n.getSnapshot,n.getServerSnapshot,t.selector,(e=t.equalityFn)!==null&&e!==void 0?e:w$);return S$(()=>n.watch(t.editor),[t.editor,n]),R.useDebugValue(r),r}const k$=!1,Vg=typeof window>"u",I$=Vg||!!(typeof window<"u"&&window.next);class mv{constructor(e){this.editor=null,this.subscriptions=new Set,this.isComponentMounted=!1,this.previousDeps=null,this.instanceId="",this.options=e,this.subscriptions=new Set,this.setEditor(this.getInitialEditor()),this.scheduleDestroy(),this.getEditor=this.getEditor.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.subscribe=this.subscribe.bind(this),this.refreshEditorInstance=this.refreshEditorInstance.bind(this),this.scheduleDestroy=this.scheduleDestroy.bind(this),this.onRender=this.onRender.bind(this),this.createEditor=this.createEditor.bind(this)}setEditor(e){this.editor=e,this.instanceId=Math.random().toString(36).slice(2,9),this.subscriptions.forEach(n=>n())}getInitialEditor(){return this.options.current.immediatelyRender===void 0?Vg||I$?null:this.createEditor():(this.options.current.immediatelyRender,this.options.current.immediatelyRender?this.createEditor():null)}createEditor(){const e={...this.options.current,onBeforeCreate:(...r)=>{var s,i;return(i=(s=this.options.current).onBeforeCreate)===null||i===void 0?void 0:i.call(s,...r)},onBlur:(...r)=>{var s,i;return(i=(s=this.options.current).onBlur)===null||i===void 0?void 0:i.call(s,...r)},onCreate:(...r)=>{var s,i;return(i=(s=this.options.current).onCreate)===null||i===void 0?void 0:i.call(s,...r)},onDestroy:(...r)=>{var s,i;return(i=(s=this.options.current).onDestroy)===null||i===void 0?void 0:i.call(s,...r)},onFocus:(...r)=>{var s,i;return(i=(s=this.options.current).onFocus)===null||i===void 0?void 0:i.call(s,...r)},onSelectionUpdate:(...r)=>{var s,i;return(i=(s=this.options.current).onSelectionUpdate)===null||i===void 0?void 0:i.call(s,...r)},onTransaction:(...r)=>{var s,i;return(i=(s=this.options.current).onTransaction)===null||i===void 0?void 0:i.call(s,...r)},onUpdate:(...r)=>{var s,i;return(i=(s=this.options.current).onUpdate)===null||i===void 0?void 0:i.call(s,...r)},onContentError:(...r)=>{var s,i;return(i=(s=this.options.current).onContentError)===null||i===void 0?void 0:i.call(s,...r)},onDrop:(...r)=>{var s,i;return(i=(s=this.options.current).onDrop)===null||i===void 0?void 0:i.call(s,...r)},onPaste:(...r)=>{var s,i;return(i=(s=this.options.current).onPaste)===null||i===void 0?void 0:i.call(s,...r)}};return new l$(e)}getEditor(){return this.editor}getServerSnapshot(){return null}subscribe(e){return this.subscriptions.add(e),()=>{this.subscriptions.delete(e)}}static compareOptions(e,n){return Object.keys(e).every(r=>["onCreate","onBeforeCreate","onDestroy","onUpdate","onTransaction","onFocus","onBlur","onSelectionUpdate","onContentError","onDrop","onPaste"].includes(r)?!0:r==="extensions"&&e.extensions&&n.extensions?e.extensions.length!==n.extensions.length?!1:e.extensions.every((s,i)=>{var o;return s===((o=n.extensions)===null||o===void 0?void 0:o[i])}):e[r]===n[r])}onRender(e){return()=>(this.isComponentMounted=!0,clearTimeout(this.scheduledDestructionTimeout),this.editor&&!this.editor.isDestroyed&&e.length===0?mv.compareOptions(this.options.current,this.editor.options)||this.editor.setOptions({...this.options.current,editable:this.editor.isEditable}):this.refreshEditorInstance(e),()=>{this.isComponentMounted=!1,this.scheduleDestroy()})}refreshEditorInstance(e){if(this.editor&&!this.editor.isDestroyed){if(this.previousDeps===null){this.previousDeps=e;return}if(this.previousDeps.length===e.length&&this.previousDeps.every((r,s)=>r===e[s]))return}this.editor&&!this.editor.isDestroyed&&this.editor.destroy(),this.setEditor(this.createEditor()),this.previousDeps=e}scheduleDestroy(){const e=this.instanceId,n=this.editor;this.scheduledDestructionTimeout=setTimeout(()=>{if(this.isComponentMounted&&this.instanceId===e){n&&n.setOptions(this.options.current);return}n&&!n.isDestroyed&&(n.destroy(),this.instanceId===e&&this.setEditor(null))},1)}}function C$(t={},e=[]){const n=R.useRef(t);n.current=t;const[r]=R.useState(()=>new mv(n)),s=pv.useSyncExternalStore(r.subscribe,r.getEditor,r.getServerSnapshot);return R.useDebugValue(s),R.useEffect(r.onRender(e)),T$({editor:s,selector:({transactionNumber:i})=>t.shouldRerenderOnTransaction===!1?null:t.immediatelyRender&&i===0?0:i+1}),s}const A$=R.createContext({editor:null});A$.Consumer;const N$=R.createContext({onDragStart:void 0}),R$=()=>R.useContext(N$);dt.forwardRef((t,e)=>{const{onDragStart:n}=R$(),r=t.as||"div";return dt.createElement(r,{...t,ref:e,"data-node-view-wrapper":"",onDragStart:n,style:{whiteSpace:"normal",...t.style}})});const P$=/^\s*>\s$/,D$=rn.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:t}){return["blockquote",$t(this.options.HTMLAttributes,t),0]},addCommands(){return{setBlockquote:()=>({commands:t})=>t.wrapIn(this.name),toggleBlockquote:()=>({commands:t})=>t.toggleWrap(this.name),unsetBlockquote:()=>({commands:t})=>t.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[mu({find:P$,type:this.type})]}}),O$=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,M$=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,L$=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,V$=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,j$=$s.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:t=>t.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:t=>t.type.name===this.name},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}]},renderHTML({HTMLAttributes:t}){return["strong",$t(this.options.HTMLAttributes,t),0]},addCommands(){return{setBold:()=>({commands:t})=>t.setMark(this.name),toggleBold:()=>({commands:t})=>t.toggleMark(this.name),unsetBold:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[ca({find:O$,type:this.type}),ca({find:L$,type:this.type})]},addPasteRules(){return[da({find:M$,type:this.type}),da({find:V$,type:this.type})]}}),F$="listItem",fS="textStyle",pS=/^\s*([-+*])\s$/,U$=rn.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:t}){return["ul",$t(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleBulletList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(F$,this.editor.getAttributes(fS)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let t=mu({find:pS,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(t=mu({find:pS,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(fS),editor:this.editor})),[t]}}),B$=/(^|[^`])`([^`]+)`(?!`)/,z$=/(^|[^`])`([^`]+)`(?!`)/g,$$=$s.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:t}){return["code",$t(this.options.HTMLAttributes,t),0]},addCommands(){return{setCode:()=>({commands:t})=>t.setMark(this.name),toggleCode:()=>({commands:t})=>t.toggleMark(this.name),unsetCode:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[ca({find:B$,type:this.type})]},addPasteRules(){return[da({find:z$,type:this.type})]}}),q$=/^```([a-z]+)?[\s\n]$/,H$=/^~~~([a-z]+)?[\s\n]$/,W$=rn.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:t=>{var e;const{languageClassPrefix:n}=this.options,i=[...((e=t.firstElementChild)===null||e===void 0?void 0:e.classList)||[]].filter(o=>o.startsWith(n)).map(o=>o.replace(n,""))[0];return i||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:t,HTMLAttributes:e}){return["pre",$t(this.options.HTMLAttributes,e),["code",{class:t.attrs.language?this.options.languageClassPrefix+t.attrs.language:null},0]]},addCommands(){return{setCodeBlock:t=>({commands:e})=>e.setNode(this.name,t),toggleCodeBlock:t=>({commands:e})=>e.toggleNode(this.name,"paragraph",t)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:t,$anchor:e}=this.editor.state.selection,n=e.pos===1;return!t||e.parent.type.name!==this.name?!1:n||!e.parent.textContent.length?this.editor.commands.clearNodes():!1},Enter:({editor:t})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=t,{selection:n}=e,{$from:r,empty:s}=n;if(!s||r.parent.type!==this.type)return!1;const i=r.parentOffset===r.parent.nodeSize-2,o=r.parent.textContent.endsWith(`

`);return!i||!o?!1:t.chain().command(({tr:a})=>(a.delete(r.pos-2,r.pos),!0)).exitCode().run()},ArrowDown:({editor:t})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=t,{selection:n,doc:r}=e,{$from:s,empty:i}=n;if(!i||s.parent.type!==this.type||!(s.parentOffset===s.parent.nodeSize-2))return!1;const a=s.after();return a===void 0?!1:r.nodeAt(a)?t.commands.command(({tr:u})=>(u.setSelection(oe.near(r.resolve(a))),!0)):t.commands.exitCode()}}},addInputRules(){return[Lg({find:q$,type:this.type,getAttributes:t=>({language:t[1]})}),Lg({find:H$,type:this.type,getAttributes:t=>({language:t[1]})})]},addProseMirrorPlugins(){return[new sn({key:new lr("codeBlockVSCodeHandler"),props:{handlePaste:(t,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const n=e.clipboardData.getData("text/plain"),r=e.clipboardData.getData("vscode-editor-data"),s=r?JSON.parse(r):void 0,i=s==null?void 0:s.mode;if(!n||!i)return!1;const{tr:o,schema:a}=t.state,l=a.text(n.replace(/\r\n?/g,`
`));return o.replaceSelectionWith(this.type.create({language:i},l)),o.selection.$from.parent.type!==this.type&&o.setSelection(ne.near(o.doc.resolve(Math.max(0,o.selection.from-2)))),o.setMeta("paste",!0),t.dispatch(o),!0}}})]}}),K$=rn.create({name:"doc",topNode:!0,content:"block+"});function G$(t={}){return new sn({view(e){return new Q$(e,t)}})}class Q${constructor(e,n){var r;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(r=n.width)!==null&&r!==void 0?r:1,this.color=n.color===!1?void 0:n.color||"black",this.class=n.class,this.handlers=["dragover","dragend","drop","dragleave"].map(s=>{let i=o=>{this[s](o)};return e.dom.addEventListener(s,i),{name:s,handler:i}})}destroy(){this.handlers.forEach(({name:e,handler:n})=>this.editorView.dom.removeEventListener(e,n))}update(e,n){this.cursorPos!=null&&n.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos),n=!e.parent.inlineContent,r,s=this.editorView.dom,i=s.getBoundingClientRect(),o=i.width/s.offsetWidth,a=i.height/s.offsetHeight;if(n){let h=e.nodeBefore,f=e.nodeAfter;if(h||f){let m=this.editorView.nodeDOM(this.cursorPos-(h?h.nodeSize:0));if(m){let y=m.getBoundingClientRect(),v=h?y.bottom:y.top;h&&f&&(v=(v+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let w=this.width/2*a;r={left:y.left,right:y.right,top:v-w,bottom:v+w}}}}if(!r){let h=this.editorView.coordsAtPos(this.cursorPos),f=this.width/2*o;r={left:h.left-f,right:h.left+f,top:h.top,bottom:h.bottom}}let l=this.editorView.dom.offsetParent;this.element||(this.element=l.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",n),this.element.classList.toggle("prosemirror-dropcursor-inline",!n);let u,d;if(!l||l==document.body&&getComputedStyle(l).position=="static")u=-pageXOffset,d=-pageYOffset;else{let h=l.getBoundingClientRect(),f=h.width/l.offsetWidth,m=h.height/l.offsetHeight;u=h.left-l.scrollLeft*f,d=h.top-l.scrollTop*m}this.element.style.left=(r.left-u)/o+"px",this.element.style.top=(r.top-d)/a+"px",this.element.style.width=(r.right-r.left)/o+"px",this.element.style.height=(r.bottom-r.top)/a+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let n=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),r=n&&n.inside>=0&&this.editorView.state.doc.nodeAt(n.inside),s=r&&r.type.spec.disableDropCursor,i=typeof s=="function"?s(this.editorView,n,e):s;if(n&&!i){let o=n.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let a=e1(this.editorView.state.doc,o,this.editorView.dragging.slice);a!=null&&(o=a)}this.setCursor(o),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}const J$=qt.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[G$(this.options)]}});class Be extends oe{constructor(e){super(e,e)}map(e,n){let r=e.resolve(n.map(this.head));return Be.valid(r)?new Be(r):oe.near(r)}content(){return q.empty}eq(e){return e instanceof Be&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new Be(e.resolve(n.pos))}getBookmark(){return new gv(this.anchor)}static valid(e){let n=e.parent;if(n.isTextblock||!Y$(e)||!X$(e))return!1;let r=n.type.spec.allowGapCursor;if(r!=null)return r;let s=n.contentMatchAt(e.index()).defaultType;return s&&s.isTextblock}static findGapCursorFrom(e,n,r=!1){e:for(;;){if(!r&&Be.valid(e))return e;let s=e.pos,i=null;for(let o=e.depth;;o--){let a=e.node(o);if(n>0?e.indexAfter(o)<a.childCount:e.index(o)>0){i=a.child(n>0?e.indexAfter(o):e.index(o)-1);break}else if(o==0)return null;s+=n;let l=e.doc.resolve(s);if(Be.valid(l))return l}for(;;){let o=n>0?i.firstChild:i.lastChild;if(!o){if(i.isAtom&&!i.isText&&!Y.isSelectable(i)){e=e.doc.resolve(s+i.nodeSize*n),r=!1;continue e}break}i=o,s+=n;let a=e.doc.resolve(s);if(Be.valid(a))return a}return null}}}Be.prototype.visible=!1;Be.findFrom=Be.findGapCursorFrom;oe.jsonID("gapcursor",Be);class gv{constructor(e){this.pos=e}map(e){return new gv(e.map(this.pos))}resolve(e){let n=e.resolve(this.pos);return Be.valid(n)?new Be(n):oe.near(n)}}function fA(t){return t.isAtom||t.spec.isolating||t.spec.createGapCursor}function Y$(t){for(let e=t.depth;e>=0;e--){let n=t.index(e),r=t.node(e);if(n==0){if(r.type.spec.isolating)return!0;continue}for(let s=r.child(n-1);;s=s.lastChild){if(s.childCount==0&&!s.inlineContent||fA(s.type))return!0;if(s.inlineContent)return!1}}return!0}function X$(t){for(let e=t.depth;e>=0;e--){let n=t.indexAfter(e),r=t.node(e);if(n==r.childCount){if(r.type.spec.isolating)return!0;continue}for(let s=r.child(n);;s=s.firstChild){if(s.childCount==0&&!s.inlineContent||fA(s.type))return!0;if(s.inlineContent)return!1}}return!0}function Z$(){return new sn({props:{decorations:r5,createSelectionBetween(t,e,n){return e.pos==n.pos&&Be.valid(n)?new Be(n):null},handleClick:t5,handleKeyDown:e5,handleDOMEvents:{beforeinput:n5}}})}const e5=B1({ArrowLeft:jc("horiz",-1),ArrowRight:jc("horiz",1),ArrowUp:jc("vert",-1),ArrowDown:jc("vert",1)});function jc(t,e){const n=t=="vert"?e>0?"down":"up":e>0?"right":"left";return function(r,s,i){let o=r.selection,a=e>0?o.$to:o.$from,l=o.empty;if(o instanceof ne){if(!i.endOfTextblock(n)||a.depth==0)return!1;l=!1,a=r.doc.resolve(e>0?a.after():a.before())}let u=Be.findGapCursorFrom(a,e,l);return u?(s&&s(r.tr.setSelection(new Be(u))),!0):!1}}function t5(t,e,n){if(!t||!t.editable)return!1;let r=t.state.doc.resolve(e);if(!Be.valid(r))return!1;let s=t.posAtCoords({left:n.clientX,top:n.clientY});return s&&s.inside>-1&&Y.isSelectable(t.state.doc.nodeAt(s.inside))?!1:(t.dispatch(t.state.tr.setSelection(new Be(r))),!0)}function n5(t,e){if(e.inputType!="insertCompositionText"||!(t.state.selection instanceof Be))return!1;let{$from:n}=t.state.selection,r=n.parent.contentMatchAt(n.index()).findWrapping(t.state.schema.nodes.text);if(!r)return!1;let s=F.empty;for(let o=r.length-1;o>=0;o--)s=F.from(r[o].createAndFill(null,s));let i=t.state.tr.replace(n.pos,n.pos,new q(s,0,0));return i.setSelection(ne.near(i.doc.resolve(n.pos+1))),t.dispatch(i),!1}function r5(t){if(!(t.selection instanceof Be))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",Xe.create(t.doc,[Sn.widget(t.selection.head,e,{key:"gapcursor"})])}const s5=qt.create({name:"gapCursor",addProseMirrorPlugins(){return[Z$()]},extendNodeSchema(t){var e;const n={name:t.name,options:t.options,storage:t.storage};return{allowGapCursor:(e=ae(K(t,"allowGapCursor",n)))!==null&&e!==void 0?e:null}}}),i5=rn.create({name:"hardBreak",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:t}){return["br",$t(this.options.HTMLAttributes,t)]},renderText(){return`
`},addCommands(){return{setHardBreak:()=>({commands:t,chain:e,state:n,editor:r})=>t.first([()=>t.exitCode(),()=>t.command(()=>{const{selection:s,storedMarks:i}=n;if(s.$from.parent.type.spec.isolating)return!1;const{keepMarks:o}=this.options,{splittableMarks:a}=r.extensionManager,l=i||s.$to.parentOffset&&s.$from.marks();return e().insertContent({type:this.name}).command(({tr:u,dispatch:d})=>{if(d&&l&&o){const h=l.filter(f=>a.includes(f.type.name));u.ensureMarks(h)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),o5=rn.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(t=>({tag:`h${t}`,attrs:{level:t}}))},renderHTML({node:t,HTMLAttributes:e}){return[`h${this.options.levels.includes(t.attrs.level)?t.attrs.level:this.options.levels[0]}`,$t(this.options.HTMLAttributes,e),0]},addCommands(){return{setHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.setNode(this.name,t):!1,toggleHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.toggleNode(this.name,"paragraph",t):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((t,e)=>({...t,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(t=>Lg({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${t}})\\s$`),type:this.type,getAttributes:{level:t}}))}});var uh=200,it=function(){};it.prototype.append=function(e){return e.length?(e=it.from(e),!this.length&&e||e.length<uh&&this.leafAppend(e)||this.length<uh&&e.leafPrepend(this)||this.appendInner(e)):this};it.prototype.prepend=function(e){return e.length?it.from(e).append(this):this};it.prototype.appendInner=function(e){return new a5(this,e)};it.prototype.slice=function(e,n){return e===void 0&&(e=0),n===void 0&&(n=this.length),e>=n?it.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,n))};it.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};it.prototype.forEach=function(e,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length),n<=r?this.forEachInner(e,n,r,0):this.forEachInvertedInner(e,n,r,0)};it.prototype.map=function(e,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length);var s=[];return this.forEach(function(i,o){return s.push(e(i,o))},n,r),s};it.from=function(e){return e instanceof it?e:e&&e.length?new pA(e):it.empty};var pA=function(t){function e(r){t.call(this),this.values=r}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(s,i){return s==0&&i==this.length?this:new e(this.values.slice(s,i))},e.prototype.getInner=function(s){return this.values[s]},e.prototype.forEachInner=function(s,i,o,a){for(var l=i;l<o;l++)if(s(this.values[l],a+l)===!1)return!1},e.prototype.forEachInvertedInner=function(s,i,o,a){for(var l=i-1;l>=o;l--)if(s(this.values[l],a+l)===!1)return!1},e.prototype.leafAppend=function(s){if(this.length+s.length<=uh)return new e(this.values.concat(s.flatten()))},e.prototype.leafPrepend=function(s){if(this.length+s.length<=uh)return new e(s.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(e.prototype,n),e}(it);it.empty=new pA([]);var a5=function(t){function e(n,r){t.call(this),this.left=n,this.right=r,this.length=n.length+r.length,this.depth=Math.max(n.depth,r.depth)+1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(r){return r<this.left.length?this.left.get(r):this.right.get(r-this.left.length)},e.prototype.forEachInner=function(r,s,i,o){var a=this.left.length;if(s<a&&this.left.forEachInner(r,s,Math.min(i,a),o)===!1||i>a&&this.right.forEachInner(r,Math.max(s-a,0),Math.min(this.length,i)-a,o+a)===!1)return!1},e.prototype.forEachInvertedInner=function(r,s,i,o){var a=this.left.length;if(s>a&&this.right.forEachInvertedInner(r,s-a,Math.max(i,a)-a,o+a)===!1||i<a&&this.left.forEachInvertedInner(r,Math.min(s,a),i,o)===!1)return!1},e.prototype.sliceInner=function(r,s){if(r==0&&s==this.length)return this;var i=this.left.length;return s<=i?this.left.slice(r,s):r>=i?this.right.slice(r-i,s-i):this.left.slice(r,i).append(this.right.slice(0,s-i))},e.prototype.leafAppend=function(r){var s=this.right.leafAppend(r);if(s)return new e(this.left,s)},e.prototype.leafPrepend=function(r){var s=this.left.leafPrepend(r);if(s)return new e(s,this.right)},e.prototype.appendInner=function(r){return this.left.depth>=Math.max(this.right.depth,r.depth)+1?new e(this.left,new e(this.right,r)):new e(this,r)},e}(it);const l5=500;class Vn{constructor(e,n){this.items=e,this.eventCount=n}popEvent(e,n){if(this.eventCount==0)return null;let r=this.items.length;for(;;r--)if(this.items.get(r-1).selection){--r;break}let s,i;n&&(s=this.remapping(r,this.items.length),i=s.maps.length);let o=e.tr,a,l,u=[],d=[];return this.items.forEach((h,f)=>{if(!h.step){s||(s=this.remapping(r,f+1),i=s.maps.length),i--,d.push(h);return}if(s){d.push(new Kn(h.map));let m=h.step.map(s.slice(i)),y;m&&o.maybeStep(m).doc&&(y=o.mapping.maps[o.mapping.maps.length-1],u.push(new Kn(y,void 0,void 0,u.length+d.length))),i--,y&&s.appendMap(y,i)}else o.maybeStep(h.step);if(h.selection)return a=s?h.selection.map(s.slice(i)):h.selection,l=new Vn(this.items.slice(0,r).append(d.reverse().concat(u)),this.eventCount-1),!1},this.items.length,0),{remaining:l,transform:o,selection:a}}addTransform(e,n,r,s){let i=[],o=this.eventCount,a=this.items,l=!s&&a.length?a.get(a.length-1):null;for(let d=0;d<e.steps.length;d++){let h=e.steps[d].invert(e.docs[d]),f=new Kn(e.mapping.maps[d],h,n),m;(m=l&&l.merge(f))&&(f=m,d?i.pop():a=a.slice(0,a.length-1)),i.push(f),n&&(o++,n=void 0),s||(l=f)}let u=o-r.depth;return u>c5&&(a=u5(a,u),o-=u),new Vn(a.append(i),o)}remapping(e,n){let r=new lu;return this.items.forEach((s,i)=>{let o=s.mirrorOffset!=null&&i-s.mirrorOffset>=e?r.maps.length-s.mirrorOffset:void 0;r.appendMap(s.map,o)},e,n),r}addMaps(e){return this.eventCount==0?this:new Vn(this.items.append(e.map(n=>new Kn(n))),this.eventCount)}rebased(e,n){if(!this.eventCount)return this;let r=[],s=Math.max(0,this.items.length-n),i=e.mapping,o=e.steps.length,a=this.eventCount;this.items.forEach(f=>{f.selection&&a--},s);let l=n;this.items.forEach(f=>{let m=i.getMirror(--l);if(m==null)return;o=Math.min(o,m);let y=i.maps[m];if(f.step){let v=e.steps[m].invert(e.docs[m]),w=f.selection&&f.selection.map(i.slice(l+1,m));w&&a++,r.push(new Kn(y,v,w))}else r.push(new Kn(y))},s);let u=[];for(let f=n;f<o;f++)u.push(new Kn(i.maps[f]));let d=this.items.slice(0,s).append(u).append(r),h=new Vn(d,a);return h.emptyItemCount()>l5&&(h=h.compress(this.items.length-r.length)),h}emptyItemCount(){let e=0;return this.items.forEach(n=>{n.step||e++}),e}compress(e=this.items.length){let n=this.remapping(0,e),r=n.maps.length,s=[],i=0;return this.items.forEach((o,a)=>{if(a>=e)s.push(o),o.selection&&i++;else if(o.step){let l=o.step.map(n.slice(r)),u=l&&l.getMap();if(r--,u&&n.appendMap(u,r),l){let d=o.selection&&o.selection.map(n.slice(r));d&&i++;let h=new Kn(u.invert(),l,d),f,m=s.length-1;(f=s.length&&s[m].merge(h))?s[m]=f:s.push(h)}}else o.map&&r--},this.items.length,0),new Vn(it.from(s.reverse()),i)}}Vn.empty=new Vn(it.empty,0);function u5(t,e){let n;return t.forEach((r,s)=>{if(r.selection&&e--==0)return n=s,!1}),t.slice(n)}class Kn{constructor(e,n,r,s){this.map=e,this.step=n,this.selection=r,this.mirrorOffset=s}merge(e){if(this.step&&e.step&&!e.selection){let n=e.step.merge(this.step);if(n)return new Kn(n.getMap().invert(),n,this.selection)}}}class es{constructor(e,n,r,s,i){this.done=e,this.undone=n,this.prevRanges=r,this.prevTime=s,this.prevComposition=i}}const c5=20;function d5(t,e,n,r){let s=n.getMeta(Ci),i;if(s)return s.historyState;n.getMeta(p5)&&(t=new es(t.done,t.undone,null,0,-1));let o=n.getMeta("appendedTransaction");if(n.steps.length==0)return t;if(o&&o.getMeta(Ci))return o.getMeta(Ci).redo?new es(t.done.addTransform(n,void 0,r,cd(e)),t.undone,mS(n.mapping.maps),t.prevTime,t.prevComposition):new es(t.done,t.undone.addTransform(n,void 0,r,cd(e)),null,t.prevTime,t.prevComposition);if(n.getMeta("addToHistory")!==!1&&!(o&&o.getMeta("addToHistory")===!1)){let a=n.getMeta("composition"),l=t.prevTime==0||!o&&t.prevComposition!=a&&(t.prevTime<(n.time||0)-r.newGroupDelay||!h5(n,t.prevRanges)),u=o?Hp(t.prevRanges,n.mapping):mS(n.mapping.maps);return new es(t.done.addTransform(n,l?e.selection.getBookmark():void 0,r,cd(e)),Vn.empty,u,n.time,a??t.prevComposition)}else return(i=n.getMeta("rebased"))?new es(t.done.rebased(n,i),t.undone.rebased(n,i),Hp(t.prevRanges,n.mapping),t.prevTime,t.prevComposition):new es(t.done.addMaps(n.mapping.maps),t.undone.addMaps(n.mapping.maps),Hp(t.prevRanges,n.mapping),t.prevTime,t.prevComposition)}function h5(t,e){if(!e)return!1;if(!t.docChanged)return!0;let n=!1;return t.mapping.maps[0].forEach((r,s)=>{for(let i=0;i<e.length;i+=2)r<=e[i+1]&&s>=e[i]&&(n=!0)}),n}function mS(t){let e=[];for(let n=t.length-1;n>=0&&e.length==0;n--)t[n].forEach((r,s,i,o)=>e.push(i,o));return e}function Hp(t,e){if(!t)return null;let n=[];for(let r=0;r<t.length;r+=2){let s=e.map(t[r],1),i=e.map(t[r+1],-1);s<=i&&n.push(s,i)}return n}function f5(t,e,n){let r=cd(e),s=Ci.get(e).spec.config,i=(n?t.undone:t.done).popEvent(e,r);if(!i)return null;let o=i.selection.resolve(i.transform.doc),a=(n?t.done:t.undone).addTransform(i.transform,e.selection.getBookmark(),s,r),l=new es(n?a:i.remaining,n?i.remaining:a,null,0,-1);return i.transform.setSelection(o).setMeta(Ci,{redo:n,historyState:l})}let Wp=!1,gS=null;function cd(t){let e=t.plugins;if(gS!=e){Wp=!1,gS=e;for(let n=0;n<e.length;n++)if(e[n].spec.historyPreserveItems){Wp=!0;break}}return Wp}const Ci=new lr("history"),p5=new lr("closeHistory");function m5(t={}){return t={depth:t.depth||100,newGroupDelay:t.newGroupDelay||500},new sn({key:Ci,state:{init(){return new es(Vn.empty,Vn.empty,null,0,-1)},apply(e,n,r){return d5(n,r,e,t)}},config:t,props:{handleDOMEvents:{beforeinput(e,n){let r=n.inputType,s=r=="historyUndo"?gA:r=="historyRedo"?yA:null;return s?(n.preventDefault(),s(e.state,e.dispatch)):!1}}}})}function mA(t,e){return(n,r)=>{let s=Ci.getState(n);if(!s||(t?s.undone:s.done).eventCount==0)return!1;if(r){let i=f5(s,n,t);i&&r(e?i.scrollIntoView():i)}return!0}}const gA=mA(!1,!0),yA=mA(!0,!0),g5=qt.create({name:"history",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:t,dispatch:e})=>gA(t,e),redo:()=>({state:t,dispatch:e})=>yA(t,e)}},addProseMirrorPlugins(){return[m5(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-":()=>this.editor.commands.undo(),"Shift-Mod-":()=>this.editor.commands.redo()}}}),y5=rn.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{}}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:t}){return["hr",$t(this.options.HTMLAttributes,t)]},addCommands(){return{setHorizontalRule:()=>({chain:t,state:e})=>{if(!c$(e,e.schema.nodes[this.name]))return!1;const{selection:n}=e,{$from:r,$to:s}=n,i=t();return r.parentOffset===0?i.insertContentAt({from:Math.max(r.pos-1,0),to:s.pos},{type:this.name}):R6(n)?i.insertContentAt(s.pos,{type:this.name}):i.insertContent({type:this.name}),i.command(({tr:o,dispatch:a})=>{var l;if(a){const{$to:u}=o.selection,d=u.end();if(u.nodeAfter)u.nodeAfter.isTextblock?o.setSelection(ne.create(o.doc,u.pos+1)):u.nodeAfter.isBlock?o.setSelection(Y.create(o.doc,u.pos)):o.setSelection(ne.create(o.doc,u.pos));else{const h=(l=u.parent.type.contentMatch.defaultType)===null||l===void 0?void 0:l.create();h&&(o.insert(d,h),o.setSelection(ne.create(o.doc,d+1)))}o.scrollIntoView()}return!0}).run()}}},addInputRules(){return[u$({find:/^(?:---|-|___\s|\*\*\*\s)$/,type:this.type})]}}),v5=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,_5=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,w5=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,x5=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,E5=$s.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:t=>t.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:t=>t.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:t}){return["em",$t(this.options.HTMLAttributes,t),0]},addCommands(){return{setItalic:()=>({commands:t})=>t.setMark(this.name),toggleItalic:()=>({commands:t})=>t.toggleMark(this.name),unsetItalic:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[ca({find:v5,type:this.type}),ca({find:w5,type:this.type})]},addPasteRules(){return[da({find:_5,type:this.type}),da({find:x5,type:this.type})]}}),S5=rn.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:t}){return["li",$t(this.options.HTMLAttributes,t),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),b5="listItem",yS="textStyle",vS=/^(\d+)\.\s$/,T5=rn.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:t=>t.hasAttribute("start")?parseInt(t.getAttribute("start")||"",10):1},type:{default:null,parseHTML:t=>t.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:t}){const{start:e,...n}=t;return e===1?["ol",$t(this.options.HTMLAttributes,n),0]:["ol",$t(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleOrderedList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(b5,this.editor.getAttributes(yS)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let t=mu({find:vS,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(t=mu({find:vS,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(yS)}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1],editor:this.editor})),[t]}}),k5=rn.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:t}){return["p",$t(this.options.HTMLAttributes,t),0]},addCommands(){return{setParagraph:()=>({commands:t})=>t.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),I5=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,C5=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,A5=$s.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["s",$t(this.options.HTMLAttributes,t),0]},addCommands(){return{setStrike:()=>({commands:t})=>t.setMark(this.name),toggleStrike:()=>({commands:t})=>t.toggleMark(this.name),unsetStrike:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[ca({find:I5,type:this.type})]},addPasteRules(){return[da({find:C5,type:this.type})]}}),N5=rn.create({name:"text",group:"inline"}),R5=qt.create({name:"starterKit",addExtensions(){const t=[];return this.options.bold!==!1&&t.push(j$.configure(this.options.bold)),this.options.blockquote!==!1&&t.push(D$.configure(this.options.blockquote)),this.options.bulletList!==!1&&t.push(U$.configure(this.options.bulletList)),this.options.code!==!1&&t.push($$.configure(this.options.code)),this.options.codeBlock!==!1&&t.push(W$.configure(this.options.codeBlock)),this.options.document!==!1&&t.push(K$.configure(this.options.document)),this.options.dropcursor!==!1&&t.push(J$.configure(this.options.dropcursor)),this.options.gapcursor!==!1&&t.push(s5.configure(this.options.gapcursor)),this.options.hardBreak!==!1&&t.push(i5.configure(this.options.hardBreak)),this.options.heading!==!1&&t.push(o5.configure(this.options.heading)),this.options.history!==!1&&t.push(g5.configure(this.options.history)),this.options.horizontalRule!==!1&&t.push(y5.configure(this.options.horizontalRule)),this.options.italic!==!1&&t.push(E5.configure(this.options.italic)),this.options.listItem!==!1&&t.push(S5.configure(this.options.listItem)),this.options.orderedList!==!1&&t.push(T5.configure(this.options.orderedList)),this.options.paragraph!==!1&&t.push(k5.configure(this.options.paragraph)),this.options.strike!==!1&&t.push(A5.configure(this.options.strike)),this.options.text!==!1&&t.push(N5.configure(this.options.text)),t}}),P5=({editor:t})=>t?p.jsxs("div",{className:"flex items-center gap-1 p-2 border-b border-gray-200 bg-gray-50 rounded-t-lg",children:[p.jsxs("div",{className:"flex items-center gap-1 border-r border-gray-300 pr-2 mr-2",children:[p.jsx("button",{onClick:()=>t.chain().focus().toggleBold().run(),disabled:!t.can().chain().focus().toggleBold().run(),className:`px-2 py-1 text-sm font-medium rounded hover:bg-gray-200 disabled:opacity-50 ${t.isActive("bold")?"bg-gray-300":""}`,title:"Bold",children:p.jsx("strong",{children:"B"})}),p.jsx("button",{onClick:()=>t.chain().focus().toggleItalic().run(),disabled:!t.can().chain().focus().toggleItalic().run(),className:`px-2 py-1 text-sm font-medium rounded hover:bg-gray-200 disabled:opacity-50 ${t.isActive("italic")?"bg-gray-300":""}`,title:"Italic",children:p.jsx("em",{children:"I"})})]}),p.jsxs("div",{className:"flex items-center gap-1 border-r border-gray-300 pr-2 mr-2",children:[p.jsx("button",{onClick:()=>t.chain().focus().toggleHeading({level:1}).run(),className:`px-2 py-1 text-sm font-medium rounded hover:bg-gray-200 ${t.isActive("heading",{level:1})?"bg-gray-300":""}`,title:"Heading 1",children:"H1"}),p.jsx("button",{onClick:()=>t.chain().focus().toggleHeading({level:2}).run(),className:`px-2 py-1 text-sm font-medium rounded hover:bg-gray-200 ${t.isActive("heading",{level:2})?"bg-gray-300":""}`,title:"Heading 2",children:"H2"}),p.jsx("button",{onClick:()=>t.chain().focus().toggleHeading({level:3}).run(),className:`px-2 py-1 text-sm font-medium rounded hover:bg-gray-200 ${t.isActive("heading",{level:3})?"bg-gray-300":""}`,title:"Heading 3",children:"H3"})]}),p.jsxs("div",{className:"flex items-center gap-1 border-r border-gray-300 pr-2 mr-2",children:[p.jsx("button",{onClick:()=>t.chain().focus().toggleBulletList().run(),className:`px-2 py-1 text-sm font-medium rounded hover:bg-gray-200 ${t.isActive("bulletList")?"bg-gray-300":""}`,title:"Bullet List",children:""}),p.jsx("button",{onClick:()=>t.chain().focus().toggleOrderedList().run(),className:`px-2 py-1 text-sm font-medium rounded hover:bg-gray-200 ${t.isActive("orderedList")?"bg-gray-300":""}`,title:"Numbered List",children:"1."})]}),p.jsxs("div",{className:"flex items-center gap-1",children:[p.jsx("button",{onClick:()=>t.chain().focus().undo().run(),disabled:!t.can().chain().focus().undo().run(),className:"px-2 py-1 text-sm font-medium rounded hover:bg-gray-200 disabled:opacity-50",title:"Undo",children:""}),p.jsx("button",{onClick:()=>t.chain().focus().redo().run(),disabled:!t.can().chain().focus().redo().run(),className:"px-2 py-1 text-sm font-medium rounded hover:bg-gray-200 disabled:opacity-50",title:"Redo",children:""})]})]}):null,D5=({content:t,onChange:e,placeholder:n="Start typing...",editable:r=!0})=>{const s=C$({extensions:[R5.configure({heading:{levels:[1,2,3]}})],content:t,editable:r,onUpdate:({editor:i})=>{const o=i.getHTML();e(o)},editorProps:{attributes:{class:"prose prose-lg max-w-none focus:outline-none min-h-[400px] p-6","data-placeholder":n}}});return R.useEffect(()=>{s&&t!==s.getHTML()&&s.commands.setContent(t)},[t,s]),s?p.jsxs("div",{className:"border border-gray-300 rounded-lg bg-white",children:[p.jsx(P5,{editor:s}),p.jsx(v$,{editor:s})]}):p.jsx("div",{children:"Loading editor..."})},Fc=t=>{const{draftId:e,onSave:n}=t,[r,s]=R.useState(!1),[i,o]=R.useState(null),[a,l]=R.useState(null),u=R.useRef(null),d=R.useRef(null),h=R.useCallback(async(y,v)=>{u.current&&clearTimeout(u.current),u.current=setTimeout(async()=>{try{s(!0),o(null),await iu.updateDraftSection(e,v,y),l(new Date),n==null||n()}catch(w){o(w.message||"Failed to save"),console.error("Save error:",w)}finally{s(!1)}},2e3)},[e,n]),f=R.useCallback(y=>{d.current=y},[]),m=R.useCallback(()=>r?"Saving...":i?"Error saving":a?`Saved ${a.toLocaleTimeString()}`:"Not saved",[r,i,a]);return{saving:r,error:i,lastSaved:a,saveContent:h,setEditor:f,getSaveStatus:m}},vA=R.createContext(void 0),yv=()=>{const t=R.useContext(vA);if(t===void 0)throw new Error("useCollaboration must be used within a CollaborationProvider");return t},O5=({children:t,draftId:e})=>{const{user:n,userProfile:r}=_t(),[s,i]=R.useState([]),[o,a]=R.useState([]),[l,u]=R.useState(!0),[d,h]=R.useState(null),f=R.useRef(null),m=R.useRef(null),y=async()=>{if(!(!n||!r||!e))try{const x=Ie(le,"drafts",e,"collaboration","data"),S={userId:n.uid,userName:r.displayName||n.email||"Unknown",lastActiveAt:new Date},b=await Bs(x);if(!b.exists())await rC(x,{activeEditors:[S],changes:[],updatedAt:xe()});else{const N=b.data(),M=(N==null?void 0:N.activeEditors)||[],V=M.findIndex(k=>k.userId===n.uid);if(V>=0){const k=[...M];k[V]=S,await En(x,{activeEditors:k,updatedAt:xe()})}else await En(x,{activeEditors:pF(S),updatedAt:xe()})}}catch(x){console.error("Error updating presence:",x),h(x.message)}},v=async x=>{var S;if(!(!n||!r||!e))try{const b=Ie(le,"drafts",e,"collaboration","data"),M={changeId:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,...x,timestamp:new Date},k=((S=(await Bs(b)).data())==null?void 0:S.changes)||[],E=[M,...k].slice(0,100);await En(b,{changes:E,updatedAt:xe()})}catch(b){console.error("Error recording change:",b),h(b.message)}};R.useEffect(()=>{if(!e)return;u(!0);const x=Ie(le,"drafts",e,"collaboration","data"),S=sC(x,b=>{if(b.exists()){const N=b.data(),M=(N==null?void 0:N.activeEditors)||[],V=(N==null?void 0:N.changes)||[],k=new Date,E=M.filter(I=>{const C=I.lastActiveAt instanceof We?I.lastActiveAt.toDate():new Date(I.lastActiveAt);return(k.getTime()-C.getTime())/1e3<30});i(E),a(V)}else i([]),a([]);u(!1),h(null)},b=>{console.error("Collaboration listener error:",b),h(b.message),u(!1)});return n&&r&&y(),f.current=setInterval(()=>{y()},1e4),()=>{if(S(),f.current&&clearInterval(f.current),m.current&&clearTimeout(m.current),n&&e){const b=Ie(le,"drafts",e,"collaboration","data");En(b,{activeEditors:mF({userId:n.uid,userName:(r==null?void 0:r.displayName)||n.email||"Unknown",lastActiveAt:new Date}),updatedAt:xe()}).catch(console.error)}}},[e,n,r]);const w={activeEditors:s,changes:o,loading:l,error:d,updatePresence:y,recordChange:v};return p.jsx(vA.Provider,{value:w,children:t})},M5=()=>{const{activeEditors:t}=yv(),{user:e}=_t(),n=t.filter(r=>r.userId!==(e==null?void 0:e.uid));return n.length===0?null:p.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 bg-blue-50 rounded-full",children:[p.jsxs("div",{className:"flex -space-x-2",children:[n.slice(0,3).map(r=>p.jsx("div",{className:"w-6 h-6 rounded-full bg-blue-500 text-white text-xs flex items-center justify-center border-2 border-white",title:r.userName,children:r.userName.charAt(0).toUpperCase()},r.userId)),n.length>3&&p.jsxs("div",{className:"w-6 h-6 rounded-full bg-gray-400 text-white text-xs flex items-center justify-center border-2 border-white",children:["+",n.length-3]})]}),p.jsx("span",{className:"text-xs text-gray-600",children:n.length===1?"1 person editing":`${n.length} people editing`})]})},L5=({change:t,currentUserId:e})=>{const n=o=>{const a=o instanceof Date?o:new Date(o),u=Math.floor((new Date().getTime()-a.getTime())/1e3);return u<60?`${u}s ago`:u<3600?`${Math.floor(u/60)}m ago`:u<86400?`${Math.floor(u/3600)}h ago`:a.toLocaleDateString()},r=()=>{switch(t.type){case"insert":return"";case"delete":return"";case"format":return"";case"refinement":return"";default:return""}},s=o=>{switch(o){case"facts":return"Facts";case"liability":return"Liability";case"damages":return"Damages";case"demand":return"Demand";default:return o}},i=t.userId===e;return p.jsxs("div",{className:`p-3 rounded-md border ${i?"bg-blue-50 border-blue-200":"bg-white border-gray-200 hover:bg-gray-50"}`,children:[p.jsxs("div",{className:"flex items-start justify-between mb-1",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("span",{className:"text-sm",children:r()}),p.jsx("span",{className:"text-sm font-medium text-gray-900",children:i?"You":t.userName}),p.jsx("span",{className:"text-xs text-gray-500",children:s(t.section)})]}),p.jsx("span",{className:"text-xs text-gray-500",children:n(t.timestamp)})]}),p.jsx("p",{className:"text-sm text-gray-700",children:t.description}),t.content&&p.jsxs("div",{className:"mt-2 p-2 bg-gray-100 rounded text-xs text-gray-600 font-mono max-h-20 overflow-y-auto",children:[t.content.substring(0,100),t.content.length>100&&"..."]})]})},V5=()=>{const{changes:t,loading:e}=yv(),{user:n}=_t();return e?p.jsx("div",{className:"p-4",children:p.jsx("p",{className:"text-sm text-gray-500",children:"Loading change history..."})}):p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"Change History"}),p.jsxs("span",{className:"text-xs text-gray-500",children:[t.length," changes"]})]}),t.length===0?p.jsx("div",{className:"text-center py-8",children:p.jsx("p",{className:"text-sm text-gray-500",children:"No changes recorded yet"})}):p.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:t.map(r=>p.jsx(L5,{change:r,currentUserId:n==null?void 0:n.uid},r.changeId))})]})};class ul{static async addComment(e,n,r){try{const s=tn(le,"drafts",e.draftId,"comments"),i={draftId:e.draftId,userId:n,userName:r,position:e.position,content:e.content,resolved:!1,replies:[],timestamp:xe()};return(await Lu(s,i)).id}catch(s){throw new Error(`Failed to add comment: ${s.message}`)}}static async getComments(e){try{const n=tn(le,"drafts",e,"comments"),r=Fs(n,Us("timestamp","desc"));return(await Ou(r)).docs.map(i=>{const o=i.data();return{...o,commentId:i.id,timestamp:o.timestamp.toDate(),resolvedAt:o.resolvedAt?o.resolvedAt.toDate():void 0}})}catch(n){throw new Error(`Failed to get comments: ${n.message}`)}}static async addReply(e,n,r){try{const s=Ie(le,"drafts",e.draftId,"comments",e.commentId),i=await Bs(s);if(!i.exists())throw new Error("Comment not found");const o=i.data(),l={replyId:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,userId:n,userName:r,content:e.content,timestamp:xe()};await En(s,{replies:[...o.replies||[],l]})}catch(s){throw new Error(`Failed to add reply: ${s.message}`)}}static async resolveComment(e,n,r){try{const s=Ie(le,"drafts",e,"comments",n);await En(s,{resolved:!0,resolvedAt:xe(),resolvedBy:r})}catch(s){throw new Error(`Failed to resolve comment: ${s.message}`)}}static async deleteComment(e,n){try{const r=Ie(le,"drafts",e,"comments",n);await Mu(r)}catch(r){throw new Error(`Failed to delete comment: ${r.message}`)}}static subscribeToComments(e,n){const r=tn(le,"drafts",e,"comments"),s=Fs(r,Us("timestamp","desc"));return sC(s,i=>{const o=i.docs.map(a=>{const l=a.data();return{...l,commentId:a.id,timestamp:l.timestamp.toDate(),resolvedAt:l.resolvedAt?l.resolvedAt.toDate():void 0}});n(o)},i=>{console.error("Error subscribing to comments:",i)})}}const j5=({comment:t,onReply:e,onResolve:n,onDelete:r})=>{const{user:s}=_t(),[i,o]=R.useState(!1),[a,l]=R.useState(""),u=f=>{const m=f instanceof Date?f:new Date(f),v=Math.floor((new Date().getTime()-m.getTime())/1e3);return v<60?`${v}s ago`:v<3600?`${Math.floor(v/60)}m ago`:v<86400?`${Math.floor(v/3600)}h ago`:m.toLocaleDateString()},d=()=>{a.trim()&&(e(t.commentId,a),l(""),o(!1))},h=t.userId===(s==null?void 0:s.uid);return p.jsxs("div",{className:`p-3 rounded-md border ${t.resolved?"bg-gray-50 border-gray-200 opacity-75":"bg-white border-gray-200"}`,children:[p.jsxs("div",{className:"flex items-start justify-between mb-2",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("span",{className:"text-sm font-medium text-gray-900",children:h?"You":t.userName}),p.jsx("span",{className:"text-xs text-gray-500",children:u(t.timestamp)}),t.resolved&&p.jsx("span",{className:"text-xs text-green-600 font-medium",children:"Resolved"})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[!t.resolved&&h&&p.jsx("button",{onClick:()=>n(t.commentId),className:"text-xs text-green-600 hover:text-green-700",children:"Resolve"}),h&&p.jsx("button",{onClick:()=>r(t.commentId),className:"text-xs text-red-600 hover:text-red-700",children:"Delete"})]})]}),p.jsx("p",{className:"text-sm text-gray-700 mb-2",children:t.content}),t.position.selectedText&&p.jsxs("div",{className:"mb-2 p-2 bg-yellow-50 border border-yellow-200 rounded text-xs text-gray-600 italic",children:['"',t.position.selectedText,'"']}),t.replies&&t.replies.length>0&&p.jsx("div",{className:"mt-3 ml-4 space-y-2 border-l-2 border-gray-200 pl-3",children:t.replies.map(f=>p.jsxs("div",{className:"text-sm",children:[p.jsx("span",{className:"font-medium text-gray-900",children:f.userId===(s==null?void 0:s.uid)?"You":f.userName}),p.jsx("span",{className:"text-xs text-gray-500 ml-2",children:u(f.timestamp)}),p.jsx("p",{className:"text-gray-700 mt-1",children:f.content})]},f.replyId))}),!t.resolved&&p.jsx("div",{className:"mt-3",children:i?p.jsxs("div",{className:"space-y-2",children:[p.jsx("textarea",{value:a,onChange:f=>l(f.target.value),placeholder:"Write a reply...",className:"w-full px-2 py-1 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:2}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("button",{onClick:d,className:"px-2 py-1 text-xs font-medium text-white bg-blue-600 rounded hover:bg-blue-700",children:"Post Reply"}),p.jsx("button",{onClick:()=>{o(!1),l("")},className:"px-2 py-1 text-xs font-medium text-gray-700 bg-gray-200 rounded hover:bg-gray-300",children:"Cancel"})]})]}):p.jsx("button",{onClick:()=>o(!0),className:"text-xs text-blue-600 hover:text-blue-700",children:"Reply"})})]})},F5=({draftId:t})=>{const{user:e,userProfile:n}=_t(),[r,s]=R.useState([]),[i,o]=R.useState("all"),[a,l]=R.useState(!0);R.useEffect(()=>{if(!t)return;const v=ul.subscribeToComments(t,w=>{s(w),l(!1)});return()=>v()},[t]);const u=async(v,w)=>{if(!(!e||!n))try{await ul.addReply({draftId:t,commentId:v,content:w},e.uid,n.displayName||e.email||"Unknown")}catch(x){alert(`Failed to add reply: ${x.message}`)}},d=async v=>{if(e)try{await ul.resolveComment(t,v,e.uid)}catch(w){alert(`Failed to resolve comment: ${w.message}`)}},h=async v=>{if(window.confirm("Are you sure you want to delete this comment?"))try{await ul.deleteComment(t,v)}catch(w){alert(`Failed to delete comment: ${w.message}`)}},f=r.filter(v=>i==="unresolved"?!v.resolved:i==="resolved"?v.resolved:!0),m=r.filter(v=>!v.resolved).length,y=r.filter(v=>v.resolved).length;return p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"Comments"}),p.jsxs("span",{className:"text-xs text-gray-500",children:[r.length," total"]})]}),p.jsxs("div",{className:"flex gap-1 border-b border-gray-200",children:[p.jsxs("button",{onClick:()=>o("all"),className:`px-3 py-1 text-xs font-medium border-b-2 transition-colors ${i==="all"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:["All (",r.length,")"]}),p.jsxs("button",{onClick:()=>o("unresolved"),className:`px-3 py-1 text-xs font-medium border-b-2 transition-colors ${i==="unresolved"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:["Unresolved (",m,")"]}),p.jsxs("button",{onClick:()=>o("resolved"),className:`px-3 py-1 text-xs font-medium border-b-2 transition-colors ${i==="resolved"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:["Resolved (",y,")"]})]}),a?p.jsx("div",{className:"text-center py-8",children:p.jsx("p",{className:"text-sm text-gray-500",children:"Loading comments..."})}):f.length===0?p.jsx("div",{className:"text-center py-8",children:p.jsx("p",{className:"text-sm text-gray-500",children:i==="all"?"No comments yet":i==="unresolved"?"No unresolved comments":"No resolved comments"})}):p.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:f.map(v=>p.jsx(j5,{comment:v,onReply:u,onResolve:d,onDelete:h},v.commentId))})]})},U5=({draftId:t,section:e,selectedText:n,onCommentAdded:r})=>{const{user:s,userProfile:i}=_t(),[o,a]=R.useState(!1),[l,u]=R.useState(""),[d,h]=R.useState(!1),f=async()=>{if(!(!s||!i||!l.trim())){h(!0);try{const m={section:e,startOffset:0,endOffset:(n==null?void 0:n.length)||0,selectedText:n};await ul.addComment({draftId:t,position:m,content:l},s.uid,i.displayName||s.email||"Unknown"),u(""),a(!1),r==null||r()}catch(m){alert(`Failed to add comment: ${m.message}`)}finally{h(!1)}}};return o?p.jsxs("div",{className:"p-3 bg-white border border-gray-200 rounded-lg shadow-lg",children:[n&&p.jsxs("div",{className:"mb-2 p-2 bg-yellow-50 border border-yellow-200 rounded text-xs text-gray-600 italic",children:['"',n,'"']}),p.jsx("textarea",{value:l,onChange:m=>u(m.target.value),placeholder:"Write a comment...",className:"w-full px-2 py-1 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 mb-2",rows:3}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("button",{onClick:f,disabled:d||!l.trim(),className:"px-3 py-1 text-xs font-medium text-white bg-blue-600 rounded hover:bg-blue-700 disabled:opacity-50",children:d?"Posting...":"Post Comment"}),p.jsx("button",{onClick:()=>{a(!1),u("")},className:"px-3 py-1 text-xs font-medium text-gray-700 bg-gray-200 rounded hover:bg-gray-300",children:"Cancel"})]})]}):p.jsx("button",{onClick:()=>a(!0),className:"px-2 py-1 text-xs font-medium text-blue-600 hover:text-blue-700 hover:bg-blue-50 rounded",title:"Add comment",children:" Comment"})};class _S{static async exportDraft(e){try{const n=Gn.currentUser;if(!n)throw new Error("User not authenticated");const s=await fetch("https://us-central1-stenographer-dev.cloudfunctions.net/exportGenerate",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${await n.getIdToken()}`},body:JSON.stringify({...e,userId:n.uid})});if(!s.ok){const o=await s.json();throw new Error(o.message||"Failed to generate export")}const i=await s.json();return{downloadUrl:i.downloadUrl,exportId:i.exportId}}catch(n){throw new Error(`Failed to export draft: ${n.message}`)}}static downloadFile(e,n){const r=document.createElement("a");r.href=e,r.download=n,r.target="_blank",document.body.appendChild(r),r.click(),document.body.removeChild(r)}}const B5=({draftId:t})=>{const{user:e,userProfile:n}=_t(),{recordChange:r}=yv(),[s,i]=R.useState(null),[o,a]=R.useState(null),[l,u]=R.useState(!0),[d,h]=R.useState(null),[f,m]=R.useState(null),[y,v]=R.useState(!1),[w,x]=R.useState("facts"),[S,b]=R.useState("facts"),N=Fc({draftId:t||""}),M=Fc({draftId:t||""}),V=Fc({draftId:t||""}),k=Fc({draftId:t||""});R.useEffect(()=>{E()},[t]);const E=async()=>{try{u(!0),h(null);const Q=await iu.getDraft(t);if(!Q){h("Draft not found");return}if(i(Q),Q.matterId)try{const ge=await Si.getMatter(Q.matterId);a(ge)}catch(ge){console.warn("Failed to load matter:",ge)}}catch(Q){h(Q.message||"Failed to load draft")}finally{u(!1)}},I=Q=>{x(Q),v(!0)},C=async(Q,ge,Re)=>{if(t){m(Q);try{await iu.refineSection(t,Q,ge,Re),await r({userId:(e==null?void 0:e.uid)||"",userName:(n==null?void 0:n.displayName)||(e==null?void 0:e.email)||"Unknown",type:"refinement",section:Q,description:`Refined ${Q} section: ${ge}`}),await E()}finally{m(null)}}},P=(Q,ge)=>{(Q==="facts"?N:Q==="liability"?M:Q==="damages"?V:k).saveContent(ge,Q);const $=setTimeout(async()=>{await r({userId:(e==null?void 0:e.uid)||"",userName:(n==null?void 0:n.displayName)||(e==null?void 0:e.email)||"Unknown",type:"insert",section:Q,description:`Edited ${Q} section`,content:ge.substring(0,200)})},3e3);return()=>clearTimeout($)},D=()=>{switch(S){case"facts":return N;case"liability":return M;case"damages":return V;case"demand":return k}},A=Q=>{switch(Q){case"facts":return"Statement of Facts";case"liability":return"Liability";case"damages":return"Damages";case"demand":return"Demand";default:return Q}},Z=async()=>{var Q,ge,Re,$;if(!(!s||!o))try{const X=await _S.exportDraft({draftId:s.draftId,matterId:s.matterId,content:{facts:((Q=s.sections.facts)==null?void 0:Q.content)||"",liability:((ge=s.sections.liability)==null?void 0:ge.content)||"",damages:((Re=s.sections.damages)==null?void 0:Re.content)||"",demand:(($=s.sections.demand)==null?void 0:$.content)||""},options:{matterTitle:o.title,clientName:o.clientName,includeHeader:!0,includeFooter:!0}});_S.downloadFile(X.downloadUrl,`${o.title}-${s.draftId.slice(0,8)}.docx`)}catch(X){alert(`Failed to export: ${X.message}`)}};return l?p.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:p.jsxs("div",{className:"text-center",children:[p.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),p.jsx("p",{className:"mt-2 text-gray-600",children:"Loading draft..."})]})}):d||!s?p.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:p.jsxs("div",{className:"text-center",children:[p.jsx("p",{className:"text-red-600 mb-4",children:d||"Draft not found"}),p.jsx(Bn,{to:"/dashboard",className:"text-blue-600 hover:text-blue-700 underline",children:"Back to Dashboard"})]})}):p.jsxs("div",{className:"min-h-screen bg-gray-50",children:[p.jsx("header",{className:"bg-white shadow",children:p.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{className:"flex items-center gap-4",children:[p.jsx(Bn,{to:`/matters/${s.matterId}`,className:"text-gray-600 hover:text-gray-900",children:" Back to Matter"}),p.jsx("div",{className:"h-6 w-px bg-gray-300"}),p.jsxs("div",{children:[p.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Draft Editor"}),o&&p.jsxs("p",{className:"text-sm text-gray-600",children:[o.title,"  ",o.clientName]})]})]}),p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx(M5,{}),p.jsx("span",{className:"text-sm text-gray-500",children:D().getSaveStatus()}),p.jsx("button",{onClick:Z,disabled:!s||s.state==="generating",className:"px-3 py-1 text-xs font-medium text-white bg-green-600 rounded hover:bg-green-700 disabled:opacity-50",children:" Export DOCX"}),p.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${s.state==="generating"?"bg-yellow-100 text-yellow-800":s.state==="editing"?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"}`,children:s.state})]})]})})}),p.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:p.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[p.jsx("div",{className:"lg:col-span-1",children:p.jsxs("div",{className:"bg-white rounded-lg shadow p-4 sticky top-4",children:[p.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-3",children:"Sections"}),p.jsx("nav",{className:"space-y-1",children:["facts","liability","damages","demand"].map(Q=>p.jsx("button",{onClick:()=>b(Q),className:`w-full text-left px-3 py-2 text-sm rounded-md transition-colors ${S===Q?"bg-blue-50 text-blue-700 font-medium":"text-gray-700 hover:bg-gray-50"}`,children:A(Q)},Q))})]})}),p.jsx("div",{className:"lg:col-span-2",children:["facts","liability","damages","demand"].map(Q=>{const ge=s.sections[Q],Re=f===Q;return S===Q?p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:A(Q)}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(U5,{draftId:t,section:Q,onCommentAdded:()=>{}}),p.jsx("button",{onClick:()=>I(Q),disabled:Re,className:"px-3 py-1 text-xs font-medium text-blue-600 hover:text-blue-700 hover:bg-blue-50 rounded disabled:opacity-50",children:Re?"Refining...":" Refine"})]})]}),Re?p.jsxs("div",{className:"text-center py-8 bg-white rounded-lg shadow",children:[p.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),p.jsx("p",{className:"mt-2 text-gray-600",children:"Refining section..."})]}):p.jsx(D5,{content:(ge==null?void 0:ge.content)||"",onChange:X=>P(Q,X),placeholder:`Start editing ${A(Q).toLowerCase()}...`}),(ge==null?void 0:ge.generatedAt)&&p.jsxs("p",{className:"text-xs text-gray-500",children:["Generated: ",new Date(ge.generatedAt).toLocaleString()]})]},Q):null})}),p.jsx("div",{className:"lg:col-span-1",children:p.jsxs("div",{className:"bg-white rounded-lg shadow p-4 sticky top-4 space-y-6",children:[p.jsx(V5,{}),p.jsx("div",{className:"border-t border-gray-200 pt-6",children:p.jsx(F5,{draftId:t})})]})})]})}),p.jsx(pU,{isOpen:y,onClose:()=>v(!1),onRefine:C,initialSection:w})]})},z5=()=>{const{draftId:t}=Ly(),e=$r();return R.useEffect(()=>{if(!t){e("/dashboard");return}},[t,e]),t?p.jsx(O5,{draftId:t,children:p.jsx(B5,{draftId:t})}):null};function $5(){return p.jsx(F4,{children:p.jsx(j4,{children:p.jsxs(xD,{children:[p.jsx("a",{href:"#main-content",className:"skip-to-main",children:"Skip to main content"}),p.jsxs(pD,{children:[p.jsx(Dn,{path:"/login",element:p.jsx(Q4,{})}),p.jsx(Dn,{path:"/signup",element:p.jsx(Y4,{})}),p.jsx(Dn,{path:"/dashboard",element:p.jsx(io,{children:p.jsx(eU,{})})}),p.jsx(Dn,{path:"/matters/:matterId",element:p.jsx(io,{children:p.jsx(cU,{})})}),p.jsx(Dn,{path:"/templates",element:p.jsx(io,{children:p.jsx(hU,{})})}),p.jsx(Dn,{path:"/templates/new",element:p.jsx(io,{children:p.jsx(sE,{})})}),p.jsx(Dn,{path:"/templates/:templateId/edit",element:p.jsx(io,{children:p.jsx(sE,{})})}),p.jsx(Dn,{path:"/drafts/:draftId",element:p.jsx(io,{children:p.jsx(z5,{})})}),p.jsx(Dn,{path:"/",element:p.jsx(Bm,{to:"/dashboard",replace:!0})}),p.jsx(Dn,{path:"*",element:p.jsx(Bm,{to:"/dashboard",replace:!0})})]})]})})})}Kp.createRoot(document.getElementById("root")).render(p.jsx(dt.StrictMode,{children:p.jsx($5,{})}));
//# sourceMappingURL=index-CczooJVx.js.map
